!function(e){function t(t){for(var n,s,r=t[0],a=t[1],o=0,l=[];o<r.length;o++)s=r[o],i[s]&&l.push(i[s][0]),i[s]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(h&&h(t);l.length;)l.shift()()}var n={},i={main:0};function s(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise(function(t,s){n=i[e]=[t,s]});t.push(n[2]=r);var a,o=document.createElement("script");o.charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.src=function(e){return s.p+"rhodonite-"+({effekseer:"effekseer",pbr:"pbr",sparkgear:"sparkgear",webgl:"webgl"}[e]||e)+".min.js"}(e);var h=new Error;a=function(t){o.onerror=o.onload=null,clearTimeout(l);var n=i[e];if(0!==n){if(n){var s=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;h.message="Loading chunk "+e+" failed.\n("+s+": "+r+")",h.name="ChunkLoadError",h.type=s,h.request=r,n[1](h)}i[e]=void 0}};var l=setTimeout(function(){a({type:"timeout",target:o})},12e4);o.onerror=o.onload=a,document.head.appendChild(o)}return Promise.all(t)},s.m=e,s.c=n,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/dist/",s.oe=function(e){throw console.error(e),e};var r=window.webpackJsonp=window.webpackJsonp||[],a=r.push.bind(r);r.push=t,r=r.slice();for(var o=0;o<r.length;o++)t(r[o]);var h=a;s(s.s=75)}([function(e,t,n){"use strict";n.d(t,"a",function(){return b});var i=n(6),s=n(1);class r extends i.a{constructor({index:e,str:t,glslStr:n,hlslStr:i,numberOfComponents:s}){super({index:e,str:t}),this.__numberOfComponents=0,this.__numberOfComponents=s,this.__glslStr=n,this.__hlslStr=i}getNumberOfComponents(){return this.__numberOfComponents}getGlslStr(e){return e===s.a.Float||e===s.a.Double||this===b.Texture2D||this===b.TextureCube?this.__glslStr:e===s.a.Byte||e===s.a.Short||e===s.a.Int?this===b.Scalar?"int":"i"+this.__glslStr:e===s.a.Bool?"bool":"unknown"}}const a=new r({index:-1,str:"UNKNOWN",glslStr:"unknown",hlslStr:"unknown",numberOfComponents:0}),o=new r({index:0,str:"SCALAR",glslStr:"float",hlslStr:"float",numberOfComponents:1}),h=new r({index:1,str:"VEC2",glslStr:"vec2",hlslStr:"float2",numberOfComponents:2}),l=new r({index:2,str:"VEC3",glslStr:"vec3",hlslStr:"float3",numberOfComponents:3}),c=new r({index:3,str:"VEC4",glslStr:"vec4",hlslStr:"float4",numberOfComponents:4}),u=new r({index:4,str:"MAT2",glslStr:"mat2",hlslStr:"float2x2",numberOfComponents:4}),_=new r({index:5,str:"MAT3",glslStr:"mat3",hlslStr:"float3x3",numberOfComponents:9}),m=new r({index:6,str:"MAT4",glslStr:"mat4",hlslStr:"float4x4",numberOfComponents:16}),d=new r({index:7,str:"TEXTURE_2D",glslStr:"sampler2D",hlslStr:"Texture2D",numberOfComponents:1}),f=new r({index:8,str:"TEXTURE_CUBE_MAP",glslStr:"samplerCube",hlslStr:"TextureCube",numberOfComponents:1}),p=new r({index:9,str:"SCALAR_ARRAY",glslStr:"float",hlslStr:"float",numberOfComponents:1}),g=new r({index:10,str:"VEC2_ARRAY",glslStr:"vec2",hlslStr:"float2",numberOfComponents:2}),v=new r({index:11,str:"VEC3_ARRAY",glslStr:"vec3",hlslStr:"float3",numberOfComponents:3}),x=new r({index:12,str:"VEC4_ARRAY",glslStr:"vec4",hlslStr:"float4",numberOfComponents:4}),y=[a,o,h,l,c,u,_,m,d,f,p,g,v,x];const b=Object.freeze({Unknown:a,Scalar:o,Vec2:h,Vec3:l,Vec4:c,Mat2:u,Mat3:_,Mat4:m,Texture2D:d,TextureCube:f,ScalarArray:p,Vec2Array:g,Vec3Array:v,Vec4Array:x,from:function(e){return Object(i.b)({typeList:y,index:e})},fromString:function(e){return Object(i.c)({typeList:y,str:e})},isArray:function(e){return e===p||e===g||e===v||e===x}})},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var i=n(6);class s extends i.a{constructor({index:e,str:t,sizeInBytes:n}){super({index:e,str:t}),this.__sizeInBytes=n}getSizeInBytes(){return this.__sizeInBytes}}const r=new s({index:5119,str:"UNKNOWN",sizeInBytes:0}),a=new s({index:5120,str:"BYTE",sizeInBytes:1}),o=new s({index:5121,str:"UNSIGNED_BYTE",sizeInBytes:1}),h=new s({index:5122,str:"SHORT",sizeInBytes:2}),l=new s({index:5123,str:"UNSIGNED_SHORT",sizeInBytes:2}),c=new s({index:5124,str:"INT",sizeInBytes:4}),u=new s({index:5125,str:"UNSIGNED_INT",sizeInBytes:4}),_=new s({index:5126,str:"FLOAT",sizeInBytes:4}),m=new s({index:5127,str:"DOUBLE",sizeInBytes:8}),d=new s({index:35670,str:"BOOL",sizeInBytes:1}),f=new s({index:36193,str:"HALF_FLOAT_OES",sizeInBytes:2}),p=[r,a,o,h,l,c,u,_,m,f];const g=Object.freeze({Unknown:r,Byte:a,UnsignedByte:o,Short:h,UnsignedShort:l,Int:c,UnsingedInt:u,Float:_,Double:m,Bool:d,HalfFloat:f,from:function(e){return Object(i.b)({typeList:p,index:e})},fromTypedArray:function(e){return e instanceof Int8Array?a:e instanceof Uint8Array||e instanceof Uint8ClampedArray?o:e instanceof Int16Array?h:e instanceof Uint16Array?l:e instanceof Int32Array?c:e instanceof Uint32Array?u:e instanceof Float32Array?_:e instanceof Float64Array?m:r}})},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var i=n(63),s=n(0);class r{constructor(e,t,n,{type:s}){ArrayBuffer.isView(e)?this.v=e:null!=e?(this.v=new s(3),i.a.not.exist(e)?(this.v[0]=0,this.v[1]=0,this.v[2]=0):Array.isArray(e)?(this.v[0]=e[0],this.v[1]=e[1],this.v[2]=e[2]):void 0!==e.w?(this.v[0]=e.v[0],this.v[1]=e.v[1],this.v[2]=e.v[2]):void 0!==e.z?(this.v[0]=e.v[0],this.v[1]=e.v[1],this.v[2]=e.v[2]):void 0!==e.y?(this.v[0]=e.v[0],this.v[1]=e.v[1],this.v[2]=0):(this.v[0]=e,this.v[1]=t,this.v[2]=n)):this.v=new s(0)}get className(){return this.constructor.name}static get compositionType(){return s.a.Vec3}isStrictEqual(e){return this.v[0]===e.v[0]&&this.v[1]===e.v[1]&&this.v[2]===e.v[2]}isEqual(e,t=Number.EPSILON){return Math.abs(e.v[0]-this.v[0])<t&&Math.abs(e.v[1]-this.v[1])<t&&Math.abs(e.v[2]-this.v[2])<t}isDummy(){return 0===this.v.length}length(){return Math.sqrt(this.v[0]*this.v[0]+this.v[1]*this.v[1]+this.v[2]*this.v[2])}copyComponents(e){this.v[0]=e.v[0],this.v[1]=e.v[1],this.v[2]=e.v[2]}static lengthSquared(e){return e.v[0]*e.v[0]+e.v[1]*e.v[1]+e.v[2]*e.v[2]}lengthTo(e){var t=e.v[0]-this.v[0],n=e.v[1]-this.v[1],i=e.v[2]-this.v[2];return Math.sqrt(t*t+n*n+i*i)}static lengthBtw(e,t){var n=t.v[0]-e.v[0],i=t.v[1]-e.v[1],s=t.v[2]-e.v[2];return Math.sqrt(n*n+i*i+s*s)}dotProduct(e){return this.v[0]*e.v[0]+this.v[1]*e.v[1]+this.v[2]*e.v[2]}static dotProduct(e,t){return e.v[0]*t.v[0]+e.v[1]*t.v[1]+e.v[2]*t.v[2]}static cross(e,t){var n=e.v[1]*t.v[2]-e.v[2]*t.v[1],i=e.v[2]*t.v[0]-e.v[0]*t.v[2],s=e.v[0]*t.v[1]-e.v[1]*t.v[0];return new e.constructor(n,i,s)}static normalize(e){var t=e.length(),n=new e.constructor(e.v[0],e.v[1],e.v[2]);return n=r.divide(n,t)}static add(e,t){return new e.constructor(e.v[0]+t.v[0],e.v[1]+t.v[1],e.v[2]+t.v[2])}static subtract(e,t){return new e.constructor(e.v[0]-t.v[0],e.v[1]-t.v[1],e.v[2]-t.v[2])}static divide(e,t){return 0!==t?new e.constructor(e.v[0]/t,e.v[1]/t,e.v[2]/t):(console.error("0 division occured!"),new e.constructor(1/0,1/0,1/0))}static multiply(e,t){return new e.constructor(e.v[0]*t,e.v[1]*t,e.v[2]*t)}static multiplyVector(e,t){return new e.constructor(e.v[0]*t.v[0],e.v[1]*t.v[1],e.v[2]*t.v[2])}static angleOfVectors(e,t){let n=r.dotProduct(e,t)/(e.length()*t.length());return Math.acos(n)}static divideVector(e,t){return new e.constructor(e.v[0]/t.v[0],e.v[1]/t.v[1],e.v[2]/t.v[2])}toString(){return"("+this.v[0]+", "+this.v[1]+", "+this.v[2]+")"}get x(){return this.v[0]}get y(){return this.v[1]}get z(){return this.v[2]}get w(){return 1}get raw(){return this.v}}class a extends r{constructor(e,t,n){super(e,t,n,{type:Float32Array})}static zero(){return new a(0,0,0)}static one(){return new a(1,1,1)}static dummy(){return new a(null,0,0)}clone(){return new a(this.v[0],this.v[1],this.v[2])}}},function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return se});var i=n(6),s=n(0);class r extends i.a{constructor({str:e}){super({index:++r.__indexCount*r._scale,str:e,noCheckStrUnique:!0}),r.__classes[this.index]=this}static getShaderSemanticByIndex(e){return this.__classes[Math.abs(e)-Math.abs(e)%this._scale]}static isNonArrayShaderSemanticIndex(e){return e>=this._scale}static isArrayAndZeroIndexShaderSemanticIndex(e){return e<0&&Math.abs(e)%r._scale==0}static isArrayAndNonZeroIndexShaderSemanticIndex(e){return e<0&&Math.abs(e)%r._scale!=0}}r.__indexCount=-1,r._scale=1e4,r.__classes=[];const a=new r({str:"worldMatrix"}),o=new r({str:"viewMatrix"}),h=new r({str:"projectionMatrix"}),l=new r({str:"normalMatrix"}),c=new r({str:"boneMatrix"}),u=new r({str:"baseColorFactor"}),_=new r({str:"baseColorTexture"}),m=new r({str:"normalTexture"}),d=new r({str:"metallicRoughnessTexture"}),f=new r({str:"occlusionTexture"}),p=new r({str:"emissiveTexture"}),g=new r({str:"lightNumber"}),v=new r({str:"lightPosition"}),x=new r({str:"lightDirection"}),y=new r({str:"lightIntensity"}),b=new r({str:"metallicRoughnessFactor"}),A=new r({str:"brdfLutTexture"}),T=new r({str:"diffuseEnvTexture"}),w=new r({str:"specularEnvTexture"}),S=new r({str:"iblParameter"}),I=new r({str:"viewPosition"}),E=new r({str:"wireframe"}),F=new r({str:"diffuseColorFactor"}),C=new r({str:"diffuseColorTexture"}),P=new r({str:"specularColorFactor"}),M=new r({str:"specularColorTexture"}),N=new r({str:"shininess"}),L=new r({str:"shadingModel"}),R=new r({str:"skinningMode"}),D=new r({str:"generalTexture"}),V=new r({str:"vertexAttributesExistenceArray"}),B=new r({str:"boneQuaternion"}),U=new r({str:"boneTranslateScale"}),O=new r({str:"boneCompressedChank"}),z=new r({str:"boneCompressedInfo"}),G=new r({str:"pointSize"}),X=new r({str:"colorEnvTexture"}),k=new r({str:"pointDistanceAttenuation"}),W=new r({str:"hdriFormat"}),Y=new r({str:"screenInfo"}),$=new r({str:"depthTexture"}),j=new r({str:"lightViewProjectionMatrix"}),Q=new r({str:"anisotropy"}),q=new r({str:"clearcoatParameter"}),H=new r({str:"sheenParameter"}),Z=new r({str:"specularGlossinessFactor"}),J=new r({str:"specularGlossinessTexture"}),K=new r({str:"entityUID"}),ee=new r({str:"morphTargetNumber"}),te=new r({str:"dataTextureMorphOffsetPosition"}),ne=new r({str:"morphWeights"}),ie=[a,o,h,l,c,u,_,m,d,f,p,g,v,x,y,b,A,T,w,S,I,E,F,C,P,M,N,L,R,D,V,B,U,O,z,G,X,k,W,Y,$,j,Q,q,H,Z,J,K,ee,te,ne];const se=Object.freeze({WorldMatrix:a,ViewMatrix:o,ProjectionMatrix:h,NormalMatrix:l,BoneMatrix:c,BaseColorFactor:u,BaseColorTexture:_,NormalTexture:m,MetallicRoughnessTexture:d,OcclusionTexture:f,EmissiveTexture:p,LightNumber:g,LightPosition:v,LightDirection:x,LightIntensity:y,MetallicRoughnessFactor:b,BrdfLutTexture:A,DiffuseEnvTexture:T,SpecularEnvTexture:w,IBLParameter:S,ViewPosition:I,Wireframe:E,DiffuseColorFactor:F,DiffuseColorTexture:C,SpecularColorFactor:P,SpecularColorTexture:M,Shininess:N,ShadingModel:L,SkinningMode:R,GeneralTexture:D,VertexAttributesExistenceArray:V,BoneQuaternion:B,BoneTranslateScale:U,BoneCompressedChank:O,BoneCompressedInfo:z,PointSize:G,ColorEnvTexture:X,PointDistanceAttenuation:k,HDRIFormat:W,ScreenInfo:Y,DepthTexture:$,LightViewProjectionMatrix:j,Anisotropy:Q,ClearCoatParameter:q,SheenParameter:H,SpecularGlossinessFactor:Z,SpecularGlossinessTexture:J,from:function(e){return Object(i.b)({typeList:ie,index:e})},fromString:function(e){return Object(i.c)({typeList:ie,str:e})},fullSemanticStr:function(e){let t="";return null!=e.prefix&&(t=e.prefix),t+e.semantic.str},getShaderProperty:(e,t,n)=>{if(t.isComponentData)return"";const i=t.compositionType.getGlslStr(t.componentType);let a=se.fullSemanticStr(t);const o=t.compositionType.getGlslStr(t.componentType);let h="";t.maxIndex&&(h=`[${t.maxIndex}]`);let l=`  uniform ${o} u_${a}${h};\n`,c="";if(n<0||s.a.isArray(t.compositionType)){if(Math.abs(n)%r._scale!=0&&!s.a.isArray(t.compositionType))return"";a.match(/\[.+?\]/)?a=a.replace(/\[.+?\]/g,"[i]"):a+="[i]",c+=`\n    ${i} val;\n    for (int i=0; i<${t.maxIndex}; i++) {\n      if (i == index) {\n        val = u_${a};\n        break;\n      }\n    }\n    return val;\n    `}else c+=`return u_${a};`;let u="";return t.compositionType===s.a.Texture2D||t.compositionType===s.a.TextureCube||(u=`\n  ${i} get_${t.semantic.str}(float instanceId, int index) {\n    ${c}\n  }\n`),`${l}${u}`},EntityUID:K,MorphTargetNumber:ee,DataTextureMorphOffsetPosition:te,MorphWeights:ne})},function(e,t,n){"use strict";n.d(t,"b",function(){return s}),n.d(t,"a",function(){return v});var i=n(6);class s extends i.a{constructor({index:e,str:t,shaderStr:n,attributeSlot:i}){super({index:e,str:t}),this.__attributeSlot=i,this.__shaderStr=n}getAttributeSlot(){return this.__attributeSlot}get shaderStr(){return this.__shaderStr}}const r=new s({index:-1,str:"UNKNOWN",shaderStr:"a_unknown",attributeSlot:-1}),a=new s({index:0,str:"POSITION",shaderStr:"a_position",attributeSlot:0}),o=new s({index:1,str:"NORMAL",shaderStr:"a_normal",attributeSlot:1}),h=new s({index:2,str:"TANGENT",shaderStr:"a_tangent",attributeSlot:2}),l=new s({index:3,str:"TEXCOORD_0",shaderStr:"a_texcoord_0",attributeSlot:3}),c=new s({index:4,str:"TEXCOORD_1",shaderStr:"a_texcoord_1",attributeSlot:4}),u=new s({index:5,str:"COLOR_0",shaderStr:"a_color_0",attributeSlot:5}),_=new s({index:6,str:"JOINTS_0",shaderStr:"a_joints_0",attributeSlot:6}),m=new s({index:7,str:"WEIGHTS_0",shaderStr:"a_weights_0",attributeSlot:7}),d=new s({index:8,str:"INSTANCE",shaderStr:"a_instance",attributeSlot:8}),f=new s({index:9,str:"FACE_NORMAL",shaderStr:"a_faceNormal",attributeSlot:9}),p=new s({index:10,str:"BARY_CENTRIC_COORD",shaderStr:"a_baryCentricCoord",attributeSlot:10}),g=[r,a,o,h,l,c,u,_,m,d,f,p];const v=Object.freeze({Unknown:r,Position:a,Normal:o,Tangent:h,Texcoord0:l,Texcoord1:c,Color0:u,Joints0:_,Weights0:m,Instance:d,FaceNormal:f,BaryCentricCoord:p,AttributeTypeNumber:11,from:function(e){return Object(i.b)({typeList:g,index:e})},fromString:function(e){let t=e;return"COLOR"===e?t="COLOR_0":"TEXCOORD"===e?t="TEXCOORD_0":"JOINTS"===e?t="JOINTS_0":"WEIGHTS"===e&&(t="WEIGHTS_0"),Object(i.c)({typeList:g,str:t})}})},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:1,str:"VertexShader"}),a=new s({index:2,str:"PixelShader"}),o=new s({index:3,str:"VertexAndPixelShader"}),h=new s({index:4,str:"ComputeShader"}),l=[r,a,o,h];const c=Object.freeze({VertexShader:r,PixelShader:a,VertexAndPixelShader:o,ComputeShader:h,from:function(e){return Object(i.b)({typeList:l,index:e})},fromString:function(e){return Object(i.c)({typeList:l,str:e})}})},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return s}),n.d(t,"c",function(){return r});class i{constructor({index:e,str:t,noCheckStrUnique:n}){if(null==i.__indices.get(this.constructor)&&i.__indices.set(this.constructor,[]),null==i.__strings.get(this.constructor)&&i.__strings.set(this.constructor,[]),-1!==i.__indices.get(this.constructor).indexOf(e))throw new Error("Dont use duplicate index.");if(!0!==n&&-1!==i.__strings.get(this.constructor).indexOf(t))throw new Error("Dont use duplicate str.");this.index=e,this.str=t,i.__indices.get(this.constructor).push(e),i.__strings.get(this.constructor).push(t)}toString(){return this.str}toJSON(){return this.index}}function s({typeList:e,index:t}){const n=e.find(e=>e.index===t);if(!n)throw new Error(`Invalid index: [${t}]`);return n}function r({typeList:e,str:t}){const n=e.find(e=>e.str.toLowerCase()===t.toLowerCase());if(!n)throw new Error(`Invalid str: [${t}]`);return n}i.__indices=new Map,i.__strings=new Map},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:0,str:"FirstTimeOnly"}),a=new s({index:1,str:"EveryTime"}),o=new s({index:2,str:"RenderPass"}),h=[r,a,o];const l=Object.freeze({FirstTimeOnly:r,EveryTime:a,RenderPass:o,from:function(e){return Object(i.b)({typeList:h,index:e})},fromString:function(e){return Object(i.c)({typeList:h,str:e})}})},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return r});var i=n(0);class s{constructor(e,t,n,i,{type:s}){ArrayBuffer.isView(e)?this.v=e:null!=e?(this.v=new s(4),Array.isArray(e)?(this.v[0]=e[0],this.v[1]=e[1],this.v[2]=e[2],this.v[3]=e[3]):void 0!==e.w?(this.v[0]=e.v[0],this.v[1]=e.v[1],this.v[2]=e.v[2],this.v[3]=e.v[3]):void 0!==e.z?(this.v[0]=e.v[0],this.v[1]=e.v[1],this.v[2]=e.v[2],this.v[3]=1):void 0!==e.y?(this.v[0]=e.v[0],this.v[1]=e.v[1],this.v[2]=0,this.v[3]=1):(this.v[0]=e,this.v[1]=t,this.v[2]=n,this.v[3]=i)):this.v=new s(0)}get className(){return this.constructor.name}static get compositionType(){return i.a.Vec4}isDummy(){return 0===this.v.length}isStrictEqual(e){return this.v[0]===e.v[0]&&this.v[1]===e.v[1]&&this.v[2]===e.v[2]&&this.v[3]===e.v[3]}isEqual(e,t=Number.EPSILON){return Math.abs(e.v[0]-this.v[0])<t&&Math.abs(e.v[1]-this.v[1])<t&&Math.abs(e.v[2]-this.v[2])<t&&Math.abs(e.v[3]-this.v[3])<t}clone(){return new this.constructor(this.v[0],this.v[1],this.v[2],this.v[3])}static zero(){return new this(0,0,0,1)}length(){return Math.sqrt(this.v[0]*this.v[0]+this.v[1]*this.v[1]+this.v[2]*this.v[2]+this.v[3]*this.v[3])}copyComponents(e){this.v[0]=e.v[0],this.v[1]=e.v[1],this.v[2]=e.v[2],this.v[3]=e.v[3]}static add(e,t){return new e.constructor(e.v[0]+t.v[0],e.v[1]+t.v[1],e.v[2]+t.v[2],e.v[2]+t.v[2])}static subtract(e,t){return new e.constructor(e.v[0]-t.v[0],e.v[1]-t.v[1],e.v[2]-t.v[2],e.v[3]-t.v[3])}static addWithOutW(e,t){return new e.constructor(e.v[0]+t.v[0],e.v[1]+t.v[1],e.v[2]+t.v[2],e.v[2])}static multiply(e,t){return new e.constructor(e.v[0]*t,e.v[1]*t,e.v[2]*t,e.v[3]*t)}static multiplyVector(e,t){return new e.constructor(e.v[0]*t.v[0],e.v[1]*t.v[1],e.v[2]*t.v[2],e.v[3]*t.v[3])}static divide(e,t){return 0!==t?new e.constructor(e.v[0]/t,e.v[1]/t,e.v[2]/t,e.v[3]/t):(console.warn("0 division occured!"),new e.constructor(1/0,1/0,1/0,1/0))}static divideVector(e,t){return new e.constructor(e.v[0]/t.v[0],e.v[1]/t.v[1],e.v[2]/t.v[2],e.v[3]/t.v[3])}static normalize(e){const t=e.length();let n=new e.constructor(e.v[0],e.v[1],e.v[2],e.v[3]);return n=s.divide(n,t)}dotProduct(e){return this.v[0]*e.v[0]+this.v[1]*e.v[1]+this.v[2]*e.v[2]+this.v[3]*e.v[3]}static dotProduct(e,t){return e.v[0]*t.v[0]+e.v[1]*t.v[1]+e.v[2]*t.v[2]+e.v[3]*t.v[3]}toString(){return"("+this.v[0]+", "+this.v[1]+", "+this.v[2]+", "+this.v[3]+")"}get x(){return this.v[0]}get y(){return this.v[1]}get z(){return this.v[2]}get w(){return this.v[3]}}class r extends s{constructor(e,t,n,i){super(e,t,n,i,{type:Float32Array})}static zeroWithWOne(){return new r(0,0,0,1)}static zero(){return new r(0,0,0,0)}static one(){return new r(1,1,1,1)}static dummy(){return new r(null,0,0,0)}clone(){return new r(this.v[0],this.v[1],this.v[2],this.v[3])}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(48);class s{static getWebGLResourceRepository(){return i.a.getInstance().getModule("webgl").WebGLResourceRepository.getInstance()}}s.InvalidCGAPIResourceUid=-1},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(27),s=n(63),r=n(17);class a{constructor(){this.__component_sid_count_map=new Map,this.__components=new Map}static registerComponentClass(e){a.__componentClasses.set(e.componentTID,e)}static unregisterComponentClass(e){a.__componentClasses.delete(e)}static getInstance(){return this.__instance||(this.__instance=new a),this.__instance}static getComponentClass(e){return this.__componentClasses.get(e)}createComponent(e,t,n){const r=a.__componentClasses.get(e);if(null!=r){let a=this.__component_sid_count_map.get(e);s.a.exist(a)||(this.__component_sid_count_map.set(e,0),a=i.a.invalidComponentSID),this.__component_sid_count_map.set(e,++a);const o=new r(t,a,n);this.__components.has(e)||this.__components.set(e,[]);const h=this.__components.get(e);if(null!=h)return h[o.componentSID]=o,o}return null}getComponent(e,t){return this.getComponentFromComponentTID(e.componentTID,t)}getComponentFromComponentTID(e,t){const n=this.__components.get(e);if(null!=n){return null!=n[t]?n[t]:null}return null}_getComponents(e){return this.__components.get(e.componentTID)}static getMemoryBeginIndex(e){let t=0;for(let n=0;n<e;n++){const e=a.__componentClasses.get(n);if(null!=e){t+=e.sizeOfThisComponent*r.a.maxEntityNumber}}return t}getComponentsWithType(e){const t=this.__components.get(e.componentTID);return null==t?[]:t}getComponentTIDs(){const e=[];for(let t of this.__components.keys())e.push(t);return e.sort(function(e,t){return e<t?-1:e>t?1:0}),e}}a.__componentClasses=new Map},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:0,str:"GPUInstanceData"}),a=new s({index:1,str:"GPUVertexData"}),o=new s({index:2,str:"UBOGeneric"}),h=new s({index:3,str:"CPUGeneric"}),l=[r,a,o,h];const c=Object.freeze({GPUInstanceData:r,GPUVertexData:a,UBOGeneric:o,CPUGeneric:h,from:function(e){return Object(i.b)({typeList:l,index:e})},fromString:function(e){return Object(i.c)({typeList:l,str:e})}})},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(18),s=n(0);Float32Array;class r extends i.a{constructor(e,t,n,i,s,r,a,o,h,l,c,u,_,m,d,f,p=!1,g=!1){const v=arguments.length>=16?p:t,x=arguments.length>=16?g:n;arguments.length>=16?super(e,t,n,i,s,r,a,o,h,l,c,u,_,m,d,f,v,x):super(e,v,x)}setComponents(e,t,n,i,s,r,a,o,h,l,c,u,_,m,d,f){return this.v[0]=e,this.v[4]=t,this.v[8]=n,this.v[12]=i,this.v[1]=s,this.v[5]=r,this.v[9]=a,this.v[13]=o,this.v[2]=h,this.v[6]=l,this.v[10]=c,this.v[14]=u,this.v[3]=_,this.v[7]=m,this.v[11]=d,this.v[15]=f,this}copyComponents(e){const t=e.v;this.v[0]=t[0],this.v[1]=t[1],this.v[2]=t[2],this.v[3]=t[3],this.v[4]=t[4],this.v[5]=t[5],this.v[6]=t[6],this.v[7]=t[7],this.v[8]=t[8],this.v[9]=t[9],this.v[10]=t[10],this.v[11]=t[11],this.v[12]=t[12],this.v[13]=t[13],this.v[14]=t[14],this.v[15]=t[15]}static get compositionType(){return s.a.Mat4}static dummy(){return new r(null)}static identity(){return new r(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}translate(e){return this.setComponents(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1)}putTranslate(e){this.m03=e.x,this.m13=e.y,this.m23=e.z}scale(e){return this.setComponents(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1)}addScale(e){return this.m00*=e.x,this.m11*=e.y,this.m22*=e.z,this}rotateX(e){var t=Math.cos(e),n=Math.sin(e);return this.setComponents(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1)}rotateY(e){var t=Math.cos(e),n=Math.sin(e);return this.setComponents(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1)}rotateZ(e){var t=Math.cos(e),n=Math.sin(e);return this.setComponents(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1)}rotateXYZ(e,t,n){var i=Math.cos(e),s=Math.sin(e),r=Math.cos(t),a=Math.sin(t),o=Math.cos(n),h=Math.sin(n);const l=o,c=-h,u=h,_=o,m=1*r,d=a*s,f=a*i,p=1*i,g=1*-s,v=1*-a,x=r*s,y=r*i;return this.v[0]=l*m,this.v[4]=l*d+c*p,this.v[8]=l*f+c*g,this.v[12]=0,this.v[1]=u*m,this.v[5]=u*d+_*p,this.v[9]=u*f+_*g,this.v[13]=0,this.v[2]=1*v,this.v[6]=1*x,this.v[10]=1*y,this.v[14]=0,this.v[3]=0,this.v[7]=0,this.v[11]=0,this.v[15]=1,this}identity(){return this.setComponents(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}_swap(e,t){this.v[t]=[this.v[e],this.v[e]=this.v[t]][0]}transpose(){return this._swap(1,4),this._swap(2,8),this._swap(3,12),this._swap(6,9),this._swap(7,13),this._swap(11,14),this}multiply(e){var t=this.m00*e.m00+this.m01*e.m10+this.m02*e.m20+this.m03*e.m30,n=this.m00*e.m01+this.m01*e.m11+this.m02*e.m21+this.m03*e.m31,i=this.m00*e.m02+this.m01*e.m12+this.m02*e.m22+this.m03*e.m32,s=this.m00*e.m03+this.m01*e.m13+this.m02*e.m23+this.m03*e.m33,r=this.m10*e.m00+this.m11*e.m10+this.m12*e.m20+this.m13*e.m30,a=this.m10*e.m01+this.m11*e.m11+this.m12*e.m21+this.m13*e.m31,o=this.m10*e.m02+this.m11*e.m12+this.m12*e.m22+this.m13*e.m32,h=this.m10*e.m03+this.m11*e.m13+this.m12*e.m23+this.m13*e.m33,l=this.m20*e.m00+this.m21*e.m10+this.m22*e.m20+this.m23*e.m30,c=this.m20*e.m01+this.m21*e.m11+this.m22*e.m21+this.m23*e.m31,u=this.m20*e.m02+this.m21*e.m12+this.m22*e.m22+this.m23*e.m32,_=this.m20*e.m03+this.m21*e.m13+this.m22*e.m23+this.m23*e.m33,m=this.m30*e.m00+this.m31*e.m10+this.m32*e.m20+this.m33*e.m30,d=this.m30*e.m01+this.m31*e.m11+this.m32*e.m21+this.m33*e.m31,f=this.m30*e.m02+this.m31*e.m12+this.m32*e.m22+this.m33*e.m32,p=this.m30*e.m03+this.m31*e.m13+this.m32*e.m23+this.m33*e.m33;return this.setComponents(t,n,i,s,r,a,o,h,l,c,u,_,m,d,f,p)}multiplyByLeft(e){var t=e.m00*this.m00+e.m01*this.m10+e.m02*this.m20+e.m03*this.m30,n=e.m00*this.m01+e.m01*this.m11+e.m02*this.m21+e.m03*this.m31,i=e.m00*this.m02+e.m01*this.m12+e.m02*this.m22+e.m03*this.m32,s=e.m00*this.m03+e.m01*this.m13+e.m02*this.m23+e.m03*this.m33,r=e.m10*this.m00+e.m11*this.m10+e.m12*this.m20+e.m13*this.m30,a=e.m10*this.m01+e.m11*this.m11+e.m12*this.m21+e.m13*this.m31,o=e.m10*this.m02+e.m11*this.m12+e.m12*this.m22+e.m13*this.m32,h=e.m10*this.m03+e.m11*this.m13+e.m12*this.m23+e.m13*this.m33,l=e.m20*this.m00+e.m21*this.m10+e.m22*this.m20+e.m23*this.m30,c=e.m20*this.m01+e.m21*this.m11+e.m22*this.m21+e.m23*this.m31,u=e.m20*this.m02+e.m21*this.m12+e.m22*this.m22+e.m23*this.m32,_=e.m20*this.m03+e.m21*this.m13+e.m22*this.m23+e.m23*this.m33,m=e.m30*this.m00+e.m31*this.m10+e.m32*this.m20+e.m33*this.m30,d=e.m30*this.m01+e.m31*this.m11+e.m32*this.m21+e.m33*this.m31,f=e.m30*this.m02+e.m31*this.m12+e.m32*this.m22+e.m33*this.m32,p=e.m30*this.m03+e.m31*this.m13+e.m32*this.m23+e.m33*this.m33;return this.setComponents(t,n,i,s,r,a,o,h,l,c,u,_,m,d,f,p)}invert(){var e=this.determinant(),t=(this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m11*this.m23*this.m32-this.m12*this.m21*this.m33-this.m13*this.m22*this.m31)/e,n=(this.m01*this.m23*this.m32+this.m02*this.m21*this.m33+this.m03*this.m22*this.m31-this.m01*this.m22*this.m33-this.m02*this.m23*this.m31-this.m03*this.m21*this.m32)/e,i=(this.m01*this.m12*this.m33+this.m02*this.m13*this.m31+this.m03*this.m11*this.m32-this.m01*this.m13*this.m32-this.m02*this.m11*this.m33-this.m03*this.m12*this.m31)/e,s=(this.m01*this.m13*this.m22+this.m02*this.m11*this.m23+this.m03*this.m12*this.m21-this.m01*this.m12*this.m23-this.m02*this.m13*this.m21-this.m03*this.m11*this.m22)/e,r=(this.m10*this.m23*this.m32+this.m12*this.m20*this.m33+this.m13*this.m22*this.m30-this.m10*this.m22*this.m33-this.m12*this.m23*this.m30-this.m13*this.m20*this.m32)/e,a=(this.m00*this.m22*this.m33+this.m02*this.m23*this.m30+this.m03*this.m20*this.m32-this.m00*this.m23*this.m32-this.m02*this.m20*this.m33-this.m03*this.m22*this.m30)/e,o=(this.m00*this.m13*this.m32+this.m02*this.m10*this.m33+this.m03*this.m12*this.m30-this.m00*this.m12*this.m33-this.m02*this.m13*this.m30-this.m03*this.m10*this.m32)/e,h=(this.m00*this.m12*this.m23+this.m02*this.m13*this.m20+this.m03*this.m10*this.m22-this.m00*this.m13*this.m22-this.m02*this.m10*this.m23-this.m03*this.m12*this.m20)/e,l=(this.m10*this.m21*this.m33+this.m11*this.m23*this.m30+this.m13*this.m20*this.m31-this.m10*this.m23*this.m31-this.m11*this.m20*this.m33-this.m13*this.m21*this.m30)/e,c=(this.m00*this.m23*this.m31+this.m01*this.m20*this.m33+this.m03*this.m21*this.m30-this.m00*this.m21*this.m33-this.m01*this.m23*this.m30-this.m03*this.m20*this.m31)/e,u=(this.m00*this.m11*this.m33+this.m01*this.m13*this.m30+this.m03*this.m10*this.m31-this.m00*this.m13*this.m31-this.m01*this.m10*this.m33-this.m03*this.m11*this.m30)/e,_=(this.m00*this.m13*this.m21+this.m01*this.m10*this.m23+this.m03*this.m11*this.m20-this.m00*this.m11*this.m23-this.m01*this.m13*this.m20-this.m03*this.m10*this.m21)/e,m=(this.m10*this.m22*this.m31+this.m11*this.m20*this.m32+this.m12*this.m21*this.m30-this.m10*this.m21*this.m32-this.m11*this.m22*this.m30-this.m12*this.m20*this.m31)/e,d=(this.m00*this.m21*this.m32+this.m01*this.m22*this.m30+this.m02*this.m20*this.m31-this.m00*this.m22*this.m31-this.m01*this.m20*this.m32-this.m02*this.m21*this.m30)/e,f=(this.m00*this.m12*this.m31+this.m01*this.m10*this.m32+this.m02*this.m11*this.m30-this.m00*this.m11*this.m32-this.m01*this.m12*this.m30-this.m02*this.m10*this.m31)/e,p=(this.m00*this.m11*this.m22+this.m01*this.m12*this.m20+this.m02*this.m10*this.m21-this.m00*this.m12*this.m21-this.m01*this.m10*this.m22-this.m02*this.m11*this.m20)/e;return this.setComponents(t,n,i,s,r,a,o,h,l,c,u,_,m,d,f,p)}static multiply(e,t){var n=e.m00*t.m00+e.m01*t.m10+e.m02*t.m20+e.m03*t.m30,i=e.m10*t.m00+e.m11*t.m10+e.m12*t.m20+e.m13*t.m30,s=e.m20*t.m00+e.m21*t.m10+e.m22*t.m20+e.m23*t.m30,a=e.m30*t.m00+e.m31*t.m10+e.m32*t.m20+e.m33*t.m30,o=e.m00*t.m01+e.m01*t.m11+e.m02*t.m21+e.m03*t.m31,h=e.m10*t.m01+e.m11*t.m11+e.m12*t.m21+e.m13*t.m31,l=e.m20*t.m01+e.m21*t.m11+e.m22*t.m21+e.m23*t.m31,c=e.m30*t.m01+e.m31*t.m11+e.m32*t.m21+e.m33*t.m31,u=e.m00*t.m02+e.m01*t.m12+e.m02*t.m22+e.m03*t.m32,_=e.m10*t.m02+e.m11*t.m12+e.m12*t.m22+e.m13*t.m32,m=e.m20*t.m02+e.m21*t.m12+e.m22*t.m22+e.m23*t.m32,d=e.m30*t.m02+e.m31*t.m12+e.m32*t.m22+e.m33*t.m32,f=e.m00*t.m03+e.m01*t.m13+e.m02*t.m23+e.m03*t.m33,p=e.m10*t.m03+e.m11*t.m13+e.m12*t.m23+e.m13*t.m33,g=e.m20*t.m03+e.m21*t.m13+e.m22*t.m23+e.m23*t.m33,v=e.m30*t.m03+e.m31*t.m13+e.m32*t.m23+e.m33*t.m33;return new r(n,o,u,f,i,h,_,p,s,l,m,g,a,c,d,v)}zero(){return this.setComponents(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this}static zero(){return new r(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}set m00(e){this.v[0]=e}get m00(){return this.v[0]}set m10(e){this.v[1]=e}get m10(){return this.v[1]}set m20(e){this.v[2]=e}get m20(){return this.v[2]}set m30(e){this.v[3]=e}get m30(){return this.v[3]}set m01(e){this.v[4]=e}get m01(){return this.v[4]}set m11(e){this.v[5]=e}get m11(){return this.v[5]}set m21(e){this.v[6]=e}get m21(){return this.v[6]}set m31(e){this.v[7]=e}get m31(){return this.v[7]}set m02(e){this.v[8]=e}get m02(){return this.v[8]}set m12(e){this.v[9]=e}get m12(){return this.v[9]}set m22(e){this.v[10]=e}get m22(){return this.v[10]}set m32(e){this.v[11]=e}get m32(){return this.v[11]}set m03(e){this.v[12]=e}get m03(){return this.v[12]}set m13(e){this.v[13]=e}get m13(){return this.v[13]}set m23(e){this.v[14]=e}get m23(){return this.v[14]}set m33(e){this.v[15]=e}get m33(){return this.v[15]}}},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var i=n(6);class s extends i.a{constructor({index:e,str:t,methodName:n}){super({index:e,str:t}),this.methodName=n}}const r=new s({index:-1,str:"UNKNOWN",methodName:"$unknown"}),a=new s({index:0,str:"CREATE",methodName:"$create"}),o=new s({index:1,str:"LOAD",methodName:"$load"}),h=new s({index:2,str:"MOUNT",methodName:"$mount"}),l=new s({index:3,str:"LOGIC",methodName:"$logic"}),c=new s({index:4,str:"PRE_RENDER",methodName:"$prerender"}),u=new s({index:5,str:"RENDER",methodName:"$render"}),_=new s({index:6,str:"UNMOUNT",methodName:"$unmount"}),m=new s({index:7,str:"DISCARD",methodName:"$discard"}),d=[r,a,o,h,l,c,u,_,m];const f=Object.freeze({Unknown:r,Create:a,Load:o,Mount:h,Logic:l,PreRender:c,Render:u,Unmount:_,Discard:m,from:function(e){return Object(i.b)({typeList:d,index:e})}})},function(e,t,n){"use strict";var i=n(10),s=n(27),r=n(30),a=n(2),o=n(47),h=n(18),l=n(31),c=n(11),u=n(1),_=n(12),m=n(13),d=n(21),f=n(58),p=n(15),g=n(32);class v{constructor(){this.top=d.a.zero(),this.bottom=d.a.zero(),this.right=d.a.zero(),this.left=d.a.zero(),this.zNear=d.a.zero(),this.zFar=d.a.zero(),this.__updated=!1,this.__vp=_.a.zero()}update(e,t){h.a.multiplyTo(t,e,this.__vp),this.zNear.x=this.__vp.m20+this.__vp.m30,this.zNear.y=this.__vp.m21+this.__vp.m31,this.zNear.z=this.__vp.m22+this.__vp.m32,this.zNear.w=this.__vp.m23+this.__vp.m33,this.zNear.normalize3(),this.zFar.x=-this.__vp.m20+this.__vp.m30,this.zFar.y=-this.__vp.m21+this.__vp.m31,this.zFar.z=-this.__vp.m22+this.__vp.m32,this.zFar.w=-this.__vp.m23+this.__vp.m33,this.zFar.normalize3(),this.bottom.x=this.__vp.m10+this.__vp.m30,this.bottom.y=this.__vp.m11+this.__vp.m31,this.bottom.z=this.__vp.m12+this.__vp.m32,this.bottom.w=this.__vp.m13+this.__vp.m33,this.bottom.normalize3(),this.top.x=-this.__vp.m10+this.__vp.m30,this.top.y=-this.__vp.m11+this.__vp.m31,this.top.z=-this.__vp.m12+this.__vp.m32,this.top.w=-this.__vp.m13+this.__vp.m33,this.top.normalize3(),this.left.x=this.__vp.m00+this.__vp.m30,this.left.y=this.__vp.m01+this.__vp.m31,this.left.z=this.__vp.m02+this.__vp.m32,this.left.w=this.__vp.m03+this.__vp.m33,this.left.normalize3(),this.right.x=-this.__vp.m00+this.__vp.m30,this.right.y=-this.__vp.m01+this.__vp.m31,this.right.z=-this.__vp.m02+this.__vp.m32,this.right.w=-this.__vp.m03+this.__vp.m33,this.right.normalize3()}clipping(e,t,n){const i=a.b.dotProduct(e,t)+e.w;return i+n<0?g.a.Invisible:i-n>0?g.a.Visible:g.a.Neutral}culling(e){const t=e.worldAABB,n=t.centerPoint,i=t.lengthCenterToCorner,s=this.clipping(this.right,n,i),r=this.clipping(this.left,n,i);if(s===g.a.Invisible&&r===g.a.Visible||s===g.a.Visible&&r===g.a.Invisible)return g.a.Invisible;const a=this.clipping(this.zNear,n,i),o=this.clipping(this.zFar,n,i);if(a===g.a.Invisible&&o===g.a.Visible||a===g.a.Visible&&o===g.a.Invisible)return g.a.Invisible;const h=this.clipping(this.top,n,i),l=this.clipping(this.bottom,n,i);return h===g.a.Invisible&&l===g.a.Visible||h===g.a.Visible&&l===g.a.Invisible?g.a.Invisible:6===h.index+l.index+s.index+r.index+a.index+o.index?g.a.Visible:g.a.Neutral}}var x=n(17);n.d(t,"a",function(){return y});class y extends s.a{constructor(e,t,n){super(e,t,n),this._eye=a.b.zero(),this._eyeInner=a.b.dummy(),this._direction=a.b.dummy(),this._directionInner=a.b.dummy(),this._up=a.b.dummy(),this._upInner=a.b.dummy(),this._corner=d.a.dummy(),this._cornerInner=d.a.dummy(),this._parameters=d.a.dummy(),this._parametersInner=d.a.dummy(),this.__type=o.a.Perspective,this._projectionMatrix=_.a.dummy(),this._viewMatrix=_.a.dummy(),this._tmp_f=a.b.dummy(),this._tmp_s=a.b.dummy(),this._tmp_u=a.b.dummy(),this.__frustum=new v,this.maxNumberOfComponent=Math.max(10,Math.floor(x.a.maxEntityNumber/100)),this.registerMember(c.a.CPUGeneric,"eyeInner",a.b,u.a.Float,[0,0,0]),this.registerMember(c.a.CPUGeneric,"direction",a.b,u.a.Float,[0,0,-1]),this.registerMember(c.a.CPUGeneric,"up",a.b,u.a.Float,[0,1,0]),this.registerMember(c.a.CPUGeneric,"directionInner",a.b,u.a.Float,[0,0,-1]),this.registerMember(c.a.CPUGeneric,"upInner",a.b,u.a.Float,[0,1,0]),this.registerMember(c.a.CPUGeneric,"corner",d.a,u.a.Float,[-1,1,1,-1]),this.registerMember(c.a.CPUGeneric,"cornerInner",d.a,u.a.Float,[-1,1,1,-1]),this.registerMember(c.a.CPUGeneric,"parameters",d.a,u.a.Float,[.1,1e4,90,1]),this.registerMember(c.a.CPUGeneric,"parametersInner",d.a,u.a.Float,[.1,1e4,90,1]),this.registerMember(c.a.CPUGeneric,"projectionMatrix",_.a,u.a.Float,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.registerMember(c.a.CPUGeneric,"viewMatrix",_.a,u.a.Float,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.registerMember(c.a.CPUGeneric,"tmp_f",a.b,u.a.Float,[0,0,0]),this.registerMember(c.a.CPUGeneric,"tmp_s",a.b,u.a.Float,[0,0,0]),this.registerMember(c.a.CPUGeneric,"tmp_u",a.b,u.a.Float,[0,0,0]),this.submitToAllocation(20),this.__sceneGraphComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,l.a),this.moveStageTo(m.a.PreRender),y.main=t}set type(e){this.__type=e,e===o.a.Orthographic?(this._parameters.z=1,this._parameters.w=1,this._parametersInner.z=1,this._parametersInner.w=1):(this._parameters.z=90,this._parameters.w=1,this._parametersInner.z=90,this._parametersInner.w=1)}get type(){return this.__type}get eye(){return a.b.zero()}get eyeInner(){return this._eyeInner}set eyeInner(e){this._eyeInner=e}set upInner(e){this._upInner.copyComponents(e)}set up(e){this._up.copyComponents(e)}get up(){return this._up.clone()}get upInner(){return this._upInner}set direction(e){const t=this._direction,n=e,i=this._up;let s;if(a.b.cross(n,i).isEqual(a.b.zero())){const e=a.b.cross(t,i);s=a.b.cross(e,n)}else{const e=a.b.multiply(n,n.dotProduct(i));s=a.b.subtract(i,e)}this._up=a.b.normalize(s),this._direction.copyComponents(n)}set directionInner(e){this._directionInner.copyComponents(e)}get direction(){return this._direction.clone()}get directionInner(){return this._directionInner}set corner(e){this._corner.copyComponents(e)}get corner(){return this._corner.clone()}set left(e){this._corner.x=e}set leftInner(e){this._cornerInner.x=e}get left(){return this._corner.x}set right(e){this._corner.y=e}set rightInner(e){this._cornerInner.y=e}get right(){return this._corner.y}set top(e){this._corner.z=e}set topInner(e){this._cornerInner.z=e}get top(){return this._corner.z}set bottom(e){this._corner.w=e}set bottomInner(e){this._cornerInner.w=e}get bottom(){return this._corner.w}set cornerInner(e){this._corner=new d.a(e)}get cornerInner(){return this._corner}set parameters(e){this._parameters.copyComponents(e)}set parametersInner(e){this._parametersInner.copyComponents(e)}get parameters(){return this._parameters.clone()}set zNear(e){this._parameters.x=e}set zNearInner(e){this._parametersInner.x=e}get zNearInner(){return this._parametersInner.x}get zNear(){return this._parameters.x}set zFar(e){this._parameters.y=e}set zFarInner(e){this._parametersInner.y=e}get zFarInner(){return this._parametersInner.y}get zFar(){return this._parameters.y}set fovy(e){this._parameters.z=e}get fovy(){return this._parameters.z}set fovyInner(e){this._parametersInner.z=e}set aspect(e){this._parameters.w=e}get aspect(){return this._parameters.w}set xmag(e){this._parameters.z=e}get xmag(){return this._parameters.z}set ymag(e){this._parameters.w=e}get ymag(){return this._parameters.w}static get componentTID(){return r.a.CameraComponentTID}$logic(){null==this.__entityRepository.getComponentOfEntity(this.__entityUid,f.a)?(this.eyeInner=this.eye,this.directionInner=this.direction,this.upInner=this.up,this.cornerInner=this.corner,this.parametersInner=this.parameters):this._parametersInner.w=this.parameters.w,this.moveStageTo(m.a.PreRender)}calcProjectionMatrix(){const e=this._parametersInner.x,t=this._parametersInner.y;if(this.type===o.a.Perspective){const s=this._parametersInner.z,r=this._parametersInner.w;var n=1/Math.tan(.5*s*Math.PI/180),i=n/r;this._projectionMatrix.setComponents(i,0,0,0,0,n,0,0,0,0,-(t+e)/(t-e),-2*t*e/(t-e),0,0,-1,0)}else if(this.type===o.a.Orthographic){const n=this._parametersInner.z,i=this._parametersInner.w;this._projectionMatrix.setComponents(1/n,0,0,0,0,1/i,0,0,0,0,-2/(t-e),-(t+e)/(t-e),0,0,0,1)}else{const n=this._cornerInner.x,i=this._cornerInner.y,s=this._cornerInner.z,r=this._cornerInner.w;this._projectionMatrix.setComponents(2*e/(i-n),0,(i+n)/(i-n),0,0,2*e/(s-r),(s+r)/(s-r),0,0,0,-(t+e)/(t-e),-2*t*e/(t-e),0,0,-1,0)}return this._projectionMatrix}get projectionMatrix(){return this._projectionMatrix}calcViewMatrix(){const e=this.eyeInner,t=a.b.normalize(a.b.subtract(this._directionInner,e)),n=a.b.normalize(a.b.cross(t,this._upInner)),i=a.b.cross(n,t);this._viewMatrix.setComponents(n.x,n.y,n.z,-a.b.dotProduct(n,e),i.x,i.y,i.z,-a.b.dotProduct(i,e),-t.x,-t.y,-t.z,a.b.dotProduct(t,e),0,0,0,1),h.a.invertTo(this.__sceneGraphComponent.worldMatrixInner,y.invertedMatrix44);const s=y.invertedMatrix44;return this._viewMatrix.multiply(s),this._viewMatrix}get viewMatrix(){return this._viewMatrix}get viewProjectionMatrix(){return h.a.multiply(this._projectionMatrix,this._viewMatrix)}$create({strategy:e}){null==this.__sceneGraphComponent&&(this.__sceneGraphComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,l.a),this.moveStageTo(m.a.Logic))}$prerender(){this.calcProjectionMatrix(),this.calcViewMatrix(),this.moveStageTo(m.a.Logic)}get worldPosition(){return this.__sceneGraphComponent.worldMatrixInner.multiplyVector3To(this.eyeInner,y.returnVector3),y.returnVector3}updateFrustum(){this.__frustum.update(this.viewMatrix,this.projectionMatrix)}get frustum(){return this.__frustum}}y.main=-1,y.invertedMatrix44=new _.a([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),y.returnVector3=p.a.zero(),i.a.registerComponentClass(y)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(2),s=n(0);class r extends i.a{constructor(e,t,n,{type:i}){super(e,t,n,{type:i})}static get compositionType(){return s.a.Vec3}zero(){return this.x=0,this.y=0,this.z=0,this}one(){return this.x=1,this.y=1,this.z=1,this}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}cross(e){var t=this.y*e.z-this.z*e.y,n=this.z*e.x-this.x*e.z,i=this.x*e.y-this.y*e.x;return this.x=t,this.y=n,this.z=i,this}normalize(){var e=this.length();return this.divide(e),this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}subtract(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}divide(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):(console.error("0 division occured!"),this.x=1/0,this.y=1/0,this.z=1/0),this}multiply(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVector(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}divideVector(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}get x(){return this.v[0]}set x(e){this.v[0]=e}get y(){return this.v[1]}set y(e){this.v[1]=e}get z(){return this.v[2]}set z(e){this.v[2]=e}get raw(){return this.v}}class a extends r{constructor(e,t,n){super(e,t,n,{type:Float32Array})}clone(){return new a(this.x,this.y,this.z)}static one(){return new a(1,1,1)}static dummy(){return new a(null,0,0)}static zero(){return new a(0,0,0)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var i=n(24),s=n(3),r=n(0),a=n(9),o=n(50),h=n(64),l=n(17),c=n(49),u=n(21),_=n(2),m=n(12),d=n(4);class f extends i.a{constructor(e,t,n={isMorphing:!1,isSkinning:!1,isLighting:!1}){super(),this.__semantics=[],this.__shaderNode=[],this.__vertexInputs=[],this.__pixelInputs=[],this.__vertexOutputs=[],this.__pixelOutputs=[],this.__vertexInputConnections=[],this.__pixelInputConnections=[],this.isSingleOperation=!1,this.__definitions="",this.shader=e,this.shaderFunctionName=t,this.__materialNodeUid=++f.__invalidMaterialNodeCount,f.materialNodes[f.__invalidMaterialNodeCount]=this,this.__isMorphing=n.isMorphing,this.__isSkinning=n.isSkinning,this.__isLighing=n.isLighting,this.__webglResourceRepository=a.a.getWebGLResourceRepository()}get definitions(){return this.__definitions}static getMaterialNode(e){return f.materialNodes[e]}get materialNodeUid(){return this.__materialNodeUid}get _semanticsInfoArray(){return this.__semantics}setShaderSemanticsInfoArray(e){const t=[];for(let n of e)if(n.compositionType===r.a.Vec4Array||n.compositionType===r.a.Vec3Array||n.compositionType==r.a.Vec2Array)if(!0===n.setEach)for(let e=0;e<n.maxIndex;e++){const i=Object.assign({},n);i.index=e,i.maxIndex=n.maxIndex,t.push(i)}else t.push(n);else t.push(n);this.__semantics=t}addVertexInputConnection(e,t,n){this.__vertexInputConnections.push({materialNodeUid:e.materialNodeUid,outputNameOfPrev:t,inputNameOfThis:n})}addPixelInputConnection(e,t,n){this.__pixelInputConnections.push({materialNodeUid:e.materialNodeUid,outputNameOfPrev:t,inputNameOfThis:n})}get vertexInputConnections(){return this.__vertexInputConnections}get pixelInputConnections(){return this.__pixelInputConnections}getVertexInput(e){for(let t of this.__vertexInputs)if(t.name===e)return t}getVertexOutput(e){for(let t of this.__vertexOutputs)if(t.name===e)return t}getPixelInput(e){for(let t of this.__pixelInputs)if(t.name===e)return t}getPixelOutput(e){for(let t of this.__pixelOutputs)if(t.name===e)return t}static initDefaultTextures(){this.__dummyWhiteTexture.isTextureReady||(this.__dummyWhiteTexture.generate1x1TextureFrom(),this.__dummyBlueTexture.generate1x1TextureFrom("rgba(127.5, 127.5, 255, 1)"),this.__dummyBlackTexture.generate1x1TextureFrom("rgba(0, 0, 0, 1)"),this.__dummyBlackCubeTexture.load1x1Texture("rgba(0, 0, 0, 1)"))}setWorldMatrix(e,t){e._gl.uniformMatrix4fv(e.worldMatrix,!1,t.v)}setNormalMatrix(e,t){e._gl.uniformMatrix3fv(e.normalMatrix,!1,t.v)}setViewInfo(e,t,n,i){if(t){const r=t.worldPosition;i?(e._gl.uniformMatrix4fv(e.viewMatrix,!1,t.viewMatrix.v),e._gl.uniform3fv(e.viewPosition,r.v)):(n.setParameter(s.a.ViewMatrix,t.viewMatrix),n.setParameter(s.a.ViewPosition,r))}else{const t=m.a.identity(),r=new _.b(0,0,10);i?(e._gl.uniformMatrix4fv(e.viewMatrix,!1,t.v),e._gl.uniform3fv(e.viewPosition,r.v)):(n.setParameter(s.a.ViewMatrix,t),n.setParameter(s.a.ViewPosition,r))}}setProjection(e,t,n,i){t?i?e._gl.uniformMatrix4fv(e.projectionMatrix,!1,t.projectionMatrix.v):n.setParameter(s.a.ProjectionMatrix,t.projectionMatrix):this.__webglResourceRepository.setUniformValue(e,s.a.ProjectionMatrix.str,!0,m.a.identity())}setSkinning(e,t,n){if(this.__isSkinning)if(t){if(n){const n=t.jointQuaternionArray,i=t.jointTranslateScaleArray;e._gl.uniform4fv(e.boneQuaternion,n),e._gl.uniform4fv(e.boneTranslateScale,i),this.__webglResourceRepository.setUniformValue(e,s.a.SkinningMode.str,!0,!0)}}else n&&e._gl.uniform1i(e.skinningMode,!1)}setLightsInfo(e,t,n,i){if(this.__isLighing){i?e._gl.uniform1i(e.lightNumber,t.length):n.setParameter(s.a.LightNumber,t.length);for(let r=0;r<t.length&&!(r>=l.a.maxLightNumberInShader)&&null!=e.lightPosition;r++){const a=t[r],o=a.entity.getSceneGraph().worldPosition,h=a.direction,l=a.intensity;if(i)e._gl.uniform4f(e.lightPosition[r],o.x,o.y,o.z,a.type.index),e._gl.uniform4f(e.lightDirection[r],h.x,h.y,h.z,0),e._gl.uniform4f(e.lightIntensity[r],l.x,l.y,l.z,0);else{const e=f.__tmp_vector4;e.x=o.x,e.y=o.y,e.z=o.z,e.w=a.type.index,n.setParameter(s.a.LightPosition,e,r),e.x=h.x,e.y=h.y,e.z=h.z,e.w=0,n.setParameter(s.a.LightDirection,e,r),e.x=l.x,e.y=l.y,e.z=l.z,e.w=0,n.setParameter(s.a.LightIntensity,e,r)}}}}static setMorphInfo(e,t,n,i){if(0===i.targets.length)return void e._gl.uniform1i(e.morphTargetNumber,0);e._gl.uniform1i(e.morphTargetNumber,t.mesh.weights.length);const s=i.targets.map(e=>{return e.get(d.a.Position).byteOffsetInBuffer/4/4});let r;e._gl.uniform1fv(e.dataTextureMorphOffsetPosition,s),n&&n.weights.length>0?r=n.weights:t.mesh.weights.length>0?r=t.mesh.weights:(r=new Float32Array(i.targets.length),e._gl.uniform1i(e.morphTargetNumber,0)),e._gl.uniform1fv(e.morphWeights,r)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){}}f.__invalidMaterialNodeUid=-1,f.__invalidMaterialNodeCount=-1,f.materialNodes=[],f.__transposedMatrix44=new m.a([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),f.__dummyWhiteTexture=new o.a,f.__dummyBlueTexture=new o.a,f.__dummyBlackTexture=new o.a,f.__dummyBlackCubeTexture=new h.a,f.__tmp_vector4=u.a.zero(),f.__tmp_vector2=c.a.zero()},function(e,t,n){"use strict";t.a={maxEntityNumber:5e3,maxLightNumberInShader:4,maxVertexMorphNumberInShader:8,maxMaterialInstanceForEachType:400}},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(2),s=n(23),r=n(8),a=n(0);const o=Float32Array;class h{constructor(e,t,n,i,r,a,h,l,c,u,_,m,d,f,p,g,v=!1,x=!1){const y=arguments.length>=16?v:t,b=arguments.length>=16?x:n,A=e;if(null!=A)if(arguments.length>=16&&null!=arguments[3]){this.v=new o(16);let e=arguments;!0===y?(this.v[0]=e[0],this.v[4]=e[4],this.v[8]=e[8],this.v[12]=e[12],this.v[1]=e[1],this.v[5]=e[5],this.v[9]=e[9],this.v[13]=e[13],this.v[2]=e[2],this.v[6]=e[6],this.v[10]=e[10],this.v[14]=e[14],this.v[3]=e[3],this.v[7]=e[7],this.v[11]=e[11],this.v[15]=e[15]):(this.v[0]=e[0],this.v[4]=e[1],this.v[8]=e[2],this.v[12]=e[3],this.v[1]=e[4],this.v[5]=e[5],this.v[9]=e[6],this.v[13]=e[7],this.v[2]=e[8],this.v[6]=e[9],this.v[10]=e[10],this.v[14]=e[11],this.v[3]=e[12],this.v[7]=e[13],this.v[11]=e[14],this.v[15]=e[15])}else if(Array.isArray(A))this.v=new o(16),!0===y?(this.v[0]=A[0],this.v[4]=A[4],this.v[8]=A[8],this.v[12]=A[12],this.v[1]=A[1],this.v[5]=A[5],this.v[9]=A[9],this.v[13]=A[13],this.v[2]=A[2],this.v[6]=A[6],this.v[10]=A[10],this.v[14]=A[14],this.v[3]=A[3],this.v[7]=A[7],this.v[11]=A[11],this.v[15]=A[15]):(this.v[0]=A[0],this.v[4]=A[1],this.v[8]=A[2],this.v[12]=A[3],this.v[1]=A[4],this.v[5]=A[5],this.v[9]=A[6],this.v[13]=A[7],this.v[2]=A[8],this.v[6]=A[9],this.v[10]=A[10],this.v[14]=A[11],this.v[3]=A[12],this.v[7]=A[13],this.v[11]=A[14],this.v[15]=A[15]);else if(A instanceof o)b?this.v=A:(this.v=new o(16),!0===y?(this.v[0]=A[0],this.v[4]=A[4],this.v[8]=A[8],this.v[12]=A[12],this.v[1]=A[1],this.v[5]=A[5],this.v[9]=A[9],this.v[13]=A[13],this.v[2]=A[2],this.v[6]=A[6],this.v[10]=A[10],this.v[14]=A[14],this.v[3]=A[3],this.v[7]=A[7],this.v[11]=A[11],this.v[15]=A[15]):(this.v[0]=A[0],this.v[4]=A[1],this.v[8]=A[2],this.v[12]=A[3],this.v[1]=A[4],this.v[5]=A[5],this.v[9]=A[6],this.v[13]=A[7],this.v[2]=A[8],this.v[6]=A[9],this.v[10]=A[10],this.v[14]=A[11],this.v[3]=A[12],this.v[7]=A[13],this.v[11]=A[14],this.v[15]=A[15]));else if(A&&void 0!==A.v[15]&&void 0!==A.v[10])if(b)this.v=A.v;else{this.v=new o(16);const e=A.v;!0===y?(this.v[0]=e[0],this.v[4]=e[4],this.v[8]=e[8],this.v[12]=e[12],this.v[1]=e[1],this.v[5]=e[5],this.v[9]=e[9],this.v[13]=e[13],this.v[2]=e[2],this.v[6]=e[6],this.v[10]=e[10],this.v[14]=e[14],this.v[3]=e[3],this.v[7]=e[7],this.v[11]=e[11],this.v[15]=e[15]):(this.v[0]=e[0],this.v[4]=e[1],this.v[8]=e[2],this.v[12]=e[3],this.v[1]=e[4],this.v[5]=e[5],this.v[9]=e[6],this.v[13]=e[7],this.v[2]=e[8],this.v[6]=e[9],this.v[10]=e[10],this.v[14]=e[11],this.v[3]=e[12],this.v[7]=e[13],this.v[11]=e[14],this.v[15]=e[15])}else if(A&&void 0===A.v[15]&&void 0!==A.v[10])if(b)this.v=A.v;else{this.v=new o(16);const e=A.v;!0===y?(this.v[0]=e[0],this.v[4]=e[3],this.v[8]=e[6],this.v[12]=0,this.v[1]=e[1],this.v[5]=e[4],this.v[9]=e[7],this.v[13]=0,this.v[2]=e[2],this.v[6]=e[5],this.v[10]=e[8],this.v[14]=0,this.v[3]=0,this.v[7]=0,this.v[11]=0,this.v[15]=1):(this.v[0]=e[0],this.v[4]=e[1],this.v[8]=e[2],this.v[12]=0,this.v[1]=e[3],this.v[5]=e[4],this.v[9]=e[5],this.v[13]=0,this.v[2]=e[6],this.v[6]=e[7],this.v[10]=e[8],this.v[14]=0,this.v[3]=0,this.v[7]=0,this.v[11]=0,this.v[15]=1)}else if(A&&void 0!==A.className&&A instanceof s.a){this.v=new o(16);const e=A.x*A.x,t=A.y*A.y,n=A.z*A.z,i=A.y*A.z,s=A.x*A.z,r=A.x*A.y,a=A.w*A.x,h=A.w*A.y,l=A.w*A.z;this.v[0]=1-2*(t+n),this.v[4]=2*(r-l),this.v[8]=2*(s+h),this.v[12]=0,this.v[1]=2*(r+l),this.v[5]=1-2*(e+n),this.v[9]=2*(i-a),this.v[13]=0,this.v[2]=2*(s-h),this.v[6]=2*(i+a),this.v[10]=1-2*(e+t),this.v[14]=0,this.v[3]=0,this.v[7]=0,this.v[11]=0,this.v[15]=1}else this.v=new o(16),this.v[0]=1,this.v[4]=0,this.v[8]=0,this.v[12]=0,this.v[1]=0,this.v[5]=1,this.v[9]=0,this.v[13]=0,this.v[2]=0,this.v[6]=0,this.v[10]=1,this.v[14]=0,this.v[3]=0,this.v[7]=0,this.v[11]=0,this.v[15]=1;else this.v=new o(0)}static dummy(){return new h(null)}static get compositionType(){return a.a.Mat4}isDummy(){return 0===this.v.length}get className(){return this.constructor.name}clone(){return new h(this.v[0],this.v[4],this.v[8],this.v[12],this.v[1],this.v[5],this.v[9],this.v[13],this.v[2],this.v[6],this.v[10],this.v[14],this.v[3],this.v[7],this.v[11],this.v[15])}static fromQuaternionTo(e,t){const n=e.x*e.x,i=e.y*e.y,s=e.z*e.z,r=e.y*e.z,a=e.x*e.z,o=e.x*e.y,h=e.w*e.x,l=e.w*e.y,c=e.w*e.z;t.m00=1-2*(i+s),t.m01=2*(o-c),t.m02=2*(a+l),t.m03=0,t.m10=2*(o+c),t.m11=1-2*(n+s),t.m12=2*(r-h),t.m13=0,t.m20=2*(a-l),t.m21=2*(r+h),t.m22=1-2*(n+i),t.m23=0,t.m30=0,t.m31=0,t.m32=0,t.m33=1}static identity(){return new h(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}isEqual(e,t=Number.EPSILON){return Math.abs(e.v[0]-this.v[0])<t&&Math.abs(e.v[1]-this.v[1])<t&&Math.abs(e.v[2]-this.v[2])<t&&Math.abs(e.v[3]-this.v[3])<t&&Math.abs(e.v[4]-this.v[4])<t&&Math.abs(e.v[5]-this.v[5])<t&&Math.abs(e.v[6]-this.v[6])<t&&Math.abs(e.v[7]-this.v[7])<t&&Math.abs(e.v[8]-this.v[8])<t&&Math.abs(e.v[9]-this.v[9])<t&&Math.abs(e.v[10]-this.v[10])<t&&Math.abs(e.v[11]-this.v[11])<t&&Math.abs(e.v[12]-this.v[12])<t&&Math.abs(e.v[13]-this.v[13])<t&&Math.abs(e.v[14]-this.v[14])<t&&Math.abs(e.v[15]-this.v[15])<t}getTranslate(){return new i.b(this.m03,this.m13,this.m23)}static translate(e){return new h(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1)}static scale(e){return new h(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1)}static rotateX(e){var t=Math.cos(e),n=Math.sin(e);return new h(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1)}static rotateY(e){var t=Math.cos(e),n=Math.sin(e);return new h(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1)}static rotateZ(e){var t=Math.cos(e),n=Math.sin(e);return new h(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1)}toEulerAngles(){let e=null;if(1!=Math.abs(this.v[2])){let t=-Math.asin(this.v[2]),n=Math.atan2(this.v[6]/Math.cos(t),this.v[10]/Math.cos(t)),s=Math.atan2(this.v[1]/Math.cos(t),this.v[0]/Math.cos(t));e=new i.b(n,t,s)}else e=-1===this.v[2]?new i.b(Math.atan2(this.v[4],this.v[8]),Math.PI/2,0):new i.b(Math.atan2(-this.v[4],-this.v[8]),-Math.PI/2,0);return e}toEulerAnglesTo(e){if(1!=Math.abs(this.v[2])){let t=-Math.asin(this.v[2]),n=Math.atan2(this.v[6]/Math.cos(t),this.v[10]/Math.cos(t)),i=Math.atan2(this.v[1]/Math.cos(t),this.v[0]/Math.cos(t));e.x=n,e.y=t,e.z=i}else-1===this.v[2]?(e.x=Math.atan2(this.v[4],this.v[8]),e.y=Math.PI/2,e.z=0):(e.x=Math.atan2(-this.v[4],-this.v[8]),e.y=-Math.PI/2,e.z=0)}static zero(){return new h(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}flattenAsArray(){return[this.v[0],this.v[1],this.v[2],this.v[3],this.v[4],this.v[5],this.v[6],this.v[7],this.v[8],this.v[9],this.v[10],this.v[11],this.v[12],this.v[13],this.v[14],this.v[15]]}static transpose(e){return new h(e.m00,e.m10,e.m20,e.m30,e.m01,e.m11,e.m21,e.m31,e.m02,e.m12,e.m22,e.m32,e.m03,e.m13,e.m23,e.m33)}multiplyVector(e){var t=this.v[0]*e.x+this.v[4]*e.y+this.v[8]*e.z+this.m03*e.w,n=this.v[1]*e.x+this.v[5]*e.y+this.v[9]*e.z+this.m13*e.w,i=this.v[2]*e.x+this.v[6]*e.y+this.v[10]*e.z+this.m23*e.w,s=this.v[3]*e.x+this.v[7]*e.y+this.v[11]*e.z+this.m33*e.w;return new r.b(t,n,i,s)}multiplyVectorTo(e,t){const n=this.v[0]*e.x+this.v[4]*e.y+this.v[8]*e.z+this.m03*e.w,i=this.v[1]*e.x+this.v[5]*e.y+this.v[9]*e.z+this.m13*e.w,s=this.v[2]*e.x+this.v[6]*e.y+this.v[10]*e.z+this.m23*e.w,r=this.v[3]*e.x+this.v[7]*e.y+this.v[11]*e.z+this.m33*e.w;t.x=n,t.y=i,t.z=s,t.w=r}multiplyVectorToVec3(e,t){const n=this.v[0]*e.x+this.v[4]*e.y+this.v[8]*e.z+this.m03*e.w,i=this.v[1]*e.x+this.v[5]*e.y+this.v[9]*e.z+this.m13*e.w,s=this.v[2]*e.x+this.v[6]*e.y+this.v[10]*e.z+this.m23*e.w;t.x=n,t.y=i,t.z=s}multiplyVector3(e){var t=this.v[0]*e.x+this.v[4]*e.y+this.v[8]*e.z+this.m03*e.w,n=this.v[1]*e.x+this.v[5]*e.y+this.v[9]*e.z+this.m13*e.w,s=this.v[2]*e.x+this.v[6]*e.y+this.v[10]*e.z+this.m23*e.w;return new i.b(t,n,s)}multiplyVector3To(e,t){t.x=this.v[0]*e.x+this.v[4]*e.y+this.v[8]*e.z+this.m03*e.w,t.y=this.v[1]*e.x+this.v[5]*e.y+this.v[9]*e.z+this.m13*e.w,t.z=this.v[2]*e.x+this.v[6]*e.y+this.v[10]*e.z+this.m23*e.w}static multiply(e,t){var n=e.v[0]*t.v[0]+e.v[4]*t.v[1]+e.v[8]*t.v[2]+e.v[12]*t.v[3],i=e.v[1]*t.v[0]+e.v[5]*t.v[1]+e.v[9]*t.v[2]+e.v[13]*t.v[3],s=e.v[2]*t.v[0]+e.v[6]*t.v[1]+e.v[10]*t.v[2]+e.v[14]*t.v[3],r=e.v[3]*t.v[0]+e.v[7]*t.v[1]+e.v[11]*t.v[2]+e.v[15]*t.v[3],a=e.v[0]*t.v[4]+e.v[4]*t.v[5]+e.v[8]*t.v[6]+e.v[12]*t.v[7],o=e.v[1]*t.v[4]+e.v[5]*t.v[5]+e.v[9]*t.v[6]+e.v[13]*t.v[7],l=e.v[2]*t.v[4]+e.v[6]*t.v[5]+e.v[10]*t.v[6]+e.v[14]*t.v[7],c=e.v[3]*t.v[4]+e.v[7]*t.v[5]+e.v[11]*t.v[6]+e.v[15]*t.v[7],u=e.v[0]*t.v[8]+e.v[4]*t.v[9]+e.v[8]*t.v[10]+e.v[12]*t.v[11],_=e.v[1]*t.v[8]+e.v[5]*t.v[9]+e.v[9]*t.v[10]+e.v[13]*t.v[11],m=e.v[2]*t.v[8]+e.v[6]*t.v[9]+e.v[10]*t.v[10]+e.v[14]*t.v[11],d=e.v[3]*t.v[8]+e.v[7]*t.v[9]+e.v[11]*t.v[10]+e.v[15]*t.v[11],f=e.v[0]*t.v[12]+e.v[4]*t.v[13]+e.v[8]*t.v[14]+e.v[12]*t.v[15],p=e.v[1]*t.v[12]+e.v[5]*t.v[13]+e.v[9]*t.v[14]+e.v[13]*t.v[15],g=e.v[2]*t.v[12]+e.v[6]*t.v[13]+e.v[10]*t.v[14]+e.v[14]*t.v[15],v=e.v[3]*t.v[12]+e.v[7]*t.v[13]+e.v[11]*t.v[14]+e.v[15]*t.v[15];return new h(n,a,u,f,i,o,_,p,s,l,m,g,r,c,d,v)}static multiplyTo(e,t,n){n.m00=e.v[0]*t.v[0]+e.v[4]*t.v[1]+e.v[8]*t.v[2]+e.v[12]*t.v[3],n.m10=e.v[1]*t.v[0]+e.v[5]*t.v[1]+e.v[9]*t.v[2]+e.v[13]*t.v[3],n.m20=e.v[2]*t.v[0]+e.v[6]*t.v[1]+e.v[10]*t.v[2]+e.v[14]*t.v[3],n.m30=e.v[3]*t.v[0]+e.v[7]*t.v[1]+e.v[11]*t.v[2]+e.v[15]*t.v[3],n.m01=e.v[0]*t.v[4]+e.v[4]*t.v[5]+e.v[8]*t.v[6]+e.v[12]*t.v[7],n.m11=e.v[1]*t.v[4]+e.v[5]*t.v[5]+e.v[9]*t.v[6]+e.v[13]*t.v[7],n.m21=e.v[2]*t.v[4]+e.v[6]*t.v[5]+e.v[10]*t.v[6]+e.v[14]*t.v[7],n.m31=e.v[3]*t.v[4]+e.v[7]*t.v[5]+e.v[11]*t.v[6]+e.v[15]*t.v[7],n.m02=e.v[0]*t.v[8]+e.v[4]*t.v[9]+e.v[8]*t.v[10]+e.v[12]*t.v[11],n.m12=e.v[1]*t.v[8]+e.v[5]*t.v[9]+e.v[9]*t.v[10]+e.v[13]*t.v[11],n.m22=e.v[2]*t.v[8]+e.v[6]*t.v[9]+e.v[10]*t.v[10]+e.v[14]*t.v[11],n.m32=e.v[3]*t.v[8]+e.v[7]*t.v[9]+e.v[11]*t.v[10]+e.v[15]*t.v[11],n.m03=e.v[0]*t.v[12]+e.v[4]*t.v[13]+e.v[8]*t.v[14]+e.v[12]*t.v[15],n.m13=e.v[1]*t.v[12]+e.v[5]*t.v[13]+e.v[9]*t.v[14]+e.v[13]*t.v[15],n.m23=e.v[2]*t.v[12]+e.v[6]*t.v[13]+e.v[10]*t.v[14]+e.v[14]*t.v[15],n.m33=e.v[3]*t.v[12]+e.v[7]*t.v[13]+e.v[11]*t.v[14]+e.v[15]*t.v[15]}determinant(){return this.v[0]*this.v[5]*this.v[10]*this.m33+this.v[0]*this.v[9]*this.m23*this.v[7]+this.v[0]*this.m13*this.v[6]*this.v[11]+this.v[4]*this.v[1]*this.m23*this.v[11]+this.v[4]*this.v[9]*this.v[2]*this.m33+this.v[4]*this.m13*this.v[10]*this.v[3]+this.v[8]*this.v[1]*this.v[6]*this.m33+this.v[8]*this.v[5]*this.m23*this.v[3]+this.v[8]*this.m13*this.v[2]*this.v[7]+this.m03*this.v[1]*this.v[10]*this.v[7]+this.m03*this.v[5]*this.v[2]*this.v[11]+this.m03*this.v[9]*this.v[6]*this.v[3]-this.v[0]*this.v[5]*this.m23*this.v[11]-this.v[0]*this.v[9]*this.v[6]*this.m33-this.v[0]*this.m13*this.v[10]*this.v[7]-this.v[4]*this.v[1]*this.v[10]*this.m33-this.v[4]*this.v[9]*this.m23*this.v[3]-this.v[4]*this.m13*this.v[2]*this.v[11]-this.v[8]*this.v[1]*this.m23*this.v[7]-this.v[8]*this.v[5]*this.v[2]*this.m33-this.v[8]*this.m13*this.v[6]*this.v[3]-this.m03*this.v[1]*this.v[6]*this.v[11]-this.m03*this.v[5]*this.v[10]*this.v[3]-this.m03*this.v[9]*this.v[2]*this.v[7]}static determinant(e){let t=e.v[0]*e.v[5]-e.v[4]*e.v[1],n=e.v[0]*e.v[9]-e.v[8]*e.v[1],i=e.v[0]*e.v[13]-e.v[12]*e.v[1],s=e.v[4]*e.v[9]-e.v[8]*e.v[5],r=e.v[4]*e.v[13]-e.v[12]*e.v[5],a=e.v[8]*e.v[13]-e.v[12]*e.v[9],o=e.v[2]*e.v[7]-e.v[6]*e.v[3],h=e.v[2]*e.v[11]-e.v[10]*e.v[3],l=e.v[2]*e.v[15]-e.v[14]*e.v[3],c=e.v[6]*e.v[11]-e.v[10]*e.v[7],u=e.v[6]*e.v[15]-e.v[14]*e.v[7];return t*(e.v[10]*e.v[15]-e.v[14]*e.v[11])-n*u+i*c+s*l-r*h+a*o}static invert(e){let t=e.v[0]*e.v[5]-e.v[4]*e.v[1],n=e.v[0]*e.v[9]-e.v[8]*e.v[1],i=e.v[0]*e.v[13]-e.v[12]*e.v[1],s=e.v[4]*e.v[9]-e.v[8]*e.v[5],r=e.v[4]*e.v[13]-e.v[12]*e.v[5],a=e.v[8]*e.v[13]-e.v[12]*e.v[9],o=e.v[2]*e.v[7]-e.v[6]*e.v[3],l=e.v[2]*e.v[11]-e.v[10]*e.v[3],c=e.v[2]*e.v[15]-e.v[14]*e.v[3],u=e.v[6]*e.v[11]-e.v[10]*e.v[7],_=e.v[6]*e.v[15]-e.v[14]*e.v[7],m=e.v[10]*e.v[15]-e.v[14]*e.v[11],d=t*m-n*_+i*u+s*c-r*l+a*o;d=1/d;const f=(e.v[5]*m-e.v[9]*_+e.v[13]*u)*d,p=(e.v[8]*_-e.v[4]*m-e.v[12]*u)*d,g=(e.v[7]*a-e.v[11]*r+e.v[15]*s)*d,v=(e.v[10]*r-e.v[6]*a-e.v[14]*s)*d,x=(e.v[9]*c-e.v[1]*m-e.v[13]*l)*d,y=(e.v[0]*m-e.v[8]*c+e.v[12]*l)*d,b=(e.v[11]*i-e.v[3]*a-e.v[15]*n)*d,A=(e.v[2]*a-e.v[10]*i+e.v[14]*n)*d,T=(e.v[1]*_-e.v[5]*c+e.v[13]*o)*d,w=(e.v[4]*c-e.v[0]*_-e.v[12]*o)*d,S=(e.v[3]*r-e.v[7]*i+e.v[15]*t)*d,I=(e.v[6]*i-e.v[2]*r-e.v[14]*t)*d,E=(e.v[5]*l-e.v[1]*u-e.v[9]*o)*d,F=(e.v[0]*u-e.v[4]*l+e.v[8]*o)*d,C=(e.v[7]*n-e.v[3]*s-e.v[11]*t)*d,P=(e.v[2]*s-e.v[6]*n+e.v[10]*t)*d;return new h(f,p,g,v,x,y,b,A,T,w,S,I,E,F,C,P,!0)}static invertTo(e,t){let n=e.v[0]*e.v[5]-e.v[4]*e.v[1],i=e.v[0]*e.v[9]-e.v[8]*e.v[1],s=e.v[0]*e.v[13]-e.v[12]*e.v[1],r=e.v[4]*e.v[9]-e.v[8]*e.v[5],a=e.v[4]*e.v[13]-e.v[12]*e.v[5],o=e.v[8]*e.v[13]-e.v[12]*e.v[9],h=e.v[2]*e.v[7]-e.v[6]*e.v[3],l=e.v[2]*e.v[11]-e.v[10]*e.v[3],c=e.v[2]*e.v[15]-e.v[14]*e.v[3],u=e.v[6]*e.v[11]-e.v[10]*e.v[7],_=e.v[6]*e.v[15]-e.v[14]*e.v[7],m=e.v[10]*e.v[15]-e.v[14]*e.v[11],d=n*m-i*_+s*u+r*c-a*l+o*h;d=1/d,t.v[0]=(e.v[5]*m-e.v[9]*_+e.v[13]*u)*d,t.v[4]=(e.v[8]*_-e.v[4]*m-e.v[12]*u)*d,t.v[8]=(e.v[7]*o-e.v[11]*a+e.v[15]*r)*d,t.v[12]=(e.v[10]*a-e.v[6]*o-e.v[14]*r)*d,t.v[1]=(e.v[9]*c-e.v[1]*m-e.v[13]*l)*d,t.v[5]=(e.v[0]*m-e.v[8]*c+e.v[12]*l)*d,t.v[9]=(e.v[11]*s-e.v[3]*o-e.v[15]*i)*d,t.v[13]=(e.v[2]*o-e.v[10]*s+e.v[14]*i)*d,t.v[2]=(e.v[1]*_-e.v[5]*c+e.v[13]*h)*d,t.v[6]=(e.v[4]*c-e.v[0]*_-e.v[12]*h)*d,t.v[10]=(e.v[3]*a-e.v[7]*s+e.v[15]*n)*d,t.v[14]=(e.v[6]*s-e.v[2]*a-e.v[14]*n)*d,t.v[3]=(e.v[5]*l-e.v[1]*u-e.v[9]*h)*d,t.v[7]=(e.v[0]*u-e.v[4]*l+e.v[8]*h)*d,t.v[11]=(e.v[7]*i-e.v[3]*r-e.v[11]*n)*d,t.v[15]=(e.v[2]*r-e.v[6]*i+e.v[10]*n)*d}get m00(){return this.v[0]}get m10(){return this.v[1]}get m20(){return this.v[2]}get m30(){return this.v[3]}get m01(){return this.v[4]}get m11(){return this.v[5]}get m21(){return this.v[6]}get m31(){return this.v[7]}get m02(){return this.v[8]}get m12(){return this.v[9]}get m22(){return this.v[10]}get m32(){return this.v[11]}get m03(){return this.v[12]}get m13(){return this.v[13]}get m23(){return this.v[14]}get m33(){return this.v[15]}toString(){return this.v[0]+" "+this.v[4]+" "+this.v[8]+" "+this.m03+" \n"+this.v[1]+" "+this.v[5]+" "+this.v[9]+" "+this.m13+" \n"+this.v[2]+" "+this.v[6]+" "+this.v[10]+" "+this.m23+" \n"+this.v[3]+" "+this.v[7]+" "+this.v[11]+" "+this.m33+" \n"}nearZeroToZero(e){return Math.abs(e)<1e-5?e=0:.99999<e&&e<1.00001?e=1:-1.00001<e&&e<-.99999&&(e=-1),e}toStringApproximately(){return this.nearZeroToZero(this.v[0])+" "+this.nearZeroToZero(this.v[4])+" "+this.nearZeroToZero(this.v[8])+" "+this.nearZeroToZero(this.m03)+" \n"+this.nearZeroToZero(this.v[1])+" "+this.nearZeroToZero(this.v[5])+" "+this.nearZeroToZero(this.v[9])+" "+this.nearZeroToZero(this.m13)+" \n"+this.nearZeroToZero(this.v[2])+" "+this.nearZeroToZero(this.v[6])+" "+this.nearZeroToZero(this.v[10])+" "+this.nearZeroToZero(this.m23)+" \n"+this.nearZeroToZero(this.v[3])+" "+this.nearZeroToZero(this.v[7])+" "+this.nearZeroToZero(this.v[11])+" "+this.nearZeroToZero(this.m33)+" \n"}getScale(){return new i.b(Math.sqrt(this.v[0]*this.v[0]+this.v[4]*this.v[4]+this.v[8]*this.v[8]),Math.sqrt(this.v[1]*this.v[1]+this.v[5]*this.v[5]+this.v[9]*this.v[9]),Math.sqrt(this.v[2]*this.v[2]+this.v[6]*this.v[6]+this.v[10]*this.v[10]))}getRotate(){const e=s.a.fromMatrix(this);return new h(e)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return s});class i{constructor(e,{type:t}){ArrayBuffer.isView(e)?this.v=e:null!=e?(this.v=new t(1),this.v[0]=e):this.v=new t(0)}getValue(){return this.v[0]}getValueInArray(){return[this.v[0]]}get x(){return this.v[0]}get raw(){return this.v}}class s extends i{constructor(e){super(e,{type:Float32Array})}static zero(){return new s(0)}static one(){return new s(1)}static dummy(){return new s(null)}clone(){return new s(this.x)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return M});var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:9728,str:"NEAREST"}),a=new s({index:9729,str:"LINEAR"}),o=new s({index:9987,str:"LINEAR_MIPMAP_LINEAR"}),h=new s({index:10240,str:"TEXTURE_MAG_FILTER"}),l=new s({index:10241,str:"TEXTURE_MIN_FILTER"}),c=new s({index:10242,str:"TEXTURE_WRAP_S"}),u=new s({index:10243,str:"TEXTURE_WRAP_T"}),_=new s({index:3553,str:"TEXTURE_2D"}),m=new s({index:5890,str:"TEXTURE"}),d=new s({index:33984,str:"TEXTURE0"}),f=new s({index:33985,str:"TEXTURE1"}),p=new s({index:34016,str:"ACTIVE_TEXTURE"}),g=new s({index:10497,str:"REPEAT"}),v=new s({index:33071,str:"CLAMP_TO_EDGE"}),x=new s({index:32849,str:"RGB8"}),y=new s({index:32856,str:"RGBA8"}),b=new s({index:32857,str:"RGB10_A2"}),A=new s({index:34843,str:"RGB16F"}),T=new s({index:34837,str:"RGB32F"}),w=new s({index:34842,str:"RGBA16F"}),S=new s({index:34836,str:"RGBA32F"}),I=new s({index:33189,str:"DEPTH_COMPONENT16"}),E=new s({index:33190,str:"DEPTH_COMPONENT24"}),F=new s({index:36012,str:"DEPTH_COMPONENT32F"}),C=new s({index:35056,str:"DEPTH24_STENCIL8"}),P=new s({index:36013,str:"DEPTH32F_STENCIL8"});const M=Object.freeze({Nearest:r,Linear:a,LinearMipmapLinear:o,TextureMagFilter:h,TextureMinFilter:l,TextureWrapS:c,TextureWrapT:u,Texture2D:_,Texture:m,Texture0:d,Texture1:f,ActiveTexture:p,Repeat:g,ClampToEdge:v,RGB8:x,RGBA8:y,RGB10_A2:b,RGB16F:A,RGB32F:T,RGBA16F:w,RGBA32F:S,Depth16:I,Depth24:E,Depth32F:F,Depth24Stencil8:C,Depth32FStencil8:P})},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(8),s=n(0);class r extends i.a{constructor(e,t,n,i,{type:s}){super(e,t,n,i,{type:s})}static get compositionType(){return s.a.Vec4}normalize(){var e=this.length();return this.divide(e),this}normalize3(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);this.x/=e,this.y/=e,this.z/=e,this.w/=e}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addWithOutW(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}subtract(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}multiply(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}multiplyVector(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}divide(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(console.error("0 division occured!"),this.x=1/0,this.y=1/0,this.z=1/0,this.w=1/0),this}divideVector(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}get x(){return this.v[0]}get y(){return this.v[1]}get z(){return this.v[2]}get w(){return this.v[3]}set x(e){this.v[0]=e}set y(e){this.v[1]=e}set z(e){this.v[2]=e}set w(e){this.v[3]=e}get raw(){return this.v}__Error(){throw new Error("Not avavailabe because this Vector class is immutable.")}}class a extends r{constructor(e,t,n,i){super(e,t,n,i,{type:Float32Array})}clone(){return new a(this.x,this.y,this.z,this.w)}static one(){return new a(1,1,1,1)}static dummy(){return new a(null,0,0,0)}static zero(){return new a(0,0,0,0)}static zeroWithWOne(){return new a(0,0,0,1)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return s});class i{constructor(e,t,{type:n}){ArrayBuffer.isView(e)?this.v=e:null!=e?(this.v=new n(2),this.v[0]=e,this.v[1]=t):this.v=new n(0)}get className(){return this.constructor.name}clone(){return new s(this.x,this.y)}static add(e,t){return new e.constructor(e.x+t.x,e.y+t.y)}static subtract(e,t){return new e.constructor(e.x-t.x,e.y-t.y)}isStrictEqual(e){return this.x===e.x&&this.y===e.y}isEqual(e,t=Number.EPSILON){return Math.abs(e.x-this.x)<t&&Math.abs(e.y-this.y)<t}static multiply(e,t){return new e.constructor(e.x*t,e.y*t)}get x(){return this.v[0]}get y(){return this.v[1]}get raw(){return this.v}}class s extends i{constructor(e,t){super(e,t,{type:Float32Array})}static zero(){return new s(0,0)}static one(){return new s(1,1)}static dummy(){return new s(null,0)}clone(){return new s(this.x,this.y)}}},function(e,t,n){"use strict";var i=n(2),s=n(0);class r{constructor(e,t,n){if(ArrayBuffer.isView(e))this.v=e;else if(null!=e)if(this.v=new Float32Array(3),null==e)this.v[0]=0,this.v[1]=0,this.v[2]=0;else if(e instanceof a){const t=Math.acos(e.w),n=Math.sin(t);this.v[0]=e.x*(t/n),this.v[1]=e.y*(t/n),this.v[2]=e.z*(t/n)}else Array.isArray(e)?(this.v[0]=e[0],this.v[1]=e[1],this.v[2]=e[2]):void 0!==e.z?(this.v[0]=e.x,this.v[1]=e.y,this.v[2]=e.z):(this.v[0]=e,this.v[1]=e,this.v[2]=e);else this.v=new Float32Array(0)}get x(){return this.v[0]}get y(){return this.v[1]}get z(){return this.v[2]}}n.d(t,"a",function(){return a});class a{constructor(e,t,n,i){if(ArrayBuffer.isView(e))this.v=e;else if(this.v=null==e?new Float32Array(0):new Float32Array(4),null==e)this.v[0]=0,this.v[1]=0,this.v[2]=0,this.v[3]=1;else if(e instanceof r){const t=e.x*e.x+e.y*e.y+e.z*e.z,n=Math.sin(t);this.v[0]=e.x*(n/t),this.v[1]=e.y*(n/t),this.v[2]=e.z*(n/t),this.v[3]=Math.cos(t)}else Array.isArray(e)?(this.v[0]=e[0],this.v[1]=e[1],this.v[2]=e[2],this.v[3]=e[3]):void 0!==e.w?(this.v[0]=e.x,this.v[1]=e.y,this.v[2]=e.z,this.v[3]=e.w):void 0!==e.z?(this.v[0]=e.x,this.v[1]=e.y,this.v[2]=e.z,this.v[3]=1):void 0!==e.y?(this.v[0]=e.x,this.v[1]=e.y,this.v[2]=0,this.v[3]=1):(this.v[0]=e,this.v[1]=t,this.v[2]=n,this.v[3]=i)}isEqual(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}static get compositionType(){return s.a.Vec4}static dummy(){return new a(null)}isDummy(){return 0===this.v.length}get className(){return this.constructor.name}clone(){return new a(this.x,this.y,this.z,this.w)}static invert(e){const t=1/((e=new a(-e.x,-e.y,-e.z,e.w)).x*e.x+e.y*e.y+e.z*e.z+e.w*e.w);return e.v[0]*=t,e.v[1]*=t,e.v[2]*=t,e.v[3]*=t,e}static qlerp(e,t,n){var i=new a(0,0,0,1),s=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(0===1-s*s)return i.v[3]=e.w,i.v[0]=e.x,i.v[1]=e.y,i.v[2]=e.z,i;{s>1?s=.999:s<-1&&(s=-.999);let r,a=Math.acos(s);s<0&&a>Math.PI/2?(s=-e.w*t.w-e.x*t.x-e.y*t.y-e.z*t.z,a=Math.acos(s),r=-1*Math.sin(a*n)/Math.sin(a)):r=Math.sin(a*n)/Math.sin(a);let o=Math.sin(a*(1-n))/Math.sin(a);return i.v[0]=e.x*o+t.x*r,i.v[1]=e.y*o+t.y*r,i.v[2]=e.z*o+t.z*r,i.v[3]=e.w*o+t.w*r,i}}static lerpTo(e,t,n,i){i.x=e.x*(1-n)+t.x*n,i.y=e.y*(1-n)+t.y*n,i.z=e.z*(1-n)+t.z*n,i.w=e.w*(1-n)+t.w*n}static qlerpTo(e,t,n,i){var s=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(0===1-s*s)i.v[3]=e.w,i.v[0]=e.x,i.v[1]=e.y,i.v[2]=e.z;else{s>1?s=.999:s<-1&&(s=-.999);let r,a=Math.acos(s);s<0&&a>Math.PI/2?(s=-e.w*t.w-e.x*t.x-e.y*t.y-e.z*t.z,a=Math.acos(s),r=-1*Math.sin(a*n)/Math.sin(a)):r=Math.sin(a*n)/Math.sin(a);let o=Math.sin(a*(1-n))/Math.sin(a);i.v[0]=e.x*o+t.x*r,i.v[1]=e.y*o+t.y*r,i.v[2]=e.z*o+t.z*r,i.v[3]=e.w*o+t.w*r}}static axisAngle(e,t){var n=.5*t,s=Math.sin(n),r=i.b.normalize(e);return new a(s*r.x,s*r.y,s*r.z,Math.cos(n))}static multiply(e,t){let n=new a(0,0,0,1);return n.v[0]=t.w*e.x+t.z*e.y-t.y*e.z+t.x*e.w,n.v[1]=-t.z*e.x+t.w*e.y+t.x*e.z+t.y*e.w,n.v[2]=t.y*e.x-t.x*e.y+t.w*e.z+t.z*e.w,n.v[3]=-t.x*e.x-t.y*e.y-t.z*e.z+t.w*e.w,n}static multiplyNumber(e,t){return new a(e.x*t,e.y*t,e.z*t,e.w*t)}static fromMatrix(e){let t=new a,n=e.m00+e.m11+e.m22;if(n>0){let i=.5/Math.sqrt(n+1);t.v[3]=.25/i,t.v[0]=(e.m21-e.m12)*i,t.v[1]=(e.m02-e.m20)*i,t.v[2]=(e.m10-e.m01)*i}else if(e.m00>e.m11&&e.m00>e.m22){let n=2*Math.sqrt(1+e.m00-e.m11-e.m22);t.v[3]=(e.m21-e.m12)/n,t.v[0]=.25*n,t.v[1]=(e.m01+e.m10)/n,t.v[2]=(e.m02+e.m20)/n}else if(e.m11>e.m22){let n=2*Math.sqrt(1+e.m11-e.m00-e.m22);t.v[3]=(e.m02-e.m20)/n,t.v[0]=(e.m01+e.m10)/n,t.v[1]=.25*n,t.v[2]=(e.m12+e.m21)/n}else{let n=2*Math.sqrt(1+e.m22-e.m00-e.m11);t.v[3]=(e.m10-e.m01)/n,t.v[0]=(e.m02+e.m20)/n,t.v[1]=(e.m12+e.m21)/n,t.v[2]=.25*n}return t}static fromPosition(e){return new a(e.x,e.y,e.z,0)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}at(e){switch(e%4){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:return}}static add(e,t){return new a(e.x+t.x,e.y+t.y,e.z+t.z,e.w+t.w)}static subtract(e,t){return new a(e.x-t.x,e.y-t.y,e.z-t.z,e.w-t.w)}toString(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}get x(){return this.v[0]}get y(){return this.v[1]}get z(){return this.v[2]}get w(){return this.v[3]}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});class i{constructor(){this.__objectUid=-1,this.__tags={},this.__conbinedTagString="",this.__objectUid=++i.currentMaxObjectCount,i.__objects[this.__objectUid]=this,this.__uniqueName="entity_of_uid_"+this.__objectUid,i.__uniqueNames[this.__objectUid]=this.__uniqueName,i.__objectsByNameMap.set(this.__uniqueName,this)}get objectUID(){return this.__objectUid}static getRnObject(e){return i.__objects[e]}static getRnObjectByName(e){return i.__objectsByNameMap.get(e)}tryToSetUniqueName(e,t){if(-1!==i.__uniqueNames.indexOf(e)){if(t){const t=e+"_("+this.__uniqueName+")";if(-1===i.__uniqueNames.indexOf(t))return this.__uniqueName=t,i.__uniqueNames[this.__objectUid]=this.__uniqueName,i.__objectsByNameMap.set(this.__uniqueName,this),!0}return!1}return this.__uniqueName=e,i.__uniqueNames[this.__objectUid]=this.__uniqueName,i.__objectsByNameMap.set(this.__uniqueName,this),!0}validateTagString(e){return!new RegExp(/[!"#$%&'()\*\+\-\s\.,\/:;<=>?@\[\\\]^`{|}~]/g).test(e)}tryToSetTag(e,t){return!(!this.validateTagString(e)||!this.validateTagString(t))&&(this.hasTag(e)&&this.removeTag(e),this.__tags[e]=t,this.__conbinedTagString+=`${e}:${t}`+" ",!0)}getTagValue(e){return this.__tags[e]}getTag(e){const t={};return t[e]=this.__tags[e],t}hasTag(e){return null!=this.__tags[e]}removeTag(e){this.__tags[e];this.__conbinedTagString.replace(this.__conbinedTagString,""),delete this.__tags[e]}matchTag(e,t){return this.__tags[e]===t}matchTagsAsFreeStrings(e){let t="^";for(let n=0;n<e.length;n++)t+=`(?=.*${e[n]})`;return!!new RegExp(t).test(this.__conbinedTagString)}matchTags(e){let t="^";for(let n in e)t+=`(?=.*${[n]}:${e[n]})`;return!!new RegExp(t).test(this.__conbinedTagString)}get uniqueName(){return this.__uniqueName}}i.__objects=[],i.InvalidObjectUID=-1,i.currentMaxObjectCount=i.InvalidObjectUID,i.__uniqueNames=[],i.__objectsByNameMap=new Map},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(10),s=n(27),r=n(30),a=n(13),o=n(8),h=n(53);class l extends s.a{constructor(e,t,n){super(e,t,n),this.__viewDepth=-Number.MAX_VALUE,this.moveStageTo(a.a.Load)}static get componentTID(){return r.a.MeshComponentTID}setMesh(e){this.__mesh=e,e._attatchedEntityUID=this.entityUID}unsetMesh(){return null!=this.__mesh&&(this.__mesh._attatchedEntityUID=h.a.invalidEntityUID,this.__mesh=void 0,!0)}get mesh(){return this.__mesh}$load(){null!=this.__mesh&&(this.__mesh.__calcTangents(),this.__mesh.weights.length>0&&this.__mesh.__calcBaryCentricCoord(),this.moveStageTo(a.a.Logic))}$logic(){this.__mesh}set weights(e){null!=this.__mesh&&(this.__mesh.weights=e)}calcViewDepth(e){const t=e.viewMatrix,n=new o.b(this.__mesh.AABB.centerPoint),i=t.multiplyVector(n);return this.__viewDepth=i.z,this.__viewDepth}get viewDepth(){return this.__viewDepth}static alertNoMeshSet(e){console.debug("No mesh is set on this MeshComponent:"+e.componentSID)}}i.a.registerComponentClass(l)},function(e,t,n){"use strict";(function(e,i){n.d(t,"a",function(){return s});class s{static isNode(){return void 0===window&&void 0!==e&&!0}static btoa(e){if(s.isNode()){let t;return(t=i.isBuffer(e)?e:new i(e.toString(),"binary")).toString("base64")}return btoa(e)}static atob(e){return s.isNode()?new i(e,"base64").toString("binary"):atob(e)}static dataUriToArrayBuffer(e){let t=e.split(","),n=(t[0].split(":")[1].split(";")[0],s.atob(t[1])),i=n.length,r=new ArrayBuffer(i),a=new Uint8Array(r);for(let e=0;e<i;e++)a[e]=n.charCodeAt(e);return r}static arrayBufferToString(e){if("undefined"!=typeof TextDecoder){return(new TextDecoder).decode(e)}{let t=new Uint8Array(e),n="",i=t.length;for(let e=0;e<i;e++)n+=String.fromCharCode(t[e]);return n}}static stringToBase64(e){let t=null;return t=s.btoa(e)}static base64ToArrayBuffer(e){for(var t=window.atob(e),n=t.length,i=new Uint8Array(n),s=0;s<n;s++)i[s]=t.charCodeAt(s);return i.buffer}static UInt8ArrayToDataURL(e,t,n){let i=document.createElement("canvas");i.width=t,i.height=n;let s=i.getContext("2d"),r=s.createImageData(t,n);for(let i=0;i<r.data.length;i+=4)r.data[i+0]=e[(n-Math.floor(i/(4*t)))*(4*t)+i%(4*t)+0],r.data[i+1]=e[(n-Math.floor(i/(4*t)))*(4*t)+i%(4*t)+1],r.data[i+2]=e[(n-Math.floor(i/(4*t)))*(4*t)+i%(4*t)+2],r.data[i+3]=e[(n-Math.floor(i/(4*t)))*(4*t)+i%(4*t)+3];return s.putImageData(r,0,0),i.remove(),i.toDataURL("image/png")}static loadResourceAsync(e,t,n,i){return new Promise((r,a)=>{if(s.isNode());else{let s=new XMLHttpRequest;t?(s.onload=e=>{let i=null;i=t?s.response:s.responseText,n(r,i)},s.open("GET",e,!0),s.responseType="arraybuffer"):(s.onreadystatechange=()=>{if(4!==s.readyState||2!==Math.floor(s.status/100)&&0!==s.status)i&&i(a,s.status);else{let e=null;e=t?s.response:s.responseText,n(r,e)}},s.open("GET",e,!0)),s.send(null)}})}static toCRC32(e){var t=0;var n="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".split(" ");t^=-1;for(var i=0,s=e.length;i<s;++i)t=t>>>8^"0x"+n[255&(t^e.charCodeAt(i))];return(-1^t)>>>0}}}).call(this,n(67),n(70).Buffer)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(28),s=n(37),r=n(18),a=n(13),o=n(10),h=n(17),l=n(12),c=n(24);class u extends c.a{constructor(e,t,n){super(),this.__currentProcessStage=a.a.Create,this.__byteOffsetOfThisComponent=-1,this.__maxComponentNumber=h.a.maxEntityNumber,this.__entityUid=e,this._component_sid=t,this.__isAlive=!0,[a.a.Create,a.a.Load,a.a.Mount,a.a.Logic,a.a.PreRender,a.a.Render,a.a.Unmount,a.a.Discard].forEach(e=>{this.isExistProcessStageMethod(e)&&null==u.__componentsOfProcessStages.get(e)&&(u.__componentsOfProcessStages.set(e,new Int32Array(h.a.maxEntityNumber)),u.__lengthOfArrayOfProcessStages.set(e,0))}),this.__memoryManager=i.a.getInstance(),this.__entityRepository=n}set maxNumberOfComponent(e){this.__maxComponentNumber=e}get maxNumberOfComponent(){return this.__maxComponentNumber}moveStageTo(e){this.__currentProcessStage=e}static get componentTID(){return 0}get componentSID(){return this._component_sid}get entityUID(){return this.__entityUid}get currentProcessStage(){return this.__currentProcessStage}static isExistProcessStageMethod(e,t,n){const i=n.getComponent(e,0);return null!=i&&null!=i[t.methodName]}isExistProcessStageMethod(e){return null!=this[e.methodName]}static process({componentType:e,processStage:t,processApproach:n,componentRepository:i,strategy:s,renderPass:r,renderPassTickCount:a}){if(!u.isExistProcessStageMethod(e,t,i))return;const o=t.methodName,h=this.__componentsOfProcessStages.get(t),l=i._getComponents(e);for(let e=0;e<h.length;++e){const i=h[e];if(i===u.invalidComponentSID)return;l[i][o]({i:e,processStage:t,processApproach:n,strategy:s,renderPass:r,renderPassTickCount:a})}}static updateComponentsOfEachProcessStage(e,t,n,i){if(!u.isExistProcessStageMethod(e,t,n))return;if(u.__componentsOfProcessStages.get(t)){const s=e["sort_"+t.methodName],r=n.getComponentsWithType(e),a=u.__componentsOfProcessStages.get(t);let o=[];if(null!=s){o=s(i);for(let e=0;e<o.length;e++)a[e]=o[e]}if(0===o.length){let e=0;for(let n=0;n<r.length;++n){t===r[n].__currentProcessStage&&(a[e++]=n)}a[e]=u.invalidComponentSID}}}static getByteLengthSumOfMembers(e,t){return this.__byteLengthSumOfMembers.get(t).get(e)}static setupBufferView(){}registerDependency(e,t){}static takeBufferView(e,t,n,s){const r=i.a.getInstance().getBuffer(e);this.__bufferViews.has(t)||this.__bufferViews.set(t,new Map);const a=this.__bufferViews.get(t);if(!a.has(e)){const t=r.takeBufferView({byteLengthToNeed:n*s,byteStride:0,isAoS:!1,byteAlign:16});return a.set(e,t),t}}takeOne(e,t,n){if(!this["_"+e].isDummy())return;let i=u.__accessors.get(this.constructor).get(e).takeOne();t===r.a||l.a,this["_"+e]=new t(i,!1,!0);for(let t=0;t<this["_"+e].v.length;++t)this["_"+e].v[t]=n[t];return null}static getAccessor(e,t){return this.__accessors.get(t).get(e)}static takeAccessor(e,t,n,i,s,r){this.__accessors.has(n)||this.__accessors.set(n,new Map);const a=this.__accessors.get(n);if(!a.has(t)){const o=this.__bufferViews.get(n);i.getNumberOfComponents(),s.getSizeInBytes();let h=0;const l=o.get(e).takeFlexibleAccessor({compositionType:i,componentType:s,count:r,byteStride:h,byteAlign:16});return a.set(t,l),l}}static getByteOffsetOfThisComponentTypeInBuffer(e,t){return this.__bufferViews.get(t).get(e).byteOffset}static getByteOffsetOfFirstOfThisMemberInBuffer(e,t){return this.__accessors.get(t).get(e).byteOffsetInBuffer}static getByteOffsetOfFirstOfThisMemberInBufferView(e,t){return this.__accessors.get(t).get(e).byteOffsetInBufferView}static getCompositionTypeOfMember(e,t){const n=this.__memberInfo.get(t).find(t=>t.memberName===e);return null!=n?n.compositionType:null}static getComponentTypeOfMember(e,t){const n=this.__memberInfo.get(t).find(t=>t.memberName===e);return null!=n?n.componentType:null}registerMember(e,t,n,i,s){u.__memberInfo.has(this.constructor)||u.__memberInfo.set(this.constructor,[]),u.__memberInfo.get(this.constructor).push({bufferUse:e,memberName:t,dataClassType:n,compositionType:n.compositionType,componentType:i,initValues:s})}submitToAllocation(e){const t=this.constructor,n=u.__memberInfo.get(t);if(0===this._component_sid){u.__members.has(t)||u.__members.set(t,new Map);const i=u.__members.get(t);n.forEach(e=>{i.set(e.bufferUse,[])}),n.forEach(e=>{i.get(e.bufferUse).push(e)});for(let n of i.keys()){const s=i.get(n);u.__byteLengthSumOfMembers.has(t)||u.__byteLengthSumOfMembers.set(t,new Map);let r=u.__byteLengthSumOfMembers.get(t);if(r.has(n)||r.set(n,0),s.forEach(e=>{r.set(n,r.get(n)+e.compositionType.getNumberOfComponents()*e.componentType.getSizeInBytes())}),s.length>0){const i=u.takeBufferView(n,t,r.get(n),e);this.__byteOffsetOfThisComponent=i.byteOffset}}for(let n of i.keys()){i.get(n).forEach(n=>{const i=u.takeAccessor(n.bufferUse,n.memberName,t,n.compositionType,n.componentType,e);this["_byteOffsetOfAccessorInBuffer_"+n.memberName]=i.byteOffsetInBuffer,this["_byteOffsetOfAccessorInComponent_"+n.memberName]=i.byteOffsetInBufferView})}}const i=u.__members.get(t);for(let e of i.keys()){i.get(e).forEach(e=>{this.takeOne(e.memberName,e.dataClassType,e.initValues)})}}get entity(){return this.__entityRepository.getEntity(this.__entityUid)}static getDataByteInfoInner(e,t){const n=e["_"+t].v,i=n.byteOffset,s=n.byteLength,r=n.length,a=i/4/4;return{byteLength:s,byteOffsetInBuffer:i,byteOffsetInThisComponent:this["_byteOffsetOfAccessorInComponent_"+t]+e.componentSID*r*4,locationOffsetInBuffer:a,locationOffsetInThisComponent:this["_byteOffsetOfAccessorInComponent_"+t]+e.componentSID*r,thisComponentByteOffsetInBuffer:e.__byteOffsetOfThisComponent,thisComponentLocationOffsetInBuffer:e.__byteOffsetOfThisComponent/4/4,componentNumber:r}}getDataByteInfo(e){return u.getDataByteInfoInner(this,e)}static getDataByteInfoByComponentSID(e,t,n){const i=o.a.getInstance().getComponent(e,t);if(i)return u.getDataByteInfoInner(i,n)}static getDataByteInfoByEntityUID(e,t,n){const i=s.a.getInstance().getComponentOfEntity(t,e);if(i)return u.getDataByteInfoInner(i,n)}static getLocationOffsetOfMemberOfComponent(e,t){return o.a.getInstance().getComponent(e,0)["_byteOffsetOfAccessorInBuffer_"+t]/4/4}}u.invalidComponentSID=-1,u.__componentsOfProcessStages=new Map,u.__lengthOfArrayOfProcessStages=new Map,u.__bufferViews=new Map,u.__accessors=new Map,u.__byteLengthSumOfMembers=new Map,u.__memberInfo=new Map,u.__members=new Map},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(52),s=n(11);class r{constructor(e,t,n,a){this.__buffers={};{let t=r.bufferWidthLength*r.bufferHeightLength*4*8*e;const n=new ArrayBuffer(this.__makeMultipleOf4byteSize(t)),a=new i.a({byteLength:n.byteLength,arrayBuffer:n,name:s.a.CPUGeneric.toString()});this.__buffers[a.name]=a}{let e=r.bufferWidthLength*r.bufferHeightLength*4*8*t;const n=new ArrayBuffer(this.__makeMultipleOf4byteSize(e)),a=new i.a({byteLength:n.byteLength,arrayBuffer:n,name:s.a.GPUInstanceData.toString()});this.__buffers[a.name]=a}{let e=r.bufferWidthLength*r.bufferHeightLength*4*8*n;const t=new ArrayBuffer(this.__makeMultipleOf4byteSize(e)),a=new i.a({byteLength:t.byteLength,arrayBuffer:t,name:s.a.GPUVertexData.toString()});this.__buffers[a.name]=a}{let e=r.bufferWidthLength*r.bufferHeightLength*4*8*a;const t=new ArrayBuffer(this.__makeMultipleOf4byteSize(e)),n=new i.a({byteLength:t.byteLength,arrayBuffer:t,name:s.a.UBOGeneric.toString()});this.__buffers[n.name]=n}}static createInstanceIfNotCreated(e,t,n,i){return this.__instance?this.__instance:(this.__instance=new r(e,t,n,i),this.__instance)}__makeMultipleOf4byteSize(e){return e+4-e%4}static getInstance(){return this.__instance}getBuffer(e){return this.__buffers[e.toString()]}static get bufferWidthLength(){return r.__bufferWidthLength}static get bufferHeightLength(){return r.__bufferHeightLength}printMemoryUsage(){const e=this.__buffers[s.a.CPUGeneric.toString()],t=this.__buffers[s.a.GPUInstanceData.toString()],n=this.__buffers[s.a.GPUVertexData.toString()],i=this.__buffers[s.a.UBOGeneric.toString()];console.log("Memory Usage in Memory Manager:"),console.log(`CPUGeneric: ${e.takenSizeInByte} byte of ${e.byteLength} bytes. (${e.takenSizeInByte/e.byteLength*100} %) `),console.log(`GPUInstanceData: ${t.takenSizeInByte} byte of ${t.byteLength} bytes. (${t.takenSizeInByte/t.byteLength*100} %) `),console.log(`GPUVertexData: ${n.takenSizeInByte} byte of ${n.byteLength} bytes. (${n.takenSizeInByte/n.byteLength*100} %) `),console.log(`UBOGeneric: ${i.takenSizeInByte} byte of ${i.byteLength} bytes. (${i.takenSizeInByte/i.byteLength*100} %) `)}}r.__bufferWidthLength=Math.pow(2,12),r.__bufferHeightLength=Math.pow(2,12)},function(e,t,n){"use strict";var i=n(22),s=n(2),r=n(8),a=n(23),o=n(35),h=n(18),l=n(0),c=n(12),u=n(33),_=n(21),m=n(15),d=n(49),f=n(19),p=n(41);class g extends f.a{constructor(e,{type:t}){super(e,{type:t})}get x(){return this.v[0]}set x(e){this.v[0]=e}setValue(e){this.x=e}}class v extends g{constructor(e){super(e,{type:Float32Array})}clone(){return new v(this.x)}static one(){return new v(1)}static dummy(){return new v(null)}static zero(){return new v(0)}}var x=n(36);n.d(t,"a",function(){return y});class y{constructor(){}static arrayToVector(e){return Array.isArray(e)?void 0!==e[3]?new r.b(e[0],e[1],e[2],e[3]):void 0!==e[2]?new s.b(e[0],e[1],e[2]):new i.b(e[0],e[1]):e}static arrayToVectorOrMatrix(e){return Array.isArray(e)?void 0!==e[15]?new h.a(e):void 0!==e[8]?new o.a(e):void 0!==e[3]?new r.b(e[0],e[1],e[2],e[3]):void 0!==e[2]?new s.b(e[0],e[1],e[2]):new i.b(e[0],e[1]):e}static getImmutableValueClass(e){return e===l.a.Vec2?i.b:e===l.a.Vec3?s.b:e===l.a.Vec4?r.b:e===l.a.Mat3?o.a:e===l.a.Mat4?h.a:void 0}static getMutableValueClass(e){return e===l.a.Vec2?d.a:e===l.a.Vec3?m.a:e===l.a.Vec4?_.a:e===l.a.Mat3?u.a:e===l.a.Mat4?c.a:void 0}static cloneOfMathObjects(e){return e instanceof h.a?e.clone():e instanceof o.a?e.clone():e instanceof r.b?e.clone():e instanceof s.b?e.clone():e instanceof i.b?e.clone():e}static isAcceptableArrayForQuaternion(e){return!(!Array.isArray(e)||void 0===e[3])}static arrayToQuaternion(e){return new a.a(e[0],e[1],e[2],e[3])}static makeSubArray(e,t){return 4===t?[e[0],e[1],e[2],e[3]]:3===t?[e[0],e[1],e[2]]:2===t?[e[0],e[1]]:e[0]}static vectorToArray(e){return e instanceof i.b?[e.x,e.v]:e instanceof s.b?[e.x,e.v,e.z]:e instanceof r.b||e instanceof a.a?[e.x,e.v,e.z,e.w]:e}static compomentNumberOfVector(e){return e instanceof i.b?2:e instanceof s.b?3:e instanceof r.b||e instanceof a.a?4:Array.isArray(e)?e.length:0}static packNormalizedVec4ToVec2(e,t,n,i,s){let r=0,a=0;return e=(e+1)/2,t=(t+1)/2,n=(n+1)/2,i=(i+1)/2,[r=(Math.floor(e*(s-1))*s+Math.floor(t*(s-1)))/s,a=(Math.floor(n*(s-1))*s+Math.floor(i*(s-1)))/s]}static unProject(e,t,n,i,a){const o=new r.b((e.x-n.x)/n.z*2-1,(e.y-n.y)/n.w*2-1,2*e.z-1,1),h=t.multiplyVector(o);return 0===h.w&&console.warn("Zero division!"),new s.b(r.b.multiply(h,1/h.w))}static add(e,t){if(isFinite(e))return e+t;if(e instanceof i.b)return i.b.add(e,t);if(e instanceof s.b)return s.b.add(e,t);if(e instanceof r.b)return r.b.add(e,t);if(e instanceof a.a)return a.a.add(e,t);if(Array.isArray(e)){const n=[];for(let i=0;i<e.length;i++)n[i]=e[i]+t[i];return n}console.error("Non supported type!")}static subtract(e,t){if(isFinite(e))return e-t;if(e instanceof i.b)return i.b.subtract(e,t);if(e instanceof s.b)return s.b.subtract(e,t);if(e instanceof r.b)return r.b.subtract(e,t);if(e instanceof a.a)return a.a.subtract(e,t);if(Array.isArray(e)){const n=[];for(let i=0;i<e.length;i++)n[i]=e[i]-t[i];return n}console.error("Non supported type!")}static multiplyNumber(e,t){if(isFinite(e))return e*t;if(e instanceof i.b)return i.b.multiply(e,t);if(e instanceof s.b)return s.b.multiply(e,t);if(e instanceof r.b)return r.b.multiply(e,t);if(e instanceof a.a)return a.a.multiplyNumber(e,t);if(Array.isArray(e)){const n=[];for(let i=0;i<e.length;i++)n[i]=e[i]*t;return n}console.error("Non supported type!")}static divideNumber(e,t){if(isFinite(e))return e/t;if(e instanceof i.b)return i.b.multiply(e,1/t);if(e instanceof s.b)return s.b.multiply(e,1/t);if(e instanceof r.b)return r.b.multiply(e,1/t);if(e instanceof a.a)return a.a.multiplyNumber(e,1/t);if(Array.isArray(e)){const n=[];for(let i=0;i<e.length;i++)n[i]=e[i]/t;return n}console.error("Non supported type!")}static initWithScalar(e,t){if(isFinite(e))return t;if(e instanceof i.b)return new i.b(t,t);if(e instanceof s.b)return new s.b(t,t,t);if(e instanceof r.b)return new r.b(t,t,t,t);if(e instanceof a.a)return new a.a(0,0,0,1);if(Array.isArray(e)){const n=[];for(let i=0;i<e.length;i++)n[i]=t;return n}console.error("Non supported type!")}static initWithFloat32Array(e,t,n,l){let g;if(isFinite(e)){const e=new Float32Array(n);return e[0]=t,new f.b(e)}if(e instanceof f.b||e instanceof v)n[0]=t.x,g=new v(n);else if(e instanceof i.b||e instanceof d.a)n[0]=t.x,n[1]=t.y,g=new d.a(n);else if(e instanceof s.b||e instanceof m.a)n[0]=t.x,n[1]=t.y,n[2]=t.z,g=new m.a(n);else if(e instanceof r.b||e instanceof _.a)n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w,g=new _.a(n);else if(e instanceof a.a||e instanceof p.a)n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w,g=new p.a(n);else if(e instanceof o.a||e instanceof u.a)(g=null==g?new u.a(n):g).m00=t.m00,g.m01=t.m01,g.m02=t.m02,g.m10=t.m10,g.m11=t.m11,g.m12=t.m12,g.m20=t.m20,g.m21=t.m21,g.m22=t.m22;else if(e instanceof h.a||e instanceof c.a)(g=new c.a(n)).m00=t.m00,g.m01=t.m01,g.m02=t.m02,g.m03=t.m03,g.m10=t.m10,g.m11=t.m11,g.m12=t.m12,g.m13=t.m13,g.m20=t.m20,g.m21=t.m21,g.m22=t.m22,g.m23=t.m23,g.m30=t.m30,g.m31=t.m31,g.m32=t.m32,g.m33=t.m33;else{if(!(e instanceof x.a)){if(null==e){let e;switch(n.length){case 4:e=new r.b(n);break;case 3:e=new s.b(n);break;case 2:e=new i.b(n);break;case 1:e=new f.b(n)}return e}return Array.isArray(e)||ArrayBuffer.isView(e)||ArrayBuffer.isView(e.v)?e:void console.error("Non supported type!")}g=new x.a(n)}return g}static _setForce(e,t){if(e instanceof r.b||e instanceof _.a)e.v[0]=t.v[0],e.v[1]=t.v[1],e.v[2]=t.v[2],e.v[3]=t.v[3];else if(e instanceof s.b||e instanceof m.a)e.v[0]=t.v[0],e.v[1]=t.v[1],e.v[2]=t.v[2];else if(e instanceof i.b||e instanceof d.a)e.v[0]=t.v[0],e.v[1]=t.v[1];else if(e instanceof f.b||e instanceof v)void 0===t.v?e.v[0]=t:e.v[0]=t.v[0];else if(e instanceof o.a||e instanceof u.a)e.v[0]=t.v[0],e.v[1]=t.v[1],e.v[2]=t.v[2],e.v[3]=t.v[3],e.v[4]=t.v[4],e.v[5]=t.v[5],e.v[6]=t.v[6],e.v[7]=t.v[7],e.v[8]=t.v[8];else if(e instanceof h.a||e instanceof c.a)e.v[0]=t.v[0],e.v[1]=t.v[1],e.v[2]=t.v[2],e.v[3]=t.v[3],e.v[4]=t.v[4],e.v[5]=t.v[5],e.v[6]=t.v[6],e.v[7]=t.v[7],e.v[8]=t.v[8],e.v[9]=t.v[9],e.v[10]=t.v[10],e.v[11]=t.v[11],e.v[12]=t.v[12],e.v[13]=t.v[13],e.v[14]=t.v[14],e.v[15]=t.v[15];else if(e instanceof a.a||e instanceof p.a)e.v[0]=t.v[0],e.v[1]=t.v[1],e.v[2]=t.v[2],e.v[3]=t.v[3];else if(e instanceof x.a){let n;n=t instanceof x.a?t.v:t;for(let t=0;t<n.length;t++)e.v[t]=n[t]}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=t.v[n];else if(isNaN(e.v.length))console.warn("Unknown type _setForce");else for(let n=0;n<e.v.length;n++)Array.isArray(t)?e.v[n]=t[n]:e.v[n]=t.v[n]}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});const i=Object.freeze({AnimationComponentTID:1,TransformComponentTID:2,SceneGraphComponentTID:3,MeshComponentTID:4,MeshRendererComponentTID:5,CameraControllerComponentTID:6,CameraComponentTID:7,LightComponentTID:8,SkeletalComponentTID:9,BlendShapeComponentTID:10,SparkGearComponentTID:11,EffekseerComponentTID:12,maxWellKnownTidNumber:12})},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var i=n(10),s=n(27),r=n(18),a=n(1),o=n(30),h=n(11),l=n(13),c=n(12),u=n(33),_=n(2),m=n(54),d=n(15),f=n(55);class p extends s.a{constructor(e,t,n){super(e,t,n),this.__children=[],this._worldMatrix=c.a.dummy(),this._normalMatrix=u.a.dummy(),this.__isWorldMatrixUpToDate=!1,this.__isNormalMatrixUpToDate=!1,this.__tmpMatrix=c.a.identity(),this.__worldAABB=new m.a,this.__isWorldAABBDirty=!0,this.isVisible=!0,this.isRootJoint=!1,this.jointIndex=-1,this._jointsOfHierarchies=[];p.__sceneGraphs.push(this),this.isAbleToBeParent=!1,this.beAbleToBeParent(!0),this.registerMember(h.a.GPUInstanceData,"worldMatrix",c.a,a.a.Float,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.registerMember(h.a.GPUInstanceData,"normalMatrix",u.a,a.a.Float,[1,0,0,0,1,0,0,0,1]),this.submitToAllocation(this.maxNumberOfComponent)}static getTopLevelComponents(){return p.__sceneGraphs.filter(e=>e.isTopLevel)}isJoint(){return this.jointIndex>=0}static get componentTID(){return o.a.SceneGraphComponentTID}beAbleToBeParent(e){this.isAbleToBeParent=e}setWorldMatrixDirty(){this.__isWorldMatrixUpToDate=!1,this.__isNormalMatrixUpToDate=!1,this.__isWorldAABBDirty=!0}addChild(e){null!=this.__children?(e.__parent=this,this.__children.push(e)):console.error("This is not allowed to have children.")}applyFunctionRecursively(e,t){for(let n of this.__children)e(n,t),n.applyFunctionRecursively(e,t)}get isTopLevel(){return null==this.__parent}get children(){return this.__children}get parent(){return this.__parent}get worldMatrixInner(){return this.__isWorldMatrixUpToDate||(this._worldMatrix.copyComponents(this.calcWorldMatrixRecursively(!1)),this.__isWorldMatrixUpToDate=!0),this._worldMatrix}get worldMatrix(){return this.worldMatrixInner.clone()}get normalMatrixInner(){return this.__isNormalMatrixUpToDate||(r.a.invertTo(this.worldMatrixInner,p.invertedMatrix44),this._normalMatrix.copyComponents(p.invertedMatrix44.transpose()),this.__isNormalMatrixUpToDate=!0),this._normalMatrix}get normalMatrix(){return this.normalMatrixInner.clone()}$create(){this.moveStageTo(l.a.Load)}$load(){this.__animationComponent=this.entity.getComponent(f.a),this.moveStageTo(l.a.Logic)}$logic(){this._worldMatrix.copyComponents(this.calcWorldMatrixRecursively(!1));this.normalMatrixInner}static common_$prerender(){}isWorldMatrixUpToDateRecursively(){if(this.__isWorldMatrixUpToDate){if(this.__parent){return this.__parent.isWorldMatrixUpToDateRecursively()}return!0}return!1}calcWorldMatrixRecursively(e){const t=this.__entityRepository.getEntity(this.__entityUid).getTransform();if(this.__isWorldMatrixUpToDate)return this._worldMatrix;{const n=t.matrixInner;if(null==this.__parent||e&&null!=this.__parent&&!this.__parent.isJoint())return n;let i;this.__tmpMatrix.copyComponents(n),i=this.isWorldMatrixUpToDateRecursively()?this.__parent._worldMatrix:this.__parent.calcWorldMatrixRecursively(e),this.__tmpMatrix.multiplyByLeft(i)}return this.__tmpMatrix}static flattenHierarchy(e,t){const n=[];if(t&&!e.isJoint()||n.push(e),e.isAbleToBeParent){const i=e.children;for(let e=0;e<i.length;e++){const s=this.flattenHierarchy(i[e],t);Array.prototype.push.apply(n,s)}}return n}get worldPosition(){const e=p.__originVector3;return this.worldMatrixInner.multiplyVector3To(e,p.returnVector3),p.returnVector3}calcWorldAABB(){var e=function e(t,n){const i=t.entity.getComponentByComponentTID(o.a.MeshComponentTID);null!=i&&null!=i.mesh&&m.a.multiplyMatrixTo(t.worldMatrixInner,i.mesh.AABB,t.__worldAABB);var s=t.children;for(let i=0;i<s.length;i++){var r=e(s[i],!0);n&&null==t.__animationComponent?t.worldAABB.mergeAABB(r):t.__worldAABB.mergeAABB(r)}return t.__worldAABB}(this,!1);return this.__worldAABB.mergeAABB(e),this.__worldAABB}get worldAABB(){return this.__isWorldAABBDirty&&(this.calcWorldAABB(),this.__isWorldAABBDirty=!1),this.__worldAABB}setVisibilityRecursively(e){this.isVisible=e;for(let t of this.__children)t.setVisibilityRecursively(e)}}p.__sceneGraphs=[],p._isAllUpdate=!1,p.__originVector3=_.b.zero(),p.returnVector3=d.a.zero(),p.invertedMatrix44=new c.a([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),i.a.registerComponentClass(p)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:0,str:"Neutral"}),a=new s({index:1,str:"Visible"}),o=new s({index:-1,str:"Invisible"}),h=[a,o,r];const l=Object.freeze({Visible:a,Invisible:o,Neutral:r,from:function(e){return Object(i.b)({typeList:h,index:e})},fromString:function(e){return Object(i.c)({typeList:h,str:e})}})},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(35),s=n(0);class r extends i.a{constructor(e,t,n,i,s,r,a,o,h,l=!1,c=!1){super(e,t,n,i,s,r,a,o,h,l)}setComponents(e,t,n,i,s,r,a,o,h){return this.v[0]=e,this.v[3]=t,this.v[6]=n,this.v[1]=i,this.v[4]=s,this.v[7]=r,this.v[2]=a,this.v[5]=o,this.v[8]=h,this}copyComponents(e){const t=e;this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m20=t.m20,this.m21=t.m21,this.m22=t.m22}static get compositionType(){return s.a.Mat3}static dummy(){return new r(null)}identity(){return this.setComponents(1,0,0,0,1,0,0,0,1),this}rotateX(e){var t=Math.cos(e),n=Math.sin(e);return this.setComponents(1,0,0,0,t,-n,0,n,t)}rotateY(e){var t=Math.cos(e),n=Math.sin(e);return this.setComponents(t,0,n,0,1,0,-n,0,t),this}rotateZ(e){var t=Math.cos(e),n=Math.sin(e);return this.setComponents(t,-n,0,n,t,0,0,0,1)}static rotateX(e){var t=Math.cos(e),n=Math.sin(e);return new r(1,0,0,0,t,-n,0,n,t)}static rotateY(e){var t=Math.cos(e),n=Math.sin(e);return new r(t,0,n,0,1,0,-n,0,t)}static rotateZ(e){var t=Math.cos(e),n=Math.sin(e);return new r(t,-n,0,n,t,0,0,0,1)}scale(e){return this.setComponents(e.x,0,0,0,e.y,0,0,0,e.z)}static rotateXYZ(e,t,n){return r.rotateZ(n).multiply(r.rotateY(t).multiply(r.rotateX(e)))}static rotate(e){return r.rotateZ(e.z).multiply(r.rotateY(e.y).multiply(r.rotateX(e.x)))}zero(){return this.setComponents(0,0,0,0,0,0,0,0,0),this}raw(){return this.v}flattenAsArray(){return[this.v[0],this.v[1],this.v[2],this.v[3],this.v[4],this.v[5],this.v[6],this.v[7],this.v[8]]}_swap(e,t){this.v[t]=[this.v[e],this.v[e]=this.v[t]][0]}transpose(){return this._swap(1,3),this._swap(2,6),this._swap(5,8),this}multiply(e){var t=this.m00*e.m00+this.m01*e.m10+this.m02*e.m20,n=this.m00*e.m01+this.m01*e.m11+this.m02*e.m21,i=this.m00*e.m02+this.m01*e.m12+this.m02*e.m22,s=this.m10*e.m00+this.m11*e.m10+this.m12*e.m20,r=this.m10*e.m01+this.m11*e.m11+this.m12*e.m21,a=this.m10*e.m02+this.m11*e.m12+this.m12*e.m22,o=this.m20*e.m00+this.m21*e.m10+this.m22*e.m20,h=this.m20*e.m01+this.m21*e.m11+this.m22*e.m21,l=this.m20*e.m02+this.m21*e.m12+this.m22*e.m22;return this.setComponents(t,n,i,s,r,a,o,h,l)}invert(){var e=this.determinant(),t=(this.m11*this.m22-this.m12*this.m21)/e,n=(this.m02*this.m21-this.m01*this.m22)/e,i=(this.m01*this.m12-this.m02*this.m11)/e,s=(this.m12*this.m20-this.m10*this.m22)/e,r=(this.m00*this.m22-this.m02*this.m20)/e,a=(this.m02*this.m10-this.m00*this.m12)/e,o=(this.m10*this.m21-this.m11*this.m20)/e,h=(this.m01*this.m20-this.m00*this.m21)/e,l=(this.m00*this.m11-this.m01*this.m10)/e;return this.setComponents(t,n,i,s,r,a,o,h,l)}addScale(e){return this.m00*=e.x,this.m11*=e.y,this.m22*=e.z,this}set m00(e){this.v[0]=e}get m00(){return this.v[0]}set m10(e){this.v[1]=e}get m10(){return this.v[1]}set m20(e){this.v[2]=e}get m20(){return this.v[2]}set m01(e){this.v[3]=e}get m01(){return this.v[3]}set m11(e){this.v[4]=e}get m11(){return this.v[4]}set m21(e){this.v[5]=e}get m21(){return this.v[5]}set m02(e){this.v[6]=e}get m02(){return this.v[6]}set m12(e){this.v[7]=e}get m12(){return this.v[7]}set m22(e){this.v[8]=e}get m22(){return this.v[8]}}},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(24);class s extends i.a{constructor(){super(),this.__width=0,this.__height=0,this.__hasTransparentPixels=!1,this.cgApiResourceUid=-1,this.__isTextureReady=!1,this.__startedToLoad=!1,this.__name="untitled",this.__textureUid=++s.__textureUidCount}get textureUID(){return this.__textureUid}get width(){return this.__width}get height(){return this.__height}get isTextureReady(){return this.__isTextureReady}get startedToLoad(){return this.__startedToLoad}__getNearestPowerOfTwo(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))}get htmlImageElement(){return this.__htmlImageElement}get htmlCanvasElement(){return this.__htmlCanvasElement}get uri(){return this.__uri}static getRhodoniteTexture(e){return this.__textureMap.get(e)}set name(e){this.__name=e}get name(){return this.__name}get isTransparent(){return this.__hasTransparentPixels}}s.InvalidTextureUid=-1,s.__textureUidCount=s.InvalidTextureUid,s.__textureMap=new Map},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(2),s=n(0);class r{constructor(e,t,n,i,s,r,a,o,h,l=!1,c=!1){const u=10===arguments.length?l:t,_=3===arguments.length?c:n,m=e;if(null!=m)if(9===arguments.length)if(this.v=new Float32Array(9),!0===u){let e=arguments;this.v[0]=e[0],this.v[3]=e[3],this.v[6]=e[6],this.v[1]=e[1],this.v[4]=e[4],this.v[7]=e[7],this.v[2]=e[2],this.v[5]=e[5],this.v[8]=e[8]}else{let e=arguments;this.v[0]=e[0],this.v[3]=e[1],this.v[6]=e[2],this.v[1]=e[3],this.v[4]=e[4],this.v[7]=e[5],this.v[2]=e[6],this.v[5]=e[7],this.v[8]=e[8]}else if(Array.isArray(m))this.v=new Float32Array(9),!0===u?(this.v[0]=m[0],this.v[3]=m[3],this.v[6]=m[6],this.v[1]=m[1],this.v[4]=m[4],this.v[7]=m[7],this.v[2]=m[2],this.v[5]=m[5],this.v[8]=m[8]):(this.v[0]=m[0],this.v[3]=m[1],this.v[6]=m[2],this.v[1]=m[3],this.v[4]=m[4],this.v[7]=m[5],this.v[2]=m[6],this.v[5]=m[7],this.v[8]=m[8]);else if(m instanceof Float32Array)_?this.v=m:(this.v=new Float32Array(9),!0===u?(this.v[0]=m[0],this.v[3]=m[3],this.v[6]=m[6],this.v[1]=m[1],this.v[4]=m[4],this.v[7]=m[7],this.v[2]=m[2],this.v[5]=m[5],this.v[8]=m[8]):(this.v[0]=m[0],this.v[3]=m[1],this.v[6]=m[2],this.v[1]=m[3],this.v[4]=m[4],this.v[7]=m[5],this.v[2]=m[6],this.v[5]=m[7],this.v[8]=m[8]));else if(m&&void 0!==m.v[8])if(_)this.v=m.v;else if(this.v=new Float32Array(9),!0===u){const e=m.v;this.v[0]=e[0],this.v[3]=e[3],this.v[6]=e[6],this.v[1]=e[1],this.v[4]=e[4],this.v[7]=e[7],this.v[2]=e[2],this.v[5]=e[5],this.v[8]=e[8]}else{const e=m.v;this.v[0]=e[0],this.v[3]=e[1],this.v[6]=e[2],this.v[1]=e[3],this.v[4]=e[4],this.v[7]=e[5],this.v[2]=e[6],this.v[5]=e[7],this.v[8]=e[8]}else if(m&&void 0!==m.className&&"Quaternion"===m.className){this.v=new Float32Array(9);const e=m,t=e.x*e.x,n=e.y*e.y,i=e.z*e.z,s=e.y*e.z,r=e.x*e.z,a=e.x*e.y,o=e.w*e.x,h=e.w*e.y,l=e.w*e.z;this.v[0]=1-2*(n+i),this.v[3]=2*(a-l),this.v[6]=2*(r+h),this.v[1]=2*(a+l),this.v[4]=1-2*(t+i),this.v[7]=2*(s-o),this.v[2]=2*(r-h),this.v[5]=2*(s+o),this.v[8]=1-2*(t+n)}else this.v=new Float32Array(9),this.v[0]=1,this.v[3]=0,this.v[6]=0,this.v[1]=0,this.v[4]=1,this.v[7]=0,this.v[2]=0,this.v[5]=0,this.v[8]=1;else this.v=new Float32Array(0)}get className(){return this.constructor.name}static get compositionType(){return s.a.Mat3}multiplyVector(e){var t=this.v[0]*e.x+this.v[3]*e.y+this.v[6]*e.z,n=this.v[1]*e.x+this.v[4]*e.y+this.v[7]*e.z,i=this.v[2]*e.x+this.v[5]*e.y+this.v[8]*e.z;return new e.constructor(t,n,i)}static identity(){return new r(1,0,0,0,1,0,0,0,1)}static dummy(){return new r(null)}isDummy(){return 0===this.v.length}clone(){return new r(this.v[0],this.v[3],this.v[6],this.v[1],this.v[4],this.v[7],this.v[2],this.v[5],this.v[8])}static rotateX(e){var t=Math.cos(e),n=Math.sin(e);return new r(1,0,0,0,t,-n,0,n,t)}static rotateY(e){var t=Math.cos(e),n=Math.sin(e);return new r(t,0,n,0,1,0,-n,0,t)}static rotateZ(e){var t=Math.cos(e),n=Math.sin(e);return new r(t,-n,0,n,t,0,0,0,1)}static rotateXYZ(e,t,n){return r.multiply(r.multiply(r.rotateZ(n),r.rotateY(t)),r.rotateX(e))}static rotate(e){return r.multiply(r.multiply(r.rotateZ(e.z),r.rotateY(e.y)),r.rotateX(e.x))}static scale(e){return new r(e.x,0,0,0,e.y,0,0,0,e.z)}static zero(){return new r(0,0,0,0,0,0,0,0,0)}static transpose(e){return new r(e.m00,e.m10,e.m20,e.m01,e.m11,e.m21,e.m02,e.m12,e.m22)}static multiply(e,t){var n=e.v[0]*t.v[0]+e.v[3]*t.v[1]+e.v[6]*t.v[2],i=e.v[1]*t.v[0]+e.v[4]*t.v[1]+e.v[7]*t.v[2],s=e.v[2]*t.v[0]+e.v[5]*t.v[1]+e.v[8]*t.v[2],a=e.v[0]*t.v[3]+e.v[3]*t.v[4]+e.v[6]*t.v[5],o=e.v[1]*t.v[3]+e.v[4]*t.v[4]+e.v[7]*t.v[5],h=e.v[2]*t.v[3]+e.v[5]*t.v[4]+e.v[8]*t.v[5],l=e.v[0]*t.v[6]+e.v[3]*t.v[7]+e.v[6]*t.v[8],c=e.v[1]*t.v[6]+e.v[4]*t.v[7]+e.v[7]*t.v[8],u=e.v[2]*t.v[6]+e.v[5]*t.v[7]+e.v[8]*t.v[8];return new r(n,a,l,i,o,c,s,h,u)}determinant(){return this.v[0]*this.v[4]*this.v[8]+this.v[1]*this.v[5]*this.v[6]+this.v[2]*this.v[3]*this.v[7]-this.v[0]*this.v[5]*this.v[7]-this.v[2]*this.v[4]*this.v[6]-this.v[1]*this.v[3]*this.v[8]}static determinant(e){return e.m00*e.m11*e.m22+e.m10*e.m21*e.m02+e.m20*e.m01*e.m12-e.m00*e.m21*e.m12-e.m20*e.m11*e.m02-e.m10*e.m01*e.m22}static invert(e){var t=e.determinant(),n=(e.m11*e.m22-e.m12*e.m21)/t,i=(e.m02*e.m21-e.m01*e.m22)/t,s=(e.m01*e.m12-e.m02*e.m11)/t,a=(e.m12*e.m20-e.m10*e.m22)/t,o=(e.m00*e.m22-e.m02*e.m20)/t,h=(e.m02*e.m10-e.m00*e.m12)/t,l=(e.m10*e.m21-e.m11*e.m20)/t,c=(e.m01*e.m20-e.m00*e.m21)/t,u=(e.m00*e.m11-e.m01*e.m10)/t;return new r(n,i,s,a,o,h,l,c,u)}get m00(){return this.v[0]}get m10(){return this.v[1]}get m20(){return this.v[2]}get m01(){return this.v[3]}get m11(){return this.v[4]}get m21(){return this.v[5]}get m02(){return this.v[6]}get m12(){return this.v[7]}get m22(){return this.v[8]}toString(){return this.v[0]+" "+this.v[3]+" "+this.v[6]+"\n"+this.v[1]+" "+this.v[4]+" "+this.v[7]+"\n"+this.v[2]+" "+this.v[5]+" "+this.v[8]+"\n"}nearZeroToZero(e){return Math.abs(e)<1e-5?e=0:.99999<e&&e<1.00001?e=1:-1.00001<e&&e<-.99999&&(e=-1),e}toStringApproximately(){return this.nearZeroToZero(this.v[0])+" "+this.nearZeroToZero(this.v[3])+" "+this.nearZeroToZero(this.v[6])+"\n"+this.nearZeroToZero(this.v[1])+" "+this.nearZeroToZero(this.v[4])+" "+this.nearZeroToZero(this.v[7])+" \n"+this.nearZeroToZero(this.v[2])+" "+this.nearZeroToZero(this.v[5])+" "+this.nearZeroToZero(this.v[8])+"\n"}getScale(){return new i.b(Math.sqrt(this.v[0]*this.v[0]+this.v[3]*this.v[3]+this.v[6]*this.v[6]),Math.sqrt(this.v[1]*this.v[1]+this.v[4]*this.v[4]+this.v[7]*this.v[7]),Math.sqrt(this.v[2]*this.v[2]+this.v[5]*this.v[5]+this.v[8]*this.v[8]))}isEqual(e,t=Number.EPSILON){return Math.abs(e.v[0]-this.v[0])<t&&Math.abs(e.v[1]-this.v[1])<t&&Math.abs(e.v[2]-this.v[2])<t&&Math.abs(e.v[3]-this.v[3])<t&&Math.abs(e.v[4]-this.v[4])<t&&Math.abs(e.v[5]-this.v[5])<t&&Math.abs(e.v[6]-this.v[6])<t&&Math.abs(e.v[7]-this.v[7])<t&&Math.abs(e.v[8]-this.v[8])<t}}},function(e,t,n){"use strict";n.d(t,"a",function(){return i});class i{constructor(e){this.v=e}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(53),s=n(10);class r{constructor(){this.__entity_uid_count=i.a.invalidEntityUID,this.__entities=[],this._components=[],this.__componentRepository=s.a.getInstance()}static getInstance(){return this.__instance||(this.__instance=new r),this.__instance}createEntity(e){const t=new i.a(++this.__entity_uid_count,!0);return this.__entities[this.__entity_uid_count]=t,this.addComponentsToEntity(e,t.entityUID)}addComponentsToEntity(e,t){const n=this.getEntity(t);for(let i of e){const e=this.__componentRepository.createComponent(i.componentTID,t,this);let s=this._components[n.entityUID];null==s&&(s=new Map,this._components[n.entityUID]=s),null!=e&&(s.set(i.componentTID,e),n._setComponent(e))}return n}removeComponentsFromEntity(e,t){const n=this.getEntity(t);for(let t of e){let e=this._components[n.entityUID];null==e&&(e=new Map,this._components[n.entityUID]=e),e.delete(t.componentTID)}return n}getEntity(e){return this.__entities[e]}getComponentOfEntity(e,t){const n=this._components[e];let i=null;return null!=n?null!=(i=n.get(t.componentTID))?i:null:i}searchByTags(e){const t=[];for(let n of this.__entities)n.matchTags(e)&&t.push(n);return t}getEntityByUniqueName(e){for(let t of this.__entities)if(t.uniqueName===e)return t}_getEntities(){return this.__entities.concat()}getEntitiesNumber(){return this.__entities.length}}},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:6402,str:"DEPTH_COMPONENT"}),a=new s({index:6406,str:"ALPHA"}),o=new s({index:6407,str:"RGB"}),h=new s({index:6408,str:"RGBA"}),l=new s({index:6409,str:"LUMINANCE"}),c=new s({index:6410,str:"LUMINANCE_ALPHA"});const u=Object.freeze({DepthComponent:r,Alpha:a,RGB:o,RGBA:h,Luminance:l,LuminanceAlpha:c})},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(4),s=n(61),r=n(3);class a{constructor(){this.__webglResourceRepository=s.a.getInstance()}get glsl_rt0(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"layout(location = 0) out vec4 rt0;\n":"vec4 rt0;\n"}get glsl_fragColor(){const e=this.__webglResourceRepository;return null!=e.currentWebGLContextWrapper&&e.currentWebGLContextWrapper.isWebGL2?"":"gl_FragColor = rt0;\n"}get glsl_vertex_in(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"in":"attribute"}get glsl_fragment_in(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"in":"varying"}get glsl_vertex_out(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"out":"varying"}get glsl_vertex_centroid_out(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"centroid out":"varying"}get glsl_texture(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"texture":"texture2D"}get glsl_textureCube(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"texture":"textureCube"}get glsl_textureProj(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"textureProj":"texture2DProj"}get glsl_versionText(){const e=this.__webglResourceRepository;return null!=e.currentWebGLContextWrapper&&e.currentWebGLContextWrapper.isWebGL2?"#version 300 es\n":""}get glslBegin(){return`${this.glsl_versionText}\n    precision highp float;\n    `}get glslMainBegin(){return"\n    void main() {\n    "}get glslMainEnd(){return"\n    }\n    "}getGlslVertexShaderProperies(e=""){return e}get glsl1ShaderTextureLodExt(){return null!=s.a.getInstance().currentWebGLContextWrapper.webgl1ExtSTL?"#extension GL_EXT_shader_texture_lod : require":""}get glsl1ShaderDerivativeExt(){return null!=s.a.getInstance().currentWebGLContextWrapper.webgl1ExtDRV?"#extension GL_OES_standard_derivatives : require":""}get toNormalMatrix(){return"\n  mat3 toNormalMatrix(mat4 m) {\n    float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n    a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n    a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n    a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3];\n\n    float b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32;\n\n    float determinantVal = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n    return mat3(\n      a11 * b11 - a12 * b10 + a13 * b09, a12 * b08 - a10 * b11 - a13 * b07, a10 * b10 - a11 * b08 + a13 * b06,\n      a02 * b10 - a01 * b11 - a03 * b09, a00 * b11 - a02 * b08 + a03 * b07, a01 * b08 - a00 * b10 - a03 * b06,\n      a31 * b05 - a32 * b04 + a33 * b03, a32 * b02 - a30 * b05 - a33 * b01, a30 * b04 - a31 * b02 + a33 * b00) / determinantVal;\n  }"}get getSkinMatrix(){return"\n#ifdef RN_IS_SKINNING\n\nhighp mat4 createMatrixFromQuaternionTransformUniformScale( highp vec4 quaternion, highp vec4 translationScale ) {\n  highp vec4 q = quaternion;\n  highp vec3 t = translationScale.xyz;\n  highp float scale = translationScale.w;\n\n  highp float sx = q.x * q.x;\n  highp float sy = q.y * q.y;\n  highp float sz = q.z * q.z;\n  highp float cx = q.y * q.z;\n  highp float cy = q.x * q.z;\n  highp float cz = q.x * q.y;\n  highp float wx = q.w * q.x;\n  highp float wy = q.w * q.y;\n  highp float wz = q.w * q.z;\n\n  highp mat4 mat = mat4(\n    1.0 - 2.0 * (sy + sz), 2.0 * (cz + wz), 2.0 * (cy - wy), 0.0,\n    2.0 * (cz - wz), 1.0 - 2.0 * (sx + sz), 2.0 * (cx + wx), 0.0,\n    2.0 * (cy + wy), 2.0 * (cx - wx), 1.0 - 2.0 * (sx + sy), 0.0,\n    t.x, t.y, t.z, 1.0\n  );\n\n  highp mat4 uniformScaleMat = mat4(\n    scale, 0.0, 0.0, 0.0,\n    0.0, scale, 0.0, 0.0,\n    0.0, 0.0, scale, 0.0,\n    0.0, 0.0, 0.0, 1.0\n  );\n\n  return mat*uniformScaleMat;\n}\n\nhighp vec4 unpackedVec2ToNormalizedVec4(highp vec2 vec_xy, highp float criteria){\n\n  highp float r;\n  highp float g;\n  highp float b;\n  highp float a;\n\n  highp float ix = floor(vec_xy.x * criteria);\n  highp float v1x = ix / criteria;\n  highp float v1y = ix - floor(v1x) * criteria;\n\n  r = ( v1x + 1.0 ) / (criteria-1.0);\n  g = ( v1y + 1.0 ) / (criteria-1.0);\n\n  highp float iy = floor( vec_xy.y * criteria);\n  highp float v2x = iy / criteria;\n  highp float v2y = iy - floor(v2x) * criteria;\n\n  b = ( v2x + 1.0 ) / (criteria-1.0);\n  a = ( v2y + 1.0 ) / (criteria-1.0);\n\n  r -= 1.0/criteria;\n  g -= 1.0/criteria;\n  b -= 1.0/criteria;\n  a -= 1.0/criteria;\n\n  r = r*2.0-1.0;\n  g = g*2.0-1.0;\n  b = b*2.0-1.0;\n  a = a*2.0-1.0;\n\n  return vec4(r, g, b, a);\n}\n\nmat4 getSkinMatrix() {\n  highp vec2 criteria = vec2(4096.0, 4096.0);\n  highp mat4 skinMat = a_weight.x * createMatrixFromQuaternionTransformUniformScale(\n    get_boneQuaternion(0.0, int(a_joint.x)),\n    get_boneTranslateScale(0.0, int(a_joint.x)));\n  skinMat += a_weight.y * createMatrixFromQuaternionTransformUniformScale(\n    get_boneQuaternion(0.0, int(a_joint.y)),\n    get_boneTranslateScale(0.0, int(a_joint.y)));\n  skinMat += a_weight.z * createMatrixFromQuaternionTransformUniformScale(\n    get_boneQuaternion(0.0, int(a_joint.z)),\n    get_boneTranslateScale(0.0, int(a_joint.z)));\n  skinMat += a_weight.w * createMatrixFromQuaternionTransformUniformScale(\n    get_boneQuaternion(0.0, int(a_joint.w)),\n    get_boneTranslateScale(0.0, int(a_joint.w)));\n\n  // mat4 skinMat = a_weight.x * u_boneMatrices[int(a_joint.x)];\n  // skinMat += a_weight.y * u_boneMatrices[int(a_joint.y)];\n  // skinMat += a_weight.z * u_boneMatrices[int(a_joint.z)];\n  // skinMat += a_weight.w * u_boneMatrices[int(a_joint.w)];\n\n  return skinMat;\n}\n#endif\n"}get packing(){return"\nconst vec4 bitEnc = vec4(1.,255.,65025.,16581375.);\nconst vec4 bitDec = 1./bitEnc;\n\nvec4 encodeFloatRGBA(float v) {\n  float val = v;\n  float r = mod(val, 255.0);\n  val -= r;\n  float g = mod(val, 65025.0);\n  val -= g;\n  float b = mod(val, 16581375.0);\n  return vec4(r/255.0, g/65025.0, b/16581375.0, 1.0);\n}"}get processGeometryWithSkinningOptionally(){return"\n#ifdef RN_IS_SKINNING\nbool skinning(\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n  )\n{\n  mat4 skinMat = getSkinMatrix();\n  outPosition_inWorld = skinMat * vec4(inPosition_inLocal, 1.0);\n  outNormalMatrix = toNormalMatrix(skinMat);\n  outNormal_inWorld = normalize(outNormalMatrix * inNormal_inLocal);\n\n  return true;\n}\n#endif\n\nbool processGeometryWithMorphingAndSkinning(\n  in mat4 worldMatrix,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n) {\n  bool isSkinning = false;\n\n  vec3 position_inLocal;\n#ifdef RN_IS_MORPHING\n  if (u_morphTargetNumber == 0) {\n#endif\n    position_inLocal = inPosition_inLocal;\n#ifdef RN_IS_MORPHING\n  } else {\n    float vertexIdx = a_baryCentricCoord.w;\n    position_inLocal = get_position(vertexIdx, inPosition_inLocal);\n  }\n#endif\n\n\n#ifdef RN_IS_SKINNING\n  int skinningMode = get_skinningMode(u_materialSID, 0);\n  if (skinningMode == 1) {\n    isSkinning = skinning(inNormalMatrix, outNormalMatrix, position_inLocal, outPosition_inWorld, inNormal_inLocal, outNormal_inWorld);\n  } else {\n#endif\n    outPosition_inWorld = worldMatrix * vec4(position_inLocal, 1.0);\n    outNormal_inWorld = normalize(inNormalMatrix * inNormal_inLocal);\n#ifdef RN_IS_SKINNING\n  }\n#endif\n\n  return isSkinning;\n}\n\n"}get prerequisites(){return`\n    uniform float u_materialSID;\n    uniform sampler2D u_dataTexture;\n\n    /*\n    * This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n    * arg = vec2(1. / size.x, 1. / size.x / size.y);\n    */\n   // highp vec4 fetchElement(highp sampler2D tex, highp float index, highp vec2 arg)\n   // {\n   //   return ${this.glsl_texture}( tex, arg * (index + 0.5) );\n   // }\n\n  highp vec4 fetchElement(highp sampler2D tex, highp float index, highp vec2 invSize)\n  {\n    highp float t = (index + 0.5) * invSize.x;\n    highp float x = fract(t);\n    highp float y = (floor(t) + 0.5) * invSize.y;\n    return ${this.glsl_texture}( tex, vec2(x, y) );\n  }`}get pointSprite(){return"vec4 position_inWorld = worldMatrix * vec4(a_position, 1.0);\n  vec3 viewPosition = get_viewPosition(u_materialSID, 0);\n  float distanceFromCamera = length(position_inWorld.xyz - viewPosition);\n  vec3 pointDistanceAttenuation = get_pointDistanceAttenuation(u_materialSID, 0);\n  float distanceAttenuationFactor = sqrt(1.0/(pointDistanceAttenuation.x + pointDistanceAttenuation.y * distanceFromCamera + pointDistanceAttenuation.z * distanceFromCamera * distanceFromCamera));\n  float maxPointSize = get_pointSize(u_materialSID, 0);\n  gl_PointSize = clamp(distanceAttenuationFactor * maxPointSize, 0.0, maxPointSize);"}get pbrUniformDefinition(){let e="";e+="uniform vec2 uMetallicRoughnessFactors;\n",e+="uniform vec3 uBaseColorFactor;\n",e+="uniform vec2 uOcclusionFactors;",e+="uniform vec3 uEmissiveFactor;",e+="uniform sampler2D uMetallicRoughnessTexture;\n";e+="uniform sampler2D uOcclusionTexture;\n";e+="uniform sampler2D uEmissiveTexture;\n";return e+="uniform sampler2D u_brdfLutTexture;\n",e+="uniform samplerCube uDiffuseEnvTexture;\n",e+="uniform samplerCube uSpecularEnvTexture;\n",e+="uniform vec4 uIBLParameters;\n",e+="uniform vec4 ambient;\n"}get mipmapLevel(){return"\n    // https://stackoverflow.com/questions/24388346/how-to-access-automatic-mipmap-level-in-glsl-fragment-shader-texture\n    float mipmapLevel(vec3 uv_as_texel)\n    {\n      vec3  dx_vtc        = dFdx(uv_as_texel);\n      vec3  dy_vtc        = dFdy(uv_as_texel);\n      float delta_max_sqr = max(dot(dx_vtc, dx_vtc), dot(dy_vtc, dy_vtc));\n      float mml = 0.5 * log2(delta_max_sqr);\n      return max( 0.0, mml );\n    }"}get pbrMethodDefinition(){return`\n    const float M_PI = 3.141592653589793;\n    const float c_MinRoughness = 0.04;\n\n    float angular_n_h(float NH) {\n      return acos(NH);\n    }\n\n    float sqr(float x) {\n      return x*x;\n    }\n\n    float d_phong(float NH, float c1) {\n      return pow(\n        cos(acos(NH))\n        , c1\n      );\n    }\n\n    // this is from https://www.unrealengine.com/blog/physically-based-shading-on-mobile\n    vec3 envBRDFApprox( vec3 F0, float Roughness, float NoV ) {\n      const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022 );\n      const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04 );\n      vec4 r = Roughness * c0 + c1;\n      float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n      vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n      return F0 * AB.x + AB.y;\n    }\n\n    // GGX NDF\n    float d_ggx(float NH, float alphaRoughness) {\n      float roughnessSqr = alphaRoughness * alphaRoughness;\n      float f = (roughnessSqr - 1.0) * NH * NH + 1.0;\n      return roughnessSqr / (M_PI * f * f);\n    }\n\n    float d_torrance_reiz(float NH, float c3) {\n      float CosSquared = NH*NH;\n      float TanSquared = (1.0 - CosSquared)/CosSquared;\n      //return (1.0/M_PI) * sqr(c3/(CosSquared * (c3*c3 + TanSquared)));  // gamma = 2, aka GGX\n      return (1.0/sqrt(M_PI)) * (sqr(c3)/(CosSquared * (c3*c3 + TanSquared))); // gamma = 1, D_Berry\n    }\n\n    float d_beckmann(float NH, float m) {\n      float co = 1.0 / (4.0 * m * m * NH * NH * NH * NH);\n      float expx = exp((NH * NH - 1.0) / (m * m * NH * NH));\n      return co * expx;\n    }\n\n    // the same as glTF WebGL sample\n    // https://github.com/KhronosGroup/glTF-WebGL-PBR/blob/88eda8c5358efe03128b72b6c5f5f6e5b6d023e1/shaders/pbr-frag.glsl#L188\n    // That is, Unreal Engine based approach, but modified to use alphaRoughness (squared artist's roughness parameter),\n    // and based on 'Separable Masking and Shadowing' approximation (propesed by Christophe Schlick)\n    // https://www.cs.virginia.edu/~jdl/bib/appearance/analytic%20models/schlick94b.pdf\n    float g_shielding(float NL, float NV, float alphaRoughness) {\n      float r = alphaRoughness;\n\n      // Local Shadowing using "Schlick-Smith" Masking Function\n      float localShadowing = 2.0 * NL / (NL + sqrt(r * r + (1.0 - r * r) * (NL * NL)));\n\n      // Local Masking using "Schlick-Smith" Masking Function\n      float localMasking = 2.0 * NV / (NV + sqrt(r * r + (1.0 - r * r) * (NV * NV)));\n\n      return localShadowing * localMasking;\n    }\n\n    // The code from https://google.github.io/filament/Filament.html#listing_approximatedspecularv\n    // The idea is from [Heitz14] Eric Heitz. 2014. Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs.\n    float v_SmithGGXCorrelated(float NL, float NV, float alphaRoughness) {\n      float a2 = alphaRoughness * alphaRoughness;\n      float GGXV = NL * sqrt(NV * NV * (1.0 - a2) + a2);\n      float GGXL = NV * sqrt(NL * NL * (1.0 - a2) + a2);\n      return 0.5 / (GGXV + GGXL);\n    }\n\n    float v_SmithGGXCorrelatedFast(float NL, float NV, float alphaRoughness) {\n      float a = alphaRoughness;\n      float GGXV = NL * (NV * (1.0 - a) + a);\n      float GGXL = NV * (NL * (1.0 - a) + a);\n      return 0.5 / (GGXV + GGXL);\n    }\n\n    // The Schlick Approximation to Fresnel\n    vec3 fresnel(vec3 f0, float VH) {\n      return vec3(f0) + (vec3(1.0) - f0) * pow(1.0 - VH, 5.0);\n    }\n\n    vec3 cook_torrance_specular_brdf(float NH, float NL, float NV, vec3 F, float alphaRoughness) {\n      float D = d_ggx(NH, alphaRoughness);\n      float V = v_SmithGGXCorrelated(NL, NV, alphaRoughness);\n      return vec3(D)*vec3(V)*F;\n//      float G = g_shielding(NL, NV, alphaRoughness);\n//      return vec3(D)*vec3(G)*F/vec3(4.0*NL*NV);\n\n    }\n\n    vec3 diffuse_brdf(vec3 albedo)\n    {\n      return albedo / M_PI;\n    }\n\n    vec3 srgbToLinear(vec3 srgbColor) {\n      return pow(srgbColor, vec3(2.2));\n    }\n\n    float srgbToLinear(float value) {\n      return pow(value, 2.2);\n    }\n\n    vec3 linearToSrgb(vec3 linearColor) {\n      return pow(linearColor, vec3(1.0/2.2));\n    }\n\n    float linearToSrgb(float value) {\n      return pow(value, 1.0/2.2);\n    }\n\n    vec3 fresnelSchlickRoughness(vec3 F0, float cosTheta, float roughness)\n    {\n      return F0 + (max(vec3(1.0 - roughness), F0) - F0) * pow(1.0 - cosTheta, 5.0);\n    }\n\n    vec3 normalBlendingUDN(sampler2D baseMap, sampler2D detailMap, vec2 baseUv, vec2 detailUv) {\n      vec3 t = ${this.glsl_texture}(baseMap,   baseUv).xyz * 2.0 - 1.0;\n      vec3 u = ${this.glsl_texture}(detailMap, detailUv).xyz * 2.0 - 1.0;\n      vec3 r = normalize(vec3(t.xy + u.xy, t.z));\n      return r;\n    }\n\n    vec2 uvTransform(vec2 scale, vec2 offset, float rotation, vec2 uv) {\n      mat3 translationMat = mat3(1,0,0, 0,1,0, offset.x, offset.y, 1);\n      mat3 rotationMat = mat3(\n          cos(rotation), sin(rotation), 0,\n         -sin(rotation), cos(rotation), 0,\n                      0,             0, 1\n      );\n      mat3 scaleMat = mat3(scale.x,0,0, 0,scale.y,0, 0,0,1);\n\n      mat3 matrix = translationMat * rotationMat * scaleMat;\n      vec2 uvTransformed = ( matrix * vec3(uv.xy, 1) ).xy;\n\n      return uvTransformed;\n    }\n\n    `}get simpleMVPPosition(){return"\n    mat4 worldMatrix = get_worldMatrix(a_instanceID);\n    mat4 viewMatrix = get_viewMatrix(a_instanceID);\n    mat4 projectionMatrix = get_projectionMatrix(a_instanceID);\n    gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(a_position, 1.0);\n    "}static getStringFromShaderAnyDataType(e){return e instanceof r.b?"u_"+e.str:e instanceof i.b?e.shaderStr:e}}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});const i=(s=new Float32Array(1),r=new Int32Array(s.buffer),function(e){s[0]=e;var t=r[0],n=t>>16&32768,i=t>>12&2047,a=t>>23&255;return a<103?n:a>142?(n|=31744,n|=(255==a?0:1)&&8388607&t):a<113?n|=((i|=2048)>>114-a)+(i>>113-a&1):(n|=a-112<<10|i>>1,n+=1&i)});var s,r;function a(e){return 0==(e&e-1)}const o=Object.freeze({radianToDegree:function(e){return 180*e/Math.PI},degreeToRadian:function(e){return e*Math.PI/180},toHalfFloat:i,isPowerOfTwo:a,isPowerOfTwoTexture:function(e,t){return a(e)&&a(t)},packNormalizedVec4ToVec2:function(e,t,n,i,s){let r=0,a=0;return e=(e+1)/2,t=(t+1)/2,n=(n+1)/2,i=(i+1)/2,[r=(Math.floor(e*(s-1))*s+Math.floor(t*(s-1)))/s,a=(Math.floor(n*(s-1))*s+Math.floor(i*(s-1)))/s]}})},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(2),s=n(23),r=n(0);class a extends s.a{constructor(e,t,n,i){super(e,t,n,i)}static dummy(){return new a(null)}clone(){return new a(this.x,this.y,this.z,this.w)}axisAngle(e,t){var n=.5*t,s=Math.sin(n),r=i.b.normalize(e);return this.w=Math.cos(n),this.x=s*r.x,this.y=s*r.y,this.z=s*r.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}multiply(e){let t=new s.a(0,0,0,1);return t.v[0]=e.w*this.x+e.z*this.y+e.y*this.z-e.x*this.w,t.v[1]=-e.z*this.x+e.w*this.y+e.x*this.z-e.y*this.w,t.v[2]=e.y*this.x+e.x*this.y+e.w*this.z-e.z*this.w,t.v[3]=-e.x*this.x-e.y*this.y-e.z*this.z-e.w*this.w,this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}fromMatrix(e){let t=e.m00+e.m11+e.m22;if(t>0){let n=.5/Math.sqrt(t+1);this.v[0]=(e.m21-e.m12)*n,this.v[1]=(e.m02-e.m20)*n,this.v[2]=(e.m10-e.m01)*n,this.v[3]=.25/n}else if(e.m00>e.m11&&e.m00>e.m22){let t=2*Math.sqrt(1+e.m00-e.m11-e.m22);this.v[0]=.25*t,this.v[1]=(e.m01+e.m10)/t,this.v[2]=(e.m02+e.m20)/t,this.v[3]=(e.m21-e.m12)/t}else if(e.m11>e.m22){let t=2*Math.sqrt(1+e.m11-e.m00-e.m22);this.v[0]=(e.m01+e.m10)/t,this.v[1]=.25*t,this.v[2]=(e.m12+e.m21)/t,this.v[3]=(e.m02-e.m20)/t}else{let t=2*Math.sqrt(1+e.m22-e.m00-e.m11);this.v[0]=(e.m02+e.m20)/t,this.v[1]=(e.m12+e.m21)/t,this.v[2]=.25*t,this.v[3]=(e.m10-e.m01)/t}return this}static get compositionType(){return r.a.Vec4}setAt(e,t){switch(e%4){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t}}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return this.x/=e,this.y/=e,this.z/=e,this.w/=e,this}identity(){this.x=0,this.y=0,this.x=0,this.w=1}static fromMatrix(e){let t=new a(0,0,0,1),n=e.m00+e.m11+e.m22;if(n>0){let i=.5/Math.sqrt(n+1);t.v[3]=.25/i,t.v[0]=(e.m21-e.m12)*i,t.v[1]=(e.m02-e.m20)*i,t.v[2]=(e.m10-e.m01)*i}else if(e.m00>e.m11&&e.m00>e.m22){let n=2*Math.sqrt(1+e.m00-e.m11-e.m22);t.v[3]=(e.m21-e.m12)/n,t.v[0]=.25*n,t.v[1]=(e.m01+e.m10)/n,t.v[2]=(e.m02+e.m20)/n}else if(e.m11>e.m22){let n=2*Math.sqrt(1+e.m11-e.m00-e.m22);t.v[3]=(e.m02-e.m20)/n,t.v[0]=(e.m01+e.m10)/n,t.v[1]=.25*n,t.v[2]=(e.m12+e.m21)/n}else{let n=2*Math.sqrt(1+e.m22-e.m00-e.m11);t.v[3]=(e.m10-e.m01)/n,t.v[0]=(e.m02+e.m20)/n,t.v[1]=(e.m12+e.m21)/n,t.v[2]=.25*n}return t}get x(){return this.v[0]}set x(e){this.v[0]=e}get y(){return this.v[1]}set y(e){this.v[1]=e}get z(){return this.v[2]}set z(e){this.v[2]=e}get w(){return this.v[3]}set w(e){this.v[3]=e}get raw(){return this.v}}},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var i=n(2),s=n(23),r=n(35),a=n(18),o=n(27),h=n(10),l=n(1),c=n(30),u=n(11),_=n(31),m=n(12),d=n(41),f=n(13),p=n(33),g=n(15);class v extends o.a{constructor(e,t,n){super(e,t,n),this._translate=i.b.dummy(),this._rotate=i.b.dummy(),this._scale=i.b.dummy(),this._quaternion=d.a.dummy(),this._matrix=m.a.dummy(),this._invMatrix=a.a.dummy(),this._normalMatrix=r.a.dummy(),this.__toUpdateAllTransform=!0,this._updateCount=0,this.__updateCountAtLastLogic=0,this._dependentAnimationComponentId=0;this.registerMember(u.a.CPUGeneric,"translate",i.b,l.a.Float,[0,0,0]),this.registerMember(u.a.CPUGeneric,"rotate",i.b,l.a.Float,[0,0,0]),this.registerMember(u.a.CPUGeneric,"scale",i.b,l.a.Float,[1,1,1]),this.registerMember(u.a.CPUGeneric,"quaternion",d.a,l.a.Float,[0,0,0,1]),this.registerMember(u.a.CPUGeneric,"matrix",m.a,l.a.Float,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.registerMember(u.a.CPUGeneric,"invMatrix",m.a,l.a.Float,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.registerMember(u.a.CPUGeneric,"normalMatrix",r.a,l.a.Float,[1,0,0,0,1,0,0,0,1]),this.submitToAllocation(this.maxNumberOfComponent),this._is_translate_updated=!0,this._is_euler_angles_updated=!0,this._is_scale_updated=!0,this._is_quaternion_updated=!0,this._is_trs_matrix_updated=!0,this._is_inverse_trs_matrix_updated=!0,this._is_normal_trs_matrix_updated=!0,this.moveStageTo(f.a.Logic)}static get renderedPropertyCount(){return null}static get componentTID(){return c.a.TransformComponentTID}$logic(){if(this.__updateCountAtLastLogic!==this._updateCount){this.__entityRepository.getComponentOfEntity(this.__entityUid,_.a).setWorldMatrixDirty(),this.__updateCountAtLastLogic=this._updateCount}}set toUpdateAllTransform(e){this.__toUpdateAllTransform=e}get toUpdateAllTransform(){return this.__toUpdateAllTransform}_needUpdate(){this._updateCount++}set translate(e){this._translate.v[0]=e.v[0],this._translate.v[1]=e.v[1],this._translate.v[2]=e.v[2],this._is_translate_updated=!0,this._is_trs_matrix_updated=!1,this._is_inverse_trs_matrix_updated=!1,this._is_normal_trs_matrix_updated=!1,this.__updateTransform()}get translate(){return this.translateInner.clone()}get translateInner(){return this._is_translate_updated?this._translate:(this._is_trs_matrix_updated&&(this._translate.v[0]=this._matrix.m03,this._translate.v[1]=this._matrix.m13,this._translate.v[2]=this._matrix.m23,this._is_translate_updated=!0),this._translate)}set rotate(e){this._rotate.v[0]=e.v[0],this._rotate.v[1]=e.v[1],this._rotate.v[2]=e.v[2],this._is_euler_angles_updated=!0,this._is_quaternion_updated=!1,this._is_trs_matrix_updated=!1,this._is_inverse_trs_matrix_updated=!1,this._is_normal_trs_matrix_updated=!1,this.__updateTransform()}get rotate(){return this.rotateInner.clone()}get rotateInner(){return this._is_euler_angles_updated?this._rotate:(this._is_trs_matrix_updated?this._rotate=this._matrix.toEulerAngles():this._is_quaternion_updated&&(this._rotate=new a.a(this._quaternion).toEulerAngles()),this._is_euler_angles_updated=!0,this._rotate)}set scale(e){this._scale.v[0]=e.v[0],this._scale.v[1]=e.v[1],this._scale.v[2]=e.v[2],this._is_scale_updated=!0,this._is_trs_matrix_updated=!1,this._is_inverse_trs_matrix_updated=!1,this._is_normal_trs_matrix_updated=!1,this.__updateTransform()}get scale(){return this.scaleInner.clone()}get scaleInner(){if(this._is_scale_updated)return this._scale;if(this._is_trs_matrix_updated){let e=this._matrix;this._scale.v[0]=Math.sqrt(e.m00*e.m00+e.m01*e.m01+e.m02*e.m02),this._scale.v[1]=Math.sqrt(e.m10*e.m10+e.m11*e.m11+e.m12*e.m12),this._scale.v[2]=Math.sqrt(e.m20*e.m20+e.m21*e.m21+e.m22*e.m22),this._is_scale_updated=!0}return this._scale}set quaternion(e){this._quaternion.v[0]=e.v[0],this._quaternion.v[1]=e.v[1],this._quaternion.v[2]=e.v[2],this._quaternion.v[3]=e.v[3],this._is_quaternion_updated=!0,this._is_euler_angles_updated=!1,this._is_trs_matrix_updated=!1,this._is_inverse_trs_matrix_updated=!1,this._is_normal_trs_matrix_updated=!1,this.__updateTransform()}get quaternion(){return this.quaternionInner.clone()}get quaternionInner(){if(this._is_quaternion_updated)return this._quaternion;if(!this._is_quaternion_updated){if(this._is_trs_matrix_updated)return this._is_quaternion_updated=!0,this._quaternion.fromMatrix(this._matrix),this._quaternion;if(this._is_euler_angles_updated)return v.__tmpMat_quaternionInner.rotateXYZ(this._rotate.x,this._rotate.y,this._rotate.z),this._is_quaternion_updated=!0,this._quaternion.fromMatrix(v.__tmpMat_quaternionInner),this._quaternion}return this._quaternion}set matrix(e){this._matrix=new m.a(e,!0),this._is_trs_matrix_updated=!0,this._is_translate_updated=!1,this._is_euler_angles_updated=!1,this._is_quaternion_updated=!1,this._is_scale_updated=!1,this._is_inverse_trs_matrix_updated=!1,this._is_normal_trs_matrix_updated=!1,this.__updateTransform()}get matrix(){return this.matrixInner.clone()}get matrixInner(){if(this._is_trs_matrix_updated)return this._matrix;const e=this.scaleInner,t=e.v[0],n=e.v[1],i=e.v[2],s=this.quaternionInner,r=s.v[0]*s.v[0],a=s.v[1]*s.v[1],o=s.v[2]*s.v[2],h=s.v[1]*s.v[2],l=s.v[0]*s.v[2],c=s.v[0]*s.v[1],u=s.v[3]*s.v[0],_=s.v[3]*s.v[1],m=s.v[3]*s.v[2],d=1-2*(a+o),f=2*(c-m),p=2*(l+_),g=2*(c+m),v=1-2*(r+o),x=2*(h-u),y=2*(l-_),b=2*(h+u),A=1-2*(r+a),T=this.translateInner;return this._matrix.m00=d*t,this._matrix.m01=f*n,this._matrix.m02=p*i,this._matrix.m03=T.v[0],this._matrix.m10=g*t,this._matrix.m11=v*n,this._matrix.m12=x*i,this._matrix.m13=T.v[1],this._matrix.m20=y*t,this._matrix.m21=b*n,this._matrix.m22=A*i,this._matrix.m23=T.v[2],this._matrix.m30=0,this._matrix.m31=0,this._matrix.m32=0,this._matrix.m33=1,this._is_trs_matrix_updated=!0,this._matrix}get inverseMatrix(){return this.inverseMatrixInner.clone()}get inverseMatrixInner(){return this._is_inverse_trs_matrix_updated||(this._invMatrix=m.a.invert(this.matrixInner),this._is_inverse_trs_matrix_updated=!0),this._invMatrix}get normalMatrix(){return this.normalMatrixInner.clone()}get normalMatrixInner(){if(!this._is_normal_trs_matrix_updated){a.a.invertTo(this.matrixInner,v.invertedMatrix44);const e=v.invertedMatrix44.transpose();v.returnMatrix33.m00=e.m00,v.returnMatrix33.m01=e.m01,v.returnMatrix33.m02=e.m02,v.returnMatrix33.m10=e.m10,v.returnMatrix33.m11=e.m11,v.returnMatrix33.m12=e.m12,v.returnMatrix33.m20=e.m20,v.returnMatrix33.m21=e.m21,v.returnMatrix33.m22=e.m22,this._normalMatrix=v.returnMatrix33,this._is_normal_trs_matrix_updated=!0}return this._normalMatrix}setTransform(e,t,n,i,s){this._is_trs_matrix_updated=!1,this._is_inverse_trs_matrix_updated=!1,this._is_normal_trs_matrix_updated=!1,null!=s&&(this._matrix=new m.a(s),this._is_trs_matrix_updated=!0,this._is_translate_updated=!1,this._is_euler_angles_updated=!1,this._is_quaternion_updated=!1,this._is_scale_updated=!1),null!=e&&(this._translate=e.clone(),this._is_translate_updated=!0),null!=t&&null!=i?(this._rotate=t.clone(),this._quaternion=new d.a(i),this._is_euler_angles_updated=!0,this._is_quaternion_updated=!0):null!=t?(this._rotate=t.clone(),this._is_euler_angles_updated=!0,this._is_quaternion_updated=!1):null!=i&&(this._quaternion=new d.a(i),this._is_euler_angles_updated=!1,this._is_quaternion_updated=!0),null!=n&&(this._scale=n.clone(),this._is_scale_updated=!0),this.__updateTransform()}__updateTransform(){this.__toUpdateAllTransform&&(this.__updateRotation(),this.__updateTranslate(),this.__updateScale()),this._needUpdate()}__updateRotation(){if(this._is_euler_angles_updated&&!this._is_quaternion_updated)v.__tmpMat_updateRotation.rotateXYZ(this._rotate.x,this._rotate.y,this._rotate.z),this._quaternion.fromMatrix(v.__tmpMat_updateRotation),this._is_quaternion_updated=!0;else if(!this._is_euler_angles_updated&&this._is_quaternion_updated)a.a.fromQuaternionTo(this._quaternion,v.updateRotationMatrix44),v.updateRotationMatrix44.toEulerAnglesTo(v.updateRotationVector3),this._rotate=v.updateRotationVector3,this._is_euler_angles_updated=!0;else if(!this._is_euler_angles_updated&&!this._is_quaternion_updated&&this._is_trs_matrix_updated){const e=this._matrix;this._quaternion.fromMatrix(e),this._is_quaternion_updated=!0,this._rotate=e.toEulerAngles(),this._is_euler_angles_updated=!0}}__updateTranslate(){if(!this._is_translate_updated&&this._is_trs_matrix_updated){const e=this._matrix;this._translate.v[0]=e.m03,this._translate.v[1]=e.m13,this._translate.v[2]=e.m23,this._is_translate_updated=!0}}__updateScale(){if(!this._is_scale_updated&&this._is_trs_matrix_updated){const e=this._matrix;this._scale.v[0]=Math.sqrt(e.m00*e.m00+e.m01*e.m01+e.m02*e.m02),this._scale.v[1]=Math.sqrt(e.m10*e.m10+e.m11*e.m11+e.m12*e.m12),this._scale.v[2]=Math.sqrt(e.m20*e.m20+e.m21*e.m21+e.m22*e.m22),this._is_scale_updated=!0}}__updateMatrix(){if(!this._is_trs_matrix_updated&&this._is_translate_updated&&this._is_quaternion_updated&&this._is_scale_updated){const e=new a.a(this._quaternion);let t=this._scale;this._matrix=m.a.multiply(e,a.a.scale(t));let n=this._translate;this._matrix.m03=n.x,this._matrix.m13=n.y,this._matrix.m23=n.z,this._is_trs_matrix_updated=!0}}setPropertiesFromJson(e){let t=e;"string"==typeof e&&(t=JSON.parse(e));for(let e in t)t.hasOwnProperty(e)&&e in this&&(this[e]="quaternion"===e?new s.a(t[e]):"matrix"===e?new a.a(t[e]):new i.b(t[e]))}setRotationFromNewUpAndFront(e,t){let n=e,s=i.b.cross(n,t),r=i.b.cross(s,n),a=m.a.identity();a.m00=s.x,a.m10=s.y,a.m20=s.z,a.m01=n.x,a.m11=n.y,a.m21=n.z,a.m02=r.x,a.m12=r.y,a.m22=r.z,this.rotateMatrix44=a}headToDirection(e,t){const n=i.b.normalize(e),s=i.b.normalize(t),r=i.b.cross(n,s),a=i.b.dotProduct(n,s);let o=Math.acos(a);this.quaternion=d.a.axisAngle(r,o)}set rotateMatrix44(e){this.quaternion=d.a.fromMatrix(e)}get rotateMatrix44(){return new a.a(this.quaternion)}}v.__tmpMat_updateRotation=m.a.identity(),v.__tmpMat_quaternionInner=m.a.identity(),v.returnMatrix33=new p.a([0,0,0,0,0,0,0,0,0]),v.invertedMatrix44=new m.a([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),v.updateRotationMatrix44=new m.a([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),v.updateRotationVector3=g.a.zero(),h.a.registerComponentClass(v)},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:0,str:"ClassicShading"}),a=new s({index:1,str:"PBRShading"}),o=(new s({index:2,str:"Lerp"}),new s({index:3,str:"Add"}),[r,a]);const h=Object.freeze({ClassicShading:r,PBRShading:a,from:function(e){return Object(i.b)({typeList:o,index:e})},fromString:function(e){return Object(i.c)({typeList:o,str:e})}})},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:0,str:".ldr_srgb"}),a=new s({index:1,str:".ldr_linear"}),o=new s({index:2,str:".hdr"}),h=new s({index:3,str:".rgbe.png"}),l=new s({index:4,str:".rgb9_e5.png"}),c=new s({index:5,str:".exr"});const u=Object.freeze({LDR_SRGB:r,LDR_LINEAR:a,HDR:o,RGBE_PNG:h,RGB9_E5_PNG:l,OpenEXR:c})},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:0,str:"NONE"}),a=new s({index:1,str:"UNIFORM_WEBGL1"}),o=new s({index:2,str:"UNIFORM_WEBGL2"}),h=new s({index:3,str:"DATA_TEXTURE_WEBGL1"}),l=new s({index:4,str:"DATA_TEXTURE_WEBGL2"}),c=new s({index:5,str:"UBO_WEBGL2"}),u=new s({index:6,str:"TRNASFORM_FEEDBACK_WEBGL2"}),_=new s({index:7,str:"FASTEST_WEBGL1"});const m=Object.freeze({None:r,UniformWebGL1:a,UniformWebGL2:o,DataTextureWebGL1:h,DataTextureWebGL2:l,UBOWebGL2:c,TransformFeedbackWebGL2:u,FastestWebGL1:_})},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var i=n(10),s=n(27),r=n(25),a=n(13),o=n(31),h=n(30),l=n(14),c=n(18),u=n(9),_=n(28),m=n(17),d=n(11),f=n(0),p=n(1),g=n(48),v=n(32),x=n(24),y=n(16);class b extends s.a{constructor(e,t,n){super(e,t,n),this.diffuseCubeMapContribution=1,this.specularCubeMapContribution=1,this.rotationOfCubeMap=0,this._readyForRendering=!1,this.__sceneGraphComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,o.a);const s=i.a.getInstance().getComponentsWithType(l.a);s&&(b.__cameraComponent=s[0])}static get componentTID(){return h.a.MeshRendererComponentTID}static get firstTranparentIndex(){return b.__firstTransparentIndex}static get lastTransparentIndex(){return b.__lastTransparentIndex}$create({processApproach:e}){if(null!=this.__meshComponent)return;this.__meshComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,r.a);const t=g.a.getInstance().getModule("webgl");this.__webglRenderingStrategy=t.getRenderingStrategy(e),this.moveStageTo(a.a.Load)}$load(){this.__webglRenderingStrategy.$load(this.__meshComponent),this.diffuseCubeMap&&!this.diffuseCubeMap.startedToLoad&&this.diffuseCubeMap.loadTextureImagesAsync(),this.specularCubeMap&&!this.specularCubeMap.startedToLoad&&this.specularCubeMap.loadTextureImagesAsync(),this.moveStageTo(a.a.PreRender)}$prerender(){this.__webglRenderingStrategy.$prerender(this.__meshComponent,this,b.__instanceIDBufferUid),this.moveStageTo(a.a.Render)}$render({i:e,renderPass:t,renderPassTickCount:n}){if(null==this.__webglRenderingStrategy.$render)return;const i=this.__entityRepository.getEntity(this.__entityUid);this.__webglRenderingStrategy.$render(e,this.__meshComponent,this.__sceneGraphComponent.worldMatrixInner,this.__sceneGraphComponent.normalMatrixInner,i,t,n,this.diffuseCubeMap,this.specularCubeMap),this.__meshComponent.mesh?this.__meshComponent.mesh.weights.length>0&&this.moveStageTo(a.a.PreRender):r.a.alertNoMeshSet(this.__meshComponent)}static common_$load({processApproach:e}){const t=g.a.getInstance().getModule("webgl");b.__staticWebglModule=t,b.__webGLStrategy=t.getRenderingStrategy(e),b.__webglResourceRepository=t.WebGLResourceRepository.getInstance(),y.a.initDefaultTextures()}static common_$prerender(){if(null==b.__webglResourceRepository.currentWebGLContextWrapper)throw new Error("No WebGLRenderingContext!");return b.__webGLStrategy.common_$prerender(),b.__isReady()?0:(b.__instanceIDBufferUid=b.__setupInstanceIDBuffer(),b.__instanceIDBufferUid)}static __isReady(){return b.__instanceIDBufferUid!==u.a.InvalidCGAPIResourceUid}static __setupInstanceIDBuffer(){if(null==b.__instanceIdAccessor){const e=_.a.getInstance().getBuffer(d.a.CPUGeneric),t=m.a.maxEntityNumber,n=e.takeBufferView({byteLengthToNeed:4*t,byteStride:0,isAoS:!1});b.__instanceIdAccessor=n.takeAccessor({compositionType:f.a.Scalar,componentType:p.a.Float,count:t})}const e=b.__componentRepository.getComponentsWithType(r.a);if(null==e)return u.a.InvalidCGAPIResourceUid;for(var t=0;t<e.length;t++)b.__instanceIdAccessor.setScalar(t,e[t].entityUID,{});return b.__webglResourceRepository.createVertexBuffer(b.__instanceIdAccessor)}static common_$render({renderPass:e,processStage:t}){b.__cameraComponent=e.cameraComponent,null==b.__cameraComponent&&(b.__cameraComponent=b.__componentRepository.getComponent(l.a,l.a.main));let n=b.__tmp_indentityMatrix,i=b.__tmp_indentityMatrix;b.__cameraComponent&&(n=b.__cameraComponent.viewMatrix,i=b.__cameraComponent.projectionMatrix);const a=s.a.__componentsOfProcessStages.get(t),o=b.__componentRepository._getComponents(r.a);b.__webGLStrategy.common_$render(a,o,n,i,e)}static sort_$render(e){if(null==b.__manualTransparentSids){return b.sort_$render_inner(void 0,e)}return b.sort_$render_inner(b.__manualTransparentSids,e)}static sort_$render_inner(e=[],t){const n=t.sceneTopLevelGraphComponents;let h=[];const c=i.a.getInstance();let u=t.cameraComponent;if(null==u&&(u=c.getComponent(l.a,l.a.main)),u){u.updateFrustum();const e=u.frustum,t=n=>{const i=e.culling(n);if(i===v.a.Visible){const e=o.a.flattenHierarchy(n,!1);for(let t of e){const e=t.entity.getComponent(r.a);e&&h.push(e)}}else if(i===v.a.Neutral){const e=n.children,i=n.entity.getComponent(r.a);i&&h.push(i);for(let n of e)t(n)}};for(let e of n)t(e)}else h=t.meshComponents;h=Array.from(new Set(h));const _=[],m=[],d=[];for(let t=0;t<h.length;t++){if(!h[t].entity.getSceneGraph().isVisible)continue;if(h[t].entity.getComponent(b).currentProcessStage===a.a.Render){const n=h[t];n.mesh?(0===e.length&&n.mesh.isBlendPartially()?(m.push(n),_.push(n.componentSID)):0===e.length&&n.mesh.isAllBlend()&&d.push(n),n.mesh.isOpaque()?_.push(n.componentSID):u&&n.calcViewDepth(u)):r.a.alertNoMeshSet(n)}}const f=m.concat(d);let p;f.sort(function(e,t){return e.viewDepth<t.viewDepth?-1:e.viewDepth>t.viewDepth?1:0}),p=0===e.length?f.map(e=>e.componentSID):e,b.__firstTransparentIndex=_.length;const g=_.concat(p);return b.__lastTransparentIndex=g.length-1,g.push(s.a.invalidComponentSID),g}static set manualTransparentSids(e){b.__manualTransparentSids=e}static set manualTransparentEntityNames(e){b.__manualTransparentSids=[];for(let t of e){const e=x.a.getRnObjectByName(t);if(e){const t=e.getComponent(r.a);if(t){const e=t.mesh;e&&(e.isOpaque()||b.__manualTransparentSids.push(t.componentSID))}}}}}b.__shaderProgramHandleOfPrimitiveObjectUids=new Map,b.__componentRepository=i.a.getInstance(),b.__instanceIDBufferUid=u.a.InvalidCGAPIResourceUid,b.__tmp_indentityMatrix=c.a.identity(),b.__firstTransparentIndex=-1,b.__lastTransparentIndex=-1,i.a.registerComponentClass(b)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:0,str:"Perspective"}),a=new s({index:1,str:"Orthographic"}),o=new s({index:2,str:"Frustom"}),h=[r,a,o];const l=Object.freeze({Perspective:r,Orthographic:a,Frustom:o,from:function(e){return Object(i.b)({typeList:h,index:e})},fromString:function(e){return Object(i.c)({typeList:h,str:e})}})},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function a(e){try{h(i.next(e))}catch(e){r(e)}}function o(e){try{h(i.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(a,o)}h((i=i.apply(e,t||[])).next())})};class s{constructor(){this.__modules=new Map}loadModule(e){return i(this,void 0,void 0,function*(){let t;return"webgl"===e.toLowerCase()?t=yield n.e("webgl").then(n.bind(null,77)):"effekseer"===e.toLowerCase()?t=yield n.e("effekseer").then(n.bind(null,79)):"sparkgear"===e.toLowerCase()?t=yield n.e("sparkgear").then(n.bind(null,78)):"pbr"===e.toLowerCase()&&(t=yield n.e("pbr").then(n.bind(null,76))),this.__modules.set(e,t),console.log("Module Loaded:",t),t.default})}getModule(e){return this.__modules.get(e).default}static getInstance(){return this.__instance||(this.__instance=new s),this.__instance}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(22);class s extends i.a{constructor(e,t,{type:n}){super(e,t,{type:n})}get x(){return this.v[0]}get y(){return this.v[1]}set x(e){this.v[0]=e}set y(e){this.v[1]=e}multiply(e){return this.x*=e,this.y*=e,this}}class r extends s{constructor(e,t){super(e,t,{type:Float32Array})}clone(){return new r(this.x,this.y)}static one(){return new r(1,1)}static dummy(){return new r(null,0)}static zero(){return new r(0,0)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(38),s=n(1),r=n(20),a=n(34),o=n(9);class h extends a.a{constructor(){super(),this.autoResize=!1,this.autoDetectTransparency=!1}__getResizedCanvas(e){var t=document.createElement("canvas");t.width=this.__getNearestPowerOfTwo(e.width),t.height=this.__getNearestPowerOfTwo(e.height);var n=t.getContext("2d");if(n.drawImage(e,0,0,t.width,t.height),this.__imageData=n.getImageData(0,0,t.width,t.height),this.autoDetectTransparency){for(let e=0;e<t.height;e++)for(let n=0;n<t.width;n++){if(this.__imageData.data[4*(n+e*t.width)+3]<1)return this.__hasTransparentPixels=!0,t}this.__hasTransparentPixels=!1}return t}generateTextureFromImage(e){let t;this.__startedToLoad=!0,this.__htmlImageElement=e,this.autoResize||this.autoDetectTransparency?(t=this.__getResizedCanvas(e),this.__htmlCanvasElement=t):t=e,this.__width=t.width,this.__height=t.height;let n=o.a.getWebGLResourceRepository().createTexture(t,{level:0,internalFormat:i.a.RGBA,width:this.__width,height:this.__height,border:0,format:i.a.RGBA,type:s.a.Float,magFilter:r.a.Linear,minFilter:r.a.LinearMipmapLinear,wrapS:r.a.Repeat,wrapT:r.a.Repeat,generateMipmap:!0,anisotropy:!0});this.cgApiResourceUid=n,this.__isTextureReady=!0,this.__uri=e.src,a.a.__textureMap.set(n,this)}generateTextureFromUri(e){return this.__uri=e,this.__startedToLoad=!0,new Promise((t,n)=>{this.__img=new Image,e.match(/^data:/)||(this.__img.crossOrigin="Anonymous"),this.__img.onload=()=>{let e;this.__htmlImageElement=this.__img,this.autoResize||this.autoDetectTransparency?(e=this.__getResizedCanvas(this.__img),this.__htmlCanvasElement=e):e=this.__img,this.__width=e.width,this.__height=e.height;let n=o.a.getWebGLResourceRepository().createTexture(e,{level:0,internalFormat:i.a.RGBA,width:this.__width,height:this.__height,border:0,format:i.a.RGBA,type:s.a.Float,magFilter:r.a.Linear,minFilter:r.a.Linear,wrapS:r.a.Repeat,wrapT:r.a.Repeat,generateMipmap:!0,anisotropy:!0});this.cgApiResourceUid=n,this.__isTextureReady=!0,a.a.__textureMap.set(n,this),t()},this.__img.src=e})}generate1x1TextureFrom(e="rgba(255,255,255,1)"){var t=document.createElement("canvas");t.width=1,t.height=1;const n=t.getContext("2d");n.fillStyle=e,n.fillRect(0,0,1,1);const h=o.a.getWebGLResourceRepository().createTexture(t,{level:0,internalFormat:i.a.RGBA,width:1,height:1,border:0,format:i.a.RGBA,type:s.a.Float,magFilter:r.a.Nearest,minFilter:r.a.Nearest,wrapS:r.a.ClampToEdge,wrapT:r.a.ClampToEdge,generateMipmap:!1,anisotropy:!1});this.cgApiResourceUid=h,this.__isTextureReady=!0,a.a.__textureMap.set(h,this)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:0,str:"OPAQUE"}),a=new s({index:1,str:"MASK"}),o=new s({index:2,str:"BLEND"}),h=[r,a,o];const l=Object.freeze({Opaque:r,Mask:a,Blend:o,from:function(e){return Object(i.b)({typeList:h,index:e})},fromString:function(e){return Object(i.c)({typeList:h,str:e})}})},function(e,t,n){"use strict";var i=n(24),s=n(1),r=n(0),a=n(22),o=n(2),h=n(8),l=n(35),c=n(12);class u extends i.a{constructor({bufferView:e,byteOffset:t,compositionType:n,componentType:i,byteStride:a,count:o,raw:h,max:l,min:c,arrayLength:u}){super(),this.__compositionType=r.a.Unknown,this.__componentType=s.a.Unknown,this.__count=0,this.__takenCount=0,this.__byteStride=0,this.__arrayLength=1,this.__bufferView=e,this.__byteOffsetInBuffer=e.byteOffset+t,this.__compositionType=n,this.__componentType=i,this.__count=o,this.__arrayLength=u,this.__raw=h.buffer,null!=l&&(this.__max=l),null!=c&&(this.__min=c),this.__byteStride=a,0===this.__byteStride&&(this.__byteStride=this.__compositionType.getNumberOfComponents()*this.__componentType.getSizeInBytes()*this.__arrayLength),this.prepare()}prepare(){const e=this.getTypedArrayClass(this.__componentType);this.__typedArrayClass=e,8===this.__componentType.getSizeInBytes()&&this.__byteOffsetInBuffer%8!=0&&(console.info("Padding added because of byteOffset of accessor is not 8 bytes aligned despite of Double precision."),this.__byteOffsetInBuffer+=8-this.__byteOffsetInBuffer%8),this.__bufferView.isSoA?this.__dataView=new DataView(this.__raw,this.__byteOffsetInBuffer,this.__compositionType.getNumberOfComponents()*this.__componentType.getSizeInBytes()*this.__count):this.__dataView=new DataView(this.__raw,this.__byteOffsetInBuffer),this.__byteOffsetInBuffer%this.__componentType.getSizeInBytes()==0&&(this.__typedArray=new e(this.__raw,this.__byteOffsetInBuffer,this.__compositionType.getNumberOfComponents()*this.__count)),this.__dataViewGetter=this.__dataView[this.getDataViewGetter(this.__componentType)].bind(this.__dataView),this.__dataViewSetter=this.__dataView[this.getDataViewSetter(this.__componentType)].bind(this.__dataView)}getTypedArrayClass(e){switch(e){case s.a.Byte:return Int8Array;case s.a.UnsignedByte:return Uint8Array;case s.a.Short:return Int16Array;case s.a.UnsignedShort:return Uint16Array;case s.a.Int:return Int32Array;case s.a.UnsingedInt:return Uint32Array;case s.a.Float:return Float32Array;case s.a.Double:return Float64Array;default:return void console.error("Unexpected ComponentType!")}}getDataViewGetter(e){switch(e){case s.a.Byte:return"getInt8";case s.a.UnsignedByte:return"getUint8";case s.a.Short:return"getInt16";case s.a.UnsignedShort:return"getUint16";case s.a.Int:return"getInt32";case s.a.UnsingedInt:return"getUint32";case s.a.Float:return"getFloat32";case s.a.Double:return"getFloat64";default:return console.error("Unexpected ComponentType!"),"unkown"}}getDataViewSetter(e){switch(e){case s.a.Byte:return"setInt8";case s.a.UnsignedByte:return"setUint8";case s.a.Short:return"setInt16";case s.a.UnsignedShort:return"setUint16";case s.a.Int:return"setInt32";case s.a.UnsingedInt:return"setUint32";case s.a.Float:return"setFloat32";case s.a.Double:return"setFloat64";default:console.error("Unexpected ComponentType!")}}takeOne(){const e=this.__raw;this.__takenCount>=this.__count&&console.error("You are trying to allocate more than you have secured.");const t=new this.__typedArrayClass(e,this.__byteOffsetInBuffer+this.__byteStride*this.__takenCount,this.__compositionType.getNumberOfComponents()*this.__arrayLength);return this.__takenCount+=1,t._accessor=this,t._idx_of_accessor=this.__takenCount,t}get takenCount(){return this.takenCount}get numberOfComponents(){return this.__compositionType.getNumberOfComponents()}get componentSizeInBytes(){return this.__componentType.getSizeInBytes()}get elementSizeInBytes(){return this.numberOfComponents*this.componentSizeInBytes}get elementCount(){return this.__dataView.byteLength/(this.numberOfComponents*this.componentSizeInBytes)}get byteLength(){return this.__byteStride*this.__count}get componentType(){return this.__componentType}get compositionType(){return this.__compositionType}getTypedArray(){return this.__bufferView.isAoS&&console.warn("Be careful. this referance bufferView is AoS(Array on Structure), it means Interleaved Data. So you can not access your data properly by this TypedArray."),this.__typedArray}get isAoS(){return this.__bufferView.isAoS}get isSoA(){return this.__bufferView.isSoA}get byteStride(){return this.__byteStride}getScalar(e,{indicesAccessor:t,endian:n=!0}){let i=e;return t&&(i=t.getScalar(e,{})),this.__dataViewGetter(this.__byteStride*i,n)}getScalarAt(e,t,{indicesAccessor:n,endian:i=!0}){let s=e;return n&&(s=n.getScalar(e,{})),this.__dataViewGetter(this.__byteStride*s+t,i)}getVec2AsArray(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const s=this.componentSizeInBytes;return[this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*s,n)]}getVec3AsArray(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const s=this.componentSizeInBytes;return[this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*s,n),this.__dataViewGetter(this.__byteStride*i+2*s,n)]}getVec4AsArray(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const s=this.componentSizeInBytes;return[this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*s,n),this.__dataViewGetter(this.__byteStride*i+2*s,n),this.__dataViewGetter(this.__byteStride*i+3*s,n)]}getMat3AsArray(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const s=this.componentSizeInBytes;return[this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*s,n),this.__dataViewGetter(this.__byteStride*i+2*s,n),this.__dataViewGetter(this.__byteStride*i+3*s,n),this.__dataViewGetter(this.__byteStride*i+4*s,n),this.__dataViewGetter(this.__byteStride*i+5*s,n),this.__dataViewGetter(this.__byteStride*i+6*s,n),this.__dataViewGetter(this.__byteStride*i+7*s,n),this.__dataViewGetter(this.__byteStride*i+8*s,n)]}getMat4AsArray(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const s=this.componentSizeInBytes;return[this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*s,n),this.__dataViewGetter(this.__byteStride*i+2*s,n),this.__dataViewGetter(this.__byteStride*i+3*s,n),this.__dataViewGetter(this.__byteStride*i+4*s,n),this.__dataViewGetter(this.__byteStride*i+5*s,n),this.__dataViewGetter(this.__byteStride*i+6*s,n),this.__dataViewGetter(this.__byteStride*i+7*s,n),this.__dataViewGetter(this.__byteStride*i+8*s,n),this.__dataViewGetter(this.__byteStride*i+9*s,n),this.__dataViewGetter(this.__byteStride*i+10*s,n),this.__dataViewGetter(this.__byteStride*i+11*s,n),this.__dataViewGetter(this.__byteStride*i+12*s,n),this.__dataViewGetter(this.__byteStride*i+13*s,n),this.__dataViewGetter(this.__byteStride*i+14*s,n),this.__dataViewGetter(this.__byteStride*i+15*s,n)]}getVec2(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const s=this.componentSizeInBytes;return new a.b(this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*s,n))}getVec3(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const s=this.componentSizeInBytes;return new o.b(this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*s,n),this.__dataViewGetter(this.__byteStride*i+2*s,n))}getVec4(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const s=this.componentSizeInBytes;return new h.b(this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*s,n),this.__dataViewGetter(this.__byteStride*i+2*s,n),this.__dataViewGetter(this.__byteStride*i+3*s,n))}getMat3(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const s=this.componentSizeInBytes;return new l.a(this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*s,n),this.__dataViewGetter(this.__byteStride*i+2*s,n),this.__dataViewGetter(this.__byteStride*i+3*s,n),this.__dataViewGetter(this.__byteStride*i+4*s,n),this.__dataViewGetter(this.__byteStride*i+5*s,n),this.__dataViewGetter(this.__byteStride*i+6*s,n),this.__dataViewGetter(this.__byteStride*i+7*s,n),this.__dataViewGetter(this.__byteStride*i+8*s,n))}getMat4(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const s=this.componentSizeInBytes;return new c.a(this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*s,n),this.__dataViewGetter(this.__byteStride*i+2*s,n),this.__dataViewGetter(this.__byteStride*i+3*s,n),this.__dataViewGetter(this.__byteStride*i+4*s,n),this.__dataViewGetter(this.__byteStride*i+5*s,n),this.__dataViewGetter(this.__byteStride*i+6*s,n),this.__dataViewGetter(this.__byteStride*i+7*s,n),this.__dataViewGetter(this.__byteStride*i+8*s,n),this.__dataViewGetter(this.__byteStride*i+9*s,n),this.__dataViewGetter(this.__byteStride*i+10*s,n),this.__dataViewGetter(this.__byteStride*i+11*s,n),this.__dataViewGetter(this.__byteStride*i+12*s,n),this.__dataViewGetter(this.__byteStride*i+13*s,n),this.__dataViewGetter(this.__byteStride*i+14*s,n),this.__dataViewGetter(this.__byteStride*i+15*s,n))}setScalar(e,t,{indicesAccessor:n,endian:i=!0}){let s=e;n&&(s=n.getScalar(e,{})),this.__dataViewSetter(this.__byteStride*s,t,i)}setVec2(e,t,n,{indicesAccessor:i,endian:s=!0}){let r=e;i&&(r=i.getScalar(e,{}));const a=this.componentSizeInBytes;this.__dataViewSetter(this.__byteStride*r,t,s),this.__dataViewSetter(this.__byteStride*r+1*a,n,s)}setVec3(e,t,n,i,{indicesAccessor:s,endian:r=!0}){let a=e;s&&(a=s.getScalar(e,{}));const o=this.componentSizeInBytes;this.__dataViewSetter(this.__byteStride*a,t,r),this.__dataViewSetter(this.__byteStride*a+1*o,n,r),this.__dataViewSetter(this.__byteStride*a+2*o,i,r)}setVec4(e,t,n,i,s,{indicesAccessor:r,endian:a=!0}){let o=e;r&&(o=r.getScalar(e,{}));const h=this.componentSizeInBytes;this.__dataViewSetter(this.__byteStride*o,t,a),this.__dataViewSetter(this.__byteStride*o+1*h,n,a),this.__dataViewSetter(this.__byteStride*o+2*h,i,a),this.__dataViewSetter(this.__byteStride*o+3*h,s,a)}setVec2AsVector(e,t,{indicesAccessor:n,endian:i=!0}){let s=e;n&&(s=n.getScalar(e,{}));const r=this.componentSizeInBytes;this.__dataViewSetter(this.__byteStride*s,t.x,i),this.__dataViewSetter(this.__byteStride*s+1*r,t.y,i)}setVec3AsVector(e,t,{indicesAccessor:n,endian:i=!0}){let s=e;n&&(s=n.getScalar(e,{}));const r=this.componentSizeInBytes;this.__dataViewSetter(this.__byteStride*s,t.x,i),this.__dataViewSetter(this.__byteStride*s+1*r,t.y,i),this.__dataViewSetter(this.__byteStride*s+2*r,t.z,i)}setVec4AsVector(e,t,{indicesAccessor:n,endian:i=!0}){let s=e;n&&(s=n.getScalar(e,{}));const r=this.componentSizeInBytes;this.__dataViewSetter(this.__byteStride*s,t.x,i),this.__dataViewSetter(this.__byteStride*s+1*r,t.y,i),this.__dataViewSetter(this.__byteStride*s+2*r,t.z,i),this.__dataViewSetter(this.__byteStride*s+3*r,t.w,i)}copyFromTypedArray(e){const t=this.numberOfComponents,n=this["setVec"+t];for(let i=0;i<e.byteLength/this.componentSizeInBytes;i++){const s=Math.floor(i/t),r=s*t;switch(t){case 1:n.call(this,s,e[r+0],{});break;case 2:n.call(this,s,e[r+0],e[r+1],{});break;case 3:n.call(this,s,e[r+0],e[r+1],e[r+2],{});break;case 4:n.call(this,s,e[r+0],e[r+1],e[r+2],e[r+3],{});break;default:throw new Error("Other than vectors are currently not supported.")}}}setScalarAt(e,t,n,{indicesAccessor:i,endian:s=!0}){let r=e;i&&(r=i.getScalar(e,{})),this.__dataViewSetter(this.__byteStride*r+t,n,s)}setElementFromSameCompositionAccessor(e,t,n){const i=null!=n?n:e;1===this.compositionType.getNumberOfComponents()?this.setScalar(e,t.getScalar(i,{}),{}):2===this.compositionType.getNumberOfComponents()?this.setVec2AsVector(e,t.getVec2(i,{}),{}):3===this.compositionType.getNumberOfComponents()?this.setVec3AsVector(e,t.getVec3(i,{}),{}):4===this.compositionType.getNumberOfComponents()&&this.setVec4AsVector(e,t.getVec4(i,{}),{})}setElementFromAccessor(e,t,n){const i=null!=n?n:e;if(1===this.compositionType.getNumberOfComponents())1===t.compositionType.getNumberOfComponents()?this.setScalar(e,t.getScalar(i,{}),{}):2===t.compositionType.getNumberOfComponents()?this.setScalar(e,t.getVec2(i,{}).x,{}):3===t.compositionType.getNumberOfComponents()?this.setScalar(e,t.getVec3(i,{}).x,{}):4===t.compositionType.getNumberOfComponents()&&this.setScalar(e,t.getVec4(i,{}).x,{});else if(2===this.compositionType.getNumberOfComponents()){if(1===t.compositionType.getNumberOfComponents()){const n=t.getScalar(i,{});this.setVec2(e,n,0,{})}else if(2===t.compositionType.getNumberOfComponents())this.setVec2AsVector(e,t.getVec2(i,{}),{});else if(3===t.compositionType.getNumberOfComponents()){const n=t.getVec3(i,{});this.setVec2(e,n.x,n.y,{})}else if(4===t.compositionType.getNumberOfComponents()){const n=t.getVec4(i,{});this.setVec2(e,n.x,n.y,{})}}else if(3===this.compositionType.getNumberOfComponents()){if(1===t.compositionType.getNumberOfComponents()){const n=t.getScalar(i,{});this.setVec3(e,n,0,0,{})}else if(2===t.compositionType.getNumberOfComponents()){const n=t.getVec2(i,{});this.setVec3(e,n.x,n.y,0,{})}else if(3===t.compositionType.getNumberOfComponents()){const n=t.getVec3(i,{});this.setVec3AsVector(e,n,{})}else if(4===t.compositionType.getNumberOfComponents()){const n=t.getVec4(i,{});this.setVec3(e,n.x,n.y,n.z,{})}}else if(4===this.compositionType.getNumberOfComponents())if(1===t.compositionType.getNumberOfComponents()){const n=t.getScalar(i,{});this.setVec4(e,n,0,0,0,{})}else if(2===t.compositionType.getNumberOfComponents()){const n=t.getVec2(i,{});this.setVec4(e,n.x,n.y,0,0,{})}else if(3===t.compositionType.getNumberOfComponents()){const n=t.getVec3(i,{});this.setVec4(e,n.x,n.y,n.z,0,{})}else if(4===t.compositionType.getNumberOfComponents()){const n=t.getVec4(i,{});this.setVec4AsVector(e,n,{})}}addElementFromSameCompositionAccessor(e,t,n,i){const s=null!=i?i:e;1===this.compositionType.getNumberOfComponents()?this.setScalar(e,this.getScalar(e,{})+n*t.getScalar(s,{}),{}):2===this.compositionType.getNumberOfComponents()?this.setVec2AsVector(e,a.b.add(this.getVec2(e,{}),a.b.multiply(t.getVec2(s,{}),n)),{}):3===this.compositionType.getNumberOfComponents()?this.setVec3AsVector(e,o.b.add(this.getVec3(e,{}),o.b.multiply(t.getVec3(s,{}),n)),{}):4===this.compositionType.getNumberOfComponents()&&this.setVec4AsVector(e,h.b.add(this.getVec4(e,{}),h.b.multiply(t.getVec4(s,{}),n)),{})}get arrayBufferOfBufferView(){return this.__raw}get dataViewOfBufferView(){return this.__dataView}get byteOffsetInBufferView(){return this.__byteOffsetInBuffer-this.__bufferView.byteOffset}get byteOffsetInBuffer(){return this.__byteOffsetInBuffer}get bufferView(){return this.__bufferView}get min(){return this.__min}get max(){return this.__max}calcMinMax(){const e=this.compositionType.getNumberOfComponents();if(4===e){const e=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],t=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE];for(let n=0;n<this.elementCount;n++){const i=this.getVec4AsArray(n,{});for(let n=0;n<4;n++)i[n]<e[n]&&(e[n]=i[n]),t[n]<i[n]&&(t[n]=i[n])}this.__min=e,this.__max=t}else if(3===e){const e=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],t=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE];for(let n=0;n<this.elementCount;n++){const i=this.getVec3AsArray(n,{});for(let n=0;n<3;n++)i[n]<e[n]&&(e[n]=i[n]),t[n]<i[n]&&(t[n]=i[n])}this.__min=e,this.__max=t}else if(2===e){const e=[Number.MAX_VALUE,Number.MAX_VALUE],t=[-Number.MAX_VALUE,-Number.MAX_VALUE];for(let n=0;n<this.elementCount;n++){const i=this.getVec2AsArray(n,{});for(let n=0;n<2;n++)i[n]<e[n]&&(e[n]=i[n]),t[n]<i[n]&&(t[n]=i[n])}this.__min=e,this.__max=t}else if(1===e){let e=Number.MAX_VALUE,t=-Number.MAX_VALUE;for(let n=0;n<this.elementCount;n++){const i=this.getScalar(n,{});i<e&&(e=i),t<i&&(t=i)}this.__min=e,this.__max=t}}}class _ extends u{constructor({bufferView:e,byteOffset:t,compositionType:n,componentType:i,byteStride:s,count:r,raw:a,arrayLength:o}){super({bufferView:e,byteOffset:t,compositionType:n,componentType:i,byteStride:s,count:r,raw:a,arrayLength:o})}}class m extends u{constructor({bufferView:e,byteOffset:t,compositionType:n,componentType:i,byteStride:s,count:r,raw:a,arrayLength:o}){super({bufferView:e,byteOffset:t,compositionType:n,componentType:i,byteStride:s,count:r,raw:a,arrayLength:o})}}class d extends i.a{constructor({buffer:e,byteOffset:t,byteLength:n,raw:i,isAoS:s}){super(),this.__byteStride=0,this.__target=0,this.__takenByteIndex=0,this.__takenByteOffsetOfFirstElement=0,this.__accessors=[],this.__buffer=e,this.__byteOffset=t,this.__byteLength=n,this.__raw=i,this.__isAoS=s}set byteStride(e){this.__byteStride=e}get byteStride(){return this.__byteStride}get byteLength(){return this.__byteLength}get byteOffset(){return this.__byteOffset}get buffer(){return this.__buffer}get isSoA(){return!this.__isAoS}recheckIsSoA(){if(this.__accessors.length<=1)return!0;let e=this.__accessors[0].byteStride,t=this.__accessors[1].byteStride,n=this.__accessors[0].elementSizeInBytes,i=this.__accessors[1].elementSizeInBytes;return e===t&&n+i<n}get isAoS(){return this.__isAoS}getUint8Array(){return this.__raw}takeAccessor({compositionType:e,componentType:t,count:n,max:i,min:s,byteAlign:r=4,arrayLength:a}){const o=this.byteStride,h=null!=a?a:1;return this.__takeAccessorInner({compositionType:e,componentType:t,count:n,byteStride:o,accessorClass:_,max:i,min:s,byteAlign:r,arrayLength:h})}takeFlexibleAccessor({compositionType:e,componentType:t,count:n,byteStride:i,max:s,min:r,byteAlign:a=4,arrayLength:o}){const h=null!=o?o:1;return this.__takeAccessorInner({compositionType:e,componentType:t,count:n,byteStride:i,accessorClass:m,max:s,min:r,byteAlign:a,arrayLength:h})}takeAccessorWithByteOffset({compositionType:e,componentType:t,count:n,byteOffset:i,max:s,min:r}){const a=this.byteStride;return this.__takeAccessorInnerWithByteOffset({compositionType:e,componentType:t,count:n,byteStride:a,byteOffset:i,accessorClass:_,max:s,min:r})}takeFlexibleAccessorWithByteOffset({compositionType:e,componentType:t,count:n,byteStride:i,byteOffset:s,max:r,min:a}){return this.__takeAccessorInnerWithByteOffset({compositionType:e,componentType:t,count:n,byteStride:i,byteOffset:s,accessorClass:m,max:r,min:a})}__takeAccessorInner({compositionType:e,componentType:t,count:n,byteStride:i,accessorClass:s,max:r,min:a,byteAlign:o,arrayLength:h}){let l=0;if(this.isSoA?(l=this.__takenByteIndex,this.__takenByteIndex+=0===i?e.getNumberOfComponents()*t.getSizeInBytes()*h*n:i*n):(l=this.__takenByteIndex,this.__takenByteIndex+=e.getNumberOfComponents()*t.getSizeInBytes()*h),l%o!=0){console.info(`Padding bytes added because byteOffset is not ${o}byte aligned.`);const e=o-l%o;l+=e,this.__takenByteIndex+=e}const c=new s({bufferView:this,byteOffset:l,compositionType:e,componentType:t,byteStride:i,count:n,raw:this.__raw,max:r,min:a,arrayLength:h});return this.__accessors.push(c),c}__takeAccessorInnerWithByteOffset({compositionType:e,componentType:t,count:n,byteStride:i,byteOffset:s,accessorClass:r,max:a,min:o}){const h=new r({bufferView:this,byteOffset:s,compositionType:e,componentType:t,byteStride:i,count:n,raw:this.__raw,max:a,min:o,arrayLength:1});return this.__accessors.push(h),h}}n.d(t,"a",function(){return f});class f extends i.a{constructor({byteLength:e,arrayBuffer:t,name:n}){super(),this.__byteLength=0,this.__name="",this.__takenBytesIndex=0,this.__bufferViews=[],this.__name=n,this.__byteLength=e,this.__raw=t}set name(e){this.__name=e}get name(){return this.__name}getArrayBuffer(){return this.__raw}takeBufferView({byteLengthToNeed:e,byteStride:t,isAoS:n,byteAlign:i=4}){e%i!=0&&(console.info(`Padding bytes added because byteLengthToNeed must be a multiple of ${i}.`),e+=i-e%i);const s=new Uint8Array(this.__raw,this.__takenBytesIndex,e),r=new d({buffer:this,byteOffset:this.__takenBytesIndex,byteLength:e,raw:s,isAoS:n});return r.byteStride=t,this.__takenBytesIndex+=Uint8Array.BYTES_PER_ELEMENT*e,this.__bufferViews.push(r),r}takeBufferViewWithByteOffset({byteLengthToNeed:e,byteStride:t,byteOffset:n,isAoS:i}){const s=new Uint8Array(this.__raw,n,e),r=new d({buffer:this,byteOffset:n,byteLength:e,raw:s,isAoS:i}),a=Uint8Array.BYTES_PER_ELEMENT*e+n;return this.__takenBytesIndex<a&&(this.__takenBytesIndex=a),r.byteStride=t,this.__bufferViews.push(r),r}_addTakenByteIndex(e){this.__takenBytesIndex+=e}get byteLength(){return this.__byteLength}get takenSizeInByte(){return this.__takenBytesIndex}}},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(30),s=n(24);class r extends s.a{constructor(e,t){super(),this.__components=[],this.__entity_uid=e,this.__isAlive=t}get entityUID(){return this.__entity_uid}_setComponent(e){this.__components[e.constructor.componentTID]=e}getComponent(e){return this.__components[e.componentTID]}getComponentByComponentTID(e){return this.__components[e]}getTransform(){return null==this.__transformComponent&&(this.__transformComponent=this.getComponentByComponentTID(i.a.TransformComponentTID)),this.__transformComponent}getSceneGraph(){return null==this.__sceneGraphComponent&&(this.__sceneGraphComponent=this.getComponentByComponentTID(i.a.SceneGraphComponentTID)),this.__sceneGraphComponent}}r.invalidEntityUID=-1},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(2),s=n(15);class r{constructor(){this.__min=new s.a(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.__max=new s.a(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this.__centerPoint=i.b.zero(),this.__lengthCenterToCorner=0,this.__isCenterPointDirty=!1,this.__isLengthCenterToCornerDirty=!1}clone(){let e=new r;return e.__max=this.__max.clone(),e.__min=this.__min.clone(),e.__centerPoint=this.__centerPoint.clone(),e.__lengthCenterToCorner=this.__lengthCenterToCorner,e}set minPoint(e){this.__min=new s.a(e)}get minPoint(){return new i.b(this.__min)}set maxPoint(e){this.__max=new s.a(e)}get maxPoint(){return new i.b(this.__max)}isVanilla(){return this.__min.x>=Number.MAX_VALUE&&this.__min.y>=Number.MAX_VALUE&&this.__min.z>=Number.MAX_VALUE&&this.__max.x<=-Number.MAX_VALUE&&this.__max.y<=-Number.MAX_VALUE&&this.__max.z<=-Number.MAX_VALUE}addPosition(e){return this.__min.x=e.x<this.__min.x?e.x:this.__min.x,this.__min.y=e.y<this.__min.y?e.y:this.__min.y,this.__min.z=e.z<this.__min.z?e.z:this.__min.z,this.__max.x=this.__max.x<e.x?e.x:this.__max.x,this.__max.y=this.__max.y<e.y?e.y:this.__max.y,this.__max.z=this.__max.z<e.z?e.z:this.__max.z,this.__isCenterPointDirty=!0,this.__isLengthCenterToCornerDirty=!0,e}addPositionWithArray(e,t){return this.__min.x=e[t+0]<this.__min.x?e[t+0]:this.__min.x,this.__min.y=e[t+1]<this.__min.y?e[t+1]:this.__min.y,this.__min.z=e[t+2]<this.__min.z?e[t+2]:this.__min.z,this.__max.x=this.__max.x<e[t+0]?e[t+0]:this.__max.x,this.__max.y=this.__max.y<e[t+1]?e[t+1]:this.__max.y,this.__max.z=this.__max.z<e[t+2]?e[t+2]:this.__max.z,this.__isCenterPointDirty=!0,this.__isLengthCenterToCornerDirty=!0,e}mergeAABB(e){var t=!1;return e.isVanilla()?t:this.isVanilla()?(this.__min.x=e.minPoint.x,this.__min.y=e.minPoint.y,this.__min.z=e.minPoint.z,this.__max.x=e.maxPoint.x,this.__max.y=e.maxPoint.y,this.__max.z=e.maxPoint.z,t=!0):(e.minPoint.x<this.__min.x&&(this.__min.x=e.minPoint.x,t=!0),e.minPoint.y<this.__min.y&&(this.__min.y=e.minPoint.y,t=!0),e.minPoint.z<this.__min.z&&(this.__min.z=e.minPoint.z,t=!0),this.__max.x<e.maxPoint.x&&(this.__max.x=e.maxPoint.x,t=!0),this.__max.y<e.maxPoint.y&&(this.__max.y=e.maxPoint.y,t=!0),this.__max.z<e.maxPoint.z&&(this.__max.z=e.maxPoint.z,t=!0),this.__isCenterPointDirty=!0,this.__isLengthCenterToCornerDirty=!0,t)}get centerPoint(){return this.__isCenterPointDirty&&(this.__centerPoint=i.b.add(this.__min,this.__max).divide(2),this.__isCenterPointDirty=!1),this.__centerPoint}get lengthCenterToCorner(){if(this.__isLengthCenterToCornerDirty){const e=i.b.lengthBtw(this.centerPoint,this.maxPoint);this.__lengthCenterToCorner=e!=e?0:e,this.__isLengthCenterToCornerDirty=!1}return this.__lengthCenterToCorner}get sizeX(){return this.__max.x-this.__min.x}get sizeY(){return this.__max.y-this.__min.y}get sizeZ(){return this.__max.z-this.__min.z}static multiplyMatrix(e,t){if(t.isVanilla())return t.clone();var n=new r;return r.__tmpVector3.x=t.__min.x,r.__tmpVector3.y=t.__min.y,r.__tmpVector3.z=t.__min.z,n.addPosition(r.__tmpVector3),r.__tmpVector3.x=t.__max.x,r.__tmpVector3.y=t.__min.y,r.__tmpVector3.z=t.__min.z,n.addPosition(r.__tmpVector3),r.__tmpVector3.x=t.__min.x,r.__tmpVector3.y=t.__max.y,r.__tmpVector3.z=t.__min.z,n.addPosition(r.__tmpVector3),r.__tmpVector3.x=t.__min.x,r.__tmpVector3.y=t.__min.y,r.__tmpVector3.z=t.__max.z,n.addPosition(r.__tmpVector3),r.__tmpVector3.x=t.__min.x,r.__tmpVector3.y=t.__max.y,r.__tmpVector3.z=t.__max.z,n.addPosition(r.__tmpVector3),r.__tmpVector3.x=t.__max.x,r.__tmpVector3.y=t.__min.y,r.__tmpVector3.z=t.__max.z,n.addPosition(r.__tmpVector3),r.__tmpVector3.x=t.__max.x,r.__tmpVector3.y=t.__max.y,r.__tmpVector3.z=t.__min.z,n.addPosition(r.__tmpVector3),r.__tmpVector3.x=t.__max.x,r.__tmpVector3.y=t.__max.y,r.__tmpVector3.z=t.__max.z,n.addPosition(r.__tmpVector3),n}static multiplyMatrixTo(e,t,n){return t.isVanilla()?t.clone():(r.__tmpVector3.x=t.__min.x,r.__tmpVector3.y=t.__min.y,r.__tmpVector3.z=t.__min.z,e.multiplyVectorToVec3(r.__tmpVector3,r.__tmpVector3),n.addPosition(r.__tmpVector3),r.__tmpVector3.x=t.__max.x,r.__tmpVector3.y=t.__min.y,r.__tmpVector3.z=t.__min.z,e.multiplyVectorToVec3(r.__tmpVector3,r.__tmpVector3),n.addPosition(r.__tmpVector3),r.__tmpVector3.x=t.__min.x,r.__tmpVector3.y=t.__max.y,r.__tmpVector3.z=t.__min.z,e.multiplyVectorToVec3(r.__tmpVector3,r.__tmpVector3),n.addPosition(r.__tmpVector3),r.__tmpVector3.x=t.__min.x,r.__tmpVector3.y=t.__min.y,r.__tmpVector3.z=t.__max.z,e.multiplyVectorToVec3(r.__tmpVector3,r.__tmpVector3),n.addPosition(r.__tmpVector3),r.__tmpVector3.x=t.__min.x,r.__tmpVector3.y=t.__max.y,r.__tmpVector3.z=t.__max.z,e.multiplyVectorToVec3(r.__tmpVector3,r.__tmpVector3),n.addPosition(r.__tmpVector3),r.__tmpVector3.x=t.__max.x,r.__tmpVector3.y=t.__min.y,r.__tmpVector3.z=t.__max.z,e.multiplyVectorToVec3(r.__tmpVector3,r.__tmpVector3),n.addPosition(r.__tmpVector3),r.__tmpVector3.x=t.__max.x,r.__tmpVector3.y=t.__max.y,r.__tmpVector3.z=t.__min.z,e.multiplyVectorToVec3(r.__tmpVector3,r.__tmpVector3),n.addPosition(r.__tmpVector3),r.__tmpVector3.x=t.__max.x,r.__tmpVector3.y=t.__max.y,r.__tmpVector3.z=t.__max.z,e.multiplyVectorToVec3(r.__tmpVector3,r.__tmpVector3),n.addPosition(r.__tmpVector3),n)}toString(){return"AABB_min: "+this.__min+"\nAABB_max: "+this.__max+"\ncenterPoint: "+this.__centerPoint+"\nlengthCenterToCorner: "+this.__lengthCenterToCorner}}r.__tmpVector3=s.a.zero()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var i=n(27),s=n(10),r=n(30),a=n(57),o=n(0),h=n(23),l=n(42),c=n(13),u=n(2),_=n(15),m=n(41),d=n(25),f=n(29);class p extends i.a{constructor(e,t,n){super(e,t,n),this.__animationLine={},this.__backupDefaultValues={},this.__currentProcessStage=c.a.Create}static get componentTID(){return r.a.AnimationComponentTID}setAnimation(e,t,n,i){const s={input:t,output:n,inTangent:[],outTangent:[],outputAttributeName:e,outputCompositionType:n[0].compositionType,interpolationMethod:i};this.__animationLine[e]=s}static lerp(e,t,n,i){if(i===o.a.Scalar)return e*(1-n)+t*n;if(e instanceof h.a)return h.a.qlerpTo(e,t,n,p.returnQuaternion),p.returnQuaternion;if(e instanceof u.b)return this.returnVector3.x=e.x*(1-n)+t.x*n,this.returnVector3.y=e.y*(1-n)+t.y*n,this.returnVector3.z=e.z*(1-n)+t.z*n,this.returnVector3;{const i=[];for(let s=0;s<e.length;s++)i[s]=e[s]*(1-n)+t[s]*n;return i}}static cubicSpline(e,t,n,i,s,r,a){const l=s*s,c=l*s;if(a===o.a.Scalar)return(2*c-3*l+1)*e+(c-2*l+s)*n+(-2*c+3*l)*t+(c-l)*i;if(e instanceof u.b)return this.returnVector3.x=(2*c-3*l+1)*e.x+(c-2*l+s)*n.x+(-2*c+3*l)*t.x+(c-l)*i.x,this.returnVector3.y=(2*c-3*l+1)*e.y+(c-2*l+s)*n.y+(-2*c+3*l)*t.y+(c-l)*i.y,this.returnVector3.z=(2*c-3*l+1)*e.z+(c-2*l+s)*n.z+(-2*c+3*l)*t.z+(c-l)*i.z,this.returnVector3;if(e instanceof h.a)return this.returnQuaternion.x=(2*c-3*l+1)*e.x+(c-2*l+s)*n.x+(-2*c+3*l)*t.x+(c-l)*i.x,this.returnQuaternion.y=(2*c-3*l+1)*e.y+(c-2*l+s)*n.y+(-2*c+3*l)*t.y+(c-l)*i.y,this.returnQuaternion.z=(2*c-3*l+1)*e.z+(c-2*l+s)*n.z+(-2*c+3*l)*t.z+(c-l)*i.z,this.returnQuaternion.w=(2*c-3*l+1)*e.w+(c-2*l+s)*n.w+(-2*c+3*l)*t.w+(c-l)*i.w,this.returnQuaternion;{const r=[];for(let a=0;a<e.length;a++)r[a]=(2*c-3*l+1)*e.x+(c-2*l+s)*n[a]+(-2*c+3*l)*t.x+(c-l)*i[a];return r}}static __isClamped(e,t){return e<0||e>=t.length}static binarySearch(e,t){let n=0,i=e.length-1,s=0;for(;n<=i;){const r=e[s=n+Math.floor((i-n)/2)];if(r===t)return s;r>t?i=s-1:n=s+1}return s}static interpolationSearch(e,t){let n=0,i=0,s=e.length-1;for(;i<=s&&!((n=Math.floor(i+(t-e[i])*(s-i)/(e[s]-e[i])))<i||s<n);){if(e[n]===t)return n;e[n]<t?i=n+1:s=n-1}return n}static interpolate(e,t){const n=e.input,i=e.output,s=e.outputCompositionType,r=null!=e.interpolationMethod?e.interpolationMethod:a.a.Linear;if(r===a.a.CubicSpline){for(let e=0;e<n.length-1;e++)if(n[e]<=t&&t<n[e+1]){const r=p.__isClamped(e-1,n),a=p.__isClamped(e+1,n),o=p.__isClamped(e+2,n);let h=f.a.initWithScalar(i[0],0);r||(h=f.a.multiplyNumber(f.a.add(f.a.divideNumber(f.a.subtract(i[e+1],i[e]),f.a.subtract(n[e+1],n[e])),f.a.divideNumber(f.a.subtract(i[e],i[e-1]),f.a.subtract(n[e],n[e-1]))),.5));let l=f.a.initWithScalar(i[0],0);a||o||(l=f.a.multiplyNumber(f.a.add(f.a.divideNumber(f.a.subtract(i[e+2],i[e+1]),f.a.subtract(n[e+2],n[e+1])),f.a.divideNumber(f.a.subtract(i[e+1],i[e]),f.a.subtract(n[e+1],n[e]))),.5));let c=(t-n[e])/(n[e+1]-n[e]);return this.cubicSpline(i[e],i[e+1],h,l,c,n[e+1]-n[e],s)}}else{if(t<n[0])return i[0];if(n[n.length-1]<=t)return i[i.length-1];if(r===a.a.Linear){const e=this.interpolationSearch(n,t);if(null!=n[e+1]){let r=(t-n[e])/(n[e+1]-n[e]);return this.lerp(i[e],i[e+1],r,s)}return i[i.length-1]}if(r===a.a.Step)for(let e=0;e<n.length&&void 0!==n[e+1];e++)if(n[e]<=t&&t<n[e+1])return i[e]}return i[0]}getStartInputValueOfAnimation(){let e=Number.MAX_VALUE;for(let t in this.__animationLine){let n=this.__animationLine[t].input[0];n<e&&(e=n)<p.__startInputValueOfAllComponent&&(p.__startInputValueOfAllComponent=e)}return e}getEndInputValueOfAnimation(){let e=-Number.MAX_VALUE;for(let t in this.__animationLine){let n=this.__animationLine[t].input,i=n[n.length-1];i>e&&(e=i)>p.__endInputValueOfAllComponent&&(p.__endInputValueOfAllComponent=e)}return e}static get startInputValue(){return s.a.getInstance().getComponentsWithType(p).forEach(e=>{e.getStartInputValueOfAnimation()}),p.__startInputValueOfAllComponent}static get endInputValue(){return s.a.getInstance().getComponentsWithType(p).forEach(e=>{e.getEndInputValueOfAnimation()}),p.__endInputValueOfAllComponent}$create(){this.__transformComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,l.a),this.__meshComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,d.a),this.moveStageTo(c.a.Logic)}$logic(){for(let e in this.__animationLine)if(null==this.__backupDefaultValues[e]&&(this.__backupDefaultValues[e]="weights"===e?this.__meshComponent[e]:this.__transformComponent[e]),p.isAnimating){const t=this.__animationLine[e];let n=p.interpolate(t,p.globalTime);"weights"===e?this.__meshComponent[e]=n:this.__transformComponent[e]=n}else"weights"===e?this.__meshComponent[e]=this.__backupDefaultValues[e]:this.__transformComponent[e]=this.__backupDefaultValues[e]}}p.globalTime=0,p.isAnimating=!0,p.__startInputValueOfAllComponent=Number.MAX_VALUE,p.__endInputValueOfAllComponent=-Number.MAX_VALUE,p.returnVector3=_.a.zero(),p.returnQuaternion=new m.a([0,0,0,1]),s.a.registerComponentClass(p)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(34),s=n(20),r=n(38),a=n(1),o=n(9),h=n(8);class l extends i.a{constructor(){super()}create({width:e,height:t,level:n=0,internalFormat:h=r.a.RGBA,format:l=r.a.RGBA,type:c=a.a.UnsignedByte,magFilter:u=s.a.Linear,minFilter:_=s.a.Linear,wrapS:m=s.a.ClampToEdge,wrapT:d=s.a.ClampToEdge}){this.__width=e,this.__height=t;const f=o.a.getWebGLResourceRepository().createRenderTargetTexture({width:e,height:t,level:n,internalFormat:h,format:l,type:c,magFilter:u,minFilter:_,wrapS:m,wrapT:d});this.cgApiResourceUid=f,i.a.__textureMap.set(f,this)}set _fbo(e){this.__fbo=e}get fbo(){return this.__fbo}destroy3DAPIResources(){return o.a.getWebGLResourceRepository().deleteTexture(this.cgApiResourceUid),!0}getTexturePixelData(){const e=o.a.getWebGLResourceRepository(),t=e.currentWebGLContextWrapper.getRawContext(),n=e.getWebGLResource(this.__fbo.framebufferUID);t.bindFramebuffer(t.FRAMEBUFFER,n);let i=new Uint8Array(this.width*this.height*4);return null!=t.readBuffer&&t.readBuffer(this.__fbo.whichColorAttachment(this)),t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,i),t.bindFramebuffer(t.FRAMEBUFFER,null),i}getPixelValueAt(e,t,n){let i=n;return i||(i=this.getTexturePixelData()),new h.b(i[4*(t*this.width+e)+0],i[4*(t*this.width+e)+1],i[4*(t*this.width+e)+2],i[4*(t*this.width+e)+3])}}},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:0,str:"Linear"}),a=new s({index:1,str:"Step"}),o=new s({index:2,str:"CubicSpline"}),h=[r,a,o];const l=Object.freeze({Linear:r,Step:a,CubicSpline:o,from:function(e){return Object(i.b)({typeList:h,index:e})},fromString:function(e){return Object(i.c)({typeList:h,str:e})}})},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var i=n(27),s=n(30),r=n(10),a=n(2),o=n(15),h=n(40),l=n(35),c=n(14),u=n(33),_=n(13),m=n(18);class d extends i.a{constructor(e,t,n){super(e,t,n),this.__isKeyUp=!1,this.__movedMouseYOnCanvas=-1,this.__movedMouseXOnCanvas=-1,this.__clickedMouseYOnCanvas=-1,this.__clickedMouseXOnCanvas=-1,this.__mouse_translate_y=0,this.__mouse_translate_x=0,this.__efficiency=1,this.__lengthOfCenterToEye=1,this.__foyvBias=1,this.__scaleOfTraslation=5,this.__mouseTranslateVec=o.a.zero(),this.__newEyeToCenterVec=o.a.zero(),this.__newUpVec=o.a.zero(),this.__newTangentVec=o.a.zero(),this.__verticalAngleThrethold=0,this.__verticalAngleOfVectors=0,this.__isForceGrab=!1,this.__isSymmetryMode=!1,this.__doResetWhenCameraSettingChanged=!1,this.__rot_bgn_x=0,this.__rot_bgn_y=0,this.__rot_x=0,this.__rot_y=0,this.__dolly=1,this.__eyeVec=o.a.zero(),this.__centerVec=o.a.zero(),this.__upVec=o.a.zero(),this.__shiftCameraTo=o.a.zero(),this.__lengthCenterToCorner=.5,this.__lengthCameraToObject=1,this.__scaleOfLengthCameraToCenter=1,this.__zFarAdjustingFactorBasedOnAABB=2,this.__scaleOfZNearAndZFar=5e3,this.__doPreventDefault=!0,this.moveSpeed=1,this.__pinchInOutInitDistance=null,this.__initX=null,this.__initY=null,this.__originalTranslate=o.a.zero(),this.__totalTranslate=o.a.zero(),this.__resetDollyTouchTime=0,this.__controllerTranslate=o.a.zero(),this.__mouseDownFunc=this.__mouseDown.bind(this),this.__mouseUpFunc=this.__mouseUp.bind(this),this.__mouseMoveFunc=this.__mouseMove.bind(this),this.__pinchInOutFunc=this.__pinchInOut.bind(this),this.__pinchInOutEndFunc=this.__pinchInOutEnd.bind(this),this.__mouseWheelFunc=this.__mouseWheel.bind(this),this.__mouseDblClickFunc=this.__mouseDblClick.bind(this),this.__contextMenuFunc=this.__contextMenu.bind(this),this.__touchParalleltranslationStartFunc=this.__touchParalleltranslationStart.bind(this),this.__touchParalleltranslationFunc=this.__touchParalleltranslation.bind(this),this.__touchParalleltranslationEndFunc=this.__touchParalleltranslationEnd.bind(this),this.__resetDollyAndPositionFunc=this.__resetDollyAndPosition.bind(this),this.__mouseParalleltranslationStartFunc=this.__mouseParalleltranslationStart.bind(this),this.__mouseParalleltranslationFunc=this.__mouseParalleltranslation.bind(this),this.__mouseParalleltranslationEndFunc=this.__mouseParalleltranslationEnd.bind(this),this.registerEventListeners()}set zFarAdjustingFactorBasedOnAABB(e){this.__zFarAdjustingFactorBasedOnAABB=e}get zFarAdjustingFactorBasedOnAABB(){return this.__zFarAdjustingFactorBasedOnAABB}setTarget(e){this.__targetEntity=e}getTarget(){return this.__targetEntity}set doPreventDefault(e){this.__doPreventDefault=e}get doPreventDefault(){return this.__doPreventDefault}$create(){this.__cameraComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,c.a),this.moveStageTo(_.a.Logic)}__mouseUp(e){this.__isKeyUp=!0,this.__movedMouseYOnCanvas=-1,this.__movedMouseXOnCanvas=-1}__mouseDown(e){this.__tryToPreventDefault(e);let t=e.target.getBoundingClientRect(),n=null,i=null;return e.clientX?(n=e.clientX,i=e.clientY):(n=e.touches[0].clientX,i=e.touches[0].clientY),this.__clickedMouseXOnCanvas=n-t.left,this.__clickedMouseYOnCanvas=i-t.top,this.__movedMouseYOnCanvas=-1,this.__movedMouseXOnCanvas=-1,this.__rot_bgn_x=this.__rot_x,this.__rot_bgn_y=this.__rot_y,this.__isKeyUp=!1,e.buttons,!1}__mouseMove(e){if(e.touches&&e.touches.length>1)return;if(this.__tryToPreventDefault(e),this.__isKeyUp)return;let t=e.target.getBoundingClientRect(),n=null,i=null;if(e.clientX?(n=e.clientX,i=e.clientY):(n=e.touches[0].clientX,i=e.touches[0].clientY),this.__movedMouseXOnCanvas=n-t.left,this.__movedMouseYOnCanvas=i-t.top,void 0!==e.buttons){let t=e.buttons,n=!!(1&t);if(!!(4&t)){this.__mouse_translate_y=(this.__movedMouseYOnCanvas-this.__clickedMouseYOnCanvas)/1e3*this.__efficiency,this.__mouse_translate_x=(this.__movedMouseXOnCanvas-this.__clickedMouseXOnCanvas)/1e3*this.__efficiency;let t=this.__lengthOfCenterToEye*this.__foyvBias*this.__scaleOfTraslation;e.shiftKey?this.__mouseTranslateVec=a.b.add(this.__mouseTranslateVec,o.a.normalize(this.__newEyeToCenterVec).multiply(-this.__mouse_translate_y).multiply(t)):this.__mouseTranslateVec=a.b.add(this.__mouseTranslateVec,o.a.normalize(this.__newUpVec).multiply(this.__mouse_translate_y).multiply(t)),this.__mouseTranslateVec=a.b.add(this.__mouseTranslateVec,o.a.normalize(this.__newTangentVec).multiply(this.__mouse_translate_x).multiply(t)),this.__clickedMouseYOnCanvas=this.__movedMouseYOnCanvas,this.__clickedMouseXOnCanvas=this.__movedMouseXOnCanvas}if(!n)return}let s=(this.__movedMouseYOnCanvas-this.__clickedMouseYOnCanvas)*this.__efficiency,r=(this.__movedMouseXOnCanvas-this.__clickedMouseXOnCanvas)*this.__efficiency;this.__rot_y=this.__rot_bgn_y-s,this.__rot_x=this.__rot_bgn_x-r,this.__verticalAngleThrethold,this.__verticalAngleOfVectors,this.__rot_y,this.__rot_y,this.__verticalAngleThrethold,this.__verticalAngleOfVectors,null!=this.__maximum_y&&this.__rot_y>this.__maximum_y&&(this.__rot_y=this.__maximum_y),null!=this.__minimum_y&&this.__rot_y<this.__minimum_y&&(this.__rot_y=this.__minimum_y)}set maximumY(e){this.__maximum_y=e}set minimumY(e){this.__minimum_y=e}__tryToPreventDefault(e){this.__doPreventDefault&&e.preventDefault()}__mouseWheel(e){this.__tryToPreventDefault(e),this.dolly+=e.deltaY/600}__contextMenu(e){e.preventDefault?this.__tryToPreventDefault(e):e.returnValue=!1}__mouseDblClick(e){e.shiftKey?this.__mouseTranslateVec=new o.a(0,0,0):e.ctrlKey&&(this.__rot_y=0,this.__rot_x=0,this.__rot_bgn_y=0,this.__rot_bgn_x=0)}resetDolly(){this.dolly=1}set dolly(e){this.__dolly=e,this.__dolly=Math.min(this.__dolly,3),this.__dolly=Math.max(this.__dolly,.01)}get dolly(){return this.__dolly}__getTouchesDistance(e){const t=e.changedTouches,n=t[0].pageX,i=t[0].pageY,s=t[1].pageX,r=t[1].pageY;return Math.sqrt(Math.pow(s-n,2)+Math.pow(r-i,2))}__pinchInOutEnd(e){this.__pinchInOutInitDistance=null}__pinchInOut(e){if(e.changedTouches.length<2)return;if(!this.__pinchInOutInitDistance)return void(this.__pinchInOutInitDistance=this.__getTouchesDistance(e));const t=this.__pinchInOutInitDistance,n=this.__getTouchesDistance(e);this.__pinchInOutInitDistance=n;const i=t/n;Math.abs(t-n);this.dolly/=1/i,this.dolly>3&&(this.dolly=3),this.dolly<.01&&(this.dolly=.01)}__touchParalleltranslationStart(e){if(2!=e.touches.length)return;const t=this.__entityRepository.getEntity(this.__entityUid).getTransform().translate;this.__originalTranslate=new a.b(t.x-this.__controllerTranslate.x,t.y-this.__controllerTranslate.y,t.z-this.__controllerTranslate.z)}__touchParalleltranslation(e){if(this.__tryToPreventDefault(e),!(e.touches.length<2)){if(this.__initX){let t=(e.touches[0].pageX+e.touches[1].pageX)/2;this.__controllerTranslate.x-=this.dolly*this.__lengthCameraToObject*Math.cos(2*Math.PI*this.__rot_x/360)*(this.__initX-t)*this.moveSpeed/200*-1,this.__controllerTranslate.z-=this.dolly*this.__lengthCameraToObject*Math.sin(2*Math.PI*this.__rot_x/360)*(this.__initX-t)*this.moveSpeed/200,this.__initX=t}else this.__initX=(e.touches[0].pageX+e.touches[1].pageX)/2;if(this.__initY){let t=e.touches[0].pageY;this.__controllerTranslate.x-=this.dolly*this.__lengthCameraToObject*Math.sin(2*Math.PI*this.__rot_y/360)*Math.sin(2*Math.PI*this.__rot_x/360)*(this.__initY-t)*this.moveSpeed/200,this.__controllerTranslate.y-=this.dolly*this.__lengthCameraToObject*Math.cos(2*Math.PI*this.__rot_y/360)*(this.__initY-t)*this.moveSpeed/200,this.__controllerTranslate.z-=this.dolly*this.__lengthCameraToObject*Math.sin(2*Math.PI*this.__rot_y/360)*Math.cos(2*Math.PI*this.__rot_x/360)*(this.__initY-t)*this.moveSpeed/200,this.__initY=t}else this.__initY=e.touches[0].pageY;this.__totalTranslate.x=this.__originalTranslate.x+this.__controllerTranslate.x,this.__totalTranslate.y=this.__originalTranslate.y+this.__controllerTranslate.y,this.__totalTranslate.z=this.__originalTranslate.z+this.__controllerTranslate.z,this.__entityRepository.getEntity(this.__entityUid).getTransform().translate=this.__totalTranslate}}__touchParalleltranslationEnd(e){this.__initX=null,this.__initY=null}__mouseParalleltranslationStart(e){if(2==e.button){this.__initX=e.clientX,this.__initY=e.clientY;const t=this.__entityRepository.getEntity(this.__entityUid).getTransform().translate;this.__originalTranslate=new a.b(t.x-this.__controllerTranslate.x,t.y-this.__controllerTranslate.y,t.z-this.__controllerTranslate.z)}}__mouseParalleltranslation(e){if(null!==this.__initX){if(this.__initX){let t=e.clientX;this.__controllerTranslate.x-=this.dolly*this.__lengthCameraToObject*Math.cos(2*Math.PI*this.__rot_x/360)*(this.__initX-t)*this.moveSpeed/200*-1,this.__controllerTranslate.z-=this.dolly*this.__lengthCameraToObject*Math.sin(2*Math.PI*this.__rot_x/360)*(this.__initX-t)*this.moveSpeed/200,this.__initX=t}if(this.__initY){let t=e.clientY;this.__controllerTranslate.x-=this.dolly*this.__lengthCameraToObject*Math.sin(2*Math.PI*this.__rot_y/360)*Math.sin(2*Math.PI*this.__rot_x/360)*(this.__initY-t)*this.moveSpeed/200,this.__controllerTranslate.y-=this.dolly*this.__lengthCameraToObject*Math.cos(2*Math.PI*this.__rot_y/360)*(this.__initY-t)*this.moveSpeed/200,this.__controllerTranslate.z-=this.dolly*this.__lengthCameraToObject*Math.sin(2*Math.PI*this.__rot_y/360)*Math.cos(2*Math.PI*this.__rot_x/360)*(this.__initY-t)*this.moveSpeed/200,this.__initY=t}this.__totalTranslate.x=this.__originalTranslate.x+this.__controllerTranslate.x,this.__totalTranslate.y=this.__originalTranslate.y+this.__controllerTranslate.y,this.__totalTranslate.z=this.__originalTranslate.z+this.__controllerTranslate.z,this.__entityRepository.getEntity(this.__entityUid).getTransform().translate=this.__totalTranslate}}__mouseParalleltranslationEnd(e){this.__initX=null,this.__initY=null}__resetDollyAndPosition(e){if(e.touches.length>1)return;const t=(new Date).getTime();t-this.__resetDollyTouchTime<300?(this.dolly=1,this.__controllerTranslate.zero(),this.__rot_x=0,this.__rot_y=0,this.__totalTranslate.x=0,this.__totalTranslate.y=0,this.__totalTranslate.z=0,this.__entityRepository.getEntity(this.__entityUid).getTransform().translate=this.__totalTranslate):this.__resetDollyTouchTime=t}registerEventListeners(e=document){e&&("ontouchend"in document?(e.addEventListener("touchstart",this.__mouseDownFunc,{passive:!this.__doPreventDefault}),e.addEventListener("touchend",this.__mouseUpFunc,{passive:!this.__doPreventDefault}),e.addEventListener("touchmove",this.__mouseMoveFunc,{passive:!this.__doPreventDefault}),e.addEventListener("mousedown",this.__mouseDownFunc,{passive:!this.__doPreventDefault}),e.addEventListener("mouseup",this.__mouseUpFunc,{passive:!this.__doPreventDefault}),e.addEventListener("mousemove",this.__mouseMoveFunc,{passive:!this.__doPreventDefault}),e.addEventListener("touchstart",this.__touchParalleltranslationStartFunc,{passive:!this.__doPreventDefault}),e.addEventListener("touchmove",this.__touchParalleltranslationFunc,{passive:!this.__doPreventDefault}),e.addEventListener("touchend",this.__touchParalleltranslationEndFunc,{passive:!this.__doPreventDefault}),e.addEventListener("touchmove",this.__pinchInOutFunc,{passive:!this.__doPreventDefault}),e.addEventListener("touchend",this.__pinchInOutEndFunc,{passive:!this.__doPreventDefault}),e.addEventListener("touchstart",this.__resetDollyAndPositionFunc,{passive:!this.__doPreventDefault})):(e.addEventListener("mousedown",this.__mouseDownFunc,{passive:!this.__doPreventDefault}),e.addEventListener("mouseup",this.__mouseUpFunc,{passive:!this.__doPreventDefault}),e.addEventListener("mousemove",this.__mouseMoveFunc,{passive:!this.__doPreventDefault}),e.addEventListener("contextmenu",e=>{e.preventDefault()}),e.addEventListener("mousedown",this.__mouseParalleltranslationStartFunc,{passive:!this.__doPreventDefault}),e.addEventListener("mousemove",this.__mouseParalleltranslationFunc,{passive:!this.__doPreventDefault}),e.addEventListener("mouseup",this.__mouseParalleltranslationEndFunc,{passive:!this.__doPreventDefault})),window.WheelEvent&&e.addEventListener("wheel",this.__mouseWheelFunc,{passive:!this.__doPreventDefault}),e.addEventListener("contextmenu",this.__contextMenuFunc,{passive:!this.__doPreventDefault}),e.addEventListener("dblclick",this.__mouseDblClickFunc,{passive:!this.__doPreventDefault}))}unregisterEventListeners(e=document){e&&("ontouchend"in document?(e.removeEventListener("touchstart",this.__mouseDownFunc),e.removeEventListener("touchend",this.__mouseUpFunc),e.removeEventListener("touchmove",this.__mouseMoveFunc),e.removeEventListener("mousedown",this.__mouseDownFunc),e.removeEventListener("mouseup",this.__mouseUpFunc),e.removeEventListener("mousemove",this.__mouseMoveFunc),e.removeEventListener("touchstart",this.__touchParalleltranslationStartFunc),e.removeEventListener("touchmove",this.__touchParalleltranslationFunc),e.removeEventListener("touchend",this.__touchParalleltranslationEndFunc),e.removeEventListener("touchmove",this.__pinchInOutFunc),e.removeEventListener("touchend",this.__pinchInOutEndFunc),e.removeEventListener("touchstart",this.__resetDollyAndPositionFunc)):(e.removeEventListener("mousedown",this.__mouseDownFunc),e.removeEventListener("mouseup",this.__mouseUpFunc),e.removeEventListener("mousemove",this.__mouseMoveFunc),e.removeEventListener("contextmenu",e=>{e.preventDefault()}),e.removeEventListener("mousedown",this.__mouseParalleltranslationStartFunc),e.removeEventListener("mousemove",this.__mouseParalleltranslationFunc),e.removeEventListener("mouseup",this.__mouseParalleltranslationEndFunc)),window.WheelEvent&&e.removeEventListener("wheel",this.__mouseWheelFunc),e.removeEventListener("contextmenu",this.__contextMenuFunc),e.removeEventListener("dblclick",this.__mouseDblClickFunc))}__getFovyFromCamera(e){return e.fovy?e.fovy:h.a.radianToDegree(2*Math.atan(Math.abs(e.top-e.bottom)/(2*e.zNear)))}$logic(){const e=this.__updateTargeting(this.__cameraComponent),t=e.newEyeVec,n=e.newCenterVec,i=e.newUpVec,s=this.__convert(this.__cameraComponent,t,n,i),r=this.__cameraComponent;r.eyeInner=s.newEyeVec,r.directionInner=s.newCenterVec,r.upInner=s.newUpVec,r.zNearInner=s.newZNear,r.zFarInner=s.newZFar,r.leftInner=s.newLeft,r.rightInner=s.newRight,r.topInner=s.newTop,r.bottomInner=s.newBottom,r.fovyInner=s.fovy}__convert(e,t,n,i){let s,r=null,c=null;!this.__isKeyUp&&this.__isForceGrab||(this.__eyeVec=a.b.add(t,this.__shiftCameraTo),this.__centerVec=a.b.add(n,this.__shiftCameraTo),this.__upVec=new o.a(i));let _=this.__getFovyFromCamera(e),m=a.b.subtract(this.__eyeVec,this.__centerVec);if(m=a.b.multiply(m,1*this.__dolly/Math.tan(h.a.degreeToRadian(_/2))),this.__lengthOfCenterToEye=m.length(),this.__isSymmetryMode){let e=a.b.angleOfVectors(new a.b(m.x,0,m.z),new a.b(0,0,1)),t=a.b.cross(new a.b(m.x,0,m.z),new a.b(0,0,1)).y;e*=t=t>=0?1:-1;let n=u.a.rotateY(h.a.degreeToRadian(e)),i=u.a.rotateX(h.a.degreeToRadian(this.__rot_y)),l=u.a.rotateY(h.a.degreeToRadian(this.__rot_x)),_=u.a.rotateY(h.a.degreeToRadian(-e)),d=u.a.multiply(_,u.a.multiply(l,u.a.multiply(i,n)));c=d.multiplyVector(this.__upVec),this.__newUpVec=c,r=d.multiplyVector(m).add(this.__centerVec),s=new o.a(this.__centerVec),this.__newEyeToCenterVec=a.b.subtract(s,r),this.__newTangentVec=a.b.cross(this.__newUpVec,this.__newEyeToCenterVec),r.add(this.__mouseTranslateVec),s.add(this.__mouseTranslateVec);let f=n.multiplyVector(m);this.__verticalAngleOfVectors=a.b.angleOfVectors(f,new a.b(0,0,1));let p=a.b.cross(f,new a.b(0,0,1)).x;p=p>=0?1:-1}else{let e=l.a.rotateX(h.a.degreeToRadian(this.__rot_y)),t=l.a.rotateY(h.a.degreeToRadian(this.__rot_x)),n=l.a.multiply(t,e);c=n.multiplyVector(this.__upVec),this.__newUpVec=c,r=a.b.add(n.multiplyVector(m),this.__centerVec),s=new o.a(this.__centerVec),this.__newEyeToCenterVec=a.b.subtract(s,r),this.__newTangentVec=a.b.cross(this.__newUpVec,this.__newEyeToCenterVec),r.add(this.__mouseTranslateVec),s.add(this.__mouseTranslateVec)}a.b.lengthBtw(r,s);let d=e.left,f=e.right,p=e.top,g=e.bottom,v=e.zNear,x=e.zFar,y=1;if(this.__targetEntity&&(x=e.zNear+a.b.subtract(s,r).length(),x+=this.__getTargetAABB().lengthCenterToCorner*this.__zFarAdjustingFactorBasedOnAABB),void 0!==d&&void 0!==this.__lengthCenterToCorner){y=x/e.zNear;y/=this.__scaleOfZNearAndZFar;d*=y,f*=y,p*=y,g*=y,v*=y}return this.__foyvBias=Math.tan(h.a.degreeToRadian(_/2)),{newEyeVec:r,newCenterVec:s,newUpVec:c,newZNear:v,newZFar:x,newLeft:d,newRight:f,newTop:p,newBottom:g,fovy:_}}__getTargetAABB(){return this.__targetEntity.getSceneGraph().worldAABB}__updateTargeting(e){const t=e.eye,n=e.direction,i=e._up,s=e.fovy;if(null==this.__targetEntity)return{newEyeVec:t,newCenterVec:n,newUpVec:i};let r=this.__getTargetAABB();e.top,e.bottom;this.__lengthCenterToCorner=r.lengthCenterToCorner,this.__lengthCameraToObject=r.lengthCenterToCorner/Math.sin(s*Math.PI/180/2)*this.__scaleOfLengthCameraToCenter;let o=r.centerPoint,h=a.b.subtract(t,n),l=a.b.normalize(h),c=a.b.add(a.b.multiply(l,this.__lengthCameraToObject),o),u=null;if(e.entity.getSceneGraph()){const t=e.entity.getSceneGraph();let n=m.a.invert(t.worldMatrixInner);n.multiplyVector3To(c,d.returnVector3Eye),c=d.returnVector3Eye,n.multiplyVector3To(o,d.returnVector3Center),o=d.returnVector3Center,n.multiplyVector3To(i,d.returnVector3Up),u=d.returnVector3Up}else u=i;return{newEyeVec:c,newCenterVec:o,newUpVec:u}}set scaleOfZNearAndZFar(e){this.__scaleOfZNearAndZFar=e}get scaleOfZNearAndZFar(){return this.__scaleOfZNearAndZFar}static get componentTID(){return s.a.CameraControllerComponentTID}}d.returnVector3Eye=o.a.zero(),d.returnVector3Center=o.a.zero(),d.returnVector3Up=o.a.zero(),r.a.registerComponentClass(d)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:0,str:"Directional"}),a=new s({index:1,str:"Point"}),o=new s({index:2,str:"Spot"}),h=new s({index:3,str:"Ambient"}),l=[a,r,o,h];const c=Object.freeze({Point:a,Directional:r,Spot:o,Ambient:h,from:function(e){return Object(i.b)({typeList:l,index:e})},fromString:function(e){return Object(i.c)({typeList:l,str:e})}})},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(10),s=n(27),r=n(30),a=n(59),o=n(2),h=n(31),l=n(13),c=n(17);class u extends s.a{constructor(e,t,n){super(e,t,n),this.type=a.a.Point,this.intensity=new o.b(1,1,1),this.__initialdirection=new o.b(0,1,0),this.__direction=new o.b(0,1,0),this.spotExponent=1,this.spotCutoff=30,this.range=-1,this.maxNumberOfComponent=Math.max(10,Math.floor(c.a.maxEntityNumber/100))}static get componentTID(){return r.a.LightComponentTID}$create(){this.__sceneGraphComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,h.a),this.moveStageTo(l.a.Logic)}$logic(){this.__direction=this.__sceneGraphComponent.normalMatrixInner.multiplyVector(this.__initialdirection)}get direction(){return this.__direction}}i.a.registerComponentClass(u)},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var i=n(9),s=n(4),r=n(20),a=n(38),o=n(0),h=n(1),l=n(68),c=n(40),u=n(3),_=n(34),m=n(56),d=n(44),f=n(65),p=n(69),g=n(7),v=n(26),x=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function a(e){try{h(i.next(e))}catch(e){r(e)}}function o(e){try{h(i.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(a,o)}h((i=i.apply(e,t||[])).next())})};class y extends i.a{constructor(){super(),this.__webglContexts=new Map,this.__resourceCounter=i.a.InvalidCGAPIResourceUid,this.__webglResources=new Map}static getInstance(){return this.__instance||(this.__instance=new y),this.__instance}addWebGLContext(e,t,n){const i=new l.a(e,t);this.__webglContexts.set("default",i),n&&(this.__glw=i)}get currentWebGLContextWrapper(){return this.__glw}getResourceNumber(){return++this.__resourceCounter}getWebGLResource(e){const t=this.__webglResources.get(e);return null!=t?t:null}createIndexBuffer(e){const t=this.__glw.getRawContext();if(null==t)throw new Error("No WebGLRenderingContext set as Default.");const n=t.createBuffer(),i=this.getResourceNumber();return this.__webglResources.set(i,n),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.getTypedArray(),t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),i}createVertexBuffer(e){const t=this.__glw.getRawContext();if(null==t)throw new Error("No WebGLRenderingContext set as Default.");const n=t.createBuffer(),i=this.getResourceNumber();return this.__webglResources.set(i,n),t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e.bufferView.getUint8Array(),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),i}createVertexBufferFromTypedArray(e){const t=this.__glw.getRawContext();if(null==t)throw new Error("No WebGLRenderingContext set as Default.");const n=t.createBuffer(),i=this.getResourceNumber();return this.__webglResources.set(i,n),t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),i}resendVertexBuffer(e,t){const n=this.__glw.getRawContext();if(null==n)throw new Error("No WebGLRenderingContext set as Default.");const i=n.createBuffer(),s=this.getResourceNumber();this.__webglResources.set(s,i),e.attributeAccessors.forEach((e,i)=>{const s=this.getWebGLResource(t[i]);n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,e.bufferView.getUint8Array(),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null)})}createVertexArray(){if(null==this.__glw)throw new Error("No WebGLRenderingContext set as Default.");const e=this.__glw.createVertexArray(),t=this.getResourceNumber();return this.__webglResources.set(t,e),t}bindTexture2D(e,t){const n=this.getWebGLResource(t);this.__glw.bindTexture2D(e,n)}bindTextureCube(e,t){const n=this.getWebGLResource(t);this.__glw.bindTextureCube(e,n)}createVertexDataResources(e){const t=this.__glw.getRawContext(),n=this.createVertexArray();let i;e.hasIndices()&&(i=this.createIndexBuffer(e.indicesAccessor));const r=[];for(let e=0;e<s.a.AttributeTypeNumber;e++)r[e]=!1;const a=[];return e.attributeAccessors.forEach((t,n)=>{const i=this.createVertexBuffer(t),s=e.attributeSemantics[n].getAttributeSlot();r[s]=!0,a.push(i)}),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),{vaoHandle:n,iboHandle:i,vboHandles:a,attributesFlags:r,setComplete:!1}}createVertexBufferAndIndexBuffer(e){this.__glw.getRawContext();let t;e.hasIndices()&&(t=this.createIndexBuffer(e.indicesAccessor));const n=[];for(let e=0;e<s.a.AttributeTypeNumber;e++)n[e]=!1;const i=[];return e.attributeAccessors.forEach((t,s)=>{const r=this.createVertexBuffer(t),a=e.attributeSemantics[s].getAttributeSlot();n[a]=!0,i.push(r)}),{vaoHandle:-1,iboHandle:t,vboHandles:i,attributesFlags:n,setComplete:!1}}createShaderProgram({materialTypeName:e,vertexShaderStr:t,fragmentShaderStr:n,attributeNames:i,attributeSemantics:s}){const r=this.__glw.getRawContext();if(null==r)throw new Error("No WebGLRenderingContext set as Default.");const a=r.createShader(r.VERTEX_SHADER);r.shaderSource(a,t),r.compileShader(a),this.__checkShaderCompileStatus(e,a,t);const o=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(o,n),r.compileShader(o),this.__checkShaderCompileStatus(e,o,n);const h=r.createProgram();h._gl=r,h._materialTypeName=e,h._vertexShaderStr=t,h._fragmentShaderStr=n,r.attachShader(h,a),r.attachShader(h,o),i.forEach((e,t)=>{r.bindAttribLocation(h,s[t].getAttributeSlot(),e)}),r.linkProgram(h),this.__checkShaderProgramLinkStatus(e,h,t,n);const l=this.getResourceNumber();return this.__webglResources.set(l,h),r.deleteShader(a),r.deleteShader(o),l}__addLineNumber(e){let t=e.split(/\r\n|\r|\n/),n="";for(let e=0;e<t.length;e++){let i=e+1,s=" : ";i<10?s="  : ":i>=100&&(s=": "),n+=i+s+t[e]+"\n"}return n}__checkShaderCompileStatus(e,t,n){const i=this.__glw.getRawContext();if(!i.getShaderParameter(t,i.COMPILE_STATUS))throw console.log("MaterialTypeName: "+e),console.log(this.__addLineNumber(n)),new Error("An error occurred compiling the shaders:"+i.getShaderInfoLog(t))}__checkShaderProgramLinkStatus(e,t,n,i){const s=this.__glw.getRawContext();if(!s.getProgramParameter(t,s.LINK_STATUS))throw console.log("MaterialTypeName: "+e),console.log(this.__addLineNumber("Vertex Shader:")),console.log(this.__addLineNumber(n)),console.log(this.__addLineNumber("Fragment Shader:")),console.log(this.__addLineNumber(i)),new Error("Unable to initialize the shader program: "+s.getProgramInfoLog(t))}setupUniformLocations(e,t){const n=this.__glw.getRawContext(),i=this.getWebGLResource(e),s=new Map;for(let e of t)s.set(e.semantic.str,e);for(let e of t){let t=e.semantic.str,s=u.a.fullSemanticStr(e);null!=e.index&&(s.match(/\[.+?\]/)?s=s.replace(/\[.+?\]/g,`[${e.index}]`):s+=`[${e.index}]`);const r=n.getUniformLocation(i,"u_"+s);null!=e.index?(null==i[t]&&(i[t]=[]),i[t][e.index]=r):i[t]=r}return null!=i._shaderSemanticsInfoMap?i._shaderSemanticsInfoMap=new Map([...i._shaderSemanticsInfoMap,...s]):i._shaderSemanticsInfoMap=s,i}__isUniformValueDirty(e,t,n,{x:i,y:s,z:r,w:a},o=Number.EPSILON){const h=n+"_value",l=t[h];if(null==l)return!0;let c=!1;if(e){const e=i.length;if(e>4)return!0;for(let t=0;t<e;t++)if(Math.abs(i[t]-l[t])>=o){c=!0;break}t[h]=i}else{c=(()=>null!=i&&Math.abs(i-l[0])>=o||(null!=s&&Math.abs(s-l[1])>=o||(null!=r&&Math.abs(r-l[2])>=o||null!=a&&Math.abs(a-l[3])>=o)))(),t[h]=[i,s,r,a]}return c}setUniformValue(e,t,n,i,s){const r=e._shaderSemanticsInfoMap.get(t);if(null==r)return!1;if(!n){const e=r.updateInteval;if(null!=e&&e===g.a.FirstTimeOnly)return!1}let a=!1,h=r.compositionType.getNumberOfComponents();r.compositionType===o.a.Mat3?(a=!0,h=3):r.compositionType===o.a.Mat4&&(a=!0,h=4);const l=t;let c=!1;return r.compositionType===o.a.Texture2D||r.compositionType===o.a.TextureCube?null!=i[0]&&null!=i[1]&&(r.compositionType===o.a.Texture2D?this.bindTexture2D(i[0],i[1]instanceof _.a?i[1].cgApiResourceUid:i[1]):r.compositionType===o.a.TextureCube&&this.bindTextureCube(i[0],i[1]instanceof _.a?i[1].cgApiResourceUid:i[1]),n&&(c=this.setUniformValueInner(e,l,r,a,h,!1,{x:i[0]},{firstTime:n},s))):c=null!=s||r.compositionType!==o.a.ScalarArray&&r.compositionType!==o.a.Vec4Array&&r.compositionType!==o.a.Vec3Array&&r.compositionType!==o.a.Vec2Array?r.compositionType!==o.a.Scalar?null==i.v?this.setUniformValueInner(e,l,r,a,h,!1,i,{firstTime:n},s):this.setUniformValueInner(e,l,r,a,h,!0,{x:i.v},{firstTime:n},s):null==i.v?this.setUniformValueInner(e,l,r,a,h,!1,{x:i},{firstTime:n},s):this.setUniformValueInner(e,l,r,a,h,!0,{x:i.v},{firstTime:n},s):null==i.v?this.setUniformValueInner(e,l,r,a,h,!0,{x:i},{firstTime:n},s):this.setUniformValueInner(e,l,r,a,h,!0,{x:i.v},{firstTime:n},s),c}setUniformValueInner(e,t,n,i,s,r,{x:a,y:o,z:l,w:c},{firstTime:u=!0,delta:_},m){let d,f=t;d=null!=m?e[f][m]:e[f];const p=this.__glw.getRawContext();if(i)4===s?p.uniformMatrix4fv(d,!1,a):p.uniformMatrix3fv(d,!1,a);else if(r){const e=n.componentType===h.a.Int||n.componentType===h.a.Short||n.componentType===h.a.Byte;1===s?e?p.uniform1iv(d,a):p.uniform1fv(d,a):2===s?e?p.uniform2iv(d,a):p.uniform2fv(d,a):3===s?e?p.uniform3iv(d,a):p.uniform3fv(d,a):4===s&&(e?p.uniform4iv(d,a):p.uniform4fv(d,a))}else{const e=n.componentType===h.a.Int||n.componentType===h.a.Short||n.componentType===h.a.Byte;1===s?e?p.uniform1i(d,a):p.uniform1f(d,a):2===s?e?p.uniform2i(d,a,o):p.uniform2f(d,a,o):3===s?e?p.uniform3i(d,a,o,l):p.uniform3f(d,a,o,l):4===s&&(e?p.uniform4i(d,a,o,l,c):p.uniform4f(d,a,o,l,c))}return!0}setVertexDataToPipeline({vaoHandle:e,iboHandle:t,vboHandles:n},r,a=i.a.InvalidCGAPIResourceUid){const l=this.__glw.getRawContext(),c=this.getWebGLResource(e);if(this.__glw.bindVertexArray(c),null!=t){const e=this.getWebGLResource(t);if(null==e)throw new Error("Nothing Element Array Buffer!");l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,e)}if(n.forEach((e,t)=>{const n=this.getWebGLResource(e);if(null==n)throw new Error("Nothing Element Array Buffer at index "+t);l.bindBuffer(l.ARRAY_BUFFER,n),l.enableVertexAttribArray(r.attributeSemantics[t].getAttributeSlot()),l.vertexAttribPointer(r.attributeSemantics[t].getAttributeSlot(),r.attributeCompositionTypes[t].getNumberOfComponents(),r.attributeComponentTypes[t].index,!1,r.attributeAccessors[t].byteStride,r.attributeAccessors[t].byteOffsetInBufferView)}),a!==i.a.InvalidCGAPIResourceUid){const e=this.getWebGLResource(a);if(null==e)throw new Error("Nothing Element Array Buffer at index");l.bindBuffer(l.ARRAY_BUFFER,e),l.enableVertexAttribArray(s.a.Instance.getAttributeSlot()),l.vertexAttribPointer(s.a.Instance.getAttributeSlot(),o.a.Scalar.getNumberOfComponents(),h.a.Float.index,!1,0,0),this.__glw.vertexAttribDivisor(s.a.Instance.getAttributeSlot(),1)}l.bindBuffer(l.ARRAY_BUFFER,null),this.__glw.bindVertexArray(null),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null)}createTexture(e,{level:t,internalFormat:n,width:i,height:s,border:a,format:o,type:l,magFilter:u,minFilter:_,wrapS:m,wrapT:d,generateMipmap:f,anisotropy:g}){const v=this.__glw.getRawContext(),x=v.createTexture(),y=this.getResourceNumber();x._resourceUid=y,this.__webglResources.set(y,x),this.__glw.bindTexture2D(0,x),e instanceof HTMLImageElement||e instanceof HTMLCanvasElement?this.__glw.isWebGL2?v.texImage2D(v.TEXTURE_2D,t,r.a.RGBA8.index,i,s,a,o.index,h.a.UnsignedByte.index,e):v.texImage2D(v.TEXTURE_2D,t,n.index,o.index,l.index,e):v.texImage2D(v.TEXTURE_2D,t,n.index,i,s,a,o.index,l.index,e);const b=i===s&&1!==i&&!(this.__glw.isWebGL2&&p.a.isMobile());return v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,m.index),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,d.index),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,u.index),b?v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,_.index):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),c.a.isPowerOfTwoTexture(i,s)&&(g&&this.__glw.webgl1ExtTFA&&v.texParameteri(v.TEXTURE_2D,this.__glw.webgl1ExtTFA.TEXTURE_MAX_ANISOTROPY_EXT,4),b&&v.generateMipmap(v.TEXTURE_2D)),this.__glw.unbindTexture2D(0),y}createAtfTexture(e,{level:t,internalFormat:n,width:i,height:s,border:r,format:a,type:o,magFilter:h,minFilter:l,wrapS:c,wrapT:u,generateMipmap:_,anisotropy:m}){const d=this.__glw.getRawContext(),f=d.createTexture(),p=this.getResourceNumber();f._resourceUid=p,this.__webglResources.set(p,f),this.__glw.bindTexture2D(0,f);let g=d.getExtension("WEBGL_compressed_texture_s3tc");g&&d.compressedTexImage2D(d.TEXTURE_2D,t,g.COMPRESSED_RGBA_S3TC_DXT1_EXT,e.width,e.height,r,e.dataArray);let v=d.getExtension("WEBGL_compressed_texture_etc1");v&&d.compressedTexImage2D(d.TEXTURE_2D,t,v.COMPRESSED_RGB_ETC1_WEBGL,e.width,e.height,r,e.dataArray);let x=d.getExtension("WEBGL_compressed_texture_pvrtc")||d.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");return x&&d.compressedTexImage2D(d.TEXTURE_2D,t,x.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,e.width,e.height,r,e.dataArray),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),this.__glw.unbindTexture2D(0),p}createFrameBufferObject(){var e=this.__glw.getRawContext().createFramebuffer();const t=this.getResourceNumber();return this.__webglResources.set(t,e),t}attachColorBufferToFrameBufferObject(e,t,n){const i=this.__glw.getRawContext(),s=this.getWebGLResource(e.framebufferUID);i.bindFramebuffer(i.FRAMEBUFFER,s);const r=this.getWebGLResource(n.cgApiResourceUid),a=this.__glw.colorAttachiment(t);n instanceof m.a?(n._fbo=e,i.framebufferTexture2D(i.FRAMEBUFFER,a,i.TEXTURE_2D,r,0)):(n._fbo=e,i.framebufferRenderbuffer(i.FRAMEBUFFER,a,i.RENDERBUFFER,r)),i.bindFramebuffer(i.FRAMEBUFFER,null)}attachDepthBufferToFrameBufferObject(e,t){this.__attachDepthOrStencilBufferToFrameBufferObject(e,t,36096)}attachStencilBufferToFrameBufferObject(e,t){this.__attachDepthOrStencilBufferToFrameBufferObject(e,t,36128)}attachDepthStencilBufferToFrameBufferObject(e,t){this.__attachDepthOrStencilBufferToFrameBufferObject(e,t,33306)}__attachDepthOrStencilBufferToFrameBufferObject(e,t,n){const i=this.__glw.getRawContext(),s=this.getWebGLResource(e.framebufferUID);i.bindFramebuffer(i.FRAMEBUFFER,s);const r=this.getWebGLResource(t.cgApiResourceUid);t instanceof m.a?(t._fbo=e,i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,r,0)):(t._fbo=e,i.framebufferRenderbuffer(i.FRAMEBUFFER,n,i.RENDERBUFFER,r)),i.bindFramebuffer(i.FRAMEBUFFER,null)}createRenderBuffer(e,t,n){const i=this.__glw.getRawContext();var s=i.createRenderbuffer();const r=this.getResourceNumber();return this.__webglResources.set(r,s),i.bindRenderbuffer(i.RENDERBUFFER,s),i.renderbufferStorage(i.RENDERBUFFER,i[n.str],e,t),i.bindRenderbuffer(i.RENDERBUFFER,null),r}setDrawTargets(e){e?this.__glw.drawBuffers(e.colorAttachmentsRenderBufferTargets):this.__glw.drawBuffers([f.a.Back])}bindFramebuffer(e){const t=this.__glw.getRawContext();if(e){const n=e.cgApiResourceUid,i=this.getWebGLResource(n);t.bindFramebuffer(t.FRAMEBUFFER,i)}else t.bindFramebuffer(t.FRAMEBUFFER,null)}unbindFramebuffer(){const e=this.__glw.getRawContext();e.bindFramebuffer(e.FRAMEBUFFER,null)}createRenderTargetTexture({width:e,height:t,level:n,internalFormat:i,format:s,type:a,magFilter:o,minFilter:l,wrapS:c,wrapT:u}){const _=this.__glw.getRawContext(),m=_.createTexture(),d=this.getResourceNumber();return m._resourceUid=d,this.__webglResources.set(d,m),this.__glw.bindTexture2D(0,m),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,o.index),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,l.index),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,c.index),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,u.index),!this.__glw.isWebGL2||6402!==i.index&&33189!==i.index&&33190!==i.index&&33191!==i.index||(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_COMPARE_MODE,_.COMPARE_REF_TO_TEXTURE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_COMPARE_FUNC,_.LESS)),this.__glw.isWebGL2?_.texImage2D(_.TEXTURE_2D,n,r.a.RGBA8.index,e,t,0,s.index,h.a.UnsignedByte.index,null):_.texImage2D(_.TEXTURE_2D,n,i.index,e,t,0,s.index,a.index,null),this.__glw.unbindTexture2D(0),d}createCubeTexture(e,t,n,i){const s=this.__glw.getRawContext(),r=s.createTexture(),a=this.getResourceNumber();r._resourceUid=a,this.__webglResources.set(a,r),this.__glw.bindTextureCube(0,r),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),e>=2?(s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR_MIPMAP_LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR)):(s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR));const o=(e,t,r)=>{e.hdriFormat===d.a.HDR?s.texImage2D(t,r,s.RGB,e.width,e.height,0,s.RGB,s.FLOAT,e.dataFloat):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement?s.texImage2D(t,r,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e):s.texImage2D(t,r,s.RGBA,n/(r+1),i/(r+1),0,s.RGBA,s.UNSIGNED_BYTE,e)};for(let e=0;e<t.length;e++){const n=t[e];o(n.posX,s.TEXTURE_CUBE_MAP_POSITIVE_X,e),o(n.negX,s.TEXTURE_CUBE_MAP_NEGATIVE_X,e),o(n.posY,s.TEXTURE_CUBE_MAP_POSITIVE_Y,e),o(n.negY,s.TEXTURE_CUBE_MAP_NEGATIVE_Y,e),o(n.posZ,s.TEXTURE_CUBE_MAP_POSITIVE_Z,e),o(n.negZ,s.TEXTURE_CUBE_MAP_NEGATIVE_Z,e)}return this.__glw.unbindTextureCube(0),a}createCubeTextureFromFiles(e,t,n,i){return x(this,void 0,void 0,function*(){const s=this.__glw.getRawContext(),r=[];let a=0,o=0;for(let h=0;h<t;h++){const t=()=>new Promise((t,r)=>{let a=0;const o=[];let l=".jpg";i===d.a.HDR?l=".hdr":i===d.a.RGBE_PNG&&(l=".RGBE.PNG");let c="_right_",u="_left_",_="_top_",m="_bottom_",f="_front_",p="_back_";n&&(c="_posx_",u="_negx_",_="_posy_",m="_negy_",f="_posz_",p="_negz_");let g=[[e+c+h+l,s.TEXTURE_CUBE_MAP_POSITIVE_X],[e+u+h+l,s.TEXTURE_CUBE_MAP_NEGATIVE_X],[e+_+h+l,s.TEXTURE_CUBE_MAP_POSITIVE_Y],[e+m+h+l,s.TEXTURE_CUBE_MAP_NEGATIVE_Y],[e+f+h+l,s.TEXTURE_CUBE_MAP_POSITIVE_Z],[e+p+h+l,s.TEXTURE_CUBE_MAP_NEGATIVE_Z]];for(var v=0;v<g.length;v++){const e=g[v][1];let n;(n=i===d.a.HDR||i===d.a.RGB9_E5_PNG?new HDRImage:new Image).hdriFormat=i,n.side=e,n.uri=g[v][0],n.crossOrigin="Anonymous",n.onload=()=>{a++,o.push(n),6===a&&t(o)},n.onerror=()=>{r(n.uri)},n.src=g[v][0]}});let l;try{l=yield t()}catch(e){try{l=yield t()}catch(e){console.error(`failed to load ${e}`)}}const c={};for(let e of l){switch(e.side){case s.TEXTURE_CUBE_MAP_POSITIVE_X:c.posX=e;break;case s.TEXTURE_CUBE_MAP_POSITIVE_Y:c.posY=e;break;case s.TEXTURE_CUBE_MAP_POSITIVE_Z:c.posZ=e;break;case s.TEXTURE_CUBE_MAP_NEGATIVE_X:c.negX=e;break;case s.TEXTURE_CUBE_MAP_NEGATIVE_Y:c.negY=e;break;case s.TEXTURE_CUBE_MAP_NEGATIVE_Z:c.negZ=e}0===h&&(a=e.width,o=e.height)}r.push(c)}return this.createCubeTexture(t,r,a,o)})}createDummyBlackCubeTexture(){const e=this.__createDummyTextureInner("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPj/HwADBwIAMCbHYQAAAABJRU5ErkJggg=="),t=new Uint8Array(e);return this.createCubeTexture(1,[{posX:t,negX:t,posY:t,negY:t,posZ:t,negZ:t}],1,1)}createDummyCubeTexture(e="rgba(0,0,0,1)"){var t=document.createElement("canvas");t.width=1,t.height=1;const n=t.getContext("2d");return n.fillStyle=e,n.fillRect(0,0,1,1),this.createCubeTexture(1,[{posX:t,negX:t,posY:t,negY:t,posZ:t,negZ:t}],1,1)}createTextureFromDataUri(e,{level:t,internalFormat:n,border:i,format:s,type:r,magFilter:a,minFilter:o,wrapS:h,wrapT:l,generateMipmap:c,anisotropy:u}){return x(this,void 0,void 0,function*(){return new Promise(_=>{const m=new Image;e.match(/^data:/)||(m.crossOrigin="Anonymous"),m.onload=()=>{const e=m.width,d=m.height;let f=this.createTexture(m,{level:t,internalFormat:n,width:e,height:d,border:i,format:s,type:r,magFilter:a,minFilter:o,wrapS:h,wrapT:l,generateMipmap:c,anisotropy:u});_(f)},m.src=e})})}updateTexture(e,t,{level:n,width:i,height:s,format:r,type:a}){const o=this.__glw.getRawContext(),h=this.getWebGLResource(e);this.__glw.bindTexture2D(0,h),o.texSubImage2D(o.TEXTURE_2D,n,0,0,i,s,r.index,a.index,t),this.__glw.unbindTexture2D(0)}deleteFrameBufferObject(e){const t=this.getWebGLResource(e),n=this.__glw.getRawContext();null!=t&&(n.deleteFramebuffer(t),this.__webglResources.delete(e))}deleteRenderBuffer(e){const t=this.__glw.getRawContext(),n=this.getWebGLResource(e);t.deleteRenderbuffer(n),this.__webglResources.delete(e)}deleteTexture(e){const t=this.getWebGLResource(e),n=this.__glw.getRawContext();null!=t&&(n.deleteTexture(t),this.__webglResources.delete(e))}createDummyTexture(e="rgba(255,255,255,1)"){var t=document.createElement("canvas");t.width=1,t.height=1;const n=t.getContext("2d");return n.fillStyle=e,n.fillRect(0,0,1,1),this.createTexture(t,{level:0,internalFormat:a.a.RGBA,width:1,height:1,border:0,format:a.a.RGBA,type:h.a.Float,magFilter:r.a.Nearest,minFilter:r.a.Nearest,wrapS:r.a.ClampToEdge,wrapT:r.a.ClampToEdge,generateMipmap:!1,anisotropy:!1})}createDummyBlackTexture(){return this.__createDummyTextureInner("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPj/HwADBwIAMCbHYQAAAABJRU5ErkJggg==")}createDummyWhiteTexture(){return this.__createDummyTextureInner("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5/hPwAIAgL/4d1j8wAAAABJRU5ErkJggg==")}createDummyNormalTexture(){return this.__createDummyTextureInner("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOsr///HwAGgAL+v1RumAAAAABJRU5ErkJggg==")}__createDummyTextureInner(e){const t=v.a.base64ToArrayBuffer(e);return this.createTexture(new Uint8Array(t),{level:0,internalFormat:a.a.RGBA,width:1,height:1,border:0,format:a.a.RGBA,type:h.a.Float,magFilter:r.a.Nearest,minFilter:r.a.Nearest,wrapS:r.a.ClampToEdge,wrapT:r.a.ClampToEdge,generateMipmap:!1,anisotropy:!1})}createUniformBuffer(e){const t=this.__glw.getRawContext();if(null==t)throw new Error("No WebGLRenderingContext set as Default.");const n=t.createBuffer(),i=this.getResourceNumber();return this.__webglResources.set(i,n),t.bindBuffer(t.UNIFORM_BUFFER,n),t.bufferData(t.UNIFORM_BUFFER,e,t.DYNAMIC_DRAW),t.bindBuffer(t.UNIFORM_BUFFER,null),i}updateUniformBuffer(e,t){const n=this.__glw.getRawContext(),i=this.getWebGLResource(e);n.bindBuffer(n.UNIFORM_BUFFER,i),n.bufferSubData(n.UNIFORM_BUFFER,0,t,0),n.bindBuffer(n.UNIFORM_BUFFER,null)}bindUniformBlock(e,t,n){const i=this.__glw.getRawContext();if(null==i)throw new Error("No WebGLRenderingContext set as Default.");const s=this.getWebGLResource(e),r=i.getUniformBlockIndex(s,t);i.uniformBlockBinding(s,r,n)}bindUniformBufferBase(e,t){const n=this.__glw.getRawContext();if(null==n)throw new Error("No WebGLRenderingContext set as Default.");const i=this.getWebGLResource(t);n.bindBufferBase(n.UNIFORM_BUFFER,e,i)}deleteUniformBuffer(e){const t=this.__glw.getRawContext();null==t&&new Error("No WebGLRenderingContext set as Default.");const n=this.getWebGLResource(e);this.__webglResources.delete(e),t.deleteBuffer(n)}createTransformFeedback(){const e=this.__glw.getRawContext();var t=e.createTransformFeedback();const n=this.getResourceNumber();return this.__webglResources.set(n,t),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,t),n}deleteTransformFeedback(e){const t=this.__glw.getRawContext(),n=this.getWebGLResource(e);t.deleteTransformFeedback(n),this.__webglResources.delete(e)}setViewport(e){const t=this.__glw.getRawContext();e?t.viewport(e.x,e.y,e.z,e.w):t.viewport(0,0,this.__glw.width,this.__glw.height)}clearFrameBuffer(e){const t=this.__glw.getRawContext();let n=0;e.toClearColorBuffer&&(t.clearColor(e.clearColor.x,e.clearColor.y,e.clearColor.z,e.clearColor.w),n|=t.COLOR_BUFFER_BIT),e.toClearDepthBuffer&&(t.clearDepth(e.clearDepth),n|=t.DEPTH_BUFFER_BIT),e.toClearStencilBuffer&&(t.clearStencil(e.clearStencil),n|=t.STENCIL_BUFFER_BIT),0!==n&&t.clear(n)}deleteVertexDataResources(e){const t=this.__glw.getRawContext(),n=e.iboHandle;if(n){const e=this.getWebGLResource(n);t.deleteBuffer(e)}const i=e.vboHandles;for(let e of i){const n=this.getWebGLResource(e);t.deleteBuffer(n)}const s=e.vaoHandle,r=this.getWebGLResource(s);this.__glw.deleteVertexArray(r)}deleteVertexArray(e){const t=this.getWebGLResource(e);this.__glw.deleteVertexArray(t)}deleteVertexBuffer(e){const t=this.__glw.getRawContext(),n=this.getWebGLResource(e);t.deleteBuffer(n)}}},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var i=n(24),s=n(51),r=n(16),a=n(3),o=n(0),h=n(29),l=n(1),c=n(9),u=n(4),_=n(28),m=n(11),d=n(17),f=n(5),p=n(26);class g extends i.a{constructor(e,t,n){super(),this.__materialNodes=[],this.__fields=new Map,this.__fieldsInfo=new Map,this._shaderProgramUid=c.a.InvalidCGAPIResourceUid,this.alphaMode=s.a.Opaque,this.__materialSid=-1,this.__materialNodes=n,this.__materialTid=e,this.__materialTypeName=t,g.__materials.push(this),g.__instancesByTypes.set(t,this),this.initialize()}get materialTypeName(){return this.__materialTypeName}get materialTID(){return this.__materialTid}get fieldsInfoArray(){return Array.from(this.__fieldsInfo.values())}static createMaterial(e,t,n){let i=t;return i||(i=g.__materialTypes.get(e)),g.__materialTypes.has(e)||g.registerMaterial(e,t,n),new g(g.__materialTids.get(e),e,i)}static __allocateBufferView(e,t){let n=0;const i=[];for(let s of t)for(let t of s._semanticsInfoArray){const s=t.compositionType.getNumberOfComponents()*t.componentType.getSizeInBytes();let r=s;if(r%16!=0&&(r=s+16-s%16),o.a.isArray(t.compositionType)){const e=t.maxIndex;null!=e?r*=e:(console.error("semanticInfo has invalid maxIndex!"),r*=100)}let a=1;t.soloDatum||(a=g.__maxInstances.get(e)),n+=r*a,i.push({alignedByte:r,semanticInfo:t})}this.__accessors.has(e)||this.__accessors.set(e,new Map);const s=_.a.getInstance().getBuffer(m.a.GPUInstanceData);let r;this.__bufferViews.has(e)?r=this.__bufferViews.get(e):(r=s.takeBufferView({byteLengthToNeed:n,byteStride:0,byteAlign:16,isAoS:!1}),this.__bufferViews.set(e,r));for(let t=0;t<i.length;t++){const n=i[t].alignedByte,s=i[t].semanticInfo;let a=1;s.soloDatum||(a=g.__maxInstances.get(e));let c=s.maxIndex;o.a.isArray(s.compositionType)&&null==c&&(c=100);const u=r.takeFlexibleAccessor({compositionType:s.compositionType,componentType:l.a.Float,count:a,byteStride:n,arrayLength:c,byteAlign:16}),_=this.__getPropertyIndex(s);if(s.soloDatum){const t=u.takeOne();let n=this.__soloDatumFields.get(e);null==n&&(n=new Map,this.__soloDatumFields.set(e,n)),n.set(this.__getPropertyIndex(s),h.a.initWithFloat32Array(s.initialValue,s.initialValue,t,s.compositionType))}else{this.__accessors.get(e).set(_,u)}}return r}static registerMaterial(e,t,n=d.a.maxMaterialInstanceForEachType){if(g.__materialTypes.has(e))return console.info(`${e} is already registered.`),!1;{g.__materialTypes.set(e,t);const i=++g.__materialTidCount;return g.__materialTids.set(e,i),g.__maxInstances.set(e,n),g.__allocateBufferView(e,t),g.__materialInstanceCountOfType.set(e,0),!0}}static getAllMaterials(){return g.__materials}setMaterialNodes(e){this.__materialNodes=e}get materialSID(){return this.__materialSid}static __getPropertyIndex(e){let t=e.semantic.index;return null!=e.index&&(t+=e.index,t*=-1),t}initialize(){let e=g.__materialInstanceCountOfType.get(this.__materialTypeName);this.__materialSid=e++,g.__materialInstanceCountOfType.set(this.__materialTypeName,e),this.__materialNodes.forEach(e=>{const t=e._semanticsInfoArray,n=g.__accessors.get(this.__materialTypeName);t.forEach(e=>{const t=g.__getPropertyIndex(e);if(this.__fieldsInfo.set(t,e),!e.soloDatum){const i=n.get(t).takeOne();this.__fields.set(t,h.a.initWithFloat32Array(e.initialValue,e.initialValue,i,e.compositionType))}})})}setParameter(e,t,n){const i=this.__fieldsInfo.get(e.index);if(null!=i){let n;n=i.soloDatum?g.__soloDatumFields.get(this.__materialTypeName).get(e.index):this.__fields.get(e.index),h.a._setForce(n,t)}}setTextureParameter(e,t){if(this.__fieldsInfo.has(e.index)){const n=this.__fields.get(e.index);this.__fields.set(e.index,[n[0],t]),e!==a.a.DiffuseColorTexture&&e!==a.a.BaseColorTexture||t.isTransparent&&(this.alphaMode=s.a.Blend)}}getParameter(e){const t=this.__fieldsInfo.get(e.index);if(null!=t)return t.soloDatum?g.__soloDatumFields.get(this.__materialTypeName).get(e.index):this.__fields.get(e.index)}setUniformLocations(e){const t=c.a.getWebGLResourceRepository();new Map;let n=[];this.__materialNodes.forEach(e=>{const t=e._semanticsInfoArray;n=n.concat(t)}),t.setupUniformLocations(e,n)}setUniformValues(e,t){const n=this._shaderProgramUid,i=c.a.getWebGLResourceRepository(),s=i.getWebGLResource(n);this.__fields.forEach((t,n)=>{const r=a.b.getShaderSemanticByIndex(n);i.setUniformValue(s,r.str,e,t)})}setUniformValuesForOnlyTextures(e){const t=this._shaderProgramUid,n=c.a.getWebGLResourceRepository(),i=n.getWebGLResource(t);this.__fields.forEach((t,s)=>{const r=this.__fieldsInfo.get(s);r.compositionType!==o.a.Texture2D&&r.compositionType!==o.a.TextureCube||this.__fields.forEach((t,s)=>{const r=a.b.getShaderSemanticByIndex(s);n.setUniformValue(i,r.str,e,t)})})}setParemetersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){this.__materialNodes.forEach(s=>{s.setParametersForGPU&&s.setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i})});const s=c.a.getWebGLResourceRepository();if(this.__fields.forEach((e,r)=>{const a=this.__fieldsInfo.get(r);(i.setUniform||a.compositionType===o.a.Texture2D||a.compositionType===o.a.TextureCube)&&(a.isSystem||s.setUniformValue(t,a.semantic.str,n,e))}),!1===n)return;const r=this.__materialTypeName,a=g.__soloDatumFields.get(r);null!=a&&a.forEach((e,r)=>{const a=this.__fieldsInfo.get(r);(i.setUniform||a.compositionType===o.a.Texture2D||a.compositionType===o.a.TextureCube)&&(a.isSystem||s.setUniformValue(t,a.semantic.str,n,e))})}createProgramAsSingleOperation(e,t){const n=c.a.getWebGLResourceRepository(),i=this.__materialNodes[0],s=i.shader;let r,a="",o="";t&&this.__fieldsInfo.forEach((e,n)=>{const i=this.__fieldsInfo.get(n);i.stage!==f.a.VertexShader&&i.stage!==f.a.VertexAndPixelShader||(a+=t(this.__materialTypeName,i,n)),i.stage!==f.a.PixelShader&&i.stage!==f.a.VertexAndPixelShader||(o+=t(this.__materialTypeName,i,n))}),r=s.getVertexShaderBody?s.getVertexShaderBody({getters:a,definitions:i.definitions,matricesGetters:e}):s.glslBegin+i.definitions+`\nuniform bool u_vertexAttributesExistenceArray[${u.a.AttributeTypeNumber}];\n`+e+s.vertexShaderDefinitions+s.getGlslVertexShaderProperies(a)+s.glslMainBegin+s.vertexShaderBody+s.glslMainEnd;let h=s.getPixelShaderBody({getters:o,definitions:i.definitions});const l=p.a.toCRC32(r+h);return g.__shaderMap.has(l)?(this._shaderProgramUid=g.__shaderMap.get(l),this._shaderProgramUid):(this._shaderProgramUid=n.createShaderProgram({materialTypeName:this.__materialTypeName,vertexShaderStr:r,fragmentShaderStr:h,attributeNames:s.attributeNames,attributeSemantics:s.attributeSemantics}),g.__shaderMap.set(l,this._shaderProgramUid),this._shaderProgramUid)}createProgramString(e=""){let t,n;for(let e=0;e<this.__materialNodes.length;e++){const i=this.__materialNodes[e];0===i.vertexInputConnections.length&&(t=i),0===i.pixelInputConnections.length&&(n=i)}const i=[t.materialNodeUid],s=[t],a=[n.materialNodeUid],o=[n],h=this.__materialNodes.concat(),c=this.__materialNodes.concat();h.splice(h.indexOf(t),1),c.splice(c.indexOf(n),1);do{let e;h.forEach(t=>{let n=0;for(let e of t.vertexInputConnections)-1===i.indexOf(e.materialNodeUid)&&n++;0===n&&(e=t)}),s.push(e),i.push(e.materialNodeUid),h.splice(h.indexOf(e),1)}while(0!==h.length);do{let e;c.forEach(t=>{let n=0;for(let e of t.pixelInputConnections)-1===a.indexOf(e.materialNodeUid)&&n++;0===n&&(e=t)}),o.push(e),a.push(e.materialNodeUid),c.splice(c.indexOf(e),1)}while(0!==c.length);let _=t.shader.glslBegin,m=t.shader.glslBegin;for(let e=0;e<s.length;e++){const t=s[e],n=t.shader.attributeNames,i=t.shader.attributeSemantics,r=t.shader.attributeCompositions;for(let e=0;e<i.length;e++){const t=n[e];_+=`${r[e].getGlslStr(l.a.Float)} ${t};\n`}}_+="\n";for(let e=0;e<s.length;e++){const t=s[e]._semanticsInfoArray;for(let e=0;e<t.length;e++){const n=t[e];_+=`uniform ${n.compositionType.getGlslStr(n.componentType)} u_${n.semantic.str};\n`}}_+="\n";for(let e=0;e<o.length;e++){const t=o[e]._semanticsInfoArray;for(let e=0;e<t.length;e++){const n=t[e];m+=`uniform ${n.compositionType.getGlslStr(n.componentType)} u_${n.semantic.str};\n`}}m+="\n";const d=[],f=[];for(let e=0;e<s.length;e++){const t=s[e];(0===e||t.vertexInputConnections.length>0)&&d.push(t)}for(let e=0;e<o.length;e++){const t=o[e];(0===e||t.pixelInputConnections.length>0)&&f.push(t)}_+=`\nuniform bool u_vertexAttributesExistenceArray[${u.a.AttributeTypeNumber}];\n`,_+=e;const p=[];for(let e=0;e<d.length;e++){const t=d[e];-1===p.indexOf(t.shaderFunctionName)&&(_+=t.shader.vertexShaderDefinitions,m+=t.shader.pixelShaderDefinitions,p.push(t.shaderFunctionName))}{_+=t.shader.glslMainBegin;const e=[],n=[];for(let t=1;t<d.length;t++){const i=d[t];null==e[t]&&(e[t]=[]),t-1>=0&&null==n[t-1]&&(n[t-1]=[]);for(let n=0;n<i.vertexInputConnections.length;n++){const s=i.vertexInputConnections[n],a=r.a.materialNodes[s.materialNodeUid].getVertexOutput(s.outputNameOfPrev),o=i.getVertexInput(s.inputNameOfThis),h=o.compositionType.getGlslStr(o.componentType),l=`${a.name}_${s.materialNodeUid}_to_${o.name}_${i.materialNodeUid}`;e[t].push(l),_+=`${h} ${l};\n`}for(let e=t;e<d.length;e++){const i=d[e],s=d[t-1];for(let e=0;e<i.vertexInputConnections.length;e++){const a=i.vertexInputConnections[e];if(null!=s&&a.materialNodeUid!==s.materialNodeUid)continue;const o=r.a.materialNodes[a.materialNodeUid].getVertexOutput(a.outputNameOfPrev),h=i.getVertexInput(a.inputNameOfThis),l=(h.compositionType.getGlslStr(h.componentType),`${o.name}_${a.materialNodeUid}_to_${h.name}_${i.materialNodeUid}`);t-1>=0&&n[t-1].push(l)}}}for(let t=0;t<d.length;t++){const i=d[t].shaderFunctionName;null==e[t]&&(e[t]=[]);const s=e[t].concat(n[t]);let r=`${i}(`;for(let e=0;e<s.length;e++){null!=s[e]&&(0!==e&&(r+=", "),r+=s[e])}_+=r+=");\n"}_+=t.shader.glslMainEnd}{m+=n.shader.glslMainBegin;const e=[],t=[];for(let n=1;n<f.length;n++){const i=f[n];null==e[n]&&(e[n]=[]),n-1>=0&&null==t[n-1]&&(t[n-1]=[]);for(let t=0;t<i.pixelInputConnections.length;t++){const s=i.pixelInputConnections[t],a=r.a.materialNodes[s.materialNodeUid].getPixelOutput(s.outputNameOfPrev),o=i.getPixelInput(s.inputNameOfThis),h=o.compositionType.getGlslStr(o.componentType),l=`${a.name}_${s.materialNodeUid}_to_${o.name}_${i.materialNodeUid}`;e[n].push(l),m+=`${h} ${l};\n`}for(let e=n;e<f.length;e++){const i=f[e],s=f[n-1];for(let e=0;e<i.pixelInputConnections.length;e++){const a=i.pixelInputConnections[e];if(null!=s&&a.materialNodeUid!==s.materialNodeUid)continue;const o=r.a.materialNodes[a.materialNodeUid].getPixelOutput(a.outputNameOfPrev),h=i.getPixelInput(a.inputNameOfThis),l=(h.compositionType.getGlslStr(h.componentType),`${o.name}_${a.materialNodeUid}_to_${h.name}_${i.materialNodeUid}`);n-1>=0&&t[n-1].push(l)}}}for(let n=0;n<f.length;n++){const i=f[n].shaderFunctionName;null==e[n]&&(e[n]=[]);const s=e[n].concat(t[n]);let r=`${i}(`;for(let e=0;e<s.length;e++){null!=s[e]&&(0!==e&&(r+=", "),r+=s[e])}m+=r+=");\n"}m+=n.shader.glslMainEnd}let g=[],v=[];for(let e=0;e<d.length;e++){const t=d[e];Array.prototype.push.apply(g,t.shader.attributeNames),Array.prototype.push.apply(v,t.shader.attributeSemantics)}return{vertexShader:_,pixelShader:m,attributeNames:g=Array.from(new Set(g)),attributeSemantics:v=Array.from(new Set(v))}}createProgram(e,t){if(this.__materialNodes[0].isSingleOperation)return this.createProgramAsSingleOperation(e,t);{const t=c.a.getWebGLResourceRepository();let n=this.createProgramString(e);const i=p.a.toCRC32(n.vertexShader+n.pixelShader);return g.__shaderMap.has(i)?(this._shaderProgramUid=g.__shaderMap.get(i),this._shaderProgramUid):(this._shaderProgramUid=t.createShaderProgram({materialTypeName:this.__materialTypeName,vertexShaderStr:n.vertexShader,fragmentShaderStr:n.pixelShader,attributeNames:n.attributeNames,attributeSemantics:n.attributeSemantics}),g.__shaderMap.set(i,this._shaderProgramUid),this._shaderProgramUid)}}isBlend(){return this.alphaMode===s.a.Blend}static getLocationOffsetOfMemberOfMaterial(e,t){const n=g.__instancesByTypes.get(e);if(n.__fieldsInfo.get(t).soloDatum){return g.__soloDatumFields.get(n.__materialTypeName).get(t).v.byteOffset/4/4}return this.__accessors.get(e).get(t).byteOffsetInBuffer/4/4}static getAccessorOfMemberOfMaterial(e,t){if(!g.__instancesByTypes.get(e).__fieldsInfo.get(t).soloDatum){return this.__accessors.get(e).get(t)}}}g.__soloDatumFields=new Map,g.__shaderMap=new Map,g.__materials=[],g.__instancesByTypes=new Map,g.__materialTidCount=-1,g.__materialTids=new Map,g.__materialInstanceCountOfType=new Map,g.__materialTypes=new Map,g.__maxInstances=new Map,g.__bufferViews=new Map,g.__accessors=new Map},function(e,t,n){"use strict";const i={not:{},all:{},any:{},_not:e=>(function(){return!e.apply(null,[...arguments])}),_all:e=>(function(){return Array.isArray(arguments[0])?arguments[0].every(e):[...arguments].every(e)}),_any:e=>(function(){return Array.isArray(arguments[0])?arguments[0].some(e):[...arguments].some(e)}),defined:e=>void 0!==e,undefined:e=>void 0===e,null:e=>null===e,exist:e=>null!=e,function:e=>"function"==typeof e};for(let e in i)if(i.hasOwnProperty(e)){const t=["not","all","any"];-1!==e.indexOf("_")||t.includes(e)||t.forEach(t=>{const n="_"+t;i[t][e]=i[n](i[e])})}t.a=i},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(34),s=n(44),r=n(9),a=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function a(e){try{h(i.next(e))}catch(e){r(e)}}function o(e){try{h(i.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(a,o)}h((i=i.apply(e,t||[])).next())})};class o extends i.a{constructor(){super(),this.mipmapLevelNumber=1,this.hdriFormat=s.a.LDR_SRGB,this.isNamePosNeg=!1}loadTextureImages(){return a(this,void 0,void 0,function*(){this.__startedToLoad=!0;const e=r.a.getWebGLResourceRepository();this.cgApiResourceUid=yield e.createCubeTextureFromFiles(this.baseUriToLoad,this.mipmapLevelNumber,this.isNamePosNeg,this.hdriFormat),this.__isTextureReady=!0})}loadTextureImagesAsync(){this.__startedToLoad=!0,r.a.getWebGLResourceRepository().createCubeTextureFromFiles(this.baseUriToLoad,this.mipmapLevelNumber,this.isNamePosNeg,this.hdriFormat).then(e=>{this.cgApiResourceUid=e}).then(()=>{this.__isTextureReady=!0})}load1x1Texture(e="rgba(0,0,0,1)"){var t=document.createElement("canvas");t.width=1,t.height=1;const n=t.getContext("2d");n.fillStyle=e,n.fillRect(0,0,1,1);const i=r.a.getWebGLResourceRepository();this.cgApiResourceUid=i.createCubeTexture(1,[{posX:t,negX:t,posY:t,negY:t,posZ:t,negZ:t}],1,1),this.__isTextureReady=!0}}},function(e,t,n){"use strict";n.d(t,"a",function(){return w});var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:-2,str:"NONE"}),a=new s({index:-1,str:"BACK"}),o=new s({index:0,str:"COLOR_ATTACHMENT0"}),h=new s({index:1,str:"COLOR_ATTACHMENT1"}),l=new s({index:2,str:"COLOR_ATTACHMENT2"}),c=new s({index:3,str:"COLOR_ATTACHMENT3"}),u=new s({index:4,str:"COLOR_ATTACHMENT4"}),_=new s({index:5,str:"COLOR_ATTACHMENT5"}),m=new s({index:6,str:"COLOR_ATTACHMENT6"}),d=new s({index:7,str:"COLOR_ATTACHMENT7"}),f=new s({index:8,str:"COLOR_ATTACHMENT8"}),p=new s({index:9,str:"COLOR_ATTACHMENT9"}),g=new s({index:10,str:"COLOR_ATTACHMENT10"}),v=new s({index:11,str:"COLOR_ATTACHMENT11"}),x=new s({index:12,str:"COLOR_ATTACHMENT12"}),y=new s({index:13,str:"COLOR_ATTACHMENT13"}),b=new s({index:14,str:"COLOR_ATTACHMENT14"}),A=new s({index:15,str:"COLOR_ATTACHMENT15"}),T=[r,a,o,h,l,c,u,_,m,d,f,p,g,v,x,y,b,A];const w=Object.freeze({None:r,Back:a,ColorAttachment0:o,ColorAttachment1:h,ColorAttachment2:l,ColorAttachment3:c,ColorAttachment4:u,ColorAttachment5:_,ColorAttachment6:m,ColorAttachment7:d,ColorAttachment8:f,ColorAttachment9:p,ColorAttachment10:g,ColorAttachment11:v,ColorAttachment12:x,ColorAttachment13:y,ColorAttachment14:b,ColorAttachment15:A,from:function(e){return Object(i.b)({typeList:T,index:e})}})},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(4),s=n(39),r=n(17),a=n(43),o=n(0);class h extends s.a{constructor(){super(),this.vertexShaderBody="\n  ",this.attributeNames=["a_position","a_color","a_normal","a_texcoord","a_joint","a_weight","a_instanceID"],this.attributeSemantics=[i.a.Position,i.a.Color0,i.a.Normal,i.a.Texcoord0,i.a.Joints0,i.a.Weights0,i.a.Instance]}static getInstance(){return this.__instance||(this.__instance=new h),this.__instance}getVertexShaderBody(e){const t=this.glsl_versionText,n=this.glsl_vertex_in,i=this.glsl_vertex_out;return`${t}\nprecision highp float;\n\n${void 0!==e.definitions?e.definitions:""}\n\n${n} vec3 a_position;\n${n} vec3 a_color;\n${n} vec3 a_normal;\n${n} float a_instanceID;\n${n} vec2 a_texcoord;\n${n} vec4 a_joint;\n${n} vec4 a_weight;\n${i} vec3 v_color;\n${i} vec3 v_normal_inWorld;\n${i} vec4 v_position_inWorld;\n${i} vec2 v_texcoord;\n\n${this.prerequisites}\n\n${void 0!==e.matricesGetters?e.matricesGetters:""}\n\n${void 0!==e.getters?e.getters:""}\n\n${this.toNormalMatrix}\n\n${this.getSkinMatrix}\n\n${this.processGeometryWithSkinningOptionally}\n\nvoid main()\n{\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat4 viewMatrix = get_viewMatrix(a_instanceID);\n  mat4 projectionMatrix = get_projectionMatrix(a_instanceID);\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n\n  // Skeletal\n  processGeometryWithMorphingAndSkinning(\n    worldMatrix,\n    normalMatrix,\n    normalMatrix,\n    a_position,\n    v_position_inWorld,\n    a_normal,\n    v_normal_inWorld\n  );\n\n  gl_Position = projectionMatrix * viewMatrix * v_position_inWorld;\n\n\n  v_color = a_color;\n  v_normal_inWorld = normalMatrix * a_normal;\n  v_texcoord = a_texcoord;\n\n  ${this.pointSprite}\n\n//  v_color = vec3(u_boneMatrices[int(a_joint.x)][1].xyz);\n\n}\n    `}get vertexShaderDefinitions(){return"\n"}getFragmentShader(e){const t=this.glsl_versionText,n=this.glsl_fragment_in,i=this.glsl_rt0,s=this.glsl_fragColor,a=this.glsl_texture;return`${t}\nprecision highp float;\n\n${void 0!==e.definitions?e.definitions:""}\n\n${this.prerequisites}\n\n${n} vec3 v_color;\n${n} vec3 v_normal_inWorld;\n${n} vec4 v_position_inWorld;\n${n} vec2 v_texcoord;\n${i}\n\n${void 0!==e.getters?e.getters:""}\n\nvoid main ()\n{\n\n  // Normal\n  vec3 normal_inWorld = normalize(v_normal_inWorld);\n\n  vec4 diffuseColorFactor = get_diffuseColorFactor(u_materialSID, 0);\n\n\n  // diffuseColor\n  vec3 diffuseColor = vec3(0.0, 0.0, 0.0);\n  float alpha = 1.0;\n  if (v_color != diffuseColor && diffuseColorFactor.rgb != diffuseColor) {\n    diffuseColor = v_color * diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (v_color == diffuseColor) {\n    diffuseColor = diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (diffuseColorFactor.rgb == diffuseColor) {\n    diffuseColor = v_color;\n  } else {\n    diffuseColor = vec3(1.0, 1.0, 1.0);\n  }\n\n  // diffuseColorTexture\n  vec4 textureColor = ${a}(u_diffuseColorTexture, v_texcoord);\n  if (textureColor.r > 0.05) {\n    diffuseColor *= textureColor.rgb;\n  }\n\n  // Lighting\n  vec3 shadingColor = vec3(0.0, 0.0, 0.0);\n#ifdef RN_IS_LIGHTING\n  int shadingModel = get_shadingModel(u_materialSID, 0);\n  if (shadingModel > 0) {\n\n    int lightNumber = get_lightNumber(0.0, 0);\n\n    vec3 diffuse = vec3(0.0, 0.0, 0.0);\n    vec3 specular = vec3(0.0, 0.0, 0.0);\n    for (int i = 0; i < ${r.a.maxLightNumberInShader}; i++) {\n      if (i >= lightNumber) {\n        break;\n      }\n\n      vec4 gotLightDirection = get_lightDirection(0.0, i);\n      vec4 gotLightPosition = get_lightPosition(0.0, i);\n      vec4 gotLightIntensity = get_lightIntensity(0.0, i);\n      vec3 lightDirection = gotLightDirection.xyz;\n      vec3 lightIntensity = gotLightIntensity.xyz;\n      vec3 lightPosition = gotLightPosition.xyz;\n      float lightType = gotLightPosition.w;\n      float spotCosCutoff = gotLightDirection.w;\n      float spotExponent = gotLightIntensity.w;\n\n      if (0.75 < lightType) { // is pointlight or spotlight\n        lightDirection = normalize(lightPosition - v_position_inWorld.xyz);\n      }\n      float spotEffect = 1.0;\n      if (lightType > 1.75) { // is spotlight\n        spotEffect = dot(lightDirection, lightDirection);\n        if (spotEffect > spotCosCutoff) {\n          spotEffect = pow(spotEffect, spotExponent);\n        } else {\n          spotEffect = 0.0;\n        }\n      }\n\n      vec3 incidentLight = spotEffect * lightIntensity;\n\n\n\n      diffuse += diffuseColor * max(0.0, dot(normal_inWorld, lightDirection)) * incidentLight;\n\n      float shininess = get_shininess(u_materialSID, 0);\n      int shadingModel = get_shadingModel(u_materialSID, 0);\n\n      vec3 viewPosition = get_viewPosition(0.0, 0);\n\n      if (shadingModel == 2) {// BLINN\n        // ViewDirection\n        vec3 viewDirection = normalize(viewPosition - v_position_inWorld.xyz);\n        vec3 halfVector = normalize(lightDirection + viewDirection);\n        specular += pow(max(0.0, dot(halfVector, normal_inWorld)), shininess);\n      } else if (shadingModel == 3) { // PHONG\n        vec3 viewDirection = normalize(viewPosition - v_position_inWorld.xyz);\n        vec3 R = reflect(lightDirection, normal_inWorld);\n        specular += pow(max(0.0, dot(R, viewDirection)), shininess);\n      }\n\n    }\n\n    shadingColor = diffuse + specular;\n  } else {\n    shadingColor = diffuseColor;\n  }\n#else\n  shadingColor = diffuseColor;\n#endif\n\n  rt0 = vec4(shadingColor * alpha, alpha);\n  // rt0 = vec4(u_lightNumber, 0.0, 0.0, 1.0);\n  // rt0 = vec4(1.0, 0.0, 0.0, 1.0);\n  // rt0 = vec4(normal_inWorld*0.5+0.5, 1.0);\n\n\n  ${s}\n}\n`}get pixelShaderDefinitions(){return""}getPixelShaderBody(e){return this.getFragmentShader(e)}get attributeCompositions(){return[o.a.Vec3,o.a.Vec3,o.a.Vec3,o.a.Vec2,o.a.Vec4,o.a.Vec4,o.a.Scalar]}}h.materialElement=a.a.ClassicShading},function(e,t){var n,i,s=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===r||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:r}catch(e){n=r}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var h,l=[],c=!1,u=-1;function _(){c&&h&&(c=!1,h.length?l=h.concat(l):u=-1,l.length&&m())}function m(){if(!c){var e=o(_);c=!0;for(var t=l.length;t;){for(h=l,l=[];++u<t;)h&&h[u].run();u=-1,t=l.length}h=null,c=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function f(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new d(e,t)),1!==l.length||c||o(m)},d.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t,n){"use strict";var i=n(6);class s extends i.a{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new s({index:1,str:"OES_vertex_array_object"}),a=new s({index:2,str:"OES_texture_float"}),o=new s({index:3,str:"OES_texture_half_float"}),h=new s({index:4,str:"OES_texture_float_linear"}),l=new s({index:5,str:"OES_texture_half_float_linear"}),c=new s({index:6,str:"ANGLE_instanced_arrays"}),u=new s({index:7,str:"EXT_texture_filter_anisotropic"}),_=new s({index:8,str:"OES_element_index_uint"}),m=new s({index:9,str:"EXT_shader_texture_lod"}),d=new s({index:10,str:"OES_standard_derivatives"}),f=new s({index:11,str:"WEBGL_draw_buffers"});const p=Object.freeze({VertexArrayObject:r,TextureFloat:a,TextureHalfFloat:o,TextureFloatLinear:h,TextureHalfFloatLinear:l,InstancedArrays:c,TextureFilterAnisotropic:u,ElementIndexUint:_,ShaderTextureLod:m,ShaderDerivatives:d,DrawBuffers:f});n.d(t,"a",function(){return g});class g{constructor(e,t){this.__webglVersion=1,this.width=0,this.height=0,this.__activeTextures2D=[],this.__activeTexturesCube=[],this.__isDebugMode=!1,this.__extensions=new Map,this.__gl=e,this.width=t.width,this.height=t.height,this.canvas=t,"WebGL2RenderingContext"===this.__gl.constructor.name?this.__webglVersion=2:(this.webgl1ExtVAO=this.__getExtension(p.VertexArrayObject),this.webgl1ExtIA=this.__getExtension(p.InstancedArrays),this.webgl1ExtTF=this.__getExtension(p.TextureFloat),this.webgl1ExtTHF=this.__getExtension(p.TextureHalfFloat),this.webgl1ExtTFL=this.__getExtension(p.TextureFloatLinear),this.webgl1ExtTHFL=this.__getExtension(p.TextureHalfFloatLinear),this.webgl1ExtTFA=this.__getExtension(p.TextureFilterAnisotropic),this.webgl1ExtEIUI=this.__getExtension(p.ElementIndexUint),this.webgl1ExtSTL=this.__getExtension(p.ShaderTextureLod),this.webgl1ExtDRV=this.__getExtension(p.ShaderDerivatives),this.webgl1ExtDB=this.__getExtension(p.DrawBuffers))}getRawContext(){return this.__gl}isSupportWebGL1Extension(e){return!!this.__getExtension(e)}get isWebGL2(){return 2===this.__webglVersion}createVertexArray(){return this.isWebGL2?this.__gl.createVertexArray():null!=this.webgl1ExtVAO?this.webgl1ExtVAO.createVertexArrayOES():void 0}deleteVertexArray(e){this.isWebGL2?this.__gl.createVertexArray(e):null!=this.webgl1ExtVAO&&this.webgl1ExtVAO.deleteVertexArrayOES(e)}bindVertexArray(e){this.isWebGL2?this.__gl.bindVertexArray(e):null!=this.webgl1ExtVAO&&this.webgl1ExtVAO.bindVertexArrayOES(e)}vertexAttribDivisor(e,t){this.isWebGL2?this.__gl.vertexAttribDivisor(e,t):this.webgl1ExtIA.vertexAttribDivisorANGLE(e,t)}drawElementsInstanced(e,t,n,i,s){this.isWebGL2?this.__gl.drawElementsInstanced(e,t,n,i,s):this.webgl1ExtIA.drawElementsInstancedANGLE(e,t,n,i,s)}drawArraysInstanced(e,t,n,i){this.isWebGL2?this.__gl.drawArraysInstanced(e,t,n,i):this.webgl1ExtIA.drawArraysInstancedANGLE(e,t,n,i)}colorAttachiment(e){return this.webgl1ExtDB?this.webgl1ExtDB[`COLOR_ATTACHMENT${e}_WEBGL`]:this.__gl[`COLOR_ATTACHMENT${e}`]}drawBuffers(e){const t=this.__gl;if(0===e.length)return;let n=e;this.isWebGL2?(t.drawBuffers(e.map(e=>t[e.str])),n=t[n[0].str]):this.webgl1ExtDB&&(this.webgl1ExtDB.drawBuffersWEBGL(e.map(e=>t[e.str])),n=t[n[0].str]),n===t.NONE?t.colorMask(!1,!1,!1,!1):t.colorMask(!0,!0,!0,!0)}__activeTexture(e){switch(e){case 0:this.__gl.activeTexture(this.__gl.TEXTURE0);break;case 1:this.__gl.activeTexture(this.__gl.TEXTURE1);break;case 2:this.__gl.activeTexture(this.__gl.TEXTURE2);break;case 3:this.__gl.activeTexture(this.__gl.TEXTURE3);break;case 4:this.__gl.activeTexture(this.__gl.TEXTURE4);break;case 5:this.__gl.activeTexture(this.__gl.TEXTURE5);break;case 6:this.__gl.activeTexture(this.__gl.TEXTURE6);break;case 7:this.__gl.activeTexture(this.__gl.TEXTURE7);break;case 8:this.__gl.activeTexture(this.__gl.TEXTURE8);break;case 9:this.__gl.activeTexture(this.__gl.TEXTURE9);break;case 10:this.__gl.activeTexture(this.__gl.TEXTURE10);break;case 11:this.__gl.activeTexture(this.__gl.TEXTURE11);break;case 12:this.__gl.activeTexture(this.__gl.TEXTURE12);break;case 13:this.__gl.activeTexture(this.__gl.TEXTURE13);break;case 14:this.__gl.activeTexture(this.__gl.TEXTURE14);break;case 15:this.__gl.activeTexture(this.__gl.TEXTURE15)}}bindTexture2D(e,t){this.__isDebugMode&&(t&&(this.__activeTextures2D[e]=t),t&&(t._bound_as,t._bound_as="2D")),this.__activeTexture(e),this.__gl.bindTexture(this.__gl.TEXTURE_2D,t)}bindTextureCube(e,t){this.__isDebugMode&&(t&&(this.__activeTexturesCube[e]=t),t&&(t._bound_as,t._bound_as="CUBE_MAP")),this.__activeTexture(e),this.__gl.bindTexture(this.__gl.TEXTURE_CUBE_MAP,t)}unbindTexture2D(e){this.__isDebugMode&&delete this.__activeTextures2D[e],this.__activeTexture(e),this.__gl.bindTexture(this.__gl.TEXTURE_2D,null)}unbindTextureCube(e){this.__isDebugMode&&delete this.__activeTexturesCube[e],this.__activeTexture(e),this.__gl.bindTexture(this.__gl.TEXTURE_CUBE_MAP,null)}unbindTextures(){for(let e=0;e<this.__activeTextures2D.length;e++)null!=this.__activeTextures2D[e]&&(this.__activeTexture(e),this.__gl.bindTexture(this.__gl.TEXTURE_2D,null),delete this.__activeTextures2D[e]);for(let e=0;e<this.__activeTexturesCube.length;e++)null!=this.__activeTexturesCube[e]&&(this.__activeTexture(e),this.__gl.bindTexture(this.__gl.TEXTURE_CUBE_MAP,null),delete this.__activeTexturesCube[e])}__getExtension(e){const t=this.__gl;if(!this.__extensions.has(e)){const n=t.getExtension(e.toString());if(null==n){const t=`The library does not support this environment because the ${e.toString()} is not available`;null!=console.error?console.error(t):console.log(t)}return this.__extensions.set(e,n),n}return this.__extensions.get(e)}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return s});const i=function(){const e=["iPod","iPad","iPhone","Android"];for(var t=0;t<e.length;t++)if(navigator.userAgent.indexOf(e[t])>0)return!0;return!1},s=Object.freeze({isMobile:i,preventDefaultForDesktopOnly:function(e){i()||e.preventDefault()},isObject:function(e){return e instanceof Object&&!(e instanceof Array)},fillTemplate:function(e,t){return new Function("return `"+e+"`;").call(t)},isNode:function(){return void 0!==e&&!0}})}).call(this,n(67))},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var i=n(72),s=n(73),r=n(74);function a(){return h.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return h.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=h.prototype:(null===e&&(e=new h(t)),e.length=t),e}function h(e,t,n){if(!(h.TYPED_ARRAY_SUPPORT||this instanceof h))return new h(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}return l(this,e,t,n)}function l(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i);h.TYPED_ARRAY_SUPPORT?(e=t).__proto__=h.prototype:e=_(e,t);return e}(e,t,n,i):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!h.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|d(t,n),s=(e=o(e,i)).write(t,n);s!==i&&(e=e.slice(0,s));return e}(e,t,n):function(e,t){if(h.isBuffer(t)){var n=0|m(t.length);return 0===(e=o(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(i=t.length)!=i?o(e,0):_(e,t);if("Buffer"===t.type&&r(t.data))return _(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t){if(c(t),e=o(e,t<0?0:0|m(t)),!h.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function _(e,t){var n=t.length<0?0:0|m(t.length);e=o(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function m(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function d(e,t){if(h.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return X(e).length;default:if(i)return G(e).length;t=(""+t).toLowerCase(),i=!0}}function f(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return F(this,t,n);case"latin1":case"binary":return C(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function p(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function g(e,t,n,i,s){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=s?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(s)return-1;n=e.length-1}else if(n<0){if(!s)return-1;n=0}if("string"==typeof t&&(t=h.from(t,i)),h.isBuffer(t))return 0===t.length?-1:v(e,t,n,i,s);if("number"==typeof t)return t&=255,h.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,i,s);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,i,s){var r,a=1,o=e.length,h=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,o/=2,h/=2,n/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(s){var c=-1;for(r=n;r<o;r++)if(l(e,r)===l(t,-1===c?0:r-c)){if(-1===c&&(c=r),r-c+1===h)return c*a}else-1!==c&&(r-=r-c),c=-1}else for(n+h>o&&(n=o-h),r=n;r>=0;r--){for(var u=!0,_=0;_<h;_++)if(l(e,r+_)!==l(t,_)){u=!1;break}if(u)return r}return-1}function x(e,t,n,i){n=Number(n)||0;var s=e.length-n;i?(i=Number(i))>s&&(i=s):i=s;var r=t.length;if(r%2!=0)throw new TypeError("Invalid hex string");i>r/2&&(i=r/2);for(var a=0;a<i;++a){var o=parseInt(t.substr(2*a,2),16);if(isNaN(o))return a;e[n+a]=o}return a}function y(e,t,n,i){return k(G(t,e.length-n),e,n,i)}function b(e,t,n,i){return k(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function A(e,t,n,i){return b(e,t,n,i)}function T(e,t,n,i){return k(X(t),e,n,i)}function w(e,t,n,i){return k(function(e,t){for(var n,i,s,r=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),i=n>>8,s=n%256,r.push(s),r.push(i);return r}(t,e.length-n),e,n,i)}function S(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);for(var i=[],s=t;s<n;){var r,a,o,h,l=e[s],c=null,u=l>239?4:l>223?3:l>191?2:1;if(s+u<=n)switch(u){case 1:l<128&&(c=l);break;case 2:128==(192&(r=e[s+1]))&&(h=(31&l)<<6|63&r)>127&&(c=h);break;case 3:r=e[s+1],a=e[s+2],128==(192&r)&&128==(192&a)&&(h=(15&l)<<12|(63&r)<<6|63&a)>2047&&(h<55296||h>57343)&&(c=h);break;case 4:r=e[s+1],a=e[s+2],o=e[s+3],128==(192&r)&&128==(192&a)&&128==(192&o)&&(h=(15&l)<<18|(63&r)<<12|(63&a)<<6|63&o)>65535&&h<1114112&&(c=h)}null===c?(c=65533,u=1):c>65535&&(c-=65536,i.push(c>>>10&1023|55296),c=56320|1023&c),i.push(c),s+=u}return function(e){var t=e.length;if(t<=E)return String.fromCharCode.apply(String,e);var n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=E));return n}(i)}t.Buffer=h,t.SlowBuffer=function(e){+e!=e&&(e=0);return h.alloc(+e)},t.INSPECT_MAX_BYTES=50,h.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),h.poolSize=8192,h._augment=function(e){return e.__proto__=h.prototype,e},h.from=function(e,t,n){return l(null,e,t,n)},h.TYPED_ARRAY_SUPPORT&&(h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0})),h.alloc=function(e,t,n){return function(e,t,n,i){return c(t),t<=0?o(e,t):void 0!==n?"string"==typeof i?o(e,t).fill(n,i):o(e,t).fill(n):o(e,t)}(null,e,t,n)},h.allocUnsafe=function(e){return u(null,e)},h.allocUnsafeSlow=function(e){return u(null,e)},h.isBuffer=function(e){return!(null==e||!e._isBuffer)},h.compare=function(e,t){if(!h.isBuffer(e)||!h.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,s=0,r=Math.min(n,i);s<r;++s)if(e[s]!==t[s]){n=e[s],i=t[s];break}return n<i?-1:i<n?1:0},h.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(e,t){if(!r(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return h.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=h.allocUnsafe(t),s=0;for(n=0;n<e.length;++n){var a=e[n];if(!h.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,s),s+=a.length}return i},h.byteLength=d,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},h.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},h.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},h.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):f.apply(this,arguments)},h.prototype.equals=function(e){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===h.compare(this,e)},h.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},h.prototype.compare=function(e,t,n,i,s){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===s&&(s=this.length),t<0||n>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(i>=s&&t>=n)return 0;if(i>=s)return-1;if(t>=n)return 1;if(this===e)return 0;for(var r=(s>>>=0)-(i>>>=0),a=(n>>>=0)-(t>>>=0),o=Math.min(r,a),l=this.slice(i,s),c=e.slice(t,n),u=0;u<o;++u)if(l[u]!==c[u]){r=l[u],a=c[u];break}return r<a?-1:a<r?1:0},h.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},h.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},h.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},h.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var s=this.length-t;if((void 0===n||n>s)&&(n=s),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var r=!1;;)switch(i){case"hex":return x(this,e,t,n);case"utf8":case"utf-8":return y(this,e,t,n);case"ascii":return b(this,e,t,n);case"latin1":case"binary":return A(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,n);default:if(r)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),r=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var E=4096;function F(e,t,n){var i="";n=Math.min(e.length,n);for(var s=t;s<n;++s)i+=String.fromCharCode(127&e[s]);return i}function C(e,t,n){var i="";n=Math.min(e.length,n);for(var s=t;s<n;++s)i+=String.fromCharCode(e[s]);return i}function P(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var s="",r=t;r<n;++r)s+=z(e[r]);return s}function M(e,t,n){for(var i=e.slice(t,n),s="",r=0;r<i.length;r+=2)s+=String.fromCharCode(i[r]+256*i[r+1]);return s}function N(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,n,i,s,r){if(!h.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<r)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function R(e,t,n,i){t<0&&(t=65535+t+1);for(var s=0,r=Math.min(e.length-n,2);s<r;++s)e[n+s]=(t&255<<8*(i?s:1-s))>>>8*(i?s:1-s)}function D(e,t,n,i){t<0&&(t=4294967295+t+1);for(var s=0,r=Math.min(e.length-n,4);s<r;++s)e[n+s]=t>>>8*(i?s:3-s)&255}function V(e,t,n,i,s,r){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function B(e,t,n,i,r){return r||V(e,0,n,4),s.write(e,t,n,i,23,4),n+4}function U(e,t,n,i,r){return r||V(e,0,n,8),s.write(e,t,n,i,52,8),n+8}h.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),h.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=h.prototype;else{var s=t-e;n=new h(s,void 0);for(var r=0;r<s;++r)n[r]=this[r+e]}return n},h.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||N(e,t,this.length);for(var i=this[e],s=1,r=0;++r<t&&(s*=256);)i+=this[e+r]*s;return i},h.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||N(e,t,this.length);for(var i=this[e+--t],s=1;t>0&&(s*=256);)i+=this[e+--t]*s;return i},h.prototype.readUInt8=function(e,t){return t||N(e,1,this.length),this[e]},h.prototype.readUInt16LE=function(e,t){return t||N(e,2,this.length),this[e]|this[e+1]<<8},h.prototype.readUInt16BE=function(e,t){return t||N(e,2,this.length),this[e]<<8|this[e+1]},h.prototype.readUInt32LE=function(e,t){return t||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},h.prototype.readUInt32BE=function(e,t){return t||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},h.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||N(e,t,this.length);for(var i=this[e],s=1,r=0;++r<t&&(s*=256);)i+=this[e+r]*s;return i>=(s*=128)&&(i-=Math.pow(2,8*t)),i},h.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||N(e,t,this.length);for(var i=t,s=1,r=this[e+--i];i>0&&(s*=256);)r+=this[e+--i]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*t)),r},h.prototype.readInt8=function(e,t){return t||N(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},h.prototype.readInt16LE=function(e,t){t||N(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},h.prototype.readInt16BE=function(e,t){t||N(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},h.prototype.readInt32LE=function(e,t){return t||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},h.prototype.readInt32BE=function(e,t){return t||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},h.prototype.readFloatLE=function(e,t){return t||N(e,4,this.length),s.read(this,e,!0,23,4)},h.prototype.readFloatBE=function(e,t){return t||N(e,4,this.length),s.read(this,e,!1,23,4)},h.prototype.readDoubleLE=function(e,t){return t||N(e,8,this.length),s.read(this,e,!0,52,8)},h.prototype.readDoubleBE=function(e,t){return t||N(e,8,this.length),s.read(this,e,!1,52,8)},h.prototype.writeUIntLE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||L(this,e,t,n,Math.pow(2,8*n)-1,0);var s=1,r=0;for(this[t]=255&e;++r<n&&(s*=256);)this[t+r]=e/s&255;return t+n},h.prototype.writeUIntBE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||L(this,e,t,n,Math.pow(2,8*n)-1,0);var s=n-1,r=1;for(this[t+s]=255&e;--s>=0&&(r*=256);)this[t+s]=e/r&255;return t+n},h.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,1,255,0),h.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},h.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},h.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):R(this,e,t,!1),t+2},h.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},h.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},h.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var s=Math.pow(2,8*n-1);L(this,e,t,n,s-1,-s)}var r=0,a=1,o=0;for(this[t]=255&e;++r<n&&(a*=256);)e<0&&0===o&&0!==this[t+r-1]&&(o=1),this[t+r]=(e/a>>0)-o&255;return t+n},h.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var s=Math.pow(2,8*n-1);L(this,e,t,n,s-1,-s)}var r=n-1,a=1,o=0;for(this[t+r]=255&e;--r>=0&&(a*=256);)e<0&&0===o&&0!==this[t+r+1]&&(o=1),this[t+r]=(e/a>>0)-o&255;return t+n},h.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,1,127,-128),h.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},h.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},h.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):R(this,e,t,!1),t+2},h.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,2147483647,-2147483648),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},h.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},h.prototype.writeFloatLE=function(e,t,n){return B(this,e,t,!0,n)},h.prototype.writeFloatBE=function(e,t,n){return B(this,e,t,!1,n)},h.prototype.writeDoubleLE=function(e,t,n){return U(this,e,t,!0,n)},h.prototype.writeDoubleBE=function(e,t,n){return U(this,e,t,!1,n)},h.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var s,r=i-n;if(this===e&&n<t&&t<i)for(s=r-1;s>=0;--s)e[s+t]=this[s+n];else if(r<1e3||!h.TYPED_ARRAY_SUPPORT)for(s=0;s<r;++s)e[s+t]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+r),t);return r},h.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var s=e.charCodeAt(0);s<256&&(e=s)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!h.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var r;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(r=t;r<n;++r)this[r]=e;else{var a=h.isBuffer(e)?e:G(new h(e,i).toString()),o=a.length;for(r=0;r<n-t;++r)this[r+t]=a[r%o]}return this};var O=/[^+\/0-9A-Za-z-_]/g;function z(e){return e<16?"0"+e.toString(16):e.toString(16)}function G(e,t){var n;t=t||1/0;for(var i=e.length,s=null,r=[],a=0;a<i;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!s){if(n>56319){(t-=3)>-1&&r.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&r.push(239,191,189);continue}s=n;continue}if(n<56320){(t-=3)>-1&&r.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(t-=3)>-1&&r.push(239,191,189);if(s=null,n<128){if((t-=1)<0)break;r.push(n)}else if(n<2048){if((t-=2)<0)break;r.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;r.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;r.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return r}function X(e){return i.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(O,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function k(e,t,n,i){for(var s=0;s<i&&!(s+n>=t.length||s>=e.length);++s)t[s+n]=e[s];return s}}).call(this,n(71))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){for(var t,n=l(e),i=n[0],a=n[1],o=new r(function(e,t,n){return 3*(t+n)/4-n}(0,i,a)),h=0,c=a>0?i-4:i,u=0;u<c;u+=4)t=s[e.charCodeAt(u)]<<18|s[e.charCodeAt(u+1)]<<12|s[e.charCodeAt(u+2)]<<6|s[e.charCodeAt(u+3)],o[h++]=t>>16&255,o[h++]=t>>8&255,o[h++]=255&t;2===a&&(t=s[e.charCodeAt(u)]<<2|s[e.charCodeAt(u+1)]>>4,o[h++]=255&t);1===a&&(t=s[e.charCodeAt(u)]<<10|s[e.charCodeAt(u+1)]<<4|s[e.charCodeAt(u+2)]>>2,o[h++]=t>>8&255,o[h++]=255&t);return o},t.fromByteArray=function(e){for(var t,n=e.length,s=n%3,r=[],a=0,o=n-s;a<o;a+=16383)r.push(c(e,a,a+16383>o?o:a+16383));1===s?(t=e[n-1],r.push(i[t>>2]+i[t<<4&63]+"==")):2===s&&(t=(e[n-2]<<8)+e[n-1],r.push(i[t>>10]+i[t>>4&63]+i[t<<2&63]+"="));return r.join("")};for(var i=[],s=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,h=a.length;o<h;++o)i[o]=a[o],s[a.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,n){for(var s,r,a=[],o=t;o<n;o+=3)s=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(i[(r=s)>>18&63]+i[r>>12&63]+i[r>>6&63]+i[63&r]);return a.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,i,s){var r,a,o=8*s-i-1,h=(1<<o)-1,l=h>>1,c=-7,u=n?s-1:0,_=n?-1:1,m=e[t+u];for(u+=_,r=m&(1<<-c)-1,m>>=-c,c+=o;c>0;r=256*r+e[t+u],u+=_,c-=8);for(a=r&(1<<-c)-1,r>>=-c,c+=i;c>0;a=256*a+e[t+u],u+=_,c-=8);if(0===r)r=1-l;else{if(r===h)return a?NaN:1/0*(m?-1:1);a+=Math.pow(2,i),r-=l}return(m?-1:1)*a*Math.pow(2,r-i)},t.write=function(e,t,n,i,s,r){var a,o,h,l=8*r-s-1,c=(1<<l)-1,u=c>>1,_=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,m=i?0:r-1,d=i?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-a))<1&&(a--,h*=2),(t+=a+u>=1?_/h:_*Math.pow(2,1-u))*h>=2&&(a++,h/=2),a+u>=c?(o=0,a=c):a+u>=1?(o=(t*h-1)*Math.pow(2,s),a+=u):(o=t*Math.pow(2,u-1)*Math.pow(2,s),a=0));s>=8;e[n+m]=255&o,m+=d,o/=256,s-=8);for(a=a<<s|o,l+=s;l>0;e[n+m]=255&a,m+=d,a/=256,l-=8);e[n+m-d]|=128*f}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";n.r(t);var i=n(37),s=n(10),r=n(42),a=n(31),o=n(25),h=n(46),l=n(6);class c extends l.a{constructor({index:e,str:t}){super({index:e,str:t})}}const u=new c({index:-1,str:"UNKNOWN"}),_=new c({index:0,str:"POINTS"}),m=new c({index:1,str:"LINES"}),d=new c({index:2,str:"LINE_LOOP"}),f=new c({index:3,str:"LINE_STRIP"}),p=new c({index:4,str:"TRIANGLES"}),g=new c({index:5,str:"TRIANGLE_STRIP"}),v=new c({index:6,str:"TRIANGLE_FAN"}),x=[u,_,m,d,f,p,g,v];const y=Object.freeze({Unknown:u,Points:_,Lines:m,LineLoop:d,LineStrip:f,Triangles:p,TriangleStrip:g,TriangleFan:v,from:function(e){return Object(l.b)({typeList:x,index:e})}});var b=n(4),A=n(24),T=n(1),w=n(28),S=n(0),I=n(11),E=n(54),F=n(62),C=n(3),P=n(16),M=n(22),N=n(9),L=n(8),R=n(2),D=n(39),V=n(17),B=n(43);class U extends D.a{constructor(){super(),this.vertexShaderBody="\n\n\n  ",this.attributeNames=["a_position","a_color","a_normal","a_faceNormal","a_texcoord","a_tangent","a_joint","a_weight","a_baryCentricCoord","a_instanceID"],this.attributeSemantics=[b.a.Position,b.a.Color0,b.a.Normal,b.a.FaceNormal,b.a.Texcoord0,b.a.Tangent,b.a.Joints0,b.a.Weights0,b.a.BaryCentricCoord,b.a.Instance]}static getInstance(){return this.__instance||(this.__instance=new U),this.__instance}get vertexShaderDefinitions(){return"\n\n"}getVertexShaderBody(e){const t=this.glsl_versionText,n=this.glsl_vertex_in,i=this.glsl_vertex_out;return`${t}\nprecision highp float;\n\n${void 0!==e.definitions?e.definitions:""}\n\n${n} vec3 a_position;\n${n} vec3 a_color;\n${n} vec3 a_normal;\n${n} vec3 a_faceNormal;\n${n} vec3 a_tangent;\n${n} float a_instanceID;\n${n} vec2 a_texcoord;\n${n} vec4 a_joint;\n${n} vec4 a_weight;\n${n} vec4 a_baryCentricCoord;\n${i} vec3 v_color;\n${i} vec3 v_normal_inWorld;\n${i} vec3 v_faceNormal_inWorld;\n${i} vec3 v_tangent_inWorld;\n${i} vec3 v_binormal_inWorld;\n${i} vec4 v_position_inWorld;\n${i} vec2 v_texcoord;\n${i} vec3 v_baryCentricCoord;\n\n${this.prerequisites}\n\n${void 0!==e.getters?e.getters:""}\n\n${void 0!==e.matricesGetters?e.matricesGetters:""}\n\n${this.toNormalMatrix}\n\n${this.getSkinMatrix}\n\n${this.processGeometryWithSkinningOptionally}\n\nvoid main()\n{\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat4 viewMatrix = get_viewMatrix(a_instanceID);\n  mat4 projectionMatrix = get_projectionMatrix(a_instanceID);\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n\n  v_color = a_color;\n\n  bool isSkinning = false;\n\n  isSkinning = processGeometryWithMorphingAndSkinning(\n    worldMatrix,\n    normalMatrix,\n    normalMatrix,\n    a_position,\n    v_position_inWorld,\n    a_normal,\n    v_normal_inWorld\n  );\n\n  gl_Position = projectionMatrix * viewMatrix * v_position_inWorld;\n\n\n\n  v_faceNormal_inWorld = normalMatrix * a_faceNormal;\n  v_texcoord = a_texcoord;\n\n  if (abs(length(a_normal)) > 0.01) {\n    // if normal exist\n    vec3 tangent_inWorld;\n    if (!isSkinning) {\n      tangent_inWorld = normalMatrix * a_tangent;\n      v_position_inWorld = worldMatrix * vec4(a_position, 1.0);\n    }\n\n    v_binormal_inWorld = cross(v_normal_inWorld, tangent_inWorld);\n    v_tangent_inWorld = cross(v_binormal_inWorld, v_normal_inWorld);\n  }\n  v_baryCentricCoord = a_baryCentricCoord.xyz;\n\n  ${this.pointSprite}\n\n  //  v_color = vec3(u_boneMatrices[int(a_joint.x)][1].xyz);\n\n}\n`}getFragmentShader(e){const t=this.glsl_versionText,n=this.glsl_fragment_in,i=this.glsl_rt0,s=this.glsl_fragColor,r=this.glsl_texture,a=this.glsl_textureCube;let o;return o=this.__webglResourceRepository.currentWebGLContextWrapper.webgl1ExtSTL?`vec4 specularTexel = ${a}LodEXT(u_specularEnvTexture, vec3(-reflection.x, reflection.y, reflection.z), lod);`:`vec4 specularTexel = ${a}(u_specularEnvTexture, vec3(-reflection.x, reflection.y, reflection.z));`,`${t}\n${this.glsl1ShaderTextureLodExt}\n${this.glsl1ShaderDerivativeExt}\nprecision highp float;\n\n${void 0!==e.definitions?e.definitions:""}\n\n${this.prerequisites}\n\n${n} vec3 v_color;\n${n} vec3 v_normal_inWorld;\n${n} vec3 v_faceNormal_inWorld;\n${n} vec3 v_tangent_inWorld;\n${n} vec3 v_binormal_inWorld;\n${n} vec4 v_position_inWorld;\n${n} vec2 v_texcoord;\n${n} vec3 v_baryCentricCoord;\n${i}\n\n${this.pbrUniformDefinition}\n\n${this.pbrMethodDefinition}\n\n\n${void 0!==e.getters?e.getters:""}\n\nvec3 IBLContribution(vec3 n, float NV, vec3 reflection, vec3 albedo, vec3 F0, float userRoughness, vec3 F)\n{\n  vec4 iblParameter = get_iblParameter(u_materialSID, 0);\n  float mipCount = iblParameter.x;\n  float lod = (userRoughness * mipCount);\n\n  vec4 diffuseTexel = ${a}(u_diffuseEnvTexture, vec3(-n.x, n.y, n.z));\n  vec3 diffuseLight;\n  diffuseLight = srgbToLinear(diffuseTexel.rgb);\n\n  ${o}\n\n  vec3 specularLight;\n  specularLight = srgbToLinear(specularTexel.rgb);\n\n  vec3 kS = fresnelSchlickRoughness(F0, NV, userRoughness);\n  vec3 kD = 1.0 - kS;\n  vec3 diffuse = diffuseLight * albedo * kD;\n  // vec3 brdf = ${r}(u_brdfLutTexture, vec2(NV, 1.0 - userRoughness)).rgb;\n  // vec3 specular = specularLight * (F0 * brdf.x + brdf.y);\n  vec3 specular = specularLight * envBRDFApprox(F0, userRoughness, NV);\n\n  float IBLDiffuseContribution = iblParameter.y;\n  float IBLSpecularContribution = iblParameter.z;\n  diffuse *= IBLDiffuseContribution;\n  specular *= IBLSpecularContribution;\n  return diffuse + specular;\n}\n\nfloat edge_ratio(vec3 bary3, float wireframeWidthInner, float wireframeWidthRelativeScale) {\n  vec3 d = fwidth(bary3);\n  vec3 x = bary3+vec3(1.0 - wireframeWidthInner)*d;\n  vec3 a3 = smoothstep(vec3(0.0), d, x);\n  float factor = min(min(a3.x, a3.y), a3.z);\n\n  return clamp((1.0 - factor), 0.0, 1.0);\n}\n\nvoid main ()\n{\n\n  // Normal\n  vec3 normal_inWorld = normalize(v_normal_inWorld);\n  vec4 iblParameter = get_iblParameter(u_materialSID, 0);\n  float rot = iblParameter.w + 3.1415;\n  mat3 rotEnvMatrix = mat3(cos(rot), 0.0, -sin(rot), 0.0, 1.0, 0.0, sin(rot), 0.0, cos(rot));\n  vec3 normal_forEnv = rotEnvMatrix * normal_inWorld;\n\n  if (abs(length(v_tangent_inWorld)) > 0.01) {\n    vec3 normal = ${r}(u_normalTexture, v_texcoord).xyz*2.0 - 1.0;\n      vec3 tangent_inWorld = normalize(v_tangent_inWorld);\n      vec3 binormal_inWorld = normalize(v_binormal_inWorld);\n      normal_inWorld = normalize(normal_inWorld);\n\n      mat3 tbnMat_tangent_to_world = mat3(\n        tangent_inWorld.x, tangent_inWorld.y, tangent_inWorld.z,\n        binormal_inWorld.x, binormal_inWorld.y, binormal_inWorld.z,\n        normal_inWorld.x, normal_inWorld.y, normal_inWorld.z\n      );\n\n      normal = normalize(tbnMat_tangent_to_world * normal);\n      normal_inWorld = normal;\n  }\n\n\n\n  // BaseColorFactor\n  vec3 baseColor = vec3(0.0, 0.0, 0.0);\n  float alpha = 1.0;\n  vec4 baseColorFactor = get_baseColorFactor(u_materialSID, 0);\n  if (v_color != baseColor && baseColorFactor.rgb != baseColor) {\n    baseColor = v_color * baseColorFactor.rgb;\n    alpha = baseColorFactor.a;\n  } else if (v_color == baseColor) {\n    baseColor = baseColorFactor.rgb;\n    alpha = baseColorFactor.a;\n  } else if (baseColorFactor.rgb == baseColor) {\n    baseColor = v_color;\n  } else {\n    baseColor = vec3(1.0, 1.0, 1.0);\n  }\n\n\n  // BaseColor (take account for BaseColorTexture)\n  vec4 textureColor = ${r}(u_baseColorTexture, v_texcoord);\n  // if (length(textureColor) > 0.01) {\n    baseColor *= srgbToLinear(textureColor.rgb);\n    alpha *= textureColor.a;\n  // }\n\n  // Metallic & Roughness\n  vec2 metallicRoughnessFactor = get_metallicRoughnessFactor(u_materialSID, 0);\n  float userRoughness = metallicRoughnessFactor.y;\n  float metallic = metallicRoughnessFactor.x;\n\n  vec4 ormTexel = ${r}(u_metallicRoughnessTexture, v_texcoord);\n  userRoughness = ormTexel.g * userRoughness;\n  metallic = ormTexel.b * metallic;\n\n  userRoughness = clamp(userRoughness, c_MinRoughness, 1.0);\n  metallic = clamp(metallic, 0.0, 1.0);\n  float alphaRoughness = userRoughness * userRoughness;\n\n  // F0\n  vec3 diffuseMatAverageF0 = vec3(0.04);\n  vec3 F0 = mix(diffuseMatAverageF0, baseColor.rgb, metallic);\n\n  // Albedo\n  vec3 albedo = baseColor.rgb * (vec3(1.0) - diffuseMatAverageF0);\n  albedo.rgb *= (1.0 - metallic);\n\n  // ViewDirection\n  vec3 viewPosition = get_viewPosition(u_materialSID, 0);\n  vec3 viewDirection = normalize(viewPosition - v_position_inWorld.xyz);\n\n  // NV\n  float NV = clamp(abs(dot(normal_inWorld, viewDirection)), 0.0, 1.0);\n\n  rt0 = vec4(0.0, 0.0, 0.0, alpha);\n\n  // Lighting\n  if (length(normal_inWorld) > 0.02) {\n    vec3 diffuse = vec3(0.0, 0.0, 0.0);\n    int lightNumber = get_lightNumber(0.0, 0);\n    for (int i = 0; i < ${V.a.maxLightNumberInShader}; i++) {\n      if (i >= lightNumber) {\n        break;\n      }\n\n      // Light\n      vec4 gotLightDirection = get_lightDirection(0.0, i);\n      vec4 gotLightPosition = get_lightPosition(0.0, i);\n      vec4 gotLightIntensity = get_lightIntensity(0.0, i);\n      vec3 lightDirection = gotLightDirection.xyz;\n      vec3 lightIntensity = gotLightIntensity.xyz;\n      vec3 lightPosition = gotLightPosition.xyz;\n      float lightType = gotLightPosition.w;\n      float spotCosCutoff = gotLightDirection.w;\n      float spotExponent = gotLightIntensity.w;\n\n      if (0.75 < lightType) { // is pointlight or spotlight\n        lightDirection = normalize(lightPosition.xyz - v_position_inWorld.xyz);\n      }\n      float spotEffect = 1.0;\n      if (lightType > 1.75) { // is spotlight\n        spotEffect = dot(lightDirection.xyz, lightDirection);\n        if (spotEffect > spotCosCutoff) {\n          spotEffect = pow(spotEffect, spotExponent);\n        } else {\n          spotEffect = 0.0;\n        }\n      }\n      //diffuse += 1.0 * max(0.0, dot(normal_inWorld, lightDirection)) * spotEffect * lightIntensity.xyz;\n\n      // IncidentLight\n      vec3 incidentLight = spotEffect * lightIntensity.xyz;\n      incidentLight *= M_PI;\n\n      // Fresnel\n      vec3 halfVector = normalize(lightDirection + viewDirection);\n      float VH = clamp(dot(viewDirection, halfVector), 0.0, 1.0);\n      vec3 F = fresnel(F0, VH);\n\n      // Diffuse\n      vec3 diffuseContrib = (vec3(1.0) - F) * diffuse_brdf(albedo);\n\n      // Specular\n      float NL = clamp(dot(normal_inWorld, lightDirection), 0.0, 1.0);\n      float NH = clamp(dot(normal_inWorld, halfVector), 0.0, 1.0);\n      vec3 specularContrib = cook_torrance_specular_brdf(NH, NL, NV, F, alphaRoughness);\n      vec3 diffuseAndSpecular = (diffuseContrib + specularContrib) * vec3(NL) * incidentLight.rgb;\n\n      rt0.xyz += diffuseAndSpecular;\n//      rt0.xyz += specularContrib * vec3(NL) * incidentLight.rgb;\n  //    rt0.xyz += diffuseContrib * vec3(NL) * incidentLight.rgb;\n  //    rt0.xyz += (vec3(1.0) - F) * diffuse_brdf(albedo);//diffuseContrib;//vec3(NL) * incidentLight.rgb;\n    }\n\n    vec3 reflection = rotEnvMatrix * reflect(-viewDirection, normal_inWorld);\n\n    vec3 F = fresnel(F0, NV);\n    vec3 ibl = IBLContribution(normal_forEnv, NV, reflection, albedo, F0, userRoughness, F);\n    float occlusion = ${r}(u_occlusionTexture, v_texcoord).r;\n\n    // Occlution to Indirect Lights\n    rt0.xyz += ibl * occlusion;\n\n  } else {\n    rt0 = vec4(baseColor, alpha);\n  }\n\n  // Emissive\n  vec3 emissive = srgbToLinear(${r}(u_emissiveTexture, v_texcoord).xyz);\n\n  rt0.xyz += emissive;\n\n\n  // Wireframe\n  float threshold = 0.001;\n  vec3 wireframe = get_wireframe(u_materialSID, 0);\n  float wireframeWidthInner = wireframe.z;\n  float wireframeWidthRelativeScale = 1.0;\n  if (wireframe.x > 0.5 && wireframe.y < 0.5) {\n    rt0.a = 0.0;\n  }\n  vec4 wireframeResult = rt0;\n  vec4 wireframeColor = vec4(0.2, 0.75, 0.0, 1.0);\n  float edgeRatio = edge_ratio(v_baryCentricCoord, wireframeWidthInner, wireframeWidthRelativeScale);\n  float edgeRatioModified = mix(step(threshold, edgeRatio), clamp(edgeRatio*4.0, 0.0, 1.0), wireframeWidthInner / wireframeWidthRelativeScale/4.0);\n  // if r0.a is 0.0, it is wireframe not on shaded\n  wireframeResult.rgb = wireframeColor.rgb * edgeRatioModified + rt0.rgb * (1.0 - edgeRatioModified);\n  wireframeResult.a = max(rt0.a, wireframeColor.a * mix(edgeRatioModified, pow(edgeRatioModified, 100.0), wireframeWidthInner / wireframeWidthRelativeScale/1.0));\n\n  if (wireframe.x > 0.5) {\n    rt0 = wireframeResult;\n    if (wireframe.y < 0.5 && rt0.a == 0.0) {\n      discard;\n    }\n  }\n\n  ${s}\n}\n`}get pixelShaderDefinitions(){return""}getPixelShaderBody(e){return this.getFragmentShader(e)}get attributeCompositions(){return[S.a.Vec3,S.a.Vec3,S.a.Vec3,S.a.Vec3,S.a.Vec2,S.a.Vec3,S.a.Vec4,S.a.Vec4,S.a.Vec4,S.a.Scalar]}}U.materialElement=B.a.PBRShading;var O=n(5),z=n(7),G=n(14),X=n(44),k=n(19),W=n(27),Y=n(30),$=n(18),j=n(13),Q=n(15),q=n(41),H=n(21),Z=n(12),J=n(45);class K extends W.a{constructor(e,t,n){super(e,t,n),this._jointIndices=[],this.__joints=[],this._inverseBindMatrices=[],this.isSkinning=!0,this.isOptimizingMode=!0,this.__boneCompressedInfo=H.a.zero(),this.__qArray=new Float32Array(0),this.__tArray=new Float32Array(0)}static get componentTID(){return Y.a.SkeletalComponentTID}set joints(e){this.__joints=e,this.__qArray=new Float32Array(4*this.__joints.length),this.__tArray=new Float32Array(4*this.__joints.length)}$create(){this.moveStageTo(j.a.Load)}$load(){for(let e=0;e<this.__joints.length;e++){let t=void 0!==this._inverseBindMatrices[e]?this._inverseBindMatrices[e]:$.a.identity();this.__joints[e]._inverseBindMatrix=t,this.__joints[e]._bindMatrix=$.a.invert(t)}const e=t=>{let n=t.parent,i=[];if(n){let t=e(n);Array.isArray(t)&&Array.prototype.push.apply(i,t);for(let e of this._jointIndices)if(n.jointIndex===e)return i.push(n),i;return i}return null};let t=null;for(let n=0;n<this.__joints.length;n++)null!=(t=e(this.__joints[n]))&&(t.push(this.__joints[n]),this.__joints[n]._jointsOfHierarchies=t);this.moveStageTo(j.a.Logic)}$logic({processApproach:e}){const t=this.entity.getComponent(o.a),n=t.mesh.getPrimitiveNumber();if(this.isSkinning){for(let e=0;e<this.__joints.length;e++){const t=this.__joints[e];let n=null,i=t._inverseBindMatrix;n=t.worldMatrixInner,K.__tmp_mat4.identity(),Z.a.multiplyTo(K.__tmp_mat4,n,K.__tmp2_mat4),Z.a.multiplyTo(K.__tmp2_mat4,i,K.__tmp_mat4),this._bindShapeMatrix&&(Z.a.multiplyTo(K.__tmp_mat4,this._bindShapeMatrix,K.__tmp2_mat4),K.__tmp_mat4.copyComponents(K.__tmp2_mat4));let s=K.__tmp_mat4;K.__scaleVec3.x=Math.sqrt(s.m00*s.m00+s.m01*s.m01+s.m02*s.m02),K.__scaleVec3.y=Math.sqrt(s.m10*s.m10+s.m11*s.m11+s.m12*s.m12),K.__scaleVec3.z=Math.sqrt(s.m20*s.m20+s.m21*s.m21+s.m22*s.m22),s.m00/=K.__scaleVec3.x,s.m01/=K.__scaleVec3.x,s.m02/=K.__scaleVec3.x,s.m10/=K.__scaleVec3.y,s.m11/=K.__scaleVec3.y,s.m12/=K.__scaleVec3.y,s.m20/=K.__scaleVec3.z,s.m21/=K.__scaleVec3.z,s.m22/=K.__scaleVec3.z;let r=q.a.fromMatrix(s);this.__qArray[4*e+0]=r.x,this.__qArray[4*e+1]=r.y,this.__qArray[4*e+2]=r.z,this.__qArray[4*e+3]=r.w;const a=s.getTranslate();this.__tArray[4*e+0]=a.x,this.__tArray[4*e+1]=a.y,this.__tArray[4*e+2]=a.z,this.__tArray[4*e+3]=Math.max(K.__scaleVec3.x,K.__scaleVec3.y,K.__scaleVec3.z)}if(e===J.a.FastestWebGL1)for(let e=0;e<n;e++){const n=t.mesh.getPrimitiveAt(e);n.material.setParameter(C.a.SkinningMode,1),n.material.setParameter(C.a.BoneQuaternion,this.__qArray),n.material.setParameter(C.a.BoneTranslateScale,this.__tArray)}}else if(e===J.a.FastestWebGL1)for(let e=0;e<n;e++){t.mesh.getPrimitiveAt(e).material.setParameter(C.a.SkinningMode,0)}}get jointMatrices(){return this.__jointMatrices}get jointQuaternionArray(){return this.__qArray}get jointTranslateScaleArray(){return this.__tArray}get jointCompressedInfo(){return this.__boneCompressedInfo}}K.__scaleVec3=Q.a.zero(),K.__tmp_mat4=Z.a.identity(),K.__tmp2_mat4=Z.a.identity(),s.a.registerComponentClass(K);var ee=n(36);class te extends W.a{constructor(e,t,n){super(e,t,n),this.__weights=[],this._dummy=R.b.dummy(),this.registerMember(I.a.CPUGeneric,"dummy",R.b,T.a.Float,[0,0,0]),this.submitToAllocation(this.maxNumberOfComponent),this.moveStageTo(j.a.Logic)}static get componentTID(){return Y.a.BlendShapeComponentTID}$logic(){}set weights(e){this.__weights=e}get weights(){return this.__weights}}s.a.registerComponentClass(te);var ne=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function a(e){try{h(i.next(e))}catch(e){r(e)}}function o(e){try{h(i.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(a,o)}h((i=i.apply(e,t||[])).next())})};class ie extends P.a{constructor({isMorphing:e,isSkinning:t,isLighting:n}){super(U.getInstance(),"pbrShading"+(e?"+morphing":"")+(t?"+skinning":"")+(n?"":"-lighting"),{isMorphing:e,isSkinning:t,isLighting:n}),ie.initDefaultTextures();let i=[{semantic:C.a.BaseColorFactor,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.PixelShader,min:0,max:2,isSystem:!1,initialValue:new L.b(1,1,1,1)},{semantic:C.a.BaseColorTexture,compositionType:S.a.Texture2D,componentType:T.a.Int,stage:O.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,initialValue:[0,P.a.__dummyWhiteTexture]},{semantic:C.a.MetallicRoughnessFactor,compositionType:S.a.Vec2,componentType:T.a.Float,stage:O.a.PixelShader,min:0,max:2,isSystem:!1,initialValue:new M.b(1,1)},{semantic:C.a.MetallicRoughnessTexture,compositionType:S.a.Texture2D,componentType:T.a.Int,stage:O.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,initialValue:[1,P.a.__dummyWhiteTexture]},{semantic:C.a.NormalTexture,compositionType:S.a.Texture2D,componentType:T.a.Int,stage:O.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,initialValue:[2,P.a.__dummyBlueTexture]},{semantic:C.a.OcclusionTexture,compositionType:S.a.Texture2D,componentType:T.a.Int,stage:O.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,initialValue:[3,P.a.__dummyWhiteTexture]},{semantic:C.a.EmissiveTexture,compositionType:S.a.Texture2D,componentType:T.a.Int,stage:O.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,initialValue:[4,P.a.__dummyBlackTexture]},{semantic:C.a.Wireframe,compositionType:S.a.Vec3,componentType:T.a.Float,stage:O.a.PixelShader,min:0,max:10,isSystem:!1,initialValue:new R.b(0,0,1)},{semantic:ie.isOutputHDR,compositionType:S.a.Scalar,componentType:T.a.Bool,stage:O.a.PixelShader,min:0,max:1,isSystem:!1,initialValue:new k.b(0)},{semantic:C.a.ViewPosition,compositionType:S.a.Vec3,componentType:T.a.Float,stage:O.a.VertexAndPixelShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.FirstTimeOnly,initialValue:new R.b(0,0,0),soloDatum:!0},{semantic:C.a.IBLParameter,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.PixelShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,initialValue:new L.b(1,1,1,1),updateInteval:z.a.EveryTime},{semantic:C.a.HDRIFormat,compositionType:S.a.Vec2,componentType:T.a.Int,stage:O.a.PixelShader,min:0,max:5,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:new M.b(0,0)},{semantic:C.a.LightNumber,compositionType:S.a.Scalar,componentType:T.a.Int,stage:O.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInteval:z.a.FirstTimeOnly,initialValue:new k.b(0),soloDatum:!0},{semantic:C.a.DiffuseEnvTexture,compositionType:S.a.TextureCube,componentType:T.a.Int,stage:O.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:[5,P.a.__dummyWhiteTexture]},{semantic:C.a.SpecularEnvTexture,compositionType:S.a.TextureCube,componentType:T.a.Int,stage:O.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:[6,P.a.__dummyWhiteTexture]}];if(i.push({semantic:C.a.PointSize,compositionType:S.a.Scalar,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!0,initialValue:new k.b(100),min:0,max:100},{semantic:C.a.PointDistanceAttenuation,compositionType:S.a.Vec3,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!0,initialValue:new R.b(0,.1,.01),min:0,max:1}),n){this.__definitions+="#define RN_IS_LIGHTING\n";const e=[];for(let t=0;t<V.a.maxLightNumberInShader;t++)s=t,e.push({semantic:C.a.LightPosition,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.PixelShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,index:s,maxIndex:4,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:new L.b(0,0,0,1),soloDatum:!0}),e.push({semantic:C.a.LightDirection,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.PixelShader,min:-1,max:1,index:s,maxIndex:4,isSystem:!0,initialValue:new L.b(0,1,0,1),updateInteval:z.a.EveryTime,soloDatum:!0}),e.push({semantic:C.a.LightIntensity,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.PixelShader,min:0,max:10,index:s,maxIndex:4,isSystem:!0,initialValue:new L.b(1,1,1,1),updateInteval:z.a.EveryTime,soloDatum:!0});i=i.concat(e)}var s;t&&(this.__definitions+="#define RN_IS_SKINNING\n",i.push({semantic:C.a.BoneQuaternion,compositionType:S.a.Vec4Array,maxIndex:250,componentType:T.a.Float,stage:O.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.EveryTime,soloDatum:!0,initialValue:new ee.a(new Float32Array(0))}),i.push({semantic:C.a.BoneTranslateScale,compositionType:S.a.Vec4Array,maxIndex:250,componentType:T.a.Float,soloDatum:!0,stage:O.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:new ee.a(new Float32Array(0))}),i.push({semantic:C.a.SkinningMode,compositionType:S.a.Scalar,componentType:T.a.Int,stage:O.a.VertexShader,min:0,max:1,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:new k.b(0)})),e&&(this.__definitions+="#define RN_IS_MORPHING\n",i.push({semantic:C.a.MorphTargetNumber,compositionType:S.a.Scalar,componentType:T.a.Int,stage:O.a.VertexShader,min:0,max:V.a.maxVertexMorphNumberInShader,isSystem:!0,updateInteval:z.a.EveryTime,soloDatum:!0,initialValue:new k.b(0)}),i.push({semantic:C.a.DataTextureMorphOffsetPosition,compositionType:S.a.ScalarArray,maxIndex:V.a.maxVertexMorphNumberInShader,componentType:T.a.Float,soloDatum:!0,stage:O.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:new ee.a(new Float32Array(V.a.maxVertexMorphNumberInShader))}),i.push({semantic:C.a.MorphWeights,compositionType:S.a.ScalarArray,maxIndex:V.a.maxVertexMorphNumberInShader,componentType:T.a.Float,soloDatum:!0,stage:O.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:new ee.a(new Float32Array(V.a.maxVertexMorphNumberInShader))})),this.setShaderSemanticsInfoArray(i)}static initDefaultTextures(){return ne(this,void 0,void 0,function*(){})}convertValue(e,t){}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix));let r=i.renderPass.cameraComponent;null==r&&(r=s.a.getInstance().getComponent(G.a,G.a.main)),this.setViewInfo(t,r,e,i.setUniform),this.setProjection(t,r,e,i.setUniform);const a=i.entity.getComponent(K);if(this.setSkinning(t,a,i.setUniform),this.__webglResourceRepository.setUniformValue(t,C.a.DiffuseEnvTexture.str,n,[5,-1]),i.diffuseCube&&i.diffuseCube.isTextureReady){const e=this.__webglResourceRepository.getWebGLResource(i.diffuseCube.cgApiResourceUid);i.glw.bindTextureCube(5,e)}else{const e=this.__webglResourceRepository.getWebGLResource(P.a.__dummyBlackCubeTexture.cgApiResourceUid);i.glw.bindTextureCube(5,e)}if(this.__webglResourceRepository.setUniformValue(t,C.a.SpecularEnvTexture.str,n,[6,-1]),i.specularCube&&i.specularCube.isTextureReady){const e=this.__webglResourceRepository.getWebGLResource(i.specularCube.cgApiResourceUid);i.glw.bindTextureCube(6,e)}else{const e=this.__webglResourceRepository.getWebGLResource(P.a.__dummyBlackCubeTexture.cgApiResourceUid);i.glw.bindTextureCube(6,e)}let l=1;i.specularCube&&(l=i.specularCube.mipmapLevelNumber);const c=i.entity.getComponent(h.a);let u=X.a.LDR_SRGB.index,_=X.a.LDR_SRGB.index;if(c.diffuseCubeMap&&(u=c.diffuseCubeMap.hdriFormat.index),c.specularCubeMap&&(_=c.specularCubeMap.hdriFormat.index),i.setUniform)this.__webglResourceRepository.setUniformValue(t,C.a.IBLParameter.str,n,{x:l,y:c.diffuseCubeMapContribution,z:c.specularCubeMapContribution,w:c.rotationOfCubeMap}),this.__webglResourceRepository.setUniformValue(t,C.a.HDRIFormat.str,n,{x:u,y:_});else{const t=P.a.__tmp_vector4;t.x=l,t.y=c.diffuseCubeMapContribution,t.z=c.specularCubeMapContribution,t.w=c.rotationOfCubeMap,e.setParameter(C.a.IBLParameter,t);const n=P.a.__tmp_vector2;n.x=u,n.y=_,e.setParameter(C.a.HDRIFormat,n)}this.setLightsInfo(t,i.lightComponents,e,i.setUniform),P.a.setMorphInfo(t,i.entity.getComponent(o.a),i.entity.getComponent(te),i.primitive)}}ie.__pbrCookTorranceBrdfLutDataUrlUid=N.a.InvalidCGAPIResourceUid,ie.isOutputHDR=new C.b({str:"isOutputHDR"});var se=n(66);class re extends l.a{constructor({index:e,str:t}){super({index:e,str:t})}}const ae=new re({index:-1,str:"UNKNOWN"}),oe=new re({index:0,str:"CONSTANT"}),he=new re({index:1,str:"LAMBERT"}),le=new re({index:2,str:"BLINN"}),ce=new re({index:3,str:"PHONG"}),ue=[ae,oe,he,le,ce];const _e=Object.freeze({Unknown:ae,Constant:oe,Lambert:he,BlinnPhong:le,Phong:ce,from:function(e){return Object(l.b)({typeList:ue,index:e})}});var me=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function a(e){try{h(i.next(e))}catch(e){r(e)}}function o(e){try{h(i.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(a,o)}h((i=i.apply(e,t||[])).next())})};class de extends P.a{constructor({isSkinning:e,isLighting:t}){super(se.a.getInstance(),"classicShading"+(e?"+skinning":"")+(t?"":"-lighting"),{isMorphing:!1,isLighting:t,isSkinning:e}),de.initDefaultTextures();N.a.getWebGLResourceRepository();let n=[{semantic:C.a.DiffuseColorFactor,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.PixelShader,min:0,max:2,isSystem:!1,initialValue:new L.b(1,1,1,1)},{semantic:C.a.DiffuseColorTexture,compositionType:S.a.Texture2D,componentType:T.a.Int,stage:O.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,initialValue:[0,P.a.__dummyWhiteTexture]},{semantic:C.a.NormalTexture,compositionType:S.a.Texture2D,componentType:T.a.Int,stage:O.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,initialValue:[2,P.a.__dummyBlueTexture]},{semantic:C.a.Shininess,compositionType:S.a.Scalar,componentType:T.a.Float,stage:O.a.PixelShader,min:0,max:Number.MAX_VALUE,isSystem:!1,initialValue:new k.b(5)},{semantic:C.a.ShadingModel,compositionType:S.a.Scalar,componentType:T.a.Int,stage:O.a.PixelShader,min:0,max:3,isSystem:!1,initialValue:new k.b(_e.Constant.index)},{semantic:C.a.LightNumber,compositionType:S.a.Scalar,componentType:T.a.Int,stage:O.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInteval:z.a.FirstTimeOnly,initialValue:new k.b(0),soloDatum:!0},{semantic:C.a.ViewPosition,compositionType:S.a.Vec3,componentType:T.a.Float,stage:O.a.VertexAndPixelShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.FirstTimeOnly,initialValue:new R.b(0,0,0),soloDatum:!0},{semantic:C.a.PointSize,compositionType:S.a.Scalar,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!0,initialValue:new k.b(30),min:0,max:100},{semantic:C.a.PointDistanceAttenuation,compositionType:S.a.Vec3,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!0,initialValue:new R.b(0,.1,.01),min:0,max:1}];if(t){this.__definitions+="#define RN_IS_LIGHTING\n";const e=[];for(let t=0;t<V.a.maxLightNumberInShader;t++)i=t,e.push({semantic:C.a.LightPosition,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.PixelShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,index:i,maxIndex:4,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:new L.b(0,0,0,1),soloDatum:!0}),e.push({semantic:C.a.LightDirection,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.PixelShader,min:-1,max:1,index:i,maxIndex:4,isSystem:!0,initialValue:new L.b(0,1,0,1),updateInteval:z.a.EveryTime,soloDatum:!0}),e.push({semantic:C.a.LightIntensity,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.PixelShader,min:0,max:10,index:i,maxIndex:4,isSystem:!0,initialValue:new L.b(1,1,1,1),updateInteval:z.a.EveryTime,soloDatum:!0});n=n.concat(e)}var i;e&&(this.__definitions+="#define RN_IS_SKINNING\n",n.push({semantic:C.a.BoneQuaternion,compositionType:S.a.Vec4Array,maxIndex:250,componentType:T.a.Float,stage:O.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.EveryTime,soloDatum:!0,initialValue:new ee.a(new Float32Array(0))}),n.push({semantic:C.a.BoneTranslateScale,compositionType:S.a.Vec4Array,maxIndex:250,componentType:T.a.Float,soloDatum:!0,stage:O.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:new ee.a(new Float32Array(0))}),n.push({semantic:C.a.SkinningMode,compositionType:S.a.Scalar,componentType:T.a.Int,stage:O.a.VertexShader,min:0,max:1,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:new k.b(0)})),this.setShaderSemanticsInfoArray(n)}static initDefaultTextures(){return me(this,void 0,void 0,function*(){})}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix));let r=i.renderPass.cameraComponent;null==r&&(r=s.a.getInstance().getComponent(G.a,G.a.main)),this.setViewInfo(t,r,e,i.setUniform),this.setProjection(t,r,e,i.setUniform);const a=i.entity.getComponent(K);this.setSkinning(t,a,i.setUniform),this.setLightsInfo(t,i.lightComponents,e,i.setUniform)}}class fe extends D.a{constructor(){super(),this.vertexShaderBody="\n  ",this.attributeNames=["a_position","a_color","a_normal","a_texcoord","a_instanceID"],this.attributeSemantics=[b.a.Position,b.a.Color0,b.a.Normal,b.a.Texcoord0,b.a.Instance]}static getInstance(){return this.__instance||(this.__instance=new fe),this.__instance}get vertexShaderDefinitions(){return"\n"}getVertexShaderBody(e){const t=this.glsl_versionText,n=this.glsl_vertex_in,i=this.glsl_vertex_out;return`${t}\nprecision highp float;\n\n${void 0!==e.definitions?e.definitions:""}\n\n${this.prerequisites}\n\n${n} vec3 a_position;\n\n${void 0!==e.matricesGetters?e.matricesGetters:""}\n\n${n} vec3 a_color;\n${n} vec3 a_normal;\n${n} float a_instanceID;\n${n} vec2 a_texcoord;\n${n} vec4 a_joint;\n${n} vec4 a_weight;\n${i} vec3 v_color;\n${i} vec3 v_normal_inWorld;\n${i} vec3 v_position_inWorld;\n${i} vec2 v_texcoord;\n\n\n\n${this.toNormalMatrix}\n\nvoid main() {\n\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat4 viewMatrix = get_viewMatrix(a_instanceID);\n  mat4 projectionMatrix = get_projectionMatrix(a_instanceID);\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n\n  gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(a_position, 1.0);\n\n  v_color = a_color;\n  v_normal_inWorld = normalMatrix * a_normal;\n  v_position_inWorld = (worldMatrix * vec4(a_position, 1.0)).xyz;\n  v_texcoord = a_texcoord;\n}\n    `}getFragmentShader(e){const t=this.glsl_versionText,n=this.glsl_fragment_in,i=this.glsl_rt0,s=this.glsl_fragColor,r=(this.glsl_texture,this.glsl_textureCube);return`${t}\nprecision highp float;\n\n${this.prerequisites}\n\n${void 0!==e.getters?e.getters:""}\n\nvec3 linearToSrgb(vec3 linearColor) {\n  return pow(linearColor, vec3(1.0/2.2));\n}\n\n${n} vec3 v_color;\n${n} vec3 v_normal_inWorld;\n${n} vec3 v_position_inWorld;\n${n} vec2 v_texcoord;\n${i}\nvoid main ()\n{\n\n  // diffuseColor\n  vec3 diffuseColor = vec3(0.0, 0.0, 0.0);\n  float alpha = 1.0;\n  vec4 diffuseColorFactor = get_diffuseColorFactor(u_materialSID, 0);\n  if (v_color != diffuseColor && diffuseColorFactor.rgb != diffuseColor) {\n    diffuseColor = v_color * diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (v_color == diffuseColor) {\n    diffuseColor = diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (diffuseColorFactor.rgb == diffuseColor) {\n    diffuseColor = v_color;\n  } else {\n    diffuseColor = vec3(1.0, 1.0, 1.0);\n  }\n\n  // diffuseColorTexture\n\n  // adapt OpenGL (RenderMan) Cubemap convension\n  float envRotation = get_envRotation(u_materialSID, 0);\n  float rot = envRotation + 3.1415;\n  mat3 rotEnvMatrix = mat3(cos(rot), 0.0, -sin(rot), 0.0, 1.0, 0.0, sin(rot), 0.0, cos(rot));\n  vec3 envNormal = normalize(rotEnvMatrix * v_position_inWorld);\n  envNormal.x *= -1.0;\n\n  vec4 textureColor = ${r}(u_colorEnvTexture, envNormal);\n  diffuseColor *= textureColor.rgb;\n\n  rt0 = vec4(diffuseColor, alpha);\n\n  ${s}\n}\n`}get pixelShaderDefinitions(){return""}getPixelShaderBody(e){return this.getFragmentShader(e)}get attributeCompositions(){return[S.a.Vec3,S.a.Vec3,S.a.Vec3,S.a.Vec2,S.a.Scalar]}}fe.materialElement=B.a.ClassicShading;var pe=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function a(e){try{h(i.next(e))}catch(e){r(e)}}function o(e){try{h(i.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(a,o)}h((i=i.apply(e,t||[])).next())})};class ge extends P.a{constructor(){super(fe.getInstance(),"envConstantShading"),ge.initDefaultTextures();const e=[{semantic:C.a.DiffuseColorFactor,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.PixelShader,min:0,max:2,isSystem:!1,initialValue:new L.b(1,1,1,1)},{semantic:C.a.ColorEnvTexture,compositionType:S.a.TextureCube,componentType:T.a.Int,stage:O.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,initialValue:[0,P.a.__dummyBlackCubeTexture]},{semantic:ge.envRotation,compositionType:S.a.Scalar,componentType:T.a.Float,stage:O.a.PixelShader,min:-Math.PI,max:Math.PI,isSystem:!1,initialValue:new k.b(0)}];this.setShaderSemanticsInfoArray(e)}static initDefaultTextures(){return pe(this,void 0,void 0,function*(){})}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix));let r=i.renderPass.cameraComponent;null==r&&(r=s.a.getInstance().getComponent(G.a,G.a.main)),r&&(this.setViewInfo(t,r,e,i.setUniform),this.setProjection(t,r,e,i.setUniform))}}ge.envRotation=new C.b({str:"envRotation"});class ve extends D.a{constructor(){super(),this.vertexShaderBody=`\n  ${this.simpleMVPPosition}\n\n  v_texcoord = a_texcoord;\n  `,this.attributeNames=["a_position","a_texcoord","a_instanceID"],this.attributeSemantics=[b.a.Position,b.a.Texcoord0,b.a.Instance]}static getInstance(){return this.instance||(this.instance=new ve),this.instance}get vertexShaderDefinitions(){this.glsl_versionText;const e=this.glsl_vertex_in;return`\n${e} float a_instanceID;\n${e} vec3 a_position;\n${e} vec2 a_texcoord;\n${this.glsl_vertex_out} vec2 v_texcoord;\n`}getFragmentShader(e){const t=this.glsl_versionText,n=this.glsl_fragment_in,i=this.glsl_rt0,s=this.glsl_fragColor,r=this.glsl_texture;return`${t}precision highp float;\n\n${this.prerequisites}\n\n${void 0!==e.getters?e.getters:""}\n\n#define FXAA_PC 1\n#define FXAA_QUALITY_PRESET 12\n#define FXAA_GREEN_AS_LUMA 1\n#define FXAA_GLSL_100 1\n\n/*============================================================================\n                             INTEGRATION KNOBS\n============================================================================*/\n//\n// FXAA_PS3 and FXAA_360 choose the console algorithm (FXAA3 CONSOLE).\n// FXAA_360_OPT is a prototype for the new optimized 360 version.\n//\n// 1 = Use API.\n// 0 = Don't use API.\n//\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_PS3\n    #define FXAA_PS3 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_360\n    #define FXAA_360 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_360_OPT\n    #define FXAA_360_OPT 0\n#endif\n/*==========================================================================*/\n#ifndef FXAA_PC\n    //\n    // FXAA Quality\n    // The high quality PC algorithm.\n    //\n    #define FXAA_PC 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_PC_CONSOLE\n    //\n    // The console algorithm for PC is included\n    // for developers targeting really low spec machines.\n    // Likely better to just run FXAA_PC, and use a really low preset.\n    //\n    #define FXAA_PC_CONSOLE 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_GLSL_120\n    #define FXAA_GLSL_120 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_GLSL_130\n    #define FXAA_GLSL_130 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_HLSL_3\n    #define FXAA_HLSL_3 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_HLSL_4\n    #define FXAA_HLSL_4 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_HLSL_5\n    #define FXAA_HLSL_5 0\n#endif\n/*==========================================================================*/\n#ifndef FXAA_GREEN_AS_LUMA\n    //\n    // For those using non-linear color,\n    // and either not able to get luma in alpha, or not wanting to,\n    // this enables FXAA to run using green as a proxy for luma.\n    // So with this enabled, no need to pack luma in alpha.\n    //\n    // This will turn off AA on anything which lacks some amount of green.\n    // Pure red and blue or combination of only R and B, will get no AA.\n    //\n    // Might want to lower the settings for both,\n    //    fxaaConsoleEdgeThresholdMin\n    //    fxaaQualityEdgeThresholdMin\n    // In order to insure AA does not get turned off on colors \n    // which contain a minor amount of green.\n    //\n    // 1 = On.\n    // 0 = Off.\n    //\n    #define FXAA_GREEN_AS_LUMA 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_EARLY_EXIT\n    //\n    // Controls algorithm's early exit path.\n    // On PS3 turning this ON adds 2 cycles to the shader.\n    // On 360 turning this OFF adds 10ths of a millisecond to the shader.\n    // Turning this off on console will result in a more blurry image.\n    // So this defaults to on.\n    //\n    // 1 = On.\n    // 0 = Off.\n    //\n    #define FXAA_EARLY_EXIT 1\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_DISCARD\n    //\n    // Only valid for PC OpenGL currently.\n    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n    //\n    // 1 = Use discard on pixels which don't need AA.\n    //     For APIs which enable concurrent TEX+ROP from same surface.\n    // 0 = Return unchanged color on pixels which don't need AA.\n    //\n    #define FXAA_DISCARD 0\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_FAST_PIXEL_OFFSET\n    //\n    // Used for GLSL 120 only.\n    //\n    // 1 = GL API supports fast pixel offsets\n    // 0 = do not use fast pixel offsets\n    //\n    #ifdef GLEXT_gpu_shader4\n        #define FXAA_FAST_PIXEL_OFFSET 1\n    #endif\n    #ifdef GLNV_gpu_shader5\n        #define FXAA_FAST_PIXEL_OFFSET 1\n    #endif\n    #ifdef GLARB_gpu_shader5\n        #define FXAA_FAST_PIXEL_OFFSET 1\n    #endif\n    #ifndef FXAA_FAST_PIXEL_OFFSET\n        #define FXAA_FAST_PIXEL_OFFSET 0\n    #endif\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_GATHER4_ALPHA\n    //\n    // 1 = API supports gather4 on alpha channel.\n    // 0 = API does not support gather4 on alpha channel.\n    //\n    #if (FXAA_HLSL_5 == 1)\n        #define FXAA_GATHER4_ALPHA 1\n    #endif\n    #ifdef GLARB_gpu_shader5\n        #define FXAA_GATHER4_ALPHA 1\n    #endif\n    #ifdef GLNV_gpu_shader5\n        #define FXAA_GATHER4_ALPHA 1\n    #endif\n    #ifndef FXAA_GATHER4_ALPHA\n        #define FXAA_GATHER4_ALPHA 0\n    #endif\n#endif\n\n/*============================================================================\n                      FXAA CONSOLE PS3 - TUNING KNOBS\n============================================================================*/\n#ifndef FXAA_CONSOLEPS3_EDGE_SHARPNESS\n    //\n    // Consoles the sharpness of edges on PS3 only.\n    // Non-PS3 tuning is done with shader input.\n    //\n    // Due to the PS3 being ALU bound,\n    // there are only two safe values here: 4 and 8.\n    // These options use the shaders ability to a free *|/ by 2|4|8.\n    //\n    // 8.0 is sharper\n    // 4.0 is softer\n    // 2.0 is really soft (good for vector graphics inputs)\n    //\n    #if 1\n        #define FXAA_CONSOLEPS3_EDGE_SHARPNESS 8.0\n    #endif\n    #if 0\n        #define FXAA_CONSOLEPS3_EDGE_SHARPNESS 4.0\n    #endif\n    #if 0\n        #define FXAA_CONSOLEPS3_EDGE_SHARPNESS 2.0\n    #endif\n#endif\n/*--------------------------------------------------------------------------*/\n#ifndef FXAA_CONSOLEPS3_EDGE_THRESHOLD\n    //\n    // Only effects PS3.\n    // Non-PS3 tuning is done with shader input.\n    //\n    // The minimum amount of local contrast required to apply algorithm.\n    // The console setting has a different mapping than the quality setting.\n    //\n    // This only applies when FXAA_EARLY_EXIT is 1.\n    //\n    // Due to the PS3 being ALU bound,\n    // there are only two safe values here: 0.25 and 0.125.\n    // These options use the shaders ability to a free *|/ by 2|4|8.\n    //\n    // 0.125 leaves less aliasing, but is softer\n    // 0.25 leaves more aliasing, and is sharper\n    //\n    #if 1\n        #define FXAA_CONSOLEPS3_EDGE_THRESHOLD 0.125\n    #else\n        #define FXAA_CONSOLEPS3_EDGE_THRESHOLD 0.25\n    #endif\n#endif\n\n/*============================================================================\n                        FXAA QUALITY - TUNING KNOBS\n------------------------------------------------------------------------------\nNOTE the other tuning knobs are now in the shader function inputs!\n============================================================================*/\n#ifndef FXAA_QUALITYPRESET\n    //\n    // Choose the quality preset.\n    // This needs to be compiled into the shader as it effects code.\n    // Best option to include multiple presets is to \n    // in each shader define the preset, then include this file.\n    // \n    // OPTIONS\n    // -----------------------------------------------------------------------\n    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n    // 39       - no dither, very expensive \n    //\n    // NOTES\n    // -----------------------------------------------------------------------\n    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n    // 13 = about same speed as FXAA 3.9 and better than 12\n    // 23 = closest to FXAA 3.9 visually and performance wise\n    //  _ = the lowest digit is directly related to performance\n    // _  = the highest digit is directly related to style\n    // \n    #define FXAA_QUALITYPRESET 12\n#endif\n\n\n/*============================================================================\n                           FXAA QUALITY - PRESETS\n============================================================================*/\n\n/*============================================================================\n                     FXAA QUALITY - MEDIUM DITHER PRESETS\n============================================================================*/\n#if (FXAA_QUALITYPRESET == 10)\n    #define FXAA_QUALITYPS 3\n    #define FXAA_QUALITYP0 1.5\n    #define FXAA_QUALITYP1 3.0\n    #define FXAA_QUALITYP2 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 11)\n    #define FXAA_QUALITYPS 4\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.5\n    #define FXAA_QUALITYP2 3.0\n    #define FXAA_QUALITYP3 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 12)\n    #define FXAA_QUALITYPS 5\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.5\n    #define FXAA_QUALITYP2 2.0\n    #define FXAA_QUALITYP3 4.0\n    #define FXAA_QUALITYP4 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 13)\n    #define FXAA_QUALITYPS 6\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.5\n    #define FXAA_QUALITYP2 2.0\n    #define FXAA_QUALITYP3 2.0\n    #define FXAA_QUALITYP4 4.0\n    #define FXAA_QUALITYP5 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 14)\n    #define FXAA_QUALITYPS 7\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.5\n    #define FXAA_QUALITYP2 2.0\n    #define FXAA_QUALITYP3 2.0\n    #define FXAA_QUALITYP4 2.0\n    #define FXAA_QUALITYP5 4.0\n    #define FXAA_QUALITYP6 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 15)\n    #define FXAA_QUALITYPS 8\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.5\n    #define FXAA_QUALITYP2 2.0\n    #define FXAA_QUALITYP3 2.0\n    #define FXAA_QUALITYP4 2.0\n    #define FXAA_QUALITYP5 2.0\n    #define FXAA_QUALITYP6 4.0\n    #define FXAA_QUALITYP7 12.0\n#endif\n\n/*============================================================================\n                     FXAA QUALITY - LOW DITHER PRESETS\n============================================================================*/\n#if (FXAA_QUALITYPRESET == 20)\n    #define FXAA_QUALITYPS 3\n    #define FXAA_QUALITYP0 1.5\n    #define FXAA_QUALITYP1 2.0\n    #define FXAA_QUALITYP2 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 21)\n    #define FXAA_QUALITYPS 4\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.5\n    #define FXAA_QUALITYP2 2.0\n    #define FXAA_QUALITYP3 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 22)\n    #define FXAA_QUALITYPS 5\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.5\n    #define FXAA_QUALITYP2 2.0\n    #define FXAA_QUALITYP3 2.0\n    #define FXAA_QUALITYP4 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 23)\n    #define FXAA_QUALITYPS 6\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.5\n    #define FXAA_QUALITYP2 2.0\n    #define FXAA_QUALITYP3 2.0\n    #define FXAA_QUALITYP4 2.0\n    #define FXAA_QUALITYP5 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 24)\n    #define FXAA_QUALITYPS 7\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.5\n    #define FXAA_QUALITYP2 2.0\n    #define FXAA_QUALITYP3 2.0\n    #define FXAA_QUALITYP4 2.0\n    #define FXAA_QUALITYP5 3.0\n    #define FXAA_QUALITYP6 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 25)\n    #define FXAA_QUALITYPS 8\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.5\n    #define FXAA_QUALITYP2 2.0\n    #define FXAA_QUALITYP3 2.0\n    #define FXAA_QUALITYP4 2.0\n    #define FXAA_QUALITYP5 2.0\n    #define FXAA_QUALITYP6 4.0\n    #define FXAA_QUALITYP7 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 26)\n    #define FXAA_QUALITYPS 9\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.5\n    #define FXAA_QUALITYP2 2.0\n    #define FXAA_QUALITYP3 2.0\n    #define FXAA_QUALITYP4 2.0\n    #define FXAA_QUALITYP5 2.0\n    #define FXAA_QUALITYP6 2.0\n    #define FXAA_QUALITYP7 4.0\n    #define FXAA_QUALITYP8 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 27)\n    #define FXAA_QUALITYPS 10\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.5\n    #define FXAA_QUALITYP2 2.0\n    #define FXAA_QUALITYP3 2.0\n    #define FXAA_QUALITYP4 2.0\n    #define FXAA_QUALITYP5 2.0\n    #define FXAA_QUALITYP6 2.0\n    #define FXAA_QUALITYP7 2.0\n    #define FXAA_QUALITYP8 4.0\n    #define FXAA_QUALITYP9 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 28)\n    #define FXAA_QUALITYPS 11\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.5\n    #define FXAA_QUALITYP2 2.0\n    #define FXAA_QUALITYP3 2.0\n    #define FXAA_QUALITYP4 2.0\n    #define FXAA_QUALITYP5 2.0\n    #define FXAA_QUALITYP6 2.0\n    #define FXAA_QUALITYP7 2.0\n    #define FXAA_QUALITYP8 2.0\n    #define FXAA_QUALITYP9 4.0\n    #define FXAA_QUALITYP10 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 29)\n    #define FXAA_QUALITYPS 12\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.5\n    #define FXAA_QUALITYP2 2.0\n    #define FXAA_QUALITYP3 2.0\n    #define FXAA_QUALITYP4 2.0\n    #define FXAA_QUALITYP5 2.0\n    #define FXAA_QUALITYP6 2.0\n    #define FXAA_QUALITYP7 2.0\n    #define FXAA_QUALITYP8 2.0\n    #define FXAA_QUALITYP9 2.0\n    #define FXAA_QUALITYP10 4.0\n    #define FXAA_QUALITYP11 8.0\n#endif\n\n/*============================================================================\n                     FXAA QUALITY - EXTREME QUALITY\n============================================================================*/\n#if (FXAA_QUALITYPRESET == 39)\n    #define FXAA_QUALITYPS 12\n    #define FXAA_QUALITYP0 1.0\n    #define FXAA_QUALITYP1 1.0\n    #define FXAA_QUALITYP2 1.0\n    #define FXAA_QUALITYP3 1.0\n    #define FXAA_QUALITYP4 1.0\n    #define FXAA_QUALITYP5 1.5\n    #define FXAA_QUALITYP6 2.0\n    #define FXAA_QUALITYP7 2.0\n    #define FXAA_QUALITYP8 2.0\n    #define FXAA_QUALITYP9 2.0\n    #define FXAA_QUALITYP10 4.0\n    #define FXAA_QUALITYP11 8.0\n#endif\n\n\n\n/*============================================================================\n                                API PORTING\n============================================================================*/\n#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n    #define FxaaBool bool\n    #define FxaaDiscard discard\n    #define FxaaFloat float\n    #define FxaaFloat2 vec2\n    #define FxaaFloat3 vec3\n    #define FxaaFloat4 vec4\n    #define FxaaHalf float\n    #define FxaaHalf2 vec2\n    #define FxaaHalf3 vec3\n    #define FxaaHalf4 vec4\n    #define FxaaInt2 ivec2\n    #define FxaaSat(x) clamp(x, 0.0, 1.0)\n    #define FxaaTex sampler2D\n#else\n    #define FxaaBool bool\n    #define FxaaDiscard clip(-1)\n    #define FxaaFloat float\n    #define FxaaFloat2 float2\n    #define FxaaFloat3 float3\n    #define FxaaFloat4 float4\n    #define FxaaHalf half\n    #define FxaaHalf2 half2\n    #define FxaaHalf3 half3\n    #define FxaaHalf4 half4\n    #define FxaaSat(x) saturate(x)\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_GLSL_100 == 1)\n    #define FxaaTexTop(t, p) ${r}(t, p, 0.0)\n    #define FxaaTexOff(t, p, o, r) ${r}(t, p + (o * r), 0.0)\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_GLSL_120 == 1)\n    // Requires,\n    //  #version 120\n    // And at least,\n    //  #extension GLEXT_gpu_shader4 : enable\n    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\n    #define FxaaTexTop(t, p) ${r}Lod(t, p, 0.0)\n    #if (FXAA_FAST_PIXEL_OFFSET == 1)\n        #define FxaaTexOff(t, p, o, r) ${r}LodOffset(t, p, 0.0, o)\n    #else\n        #define FxaaTexOff(t, p, o, r) ${r}Lod(t, p + (o * r), 0.0)\n    #endif\n    #if (FXAA_GATHER4_ALPHA == 1)\n        // use #extension GLARB_gpu_shader5 : enable\n        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n    #endif\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_GLSL_130 == 1)\n    // Requires "#version 130" or better\n    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n    #if (FXAA_GATHER4_ALPHA == 1)\n        // use #extension GLARB_gpu_shader5 : enable\n        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n    #endif\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_HLSL_3 == 1) || (FXAA_360 == 1) || (FXAA_PS3 == 1)\n    #define FxaaInt2 float2\n    #define FxaaTex sampler2D\n    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_HLSL_4 == 1)\n    #define FxaaInt2 int2\n    struct FxaaTex { SamplerState smpl; ${r} tex; };\n    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_HLSL_5 == 1)\n    #define FxaaInt2 int2\n    struct FxaaTex { SamplerState smpl; ${r} tex; };\n    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n#endif\n\n\n/*============================================================================\n                   GREEN AS LUMA OPTION SUPPORT FUNCTION\n============================================================================*/\n#if (FXAA_GREEN_AS_LUMA == 0)\n    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n#else\n    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n#endif    \n\n\n\n\n/*============================================================================\n                             FXAA3 QUALITY - PC\n============================================================================*/\n#if (FXAA_PC == 1)\n/*--------------------------------------------------------------------------*/\nFxaaFloat4 FxaaPixelShader(\n    //\n    // Use noperspective interpolation here (turn off perspective interpolation).\n    // {xy} = center of pixel\n    FxaaFloat2 pos,\n    //\n    // Used only for FXAA Console, and not used on the 360 version.\n    // Use noperspective interpolation here (turn off perspective interpolation).\n    // {xy} = upper left of pixel\n    // {zw} = lower right of pixel\n    FxaaFloat4 fxaaConsolePosPos,\n    //\n    // Input color texture.\n    // {rgb_} = color in linear or perceptual color space\n    // if (FXAA_GREEN_AS_LUMA == 0)\n    //     {_a} = luma in perceptual color space (not linear)\n    FxaaTex tex,\n    //\n    // Only used on the optimized 360 version of FXAA Console.\n    // For everything but 360, just use the same input here as for "tex".\n    // For 360, same texture, just alias with a 2nd sampler.\n    // This sampler needs to have an exponent bias of -1.\n    FxaaTex fxaaConsole360TexExpBiasNegOne,\n    //\n    // Only used on the optimized 360 version of FXAA Console.\n    // For everything but 360, just use the same input here as for "tex".\n    // For 360, same texture, just alias with a 3nd sampler.\n    // This sampler needs to have an exponent bias of -2.\n    FxaaTex fxaaConsole360TexExpBiasNegTwo,\n    //\n    // Only used on FXAA Quality.\n    // This must be from a constant/uniform.\n    // {x_} = 1.0/screenWidthInPixels\n    // {_y} = 1.0/screenHeightInPixels\n    FxaaFloat2 fxaaQualityRcpFrame,\n    //\n    // Only used on FXAA Console.\n    // This must be from a constant/uniform.\n    // This effects sub-pixel AA quality and inversely sharpness.\n    //   Where N ranges between,\n    //     N = 0.50 (default)\n    //     N = 0.33 (sharper)\n    // {x_} = -N/screenWidthInPixels  \n    // {_y} = -N/screenHeightInPixels\n    // {z_} =  N/screenWidthInPixels  \n    // {_w} =  N/screenHeightInPixels \n    FxaaFloat4 fxaaConsoleRcpFrameOpt,\n    //\n    // Only used on FXAA Console.\n    // Not used on 360, but used on PS3 and PC.\n    // This must be from a constant/uniform.\n    // {x_} = -2.0/screenWidthInPixels  \n    // {_y} = -2.0/screenHeightInPixels\n    // {z_} =  2.0/screenWidthInPixels  \n    // {_w} =  2.0/screenHeightInPixels \n    FxaaFloat4 fxaaConsoleRcpFrameOpt2,\n    //\n    // Only used on FXAA Console.\n    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\n    // This must be from a constant/uniform.\n    // {x_} =  8.0/screenWidthInPixels  \n    // {_y} =  8.0/screenHeightInPixels\n    // {z_} = -4.0/screenWidthInPixels  \n    // {_w} = -4.0/screenHeightInPixels \n    FxaaFloat4 fxaaConsole360RcpFrameOpt2,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITYSUBPIX define.\n    // It is here now to allow easier tuning.\n    // Choose the amount of sub-pixel aliasing removal.\n    // This can effect sharpness.\n    //   1.00 - upper limit (softer)\n    //   0.75 - default amount of filtering\n    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n    //   0.25 - almost off\n    //   0.00 - completely off\n    FxaaFloat fxaaQualitySubpix,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITYEDGE_THRESHOLD define.\n    // It is here now to allow easier tuning.\n    // The minimum amount of local contrast required to apply algorithm.\n    //   0.333 - too little (faster)\n    //   0.250 - low quality\n    //   0.166 - default\n    //   0.125 - high quality \n    //   0.063 - overkill (slower)\n    FxaaFloat fxaaQualityEdgeThreshold,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITYEDGE_THRESHOLD_MIN define.\n    // It is here now to allow easier tuning.\n    // Trims the algorithm from processing darks.\n    //   0.0833 - upper limit (default, the start of visible unfiltered edges)\n    //   0.0625 - high quality (faster)\n    //   0.0312 - visible limit (slower)\n    // Special notes when using FXAA_GREEN_AS_LUMA,\n    //   Likely want to set this to zero.\n    //   As colors that are mostly not-green\n    //   will appear very dark in the green channel!\n    //   Tune by looking at mostly non-green content,\n    //   then start at zero and increase until aliasing is a problem.\n    FxaaFloat fxaaQualityEdgeThresholdMin,\n    // \n    // Only used on FXAA Console.\n    // This used to be the FXAA_CONSOLEEDGE_SHARPNESS define.\n    // It is here now to allow easier tuning.\n    // This does not effect PS3, as this needs to be compiled in.\n    //   Use FXAA_CONSOLEPS3_EDGE_SHARPNESS for PS3.\n    //   Due to the PS3 being ALU bound,\n    //   there are only three safe values here: 2 and 4 and 8.\n    //   These options use the shaders ability to a free *|/ by 2|4|8.\n    // For all other platforms can be a non-power of two.\n    //   8.0 is sharper (default!!!)\n    //   4.0 is softer\n    //   2.0 is really soft (good only for vector graphics inputs)\n    FxaaFloat fxaaConsoleEdgeSharpness,\n    //\n    // Only used on FXAA Console.\n    // This used to be the FXAA_CONSOLEEDGE_THRESHOLD define.\n    // It is here now to allow easier tuning.\n    // This does not effect PS3, as this needs to be compiled in.\n    //   Use FXAA_CONSOLEPS3_EDGE_THRESHOLD for PS3.\n    //   Due to the PS3 being ALU bound,\n    //   there are only two safe values here: 1/4 and 1/8.\n    //   These options use the shaders ability to a free *|/ by 2|4|8.\n    // The console setting has a different mapping than the quality setting.\n    // Other platforms can use other values.\n    //   0.125 leaves less aliasing, but is softer (default!!!)\n    //   0.25 leaves more aliasing, and is sharper\n    FxaaFloat fxaaConsoleEdgeThreshold,\n    //\n    // Only used on FXAA Console.\n    // This used to be the FXAA_CONSOLEEDGE_THRESHOLD_MIN define.\n    // It is here now to allow easier tuning.\n    // Trims the algorithm from processing darks.\n    // The console setting has a different mapping than the quality setting.\n    // This only applies when FXAA_EARLY_EXIT is 1.\n    // This does not apply to PS3, \n    // PS3 was simplified to avoid more shader instructions.\n    //   0.06 - faster but more aliasing in darks\n    //   0.05 - default\n    //   0.04 - slower and less aliasing in darks\n    // Special notes when using FXAA_GREEN_AS_LUMA,\n    //   Likely want to set this to zero.\n    //   As colors that are mostly not-green\n    //   will appear very dark in the green channel!\n    //   Tune by looking at mostly non-green content,\n    //   then start at zero and increase until aliasing is a problem.\n    FxaaFloat fxaaConsoleEdgeThresholdMin,\n    //    \n    // Extra constants for 360 FXAA Console only.\n    // Use zeros or anything else for other platforms.\n    // These must be in physical constant registers and NOT immedates.\n    // Immedates will result in compiler un-optimizing.\n    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\n    FxaaFloat4 fxaaConsole360ConstDir\n) {\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posM;\n    posM.x = pos.x;\n    posM.y = pos.y;\n    #if (FXAA_GATHER4_ALPHA == 1)\n        #if (FXAA_DISCARD == 0)\n            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n            #if (FXAA_GREEN_AS_LUMA == 0)\n                #define lumaM rgbyM.w\n            #else\n                #define lumaM rgbyM.y\n            #endif\n        #endif\n        #if (FXAA_GREEN_AS_LUMA == 0)\n            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\n            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\n        #else\n            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\n            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\n        #endif\n        #if (FXAA_DISCARD == 1)\n            #define lumaM luma4A.w\n        #endif\n        #define lumaE luma4A.z\n        #define lumaS luma4A.x\n        #define lumaSE luma4A.y\n        #define lumaNW luma4B.w\n        #define lumaN luma4B.z\n        #define lumaW luma4B.x\n    #else\n        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n        #if (FXAA_GREEN_AS_LUMA == 0)\n            #define lumaM rgbyM.w\n        #else\n            #define lumaM rgbyM.y\n        #endif\n        #if (FXAA_GLSL_100 == 1)\n            FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n        #else\n            FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n        #endif\n    #endif\n/*--------------------------------------------------------------------------*/\n    FxaaFloat maxSM = max(lumaS, lumaM);\n    FxaaFloat minSM = min(lumaS, lumaM);\n    FxaaFloat maxESM = max(lumaE, maxSM);\n    FxaaFloat minESM = min(lumaE, minSM);\n    FxaaFloat maxWN = max(lumaN, lumaW);\n    FxaaFloat minWN = min(lumaN, lumaW);\n    FxaaFloat rangeMax = max(maxWN, maxESM);\n    FxaaFloat rangeMin = min(minWN, minESM);\n    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n    FxaaFloat range = rangeMax - rangeMin;\n    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n    FxaaBool earlyExit = range < rangeMaxClamped;\n/*--------------------------------------------------------------------------*/\n    if(earlyExit)\n        #if (FXAA_DISCARD == 1)\n            FxaaDiscard;\n        #else\n            return rgbyM;\n        #endif\n/*--------------------------------------------------------------------------*/\n    #if (FXAA_GATHER4_ALPHA == 0)\n        #if (FXAA_GLSL_100 == 1)\n            FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n        #else\n            FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n        #endif\n    #else\n        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n    #endif\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNS = lumaN + lumaS;\n    FxaaFloat lumaWE = lumaW + lumaE;\n    FxaaFloat subpixRcpRange = 1.0/range;\n    FxaaFloat subpixNSWE = lumaNS + lumaWE;\n    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNESE = lumaNE + lumaSE;\n    FxaaFloat lumaNWNE = lumaNW + lumaNE;\n    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat lumaNWSW = lumaNW + lumaSW;\n    FxaaFloat lumaSWSE = lumaSW + lumaSE;\n    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n    FxaaBool horzSpan = edgeHorz >= edgeVert;\n    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n/*--------------------------------------------------------------------------*/\n    if(!horzSpan) lumaN = lumaW;\n    if(!horzSpan) lumaS = lumaE;\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat gradientN = lumaN - lumaM;\n    FxaaFloat gradientS = lumaS - lumaM;\n    FxaaFloat lumaNN = lumaN + lumaM;\n    FxaaFloat lumaSS = lumaS + lumaM;\n    FxaaBool pairN = abs(gradientN) >= abs(gradientS);\n    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n    if(pairN) lengthSign = -lengthSign;\n    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posB;\n    posB.x = posM.x;\n    posB.y = posM.y;\n    FxaaFloat2 offNP;\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n    if(!horzSpan) posB.x += lengthSign * 0.5;\n    if( horzSpan) posB.y += lengthSign * 0.5;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat2 posN;\n    posN.x = posB.x - offNP.x * FXAA_QUALITYP0;\n    posN.y = posB.y - offNP.y * FXAA_QUALITYP0;\n    FxaaFloat2 posP;\n    posP.x = posB.x + offNP.x * FXAA_QUALITYP0;\n    posP.y = posB.y + offNP.y * FXAA_QUALITYP0;\n    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n    FxaaFloat subpixE = subpixC * subpixC;\n    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n/*--------------------------------------------------------------------------*/\n    if(!pairN) lumaNN = lumaSS;\n    FxaaFloat gradientScaled = gradient * 1.0/4.0;\n    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n    FxaaFloat subpixF = subpixD * subpixE;\n    FxaaBool lumaMLTZero = lumaMM < 0.0;\n/*--------------------------------------------------------------------------*/\n    lumaEndN -= lumaNN * 0.5;\n    lumaEndP -= lumaNN * 0.5;\n    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n    if(!doneN) posN.x -= offNP.x * FXAA_QUALITYP1;\n    if(!doneN) posN.y -= offNP.y * FXAA_QUALITYP1;\n    FxaaBool doneNP = (!doneN) || (!doneP);\n    if(!doneP) posP.x += offNP.x * FXAA_QUALITYP1;\n    if(!doneP) posP.y += offNP.y * FXAA_QUALITYP1;\n/*--------------------------------------------------------------------------*/\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITYP2;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITYP2;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITYP2;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITYP2;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITYPS > 3)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITYP3;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITYP3;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITYP3;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITYP3;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITYPS > 4)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITYP4;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITYP4;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITYP4;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITYP4;\n/*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITYPS > 5)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITYP5;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITYP5;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITYP5;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITYP5;\n/*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITYPS > 6)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITYP6;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITYP6;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITYP6;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITYP6;\n/*--------------------------------------------------------------------------*/\n                        #if (FXAA_QUALITYPS > 7)\n                        if(doneNP) {\n                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                            doneN = abs(lumaEndN) >= gradientScaled;\n                            doneP = abs(lumaEndP) >= gradientScaled;\n                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITYP7;\n                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITYP7;\n                            doneNP = (!doneN) || (!doneP);\n                            if(!doneP) posP.x += offNP.x * FXAA_QUALITYP7;\n                            if(!doneP) posP.y += offNP.y * FXAA_QUALITYP7;\n/*--------------------------------------------------------------------------*/\n    #if (FXAA_QUALITYPS > 8)\n    if(doneNP) {\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITYP8;\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITYP8;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITYP8;\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITYP8;\n/*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITYPS > 9)\n        if(doneNP) {\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITYP9;\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITYP9;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITYP9;\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITYP9;\n/*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITYPS > 10)\n            if(doneNP) {\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITYP10;\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITYP10;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITYP10;\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITYP10;\n/*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITYPS > 11)\n                if(doneNP) {\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITYP11;\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITYP11;\n                    doneNP = (!doneN) || (!doneP);\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITYP11;\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITYP11;\n/*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITYPS > 12)\n                    if(doneNP) {\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITYP12;\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITYP12;\n                        doneNP = (!doneN) || (!doneP);\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITYP12;\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITYP12;\n/*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n/*--------------------------------------------------------------------------*/\n                }\n                #endif\n/*--------------------------------------------------------------------------*/\n            }\n            #endif\n/*--------------------------------------------------------------------------*/\n        }\n        #endif\n/*--------------------------------------------------------------------------*/\n    }\n    #endif\n/*--------------------------------------------------------------------------*/\n                        }\n                        #endif\n/*--------------------------------------------------------------------------*/\n                    }\n                    #endif\n/*--------------------------------------------------------------------------*/\n                }\n                #endif\n/*--------------------------------------------------------------------------*/\n            }\n            #endif\n/*--------------------------------------------------------------------------*/\n        }\n        #endif\n/*--------------------------------------------------------------------------*/\n    }\n/*--------------------------------------------------------------------------*/\n    FxaaFloat dstN = posM.x - posN.x;\n    FxaaFloat dstP = posP.x - posM.x;\n    if(!horzSpan) dstN = posM.y - posN.y;\n    if(!horzSpan) dstP = posP.y - posM.y;\n/*--------------------------------------------------------------------------*/\n    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n    FxaaFloat spanLength = (dstP + dstN);\n    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n    FxaaFloat spanLengthRcp = 1.0/spanLength;\n/*--------------------------------------------------------------------------*/\n    FxaaBool directionN = dstN < dstP;\n    FxaaFloat dst = min(dstN, dstP);\n    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n    FxaaFloat subpixG = subpixF * subpixF;\n    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n/*--------------------------------------------------------------------------*/\n    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n    #if (FXAA_DISCARD == 1)\n        return FxaaTexTop(tex, posM);\n    #else\n        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n    #endif\n}\n/*==========================================================================*/\n#endif\n\n\n${n} vec2 v_texcoord;\n${i}\nvoid main() {\n\n    vec2 screenInfo = get_screenInfo(u_materialSID, 0);\n    rt0 = FxaaPixelShader(\n            v_texcoord,\n            vec4(0.0),\n            u_baseColorTexture,\n            u_baseColorTexture,\n            u_baseColorTexture,\n            1.0/screenInfo,\n            vec4(0.0),\n            vec4(0.0),\n            vec4(0.0),\n            0.75,\n            0.166,\n            0.0833,\n            0.0,\n            0.0,\n            0.0,\n            vec4(0.0)\n          );\n    rt0.a = 1.0;\n    ${s}\n}\n`}get pixelShaderDefinitions(){return""}getPixelShaderBody(e){return this.getFragmentShader(e)}get attributeCompositions(){return[S.a.Vec3,S.a.Vec2,S.a.Scalar]}}var xe=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function a(e){try{h(i.next(e))}catch(e){r(e)}}function o(e){try{h(i.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(a,o)}h((i=i.apply(e,t||[])).next())})};class ye extends P.a{constructor(){super(ve.getInstance(),"FXAA3QualityShading"),ye.initDefaultTextures();const e=[{semantic:C.a.BaseColorTexture,compositionType:S.a.Texture2D,componentType:T.a.Int,stage:O.a.PixelShader,isSystem:!1,updateInteval:z.a.EveryTime,initialValue:[0,P.a.__dummyWhiteTexture],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:C.a.ScreenInfo,compositionType:S.a.Vec2,componentType:T.a.Float,stage:O.a.PixelShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!1,initialValue:new M.b(0,0),min:0,max:Number.MAX_SAFE_INTEGER}];this.setShaderSemanticsInfoArray(e)}static initDefaultTextures(){return xe(this,void 0,void 0,function*(){})}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&this.setWorldMatrix(t,i.worldMatrix);let r=i.renderPass.cameraComponent;null==r&&(r=s.a.getInstance().getComponent(G.a,G.a.main)),r&&(this.setViewInfo(t,r,e,i.setUniform),this.setProjection(t,r,e,i.setUniform))}}class be extends D.a{constructor(){super(),this.vertexShaderBody="",this.attributeNames=["a_position","a_normal","a_joint","a_weight","a_instanceID"],this.attributeSemantics=[b.a.Position,b.a.Normal,b.a.Joints0,b.a.Weights0,b.a.Instance]}static getInstance(){return this.__instance||(this.__instance=new be),this.__instance}get vertexShaderDefinitions(){return""}getVertexShaderBody(e){const t=this.glsl_vertex_in,n=this.glsl_vertex_out;return`${this.glsl_versionText}\nprecision highp float;\n${t} vec3 a_position;\n${t} vec3 a_normal;\n${t} float a_instanceID;\n${t} vec4 a_joint;\n${t} vec4 a_weight;\n${n} vec3 v_normal_inWorld;\n${n} vec4 v_position_inLocal;\n${n} vec4 v_position_inWorld;\n\nuniform float u_materialSID;\nuniform vec3 u_viewPosition;\n\nuniform float u_pointSize;\nuniform vec3 u_pointDistanceAttenuation;\n\nuniform int u_skinningMode;\nuniform highp vec4 u_boneCompressedChank[90];\nuniform highp vec4 u_boneCompressedInfo;\n\n${void 0!==e.matricesGetters?e.matricesGetters:""}\n\n${void 0!==e.definitions?e.definitions:""}\n\n${void 0!==e.getters?e.getters:""}\n\n${this.toNormalMatrix}\n\n${this.getSkinMatrix}\n\n${this.processGeometryWithSkinningOptionally}\n\n  void main(){\n    mat4 worldMatrix = get_worldMatrix(a_instanceID);\n    mat4 viewMatrix = get_viewMatrix(a_instanceID);\n    mat4 projectionMatrix = get_projectionMatrix(a_instanceID);\n    mat3 normalMatrix = get_normalMatrix(a_instanceID);\n\n    // Skeletal\n    bool isSkinning;\n    skinning(isSkinning, normalMatrix, normalMatrix);\n\n    ${this.pointSprite}\n\n    v_position_inLocal = gl_Position;\n  }\n    `}getFragmentShader(){const e=this.glsl_fragment_in,t=s.a.getInstance().getComponent(G.a,G.a.main),n=t.zNearInner;let i=t.zFarInner-n;return Number.isInteger(i)&&(i+=".0"),`${this.glsl_versionText}\nprecision highp float;\n${e} vec4 v_position_inLocal;\n\nvec4 encodeDepthToRGBA(float depth){\n  float r = depth;\n  float g = fract(r * 255.0);\n  float b = fract(g * 255.0);\n  float a = fract(b * 255.0);\n  float coef = 1.0 / 255.0;\n  r -= g * coef;\n  g -= b * coef;\n  b -= a * coef;\n  return vec4(r, g, b, a);\n}\n\n${this.glsl_rt0}\nvoid main ()\n{\n  float normalizationCoefficient = 1.0 / ${i};\n  float linerDepth = normalizationCoefficient * length(v_position_inLocal);\n  vec4 encodedLinearDepth = encodeDepthToRGBA(linerDepth);\n\n  rt0 = encodedLinearDepth;\n\n  ${this.glsl_fragColor}\n}\n`}get pixelShaderDefinitions(){return""}getPixelShaderBody(){return this.getFragmentShader()}get attributeCompositions(){return[S.a.Vec3,S.a.Vec3,S.a.Vec4,S.a.Vec4,S.a.Scalar]}}be.materialElement=B.a.ClassicShading;class Ae extends P.a{constructor({isSkinning:e}){super(be.getInstance(),"depthEncodeShading"+(e?"+skinning":""));const t=[{semantic:C.a.ViewPosition,compositionType:S.a.Vec3,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!1,updateInteval:z.a.EveryTime,soloDatum:!0,initialValue:new R.b(0,0,0),min:-Number.MAX_VALUE,max:Number.MAX_VALUE}];t.push({semantic:C.a.PointSize,compositionType:S.a.Scalar,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!0,initialValue:new k.b(100),min:0,max:100},{semantic:C.a.PointDistanceAttenuation,compositionType:S.a.Vec3,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!0,initialValue:new R.b(0,.1,.01),min:0,max:1}),e&&(this.__definitions+="#define RN_IS_SKINNING",t.push({semantic:C.a.SkinningMode,compositionType:S.a.Scalar,componentType:T.a.Int,stage:O.a.VertexShader,isSystem:!1,updateInteval:z.a.EveryTime,soloDatum:!1,initialValue:new k.b(0),min:0,max:1},{semantic:C.a.BoneCompressedChank,compositionType:S.a.Vec4Array,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!1,updateInteval:z.a.EveryTime,soloDatum:!1,initialValue:new ee.a(new Float32Array(0)),min:-Number.MAX_VALUE,max:Number.MAX_VALUE,maxIndex:250},{semantic:C.a.BoneCompressedInfo,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!1,updateInteval:z.a.EveryTime,soloDatum:!1,initialValue:H.a.zero(),min:-Number.MAX_VALUE,max:Number.MAX_VALUE})),this.setShaderSemanticsInfoArray(t)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix));let r=i.renderPass.cameraComponent;null==r&&(r=s.a.getInstance().getComponent(G.a,G.a.main)),this.setViewInfo(t,r,e,i.setUniform),this.setProjection(t,r,e,i.setUniform),e.setParameter(C.a.ViewPosition,r.entity.getTransform().translate);const a=i.entity.getComponent(K);this.setSkinning(t,a,i.setUniform)}}class Te extends D.a{constructor(){super(),this.vertexShaderBody="",this.attributeNames=["a_position","a_color","a_normal","a_texcoord_0","a_joint","a_weight","a_instanceID","a_texcoord_1"],this.attributeSemantics=[b.a.Position,b.a.Color0,b.a.Normal,b.a.Texcoord0,b.a.Joints0,b.a.Weights0,b.a.Instance,b.a.Texcoord1]}static getInstance(){return this.__instance||(this.__instance=new Te),this.__instance}get vertexShaderDefinitions(){return""}getVertexShaderBody(e){const t=this.glsl_versionText,n=this.glsl_vertex_in,i=this.glsl_vertex_out;return`${t}\nprecision highp float;\n\n${void 0!==e.definitions?e.definitions:""}\n\n${n} vec3 a_position;\n${n} vec3 a_color;\n${n} vec3 a_normal;\n${n} float a_instanceID;\n${n} vec2 a_texcoord_0;\n${n} vec2 a_texcoord_1;\n${n} vec4 a_joint;\n${n} vec4 a_weight;\n${i} vec3 v_color;\n${i} vec3 v_normal_inWorld;\n${i} vec3 v_faceNormal_inWorld;\n${i} vec3 v_tangent_inWorld;\n${i} vec3 v_binormal_inWorld;\n${i} vec4 v_position_inWorld;\n${i} vec3 v_baryCentricCoord;\n${i} vec2 v_texcoord_0;\n${i} vec4 v_texcoord_1;\n${i} vec4 v_projPosition_from_light;\n\nuniform float u_materialSID;\nuniform vec3 u_viewPosition;\nuniform mat4 u_lightViewProjectionMatrix;\n\nuniform float u_pointSize;\nuniform vec3 u_pointDistanceAttenuation;\n\nuniform int u_skinningMode;\nuniform highp vec4 u_boneCompressedChank[90];\nuniform highp vec4 u_boneCompressedInfo;\n\n${void 0!==e.matricesGetters?e.matricesGetters:""}\n\n${void 0!==e.getters?e.getters:""}\n\n${this.toNormalMatrix}\n\n${this.getSkinMatrix}\n\n${this.processGeometryWithSkinningOptionally}\n\nvoid main(){\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat4 viewMatrix = get_viewMatrix(a_instanceID);\n  mat4 projectionMatrix = get_projectionMatrix(a_instanceID);\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n\n  v_color = a_color;\n  v_normal_inWorld = normalMatrix * a_normal;\n  v_texcoord_0 = a_texcoord_0;\n\n  // Skeletal\n  bool isSkinning;\n  skinning(isSkinning, normalMatrix, normalMatrix);\n\n  ${this.pointSprite}\n\n  // Shadow mapping\n  mat4 lightViewProjectionMatrix = get_lightViewProjectionMatrix(u_materialSID, 0);\n  v_projPosition_from_light = lightViewProjectionMatrix * v_position_inWorld;\n\n  // Following tMatrix is based on https://wgld.org/d/webgl/w051.html\n  mat4 tMatrix = mat4(\n    0.5, 0.0, 0.0, 0.0,\n    0.0, 0.5, 0.0, 0.0,\n    0.0, 0.0, 1.0, 0.0,\n    0.5, 0.5, 0.0, 1.0\n  );\n  v_texcoord_1 = tMatrix * v_projPosition_from_light;\n}\n`}getFragmentShader(e){const t=this.glsl_versionText,n=this.glsl_fragment_in,i=this.glsl_rt0,r=this.glsl_fragColor,a=this.glsl_texture,o=this.glsl_textureProj,h=s.a.getInstance().getComponent(G.a,G.a.main);let l=h.zNearInner,c=h.zFarInner-l;return Number.isInteger(c)&&(c+=".0"),`${t}\nprecision highp float;\n\n${n} vec3 v_color;\n${n} vec3 v_normal_inWorld;\n${n} vec4 v_position_inWorld;\n${n} vec2 v_texcoord_0;\n${n} vec4 v_texcoord_1;\n${n} vec4 v_projPosition_from_light;\n${i}\n\nstruct Light {\n  vec4 lightPosition;\n  vec4 lightDirection;\n  vec4 lightIntensity;\n};\n\nstruct Material {\n  vec4 diffuseColorFactor;\n};\n\nuniform float u_materialSID;\n\nuniform int u_shadingModel;\nuniform int u_lightNumber;\nuniform float u_shininess;\nuniform float u_shadowAlpha;\nuniform float u_nonShadowAlpha;\nuniform float u_allowableDepthError;\nuniform vec3 u_viewPosition;\nuniform vec3 u_shadowColor;\nuniform Material u_material;\nuniform sampler2D u_depthTexture;\nuniform sampler2D u_diffuseColorTexture;\n\nuniform Light u_lights[${V.a.maxLightNumberInShader}];\n\n${void 0!==e.getters?e.getters:""}\n\nfloat decodeRGBAToDepth(vec4 RGBA){\n  const float rMask = 1.0;\n  const float gMask = 1.0 / 255.0;\n  const float bMask = 1.0 / (255.0 * 255.0);\n  const float aMask = 1.0 / (255.0 * 255.0 * 255.0);\n  float depth = dot(RGBA, vec4(rMask, gMask, bMask, aMask));\n  return depth;\n}\n\nvoid main (){\n  // Normal\n  vec3 normal_inWorld = normalize(v_normal_inWorld);\n\n  // diffuseColor\n  vec3 diffuseColor = vec3(0.0, 0.0, 0.0);\n  float alpha = 1.0;\n\n  vec4 diffuseColorFactor = get_diffuseColorFactor(u_materialSID, 0);\n  if (v_color != diffuseColor && diffuseColorFactor.rgb != diffuseColor) {\n    diffuseColor = v_color * diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (v_color == diffuseColor) {\n    diffuseColor = diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (diffuseColorFactor.rgb == diffuseColor) {\n    diffuseColor = v_color;\n  } else {\n    diffuseColor = vec3(1.0, 1.0, 1.0);\n  }\n\n  // diffuseColorTexture\n  vec4 textureColor = ${a}(u_diffuseColorTexture, v_texcoord_0);\n  if (textureColor.r > 0.05) {\n    diffuseColor *= textureColor.rgb;\n    alpha *= textureColor.a;\n  }\n\n  // shadow mapping\n  float nonShadowAlpha = get_nonShadowAlpha(u_materialSID, 0);\n  if(v_projPosition_from_light.w > 0.0){\n    float normalizationCoefficient = 1.0 / ${c};\n    float measureDepth = normalizationCoefficient * length(v_projPosition_from_light);\n    float textureDepth = decodeRGBAToDepth(${o}(u_depthTexture, v_texcoord_1));\n    float allowableDepthError = get_allowableDepthError(u_materialSID, 0);\n    if(measureDepth > textureDepth + allowableDepthError){\n      vec3 shadowColor = get_shadowColor(u_materialSID, 0);\n      diffuseColor *= shadowColor;\n\n      float shadowAlpha = get_shadowAlpha(u_materialSID, 0);\n      alpha *= shadowAlpha;\n    }else{\n      alpha *= nonShadowAlpha;\n    }\n  }else{\n    alpha *= nonShadowAlpha;\n  }\n\n  // Lighting\n  vec3 shadingColor = vec3(0.0, 0.0, 0.0);\n  int shadingModel = get_shadingModel(u_materialSID, 0);\n  if (shadingModel > 0) {\n\n    vec3 diffuse = vec3(0.0, 0.0, 0.0);\n    vec3 specular = vec3(0.0, 0.0, 0.0);\n    int lightNumber = get_lightNumber(u_materialSID, 0);\n    for (int i = 0; i < ${V.a.maxLightNumberInShader}; i++) {\n      if (i >= lightNumber) {\n        break;\n      }\n\n      vec4 gotLightDirection = get_lightDirection(0.0, i);\n      vec4 gotLightIntensity = get_lightIntensity(0.0, i);\n      vec4 gotLightPosition = get_lightPosition(0.0, i);\n\n      vec3 lightDirection = gotLightDirection.xyz;\n      vec3 lightIntensity = gotLightIntensity.xyz;\n      vec3 lightPosition = gotLightPosition.xyz;\n      float spotCosCutoff = gotLightDirection.w;\n      float spotExponent = gotLightIntensity.w;\n      float lightType = gotLightPosition.w;\n\n      if (0.75 < lightType) { // is pointlight or spotlight\n        lightDirection = normalize(lightPosition - v_position_inWorld.xyz);\n      }\n      float spotEffect = 1.0;\n      if (lightType > 1.75) { // is spotlight\n        spotEffect = dot(lightDirection, lightDirection);\n        if (spotEffect > spotCosCutoff) {\n          spotEffect = pow(spotEffect, spotExponent);\n        } else {\n          spotEffect = 0.0;\n        }\n      }\n\n      vec3 incidentLight = spotEffect * lightIntensity.xyz;\n//      incidentLight *= M_PI;\n\n      diffuse += diffuseColor * max(0.0, dot(normal_inWorld, lightDirection)) * incidentLight;\n\n      vec3 viewPosition = get_viewPosition(u_materialSID, 0);\n      float shininess = get_shininess(u_materialSID, 0);\n      if (shadingModel == 2) {// BLINN\n        // ViewDirection\n        vec3 viewDirection = normalize(viewPosition - v_position_inWorld.xyz);\n        vec3 halfVector = normalize(lightDirection + viewDirection);\n        specular += pow(max(0.0, dot(halfVector, normal_inWorld)), shininess);\n      } else if (shadingModel == 3) { // PHONG\n        vec3 viewDirection = normalize(viewPosition - v_position_inWorld.xyz);\n        vec3 R = reflect(lightDirection, normal_inWorld);\n        specular += pow(max(0.0, dot(R, viewDirection)), shininess);\n      }\n\n    }\n\n    shadingColor = diffuse + specular;\n  } else {\n    shadingColor = diffuseColor;\n  }\n\n  rt0 = vec4(shadingColor, alpha);\n  //rt0 = vec4(u_lightNumber, 0.0, 0.0, 1.0);\n\n\n  ${r}\n}\n`}get pixelShaderDefinitions(){return""}getPixelShaderBody(e){return this.getFragmentShader(e)}get attributeCompositions(){return[S.a.Vec3,S.a.Vec3,S.a.Vec3,S.a.Vec2,S.a.Vec4,S.a.Vec4,S.a.Scalar,S.a.Vec2]}}Te.materialElement=B.a.ClassicShading;class we extends P.a{constructor(e,{isSkinning:t,isLighting:n,colorAttachmentsNumber:i}){super(Te.getInstance(),"ShadowMapDecodeClassicShading"+(t?"+skinning":"")+(n?"":"-lighting")),this.encodedDepthRenderPass=e;const s=e.getFramebuffer();if(null==s)return void console.error("encodedDepthRenderPass does not have framebuffer");const r=s.colorAttachments[i],a=[];if(a.push({semantic:C.a.ViewPosition,compositionType:S.a.Vec3,componentType:T.a.Float,stage:O.a.VertexAndPixelShader,isSystem:!1,updateInteval:z.a.EveryTime,soloDatum:!0,initialValue:new R.b(0,0,0),min:-Number.MAX_VALUE,max:Number.MAX_VALUE}),a.push({semantic:C.a.LightViewProjectionMatrix,compositionType:S.a.Mat4,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!0,updateInteval:z.a.EveryTime,soloDatum:!1,initialValue:Z.a.zero(),min:-Number.MAX_VALUE,max:Number.MAX_VALUE}),a.push({semantic:C.a.ShadingModel,compositionType:S.a.Scalar,componentType:T.a.Int,stage:O.a.PixelShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!1,initialValue:new k.b(_e.Constant.index),min:0,max:3},{semantic:C.a.LightNumber,compositionType:S.a.Scalar,componentType:T.a.Int,stage:O.a.PixelShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!0,initialValue:new k.b(0),min:0,max:Number.MAX_SAFE_INTEGER},{semantic:C.a.Shininess,compositionType:S.a.Scalar,componentType:T.a.Float,stage:O.a.PixelShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!1,initialValue:5,min:0,max:Number.MAX_VALUE},{semantic:we.ShadowAlpha,compositionType:S.a.Scalar,componentType:T.a.Float,stage:O.a.PixelShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!1,initialValue:new k.b(.5),min:0,max:1},{semantic:we.NonShadowAlpha,compositionType:S.a.Scalar,componentType:T.a.Float,stage:O.a.PixelShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!1,initialValue:new k.b(0),min:0,max:1},{semantic:we.AllowableDepthError,compositionType:S.a.Scalar,componentType:T.a.Float,stage:O.a.PixelShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!1,initialValue:new k.b(1e-4),min:0,max:1},{semantic:we.ShadowColor,compositionType:S.a.Vec3,componentType:T.a.Float,stage:O.a.PixelShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!1,initialValue:new R.b(0,0,0),min:0,max:1},{semantic:C.a.DiffuseColorFactor,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.PixelShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!1,initialValue:new L.b(1,1,1,1),min:0,max:2,prefix:"material."},{semantic:C.a.DepthTexture,compositionType:S.a.Texture2D,componentType:T.a.Int,stage:O.a.PixelShader,isSystem:!1,updateInteval:z.a.EveryTime,initialValue:[0,r],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:C.a.DiffuseColorTexture,compositionType:S.a.Texture2D,componentType:T.a.Int,stage:O.a.PixelShader,isSystem:!1,updateInteval:z.a.EveryTime,initialValue:[1,P.a.__dummyWhiteTexture],min:0,max:Number.MAX_SAFE_INTEGER}),a.push({semantic:C.a.PointSize,compositionType:S.a.Scalar,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!0,initialValue:new k.b(30),min:0,max:100},{semantic:C.a.PointDistanceAttenuation,compositionType:S.a.Vec3,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!0,initialValue:new R.b(0,.1,.01),min:0,max:1}),t&&(this.__definitions+="#define RN_IS_SKINNING\n",a.push({semantic:C.a.SkinningMode,compositionType:S.a.Scalar,componentType:T.a.Int,stage:O.a.VertexShader,isSystem:!0,updateInteval:z.a.EveryTime,soloDatum:!1,initialValue:new k.b(0),min:0,max:1},{semantic:C.a.BoneCompressedChank,compositionType:S.a.Vec4Array,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!0,updateInteval:z.a.EveryTime,soloDatum:!0,initialValue:new ee.a(new Float32Array(0)),min:-Number.MAX_VALUE,max:Number.MAX_VALUE,maxIndex:250},{semantic:C.a.BoneCompressedInfo,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!0,updateInteval:z.a.EveryTime,soloDatum:!0,initialValue:H.a.zero(),min:-Number.MAX_VALUE,max:Number.MAX_VALUE})),n){this.__definitions+="#define RN_IS_LIGHTING\n";for(let e=0;e<V.a.maxLightNumberInShader;e++)o=e,a.push({semantic:C.a.LightPosition,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.PixelShader,isSystem:!0,updateInteval:z.a.EveryTime,soloDatum:!0,initialValue:new L.b(0,0,0,1),min:-Number.MAX_VALUE,max:Number.MAX_VALUE,prefix:`lights[${o}].`,maxIndex:4,index:o},{semantic:C.a.LightDirection,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.PixelShader,isSystem:!0,updateInteval:z.a.EveryTime,soloDatum:!0,initialValue:new L.b(0,1,0,1),min:-1,max:1,prefix:`lights[${o}].`,maxIndex:4,index:o},{semantic:C.a.LightIntensity,compositionType:S.a.Vec4,componentType:T.a.Float,stage:O.a.PixelShader,isSystem:!0,updateInteval:z.a.EveryTime,soloDatum:!0,initialValue:new L.b(1,1,1,1),min:0,max:10,prefix:`lights[${o}].`,maxIndex:4,index:o})}var o;this.setShaderSemanticsInfoArray(a)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix));let r=i.renderPass.cameraComponent;null==r&&(r=s.a.getInstance().getComponent(G.a,G.a.main)),this.setViewInfo(t,r,e,i.setUniform),this.setProjection(t,r,e,i.setUniform);const a=i.entity.getComponent(K);this.setSkinning(t,a,i.setUniform),this.setLightsInfo(t,i.lightComponents,e,i.setUniform),N.a.getWebGLResourceRepository().setUniformValue(t,C.a.LightViewProjectionMatrix.str,!0,this.encodedDepthRenderPass.cameraComponent.viewProjectionMatrix)}}we.ShadowColor=new C.b({str:"shadowColor"}),we.ShadowAlpha=new C.b({str:"shadowAlpha"}),we.NonShadowAlpha=new C.b({str:"nonShadowAlpha"}),we.AllowableDepthError=new C.b({str:"allowableDepthError"});class Se extends D.a{constructor(){super(),this.vertexShaderBody="",this.attributeNames=["a_position","a_texcoord","a_instanceID"],this.attributeSemantics=[b.a.Position,b.a.Texcoord0,b.a.Instance]}static getInstance(){return this.__instance||(this.__instance=new Se),this.__instance}get vertexShaderDefinitions(){return""}getVertexShaderBody(e){const t=this.glsl_versionText,n=this.glsl_vertex_in;return`${t}\nprecision highp float;\n\n${n} vec3 a_position;\n${n} float a_instanceID;\n${n} vec2 a_texcoord;\n${this.glsl_vertex_out} vec2 v_texcoord;\n\n${this.prerequisites}\n\n${void 0!==e.matricesGetters?e.matricesGetters:""}\n\nvoid main(){\n  v_texcoord = a_texcoord;\n  ${this.simpleMVPPosition}\n}\n`}getFragmentShader(e){const t=this.glsl_versionText,n=this.glsl_fragment_in,i=this.glsl_rt0,s=this.glsl_fragColor,r=this.glsl_texture;return`${t}\nprecision highp float;\n\n${this.prerequisites}\n\n${void 0!==e.getters?e.getters:""}\n\nvec3 linearToSrgb(vec3 linearColor) {\n  return pow(linearColor, vec3(1.0/2.2));\n}\n\nvec3 srgbToLinear(vec3 srgbColor) {\n  return pow(srgbColor, vec3(2.2));\n}\n\n${n} vec2 v_texcoord;\n${i}\nvoid main ()\n{\n\n  vec4 baseColor = ${r}(u_baseColorTexture, v_texcoord);\n\n  baseColor.rgb = linearToSrgb(baseColor.rgb);\n\n  rt0 = vec4(baseColor.rgb, 1.0);\n\n  ${s}\n}\n`}get pixelShaderDefinitions(){return""}getPixelShaderBody(e){return this.getFragmentShader(e)}get attributeCompositions(){return[S.a.Vec3,S.a.Vec2,S.a.Scalar]}}Se.materialElement=B.a.ClassicShading;var Ie=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function a(e){try{h(i.next(e))}catch(e){r(e)}}function o(e){try{h(i.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(a,o)}h((i=i.apply(e,t||[])).next())})};class Ee extends P.a{constructor(){super(Se.getInstance(),"GammaCorrection"),Ee.initDefaultTextures();const e=[{semantic:C.a.BaseColorTexture,compositionType:S.a.Texture2D,componentType:T.a.Int,stage:O.a.PixelShader,isSystem:!1,updateInteval:z.a.EveryTime,initialValue:[0,P.a.__dummyWhiteTexture],min:0,max:10}];this.setShaderSemanticsInfoArray(e)}static initDefaultTextures(){return Ie(this,void 0,void 0,function*(){})}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&this.setWorldMatrix(t,i.worldMatrix);let r=i.renderPass.cameraComponent;null==r&&(r=s.a.getInstance().getComponent(G.a,G.a.main)),r&&(this.setViewInfo(t,r,e,i.setUniform),this.setProjection(t,r,e,i.setUniform))}}class Fe extends D.a{constructor(){super(),this.vertexShaderBody="\n  ",this.attributeNames=["a_position","a_color","a_normal","a_texcoord","a_joint","a_weight","a_instanceID"],this.attributeSemantics=[b.a.Position,b.a.Color0,b.a.Normal,b.a.Texcoord0,b.a.Joints0,b.a.Weights0,b.a.Instance]}static getInstance(){return this.__instance||(this.__instance=new Fe),this.__instance}getVertexShaderBody(e){const t=this.glsl_versionText,n=this.glsl_vertex_in,i=this.glsl_vertex_out;return`${t}\nprecision highp float;\n\n${void 0!==e.definitions?e.definitions:""}\n\n${n} vec3 a_position;\n${n} vec3 a_color;\n${n} vec3 a_normal;\n${n} float a_instanceID;\n${n} vec2 a_texcoord;\n${n} vec4 a_joint;\n${n} vec4 a_weight;\n${i} vec3 v_color;\n${i} vec3 v_normal_inWorld;\n${i} vec4 v_position_inWorld;\n${i} vec2 v_texcoord;\n\nuniform float u_materialSID;\n\n${void 0!==e.matricesGetters?e.matricesGetters:""}\n\n${void 0!==e.getters?e.getters:""}\n\n${this.toNormalMatrix}\n\n${this.getSkinMatrix}\n\n${this.processGeometryWithSkinningOptionally}\n\nvoid main()\n{\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat4 viewMatrix = get_viewMatrix(a_instanceID);\n  mat4 projectionMatrix = get_projectionMatrix(a_instanceID);\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n\n  // Skeletal\n  processGeometryWithMorphingAndSkinning(\n    worldMatrix,\n    normalMatrix,\n    normalMatrix,\n    a_position,\n    v_position_inWorld,\n    a_normal,\n    v_normal_inWorld\n  );\n\n  gl_Position = projectionMatrix * viewMatrix * v_position_inWorld;\n  ${this.pointSprite}\n}`}get vertexShaderDefinitions(){return"\n"}getFragmentShader(e){const t=this.glsl_versionText,n=this.glsl_fragment_in,i=this.glsl_rt0,s=this.glsl_fragColor;this.glsl_texture;return`${t}\nprecision highp float;\n\n${void 0!==e.definitions?e.definitions:""}\n\n\n${this.prerequisites}\n\n${n} vec3 v_normal_inWorld;\n${n} vec4 v_position_inWorld;\n${i}\n\n${void 0!==e.getters?e.getters:""}\n\n${this.packing}\n\nvoid main ()\n{\n  rt0 = encodeFloatRGBA(u_entityUID);\n\n  ${s}\n}\n`}get pixelShaderDefinitions(){return""}getPixelShaderBody(e){return this.getFragmentShader(e)}get attributeCompositions(){return[S.a.Vec3,S.a.Vec3,S.a.Vec3,S.a.Vec2,S.a.Vec4,S.a.Vec4,S.a.Scalar]}}Fe.materialElement=B.a.ClassicShading;var Ce=n(33),Pe=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function a(e){try{h(i.next(e))}catch(e){r(e)}}function o(e){try{h(i.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(a,o)}h((i=i.apply(e,t||[])).next())})};class Me extends P.a{constructor(){super(Fe.getInstance(),"entityUidOutputShading+skinning"),Me.initDefaultTextures();let e=[{semantic:C.a.WorldMatrix,isComponentData:!0,compositionType:S.a.Mat4,componentType:T.a.Float,stage:O.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:Z.a.zero()},{semantic:C.a.NormalMatrix,isComponentData:!0,compositionType:S.a.Mat3,componentType:T.a.Float,stage:O.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:Ce.a.zero()},{semantic:C.a.ViewMatrix,isComponentData:!0,compositionType:S.a.Mat4,componentType:T.a.Float,stage:O.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.FirstTimeOnly,initialValue:Z.a.zero()},{semantic:C.a.ProjectionMatrix,isComponentData:!0,compositionType:S.a.Mat4,componentType:T.a.Float,stage:O.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.FirstTimeOnly,initialValue:Z.a.zero()},{semantic:C.a.EntityUID,compositionType:S.a.Scalar,componentType:T.a.Float,stage:O.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:new k.b(0)},{semantic:C.a.ViewPosition,compositionType:S.a.Vec3,componentType:T.a.Float,stage:O.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.FirstTimeOnly,initialValue:new R.b(0,0,0),soloDatum:!0},{semantic:C.a.PointSize,compositionType:S.a.Scalar,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!0,initialValue:new k.b(30),min:0,max:100},{semantic:C.a.PointDistanceAttenuation,compositionType:S.a.Vec3,componentType:T.a.Float,stage:O.a.VertexShader,isSystem:!1,updateInteval:z.a.FirstTimeOnly,soloDatum:!0,initialValue:new R.b(0,.1,.01),min:0,max:1}];this.__definitions+="#define RN_IS_SKINNING\n",e.push({semantic:C.a.BoneCompressedChank,compositionType:S.a.Vec4Array,maxIndex:250,componentType:T.a.Float,stage:O.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.EveryTime,soloDatum:!0,initialValue:new ee.a(new Float32Array(0))}),e.push({semantic:C.a.BoneCompressedInfo,compositionType:S.a.Vec4,componentType:T.a.Float,soloDatum:!0,stage:O.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:H.a.zero()}),e.push({semantic:C.a.SkinningMode,compositionType:S.a.Scalar,componentType:T.a.Int,stage:O.a.VertexShader,min:0,max:1,isSystem:!0,updateInteval:z.a.EveryTime,initialValue:new k.b(0)}),this.setShaderSemanticsInfoArray(e)}static initDefaultTextures(){return Pe(this,void 0,void 0,function*(){})}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix));let r=i.renderPass.cameraComponent;null==r&&(r=s.a.getInstance().getComponent(G.a,G.a.main)),this.setViewInfo(t,r,e,i.setUniform),this.setProjection(t,r,e,i.setUniform);const a=i.entity.getComponent(K);this.setSkinning(t,a,i.setUniform),this.setLightsInfo(t,i.lightComponents,e,i.setUniform),this.__webglResourceRepository.setUniformValue(t,C.a.EntityUID.str,!0,i.entity.entityUID)}}function Ne(e,t,n){return F.a.createMaterial(e,t,n)}var Le=Object.freeze({createPbrUberMaterial:function({isMorphing:e,isSkinning:t,isLighting:n,additionalName:i,maxInstancesNumber:s}){const r="PbrUber"+`_${i}_`+(e?"+morphing":"")+(t?"+skinning":"")+(n?"":"-lighting"),a=new ie({isMorphing:e,isSkinning:t,isLighting:n});return a.isSingleOperation=!0,Ne(r,[a],s)},createClassicUberMaterial:function({isSkinning:e,isLighting:t,additionalName:n,maxInstancesNumber:i}){const s="ClassicUber"+`_${n}_`+(e?"+skinning":"")+(t?"":"-lighting"),r=new de({isSkinning:e,isLighting:t});return r.isSingleOperation=!0,Ne(s,[r],i)},createEnvConstantMaterial:function(e){const t=new ge;return t.isSingleOperation=!0,Ne("EnvConstant",[t],null!=e?e:10)},createFXAA3QualityMaterial:function(e){const t=new ye;return t.isSingleOperation=!0,Ne("FXAA3Quality",[t],null!=e?e:10)},createDepthEncodeMaterial:function({isSkinning:e=!0}={},t){const n="DepthEncode"+(e?"+skinning":""),i=new Ae({isSkinning:e});return i.isSingleOperation=!0,Ne(n,[i],null!=t?t:20)},createShadowMapDecodeClassicSingleMaterial:function(e,{isSkinning:t=!0,isLighting:n=!0,colorAttachmentsNumber:i=0}={},s){const r="ShadowMapDecodeClassic"+(t?"+skinning":"")+(n?"":"-lighting"),a=new we(e,{isSkinning:t,isLighting:n,colorAttachmentsNumber:i});return a.isSingleOperation=!0,Ne(r,[a],null!=s?s:20)},createGammaCorrectionMaterial:function(e){const t=new Ee;return t.isSingleOperation=!0,Ne("GammaCorrection",[t],null!=e?e:10)},createEntityUIDOutputMaterial:function(e){const t=new Me;return t.isSingleOperation=!0,Ne("EntityUIDOutput",[t],null!=e?e:10)}});class Re extends A.a{constructor(){super(),this.__mode=y.Unknown,this.__attributes=new Map,this.__primitiveUid=-1,this.__aabb=new E.a,this.__targets=[]}setData(e,t,n,i){this.__indices=i,this.__attributes=e,this.material=null!=n?n:Le.createClassicUberMaterial({isSkinning:!0,isLighting:!0}),this.__mode=t,this.__primitiveUid=Re.__primitiveCount++}static get maxPrimitiveCount(){return 500}static get headerAccessor(){return this.__headerAccessor}static createPrimitive({indices:e,attributeCompositionTypes:t,attributeSemantics:n,attributes:i,material:s,primitiveMode:r}){const a=w.a.getInstance().getBuffer(I.a.GPUVertexData);let o,h,l;if(null!=e){o=T.a.fromTypedArray(e),l=(h=a.takeBufferView({byteLengthToNeed:e.byteLength,byteStride:0,isAoS:!1})).takeAccessor({compositionType:S.a.Scalar,componentType:o,count:e.byteLength/o.getSizeInBytes()});for(let t=0;t<e.byteLength/l.componentSizeInBytes;t++)l.setScalar(t,e[t],{})}let c=0;i.forEach(e=>{c+=e.byteLength});const u=a.takeBufferView({byteLengthToNeed:c,byteStride:0,isAoS:!1}),_=[],m=[];i.forEach((e,n)=>{m[n]=T.a.fromTypedArray(i[n]);const s=u.takeAccessor({compositionType:t[n],componentType:T.a.fromTypedArray(i[n]),count:e.byteLength/t[n].getNumberOfComponents()/m[n].getSizeInBytes()});s.copyFromTypedArray(e),_.push(s)});const d=new Map;for(let e=0;e<n.length;e++)d.set(n[e],_[e]);const f=new Re;return f.setData(d,r,s,l),f}get indicesAccessor(){return this.__indices}getVertexCountAsIndicesBased(){return this.indicesAccessor?this.indicesAccessor.elementCount:this.getVertexCountAsVerticesBased()}getVertexCountAsVerticesBased(){return this.__attributes.get(b.a.Position).elementCount}getTriangleCountAsIndicesBased(){if(!this.indicesAccessor)return this.getTriangleCountAsVerticesBased();switch(this.__mode){case y.Triangles:return this.indicesAccessor.elementCount/3;case y.TriangleStrip:case y.TriangleFan:return this.indicesAccessor.elementCount-2;default:return 0}}getTriangleCountAsVerticesBased(){const e=this.__attributes.get(b.a.Position);switch(this.__mode){case y.Triangles:return e.elementCount/3;case y.TriangleStrip:case y.TriangleFan:return e.elementCount-2;default:return 0}}hasIndices(){return null!=this.__indices}get attributeAccessors(){const e=[];return this.__attributes.forEach((t,n)=>{e.push(t)}),e}getAttribute(e){return this.__attributes.get(e)}get attributeSemantics(){const e=[];return this.__attributes.forEach((t,n)=>{e.push(n)}),e}get attributeEntries(){return this.__attributes.entries()}get attributeCompositionTypes(){const e=[];return this.__attributes.forEach((t,n)=>{e.push(t.compositionType)}),e}get attributeComponentTypes(){const e=[];return this.__attributes.forEach((t,n)=>{e.push(t.componentType)}),e}get primitiveMode(){return this.__mode}get primitiveUid(){return this.__primitiveUid}get AABB(){if(this.__aabb.isVanilla()){const e=this.__attributes.get(b.a.Position);null!=e.min&&null!=e.max||e.calcMinMax(),this.__aabb.minPoint=e.min,this.__aabb.maxPoint=e.max}return this.__aabb}setVertexAttribute(e,t){this.__attributes.set(t,e)}removeIndices(){this.__indices=void 0}setIndices(e){this.__indices=e}setTargets(e){this.__targets=e}get targets(){return this.__targets}isBlend(){return!(null==this.material||!this.material.isBlend())}isOpaque(){return!this.isBlend()}create3DAPIVertexData(){if(null!=this.__vertexHandles)return!1;const e=N.a.getWebGLResourceRepository();return this.__vertexHandles=e.createVertexBufferAndIndexBuffer(this),!0}delete3DAPIVertexData(){if(null==this.__vertexHandles)return!1;return N.a.getWebGLResourceRepository().deleteVertexDataResources(this.__vertexHandles),!0}get vertexHandles(){return this.__vertexHandles}}Re.__primitiveCount=0;var De=n(48);class Ve extends A.a{constructor(){super(),this.__renderPasses=[]}addRenderPasses(e){this.__renderPasses=this.__renderPasses.concat(e)}clearRenderPasses(){this.__renderPasses.length=0}get renderPasses(){return this.__renderPasses}}class Be extends A.a{constructor(){super(),this.__entities=[],this.__sceneGraphDirectlyAdded=[],this.__topLevelSceneGraphComponents=[],this.toClearColorBuffer=!1,this.toClearDepthBuffer=!0,this.toClearStencilBuffer=!1,this.clearColor=new L.b(1,1,1,1),this.clearDepth=1,this.clearStencil=0,this.cullface=!1}addEntities(e){for(let t of e){const e=t.getSceneGraph();this.__sceneGraphDirectlyAdded.push(e);const n=a.a.flattenHierarchy(e,!1).map(e=>e.entity),i=this.__entities.concat(n).reduce((e,t)=>(e.set(t.entityUID,t),e),new Map);this.__entities=Array.from(i.values())}this.__meshComponents=void 0,this.__topLevelSceneGraphComponents=void 0,this.__collectMeshComponents(),this.__collectTopLevelSceneGraphComponents()}get entities(){return this.__entities}clearEntities(){this.__meshComponents=void 0,this.__topLevelSceneGraphComponents=void 0,this.__entities=[]}__collectTopLevelSceneGraphComponents(){if(null==this.__topLevelSceneGraphComponents){const e=t=>(t.parent&&e(t.parent),t);this.__topLevelSceneGraphComponents=this.__sceneGraphDirectlyAdded.map(t=>e(t));let t=new Set(this.__topLevelSceneGraphComponents);this.__topLevelSceneGraphComponents=Array.from(t)}}__collectMeshComponents(){null==this.__meshComponents&&(this.__meshComponents=[],this.__entities.filter(e=>{const t=e.getComponent(o.a);t&&this.__meshComponents.push(t)}))}get meshComponents(){return this.__collectMeshComponents(),this.__meshComponents}get sceneTopLevelGraphComponents(){return this.__collectTopLevelSceneGraphComponents(),this.__topLevelSceneGraphComponents}setFramebuffer(e){this.__frameBuffer=e,this.setViewport(new L.b(0,0,e.width,e.height))}getFramebuffer(){return this.__frameBuffer}setViewport(e){this.__viewport=e}getViewport(){return this.__viewport}}class Ue{constructor(){this.__processStages=[j.a.Create,j.a.Load,j.a.Logic,j.a.PreRender,j.a.Render],this.__componentRepository=s.a.getInstance(),this.__entityRepository=i.a.getInstance(),this.__processApproach=J.a.None,this.__webglResourceRepository=N.a.getWebGLResourceRepository(),this.__localExpression=new Ve,this.__localRenderPass=new Be,this.__lastEntitiesNumber=-1,this.__renderPassTickCount=0,this.__localExpression.addRenderPasses([this.__localRenderPass])}process(e){if(this.__processApproach===J.a.None)throw new Error("Choose a process approach first.");let t=null!=e?e:this.__localExpression;t===this.__localExpression&&this.__entityRepository.getEntitiesNumber()!==this.__lastEntitiesNumber&&(this.__localRenderPass.clearEntities(),this.__localRenderPass.addEntities(this.__entityRepository._getEntities()),this.__lastEntitiesNumber=this.__entityRepository.getEntitiesNumber());for(let e of this.__processStages){const n="common_"+e.methodName,i=this.__componentRepository.getComponentTIDs();for(let r of i){let i=1;r===h.a.componentTID&&(i=t.renderPasses.length);for(let a=0;a<i;a++){const i=t.renderPasses[a];r===h.a.componentTID&&e==j.a.Render&&(this.__webglResourceRepository.bindFramebuffer(i.getFramebuffer()),this.__webglResourceRepository.setViewport(i.getViewport()),this.__webglResourceRepository.setDrawTargets(i.getFramebuffer()),this.__webglResourceRepository.clearFrameBuffer(i));const o=s.a.getComponentClass(r);o.updateComponentsOfEachProcessStage(o,e,this.__componentRepository,i);const l=o[n];l&&l({processApproach:this.__processApproach,renderPass:i,processStage:e}),o.process({componentType:o,processStage:e,processApproach:this.__processApproach,componentRepository:this.__componentRepository,strategy:this.__webglStrategy,renderPass:i,renderPassTickCount:this.__renderPassTickCount}),this.__renderPassTickCount++}}}}setProcessApproachAndCanvas(e,t,n=1){const i=De.a.getInstance().getModule("webgl");this.__webglStrategy=i.getRenderingStrategy(e);const s=i.WebGLResourceRepository.getInstance();let r;return(r=e===J.a.DataTextureWebGL2||e===J.a.UBOWebGL2||e===J.a.TransformFeedbackWebGL2||e===J.a.UniformWebGL2?t.getContext("webgl2"):t.getContext("webgl")||t.getContext("experimental-webgl")).enable(r.DEPTH_TEST),w.a.createInstanceIfNotCreated(1*n,1*n,.1*n,.5*n),s.addWebGLContext(r,t,!0),this.__processApproach=e,r}get processApproach(){return this.__processApproach}static getInstance(){return this.__instance||(this.__instance=new Ue),this.__instance}}var Oe=n(49);class ze{constructor(e,t,n,i,s=!1,r=!1){const a=5===arguments.length?s:t,o=3===arguments.length?r:n,h=e;if(null!=h)if(4===arguments.length)if(this.v=new Float32Array(4),!0===a){let e=arguments;this.v[0]=e[0],this.v[2]=e[2],this.v[1]=e[1],this.v[3]=e[3]}else{let e=arguments;this.v[0]=e[0],this.v[2]=e[1],this.v[1]=e[2],this.v[3]=e[3]}else if(Array.isArray(h))this.v=new Float32Array(4),!0===a?(this.v[0]=h[0],this.v[2]=h[2],this.v[1]=h[1],this.v[3]=h[3]):(this.v[0]=h[0],this.v[2]=h[1],this.v[1]=h[2],this.v[3]=h[3]);else if(h instanceof Float32Array)o?this.v=h:(this.v=new Float32Array(4),!0===a?(this.v[0]=h[0],this.v[2]=h[2],this.v[1]=h[1],this.v[3]=h[3]):(this.v[0]=h[0],this.v[2]=h[1],this.v[1]=h[2],this.v[3]=h[3]));else if(h&&void 0!==h.v[8])if(o)this.v=h.v;else if(this.v=new Float32Array(4),!0===a){h.v;this.v[0]=h[0],this.v[2]=h[2],this.v[1]=h[1],this.v[3]=h[3]}else{h.v;this.v[0]=h[0],this.v[2]=h[1],this.v[1]=h[2],this.v[3]=h[3]}else this.v=new Float32Array(4),this.v[0]=1,this.v[2]=0,this.v[1]=0,this.v[3]=1;else this.v=new Float32Array(0)}get className(){return this.constructor.name}static get compositionType(){return S.a.Mat2}multiplyVector(e){const t=this.v[0]*e.x+this.v[2]*e.y,n=this.v[1]*e.x+this.v[3]*e.y;return new e.constructor(t,n)}static identity(){return new ze(1,0,0,1)}static dummy(){return new ze(null)}isDummy(){return 0===this.v.length}clone(){return new ze(this.v[0],this.v[2],this.v[1],this.v[3])}static rotate(e){const t=Math.cos(e),n=Math.sin(e);return new ze(t,-n,n,t)}static scale(e){return new ze(e.x,0,0,e.y)}static zero(){return new ze(0,0,0,0)}static transpose(e){return new ze(e.m00,e.m10,e.m01,e.m11)}static multiply(e,t){const n=e.v[0]*t.v[0]+e.v[2]*t.v[1],i=e.v[1]*t.v[0]+e.v[3]*t.v[1],s=e.v[0]*t.v[2]+e.v[2]*t.v[3],r=e.v[1]*t.v[2]+e.v[3]*t.v[3];return new ze(n,s,i,r)}determinant(){return this.v[0]*this.v[3]-this.v[1]*this.v[2]}static determinant(e){return e.m00*e.m11-e.m10*e.m01}static invert(e){const t=e.determinant(),n=e.m11/t,i=e.m01/t*-1,s=e.m10/t*-1,r=e.m00/t;return new ze(n,i,s,r)}get m00(){return this.v[0]}get m10(){return this.v[1]}get m01(){return this.v[2]}get m11(){return this.v[3]}toString(){return this.v[0]+" "+this.v[2]+"\n"+this.v[1]+" "+this.v[3]+" \n"}nearZeroToZero(e){return Math.abs(e)<1e-5?e=0:.99999<e&&e<1.00001?e=1:-1.00001<e&&e<-.99999&&(e=-1),e}toStringApproximately(){return this.nearZeroToZero(this.v[0])+" "+this.nearZeroToZero(this.v[2])+"\n"+this.nearZeroToZero(this.v[1])+" "+this.nearZeroToZero(this.v[3])+" \n"}isEqual(e,t=Number.EPSILON){return Math.abs(e.v[0]-this.v[0])<t&&Math.abs(e.v[1]-this.v[1])<t&&Math.abs(e.v[2]-this.v[2])<t&&Math.abs(e.v[3]-this.v[3])<t&&Math.abs(e.v[4]-this.v[4])<t&&Math.abs(e.v[5]-this.v[5])<t&&Math.abs(e.v[6]-this.v[6])<t&&Math.abs(e.v[7]-this.v[7])<t&&Math.abs(e.v[8]-this.v[8])<t}}var Ge=n(35);class Xe extends ze{constructor(e,t,n,i,s=!1,r=!1){super(e,t,n,i,s)}setComponents(e,t,n,i){return this.v[0]=e,this.v[3]=t,this.v[1]=n,this.v[4]=i,this}copyComponents(e){const t=e;this.m00=t.m00,this.m01=t.m01,this.m10=t.m10,this.m11=t.m11}static get compositionType(){return S.a.Mat2}static dummy(){return new Xe(null)}identity(){return this.setComponents(1,0,0,1),this}rotate(e){const t=Math.cos(e),n=Math.sin(e);return this.setComponents(t,-n,n,t)}static rotate(e){const t=Math.cos(e),n=Math.sin(e);return new Xe(t,-n,n,t)}scale(e){return this.setComponents(e.x,0,0,e.y)}zero(){return this.setComponents(0,0,0,0),this}raw(){return this.v}flattenAsArray(){return[this.v[0],this.v[1],this.v[2],this.v[3]]}_swap(e,t){this.v[t]=[this.v[e],this.v[e]=this.v[t]][0]}transpose(){return this._swap(1,2),this}multiply(e){const t=this.m00*e.m00+this.m01*e.m10,n=this.m00*e.m01+this.m01*e.m11,i=this.m10*e.m00+this.m11*e.m10,s=this.m10*e.m01+this.m11*e.m11;return this.setComponents(t,n,i,s)}invert(){const e=this.determinant(),t=this.m11/e,n=this.m01/e*-1,i=this.m10/e*-1,s=this.m00/e;return this.setComponents(t,n,i,s)}addScale(e){return this.m00*=e.x,this.m11*=e.y,this}set m00(e){this.v[0]=e}get m00(){return this.v[0]}set m10(e){this.v[1]=e}get m10(){return this.v[1]}set m01(e){this.v[2]=e}get m01(){return this.v[2]}set m11(e){this.v[3]=e}get m11(){return this.v[3]}}var ke=n(26),We=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function a(e){try{h(i.next(e))}catch(e){r(e)}}function o(e){try{h(i.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(a,o)}h((i=i.apply(e,t||[])).next())})};class Ye{constructor(){}import(e,t){return We(this,void 0,void 0,function*(){let n={files:{},loaderExtension:null,defaultMaterial:null,statesOfElements:[{targets:[],states:{enable:[],functions:{}},isTransparent:!0,opacity:1,isTextureImageToLoadPreMultipliedAlpha:!1}],extendedJson:void 0};if(t&&t.files)for(let e in t.files){const i=e.split("."),s=i[i.length-1];if("gltf"===s||"glb"===s)return yield this.__loadFromArrayBuffer(t.files[e],n,t,void 0)}const i=yield fetch(e),s=yield i.arrayBuffer();return yield this.__loadFromArrayBuffer(s,n,t,e)})}__loadFromArrayBuffer(e,t,n,i){return We(this,void 0,void 0,function*(){const s=new DataView(e,0,20);let r;if(1179937895!==s.getUint32(0,!0)){const s=ke.a.arrayBufferToString(e),a=JSON.parse(s);r=yield this._loadAsTextJson(a,n,t,i)}else r=yield this._loadAsBinaryJson(s,!0,e,n,t,i);return r})}_getOptions(e,t,n){if(t.asset&&t.asset.extras&&t.asset.extras.rnLoaderOptions)for(let n in t.asset.extras.rnLoaderOptions)e[n]=t.asset.extras.rnLoaderOptions[n];for(let t in n)e[t]=n[t];return n&&n.loaderExtension&&"string"==typeof n.loaderExtension&&(null!=Rn[n.loaderExtension]?e.loaderExtension=Rn[n.loaderExtension].getInstance():(console.error(`${n.loaderExtension} not found!`),e.loaderExtension=void 0)),e}_loadAsBinaryJson(e,t,n,i,s,r){return We(this,void 0,void 0,function*(){if(1!==e.getUint32(4,t))throw new Error("invalid version field in this binary glTF file.");e.getUint32(8,t);let a=e.getUint32(12,t);if(0!==e.getUint32(16,t))throw new Error("invalid chunkType of chunk0 in this binary glTF file.");let o=n.slice(20,20+a),h=ke.a.arrayBufferToString(o),l=JSON.parse(h);i=this._getOptions(s,l,i);let c=n.slice(20+a),u=null;return r&&(u=r.substring(0,r.lastIndexOf("/"))+"/"),void 0===l.asset&&(l.asset={}),void 0===l.asset.extras&&(l.asset.extras={fileType:"glTF",version:"1"}),this._mergeExtendedJson(l,i.extendedJson),l.asset.extras.basePath=u,l.asset.extras.rnLoaderOptions=i,(yield this._loadInner(c,u,l,i))[0][0]})}_loadAsTextJson(e,t,n,i){return We(this,void 0,void 0,function*(){let s;return i&&(s=i.substring(0,i.lastIndexOf("/"))+"/"),void 0===e.asset&&(e.asset={}),void 0===e.asset.extras&&(e.asset.extras={fileType:"glTF",version:"1"}),t=this._getOptions(n,e,t),this._mergeExtendedJson(e,t.extendedJson),e.asset.extras.basePath=s,e.asset.extras.rnLoaderOptions=t,(yield this._loadInner(void 0,s,e,t))[0][0]})}_loadInner(e,t,n,i){let s=[];return s.push(this._loadResources(e,t,n,i,{shaders:[],buffers:[],images:[]})),s.push(new Promise((e,t)=>{this._loadJsonContent(n,i),e()})),Promise.all(s)}_loadJsonContent(e,t){this._convertToGltf2LikeStructure(e),this._loadDependenciesOfScenes(e),this._loadDependenciesOfNodes(e),this._loadDependenciesOfMeshes(e),this._loadDependenciesOfMaterials(e),this._loadDependenciesOfTextures(e),this._loadDependenciesOfJoints(e),this._loadDependenciesOfAnimations(e),this._loadDependenciesOfAccessors(e),this._loadDependenciesOfBufferViews(e)}_convertToGltf2LikeStructure(e){e.bufferDic=e.buffers,e.buffers=[];for(let t in e.bufferDic)e.buffers.push(e.bufferDic[t]);e.sceneDic=e.scenes,e.scenes=[];for(let t in e.sceneDic)e.scenes.push(e.sceneDic[t]);e.meshDic=e.meshes;{let t=0;e.nodeDic=e.nodes,e.nodes=[],e.nodesIndices=[];for(let n in e.nodeDic){e.nodesIndices.push(t);const i=e.nodeDic[n];i._index=t++,e.nodes.push(i)}}e.skinDic=e.skins,e.skins=[];for(let t in e.skinDic)e.skins.push(e.skinDic[t]);e.materialDic=e.materials,e.cameraDic=e.cameras,e.shaderDic=e.shaders,e.imageDic=e.images,e.animationDic=e.animations,e.animations=[];for(let t in e.animationDic)e.animations.push(e.animationDic[t]);e.textureDic=e.textures,e.samplerDic=e.samplers,e.accessorDic=e.accessors,e.bufferViewDic=e.bufferViews}_loadDependenciesOfScenes(e){for(let t in e.sceneDic){const n=e.sceneDic[t];n.nodeNames=n.nodes,n.nodes=[],n.nodesIndices=[];for(let t of n.nodeNames){n.nodes.push(e.nodeDic[t]);let i=0;for(let n in e.nodeDic){if(n===t)break;i++}n.nodesIndices.push(i)}}}_loadDependenciesOfNodes(e){for(let t of e.nodes){if(t.children){t.childrenNames=t.children.concat(),t.children=[],t.childrenIndices=[];for(let n of t.childrenNames){const i=e.nodeDic[n];t.children.push(i),t.childrenIndices.push(i._index)}}if(void 0!==t.meshes&&void 0!==e.meshes){t.meshNames=t.meshes,t.meshes=[];for(let n of t.meshNames)t.meshes.push(e.meshDic[n]);if(t.mesh=t.meshes[1],null==t.meshes||0===t.meshes.length)t.mesh=t.meshes[0];else{const e={name:"",primitives:[]};for(let n=0;n<t.meshes.length;n++)e.name+="_"+t.meshes[n].name,Array.prototype.push.apply(e.primitives,t.meshes[n].primitives);e.name+="_merged",t.mesh=e,t.meshes=void 0}}void 0!==t.skin&&void 0!==e.skins&&"string"==typeof t.skin&&(t.skinName=t.skin,t.skin=e.skinDic[t.skinName]),void 0!==t.camera&&void 0!==e.cameras&&(t.cameraName=t.camera,t.camera=e.cameraDic[t.cameraName])}}_loadDependenciesOfMeshes(e){for(let t in e.meshDic){const n=e.meshDic[t];for(let t of n.primitives){void 0!==t.material&&(t.materialName=t.material,t.material=e.materialDic[t.materialName]),t.attributeNames=Object.assign({},t.attributes),t.attributes=[];for(let n in t.attributeNames)if(null!=t.attributeNames[n]){const i=t.attributeNames[n];let s=e.accessorDic[i];"JOINT"===n?(n="JOINTS_0",delete t.attributes.JOINT):"WEIGHT"===n&&(n="WEIGHTS_0",delete t.attributes.WEIGHT),s.extras={toGetAsTypedArray:!0,attributeName:n},t.attributes.push(s)}void 0!==t.indices&&(t.indicesName=t.indices,t.indices=e.accessorDic[t.indicesName])}}}_isKHRMaterialsCommon(e){return void 0!==e.extensions&&void 0!==e.extensions.KHR_materials_common}_loadDependenciesOfMaterials(e){if(e.materials)for(let t in e.materials){let n=e.materials[t];const i=n;this._isKHRMaterialsCommon(n)&&(n=n.extensions.KHR_materials_common);const s=(t,s)=>{for(let r in t){let a=null;if(s){if(void 0===(a=t[r].value))continue}else a=t[r];if("string"==typeof a){let t=a;"diffuse"===r||"CONSTANT"===n.technique&&"ambient"===r?(i.diffuseColorTexture={},i.diffuseColorTexture.texture=e.textures[a]):"emission"===r&&t.match(/_normal$/)&&(i.emissionTexture={},i.emissionTexture.texture=e.textures[a]),i.extras={},i.extras.technique=n.technique}else"diffuse"===r&&(i.diffuseColorFactor=a)}};s(n.values,!1),n.technique&&e.techniques&&void 0!==e.techniques[n.technique]&&s(e.techniques[n.technique].parameters,!0)}}_loadDependenciesOfTextures(e){if(e.textures)for(let t in e.textureDic){const n=e.textureDic[t];void 0!==n.sampler&&(n.samplerName=n.sampler,n.sampler=e.samplerDic[n.samplerName]),void 0!==n.source&&(n.sourceName=n.source,n.image=e.imageDic[n.sourceName])}}_loadDependenciesOfJoints(e){if(e.skins)for(let t in e.skinDic){const n=e.skinDic[t];n.joints=[],n.jointsIndices=[];for(let t of n.jointNames){const i=e.nodeDic[t];n.joints.push(i),n.jointsIndices.push(i._index)}if(n.skeletonNames=n.skeletons,n.skeletonNames)for(let t of n.skeletonNames)n.skeleton=n.skeletons.push(e.nodeDic[t]);else n.skeleton=n.joints[0];n.skeletonIndex=n.skeleton._index,n.inverseBindMatricesName=n.inverseBindMatrices,n.inverseBindMatrices=e.accessorDic[n.inverseBindMatricesName],n.joints_tmp=n.joints,n.joints=[];for(let t of n.joints_tmp)n.joints.push(e.nodeDic[t.name]);n.joints_tmp=void 0}}_loadDependenciesOfAnimations(e){if(e.animations)for(let t in e.animationDic){const n=e.animationDic[t];n.samplerDic=n.samplers,n.samplers=[];for(let t of n.channels)t.sampler=n.samplerDic[t.sampler],t.target.node=e.nodeDic[t.target.id],t.target.nodeIndex=t.target.node._index,t.sampler.input=e.accessors[n.parameters.TIME],t.sampler.output=e.accessors[n.parameters[t.target.path]],n.samplers.push(t.sampler),"rotation"===t.target.path&&(void 0===t.sampler.output.extras&&(t.sampler.output.extras={}),t.sampler.output.extras.quaternionIfVec4=!0);n.channelDic=n.channels,n.channels=[];for(let e of n.channelDic)n.channels.push(e)}}_loadDependenciesOfAccessors(e){for(let t in e.accessorDic){const n=e.accessorDic[t];void 0!==n.bufferView&&(n.bufferViewName=n.bufferView,n.bufferView=e.bufferViewDic[n.bufferViewName])}}_loadDependenciesOfBufferViews(e){for(let t in e.bufferViewDic){const n=e.bufferViewDic[t];void 0!==n.buffer&&(n.bufferName=n.buffer,n.buffer=e.bufferDic[n.bufferName])}}_mergeExtendedJson(e,t){let n=null;if(t instanceof ArrayBuffer){const e=ke.a.arrayBufferToString(t);n=JSON.parse(e)}else"string"==typeof t?n=n=JSON.parse(t):"object"==typeof t&&(n=t);Object.assign(e,n)}_loadResources(e,t,n,i,s){let r=[];for(let a in n.buffers){let o,h,l=n.buffers[a];l.uri&&(o=l.uri.split("/"),h=o[o.length-1]),void 0===l.uri?r.push(new Promise((t,i)=>{s.buffers[a]=e,l.buffer=e,t(n)})):""===l.uri||"data:,"===l.uri?r.push(new Promise((t,i)=>{s.buffers[a]=e,l.buffer=e,t(n)})):l.uri.match(/^data:application\/(.*);base64,/)?r.push(new Promise((e,t)=>{let i=ke.a.dataUriToArrayBuffer(l.uri);s.buffers[a]=i,l.buffer=i,e(n)})):i.files&&i.files[h]?r.push(new Promise((e,t)=>{const r=i.files[h];s.buffers[a]=r,l.buffer=r,e(n)})):r.push(ke.a.loadResourceAsync(t+l.uri,!0,(e,t)=>{s.buffers[a]=t,l.buffer=t,e(n)},(e,t)=>{}))}for(let a in n.images){const o=a;let h,l=n.images[o];if(void 0!==l.extensions&&void 0!==l.extensions.KHR_binary_glTF)h=this._accessBinaryAsImage(l.extensions.KHR_binary_glTF.bufferView,n,e,l.extensions.KHR_binary_glTF.mimeType);else if(void 0===l.uri)h=this._accessBinaryAsImage(l.bufferView,n,e,l.mimeType);else{let e=l.uri;const n=e.split("/"),s=n[n.length-1];if(i.files&&i.files[s]){const e=i.files[s],t=s.split("."),n=t[t.length-1];h=this._accessArrayBufferAsImage(e,n)}else h=e.match(/^data:/)?e:t+e}r.push(new Promise((e,t)=>We(this,void 0,void 0,function*(){let t=new Image;if(t.crossOrigin="Anonymous",yield this._imgLoad(t,h),l.image=t,s.images[o]=t,h.match(/^data:/))e(n);else{const i=(t,i)=>{for(var s=new Uint8Array(i),r="",a=0,o=s.byteLength;a<o;a++)r+=String.fromCharCode(s[a]);const l=h.split(".");let c=l[l.length-1];t.src=this._getImageType(c)+window.btoa(r),t.onload=()=>{e(n)}};(()=>{var e=new XMLHttpRequest;e.onreadystatechange=function(t){return function(){4==e.readyState&&200==e.status&&i(t,e.response)}}(t),e.open("GET",h),e.responseType="arraybuffer",e.send()})()}s.images[o]=t})))}return Promise.all(r)}_accessBinaryAsImage(e,t,n,i){let s=this._sliceBufferViewToArrayBuffer(t,e,n);return this._accessArrayBufferAsImage(s,i)}_sliceBufferViewToArrayBuffer(e,t,n){let i=e.bufferViews[t],s=null!=i.byteOffset?i.byteOffset:0,r=i.byteLength;return n.slice(s,s+r)}_accessArrayBufferAsImage(e,t){let n=new Uint8Array(e),i="";for(let e=0,t=n.byteLength;e<t;e++)i+=String.fromCharCode(n[e]);return this._getImageType(t)+ke.a.btoa(i)}_imgLoad(e,t){return new Promise((n,i)=>{e.onload=()=>{n()},e.src=t})}_getImageType(e){let t=null;return t="image/jpeg"===e||"jpg"===e.toLowerCase()||"jpeg"===e.toLowerCase()?"data:image/jpeg;base64,":"image/png"==e||"png"===e.toLowerCase()?"data:image/png;base64,":"image/gif"==e||"gif"===e.toLowerCase()?"data:image/gif;base64,":"image/bmp"==e||"bmp"===e.toLowerCase()?"data:image/bmp;base64,":"data:image/unknown;base64,"}static getInstance(){return this.__instance||(this.__instance=new Ye),this.__instance}}var $e=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function a(e){try{h(i.next(e))}catch(e){r(e)}}function o(e){try{h(i.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(a,o)}h((i=i.apply(e,t||[])).next())})};class je{constructor(){}import(e,t){return $e(this,void 0,void 0,function*(){let n,i={files:{},loaderExtension:null,defaultMaterial:null,statesOfElements:[{targets:[],states:{enable:[],functions:{}},isTransparent:!0,opacity:1,isTextureImageToLoadPreMultipliedAlpha:!1}],extendedJson:void 0};if(t&&t.files)for(let e in t.files){const n=e.split("."),s=n[n.length-1];if("gltf"===s||"glb"===s)return yield this.__loadFromArrayBuffer(t.files[e],i,t,void 0).catch(e=>{console.log("this.__loadFromArrayBuffer error",e)})}try{n=yield fetch(e)}catch(e){console.log("this.__loadFromArrayBuffer",e)}const s=yield n.arrayBuffer();return yield this.__loadFromArrayBuffer(s,i,t,e).catch(e=>{console.log("this.__loadFromArrayBuffer error",e)})})}__loadFromArrayBuffer(e,t,n,i){return $e(this,void 0,void 0,function*(){const s=new DataView(e,0,20);let r;if(1179937895!==s.getUint32(0,!0)){const s=ke.a.arrayBufferToString(e),a=JSON.parse(s);r=yield this._loadAsTextJson(a,n,t,i).catch(e=>{console.log("this.__loadAsTextJson error",e)})}else r=yield this._loadAsBinaryJson(s,!0,e,n,t,i).catch(e=>{console.log("this.__loadAsBinaryJson error",e)});return r})}_getOptions(e,t,n){if(t.asset&&t.asset.extras&&t.asset.extras.rnLoaderOptions)for(let n in t.asset.extras.rnLoaderOptions)e[n]=t.asset.extras.rnLoaderOptions[n];for(let t in n)e[t]=n[t];return n&&n.loaderExtension&&"string"==typeof n.loaderExtension&&(null!=Rn[n.loaderExtension]?e.loaderExtension=Rn[n.loaderExtension].getInstance():(console.error(`${n.loaderExtension} not found!`),e.loaderExtension=void 0)),e}_loadAsBinaryJson(e,t,n,i,s,r){return $e(this,void 0,void 0,function*(){if(2!==e.getUint32(4,t))throw new Error("invalid version field in this binary glTF file.");e.getUint32(8,t);let a=e.getUint32(12,t);if(1313821514!==e.getUint32(16,t))throw new Error("invalid chunkType of chunk0 in this binary glTF file.");let o=n.slice(20,20+a),h=ke.a.arrayBufferToString(o),l=JSON.parse(h);i=this._getOptions(s,l,i);let c,u=n.slice(20+a+8),_=null;r&&(_=r.substring(0,r.lastIndexOf("/"))+"/"),void 0===l.asset.extras&&(l.asset.extras={fileType:"glTF",version:"2"}),this._mergeExtendedJson(l,i.extendedJson),l.asset.extras.basePath=_,l.asset.extras.rnLoaderOptions=i;try{c=yield this._loadInner(u,_,l,i)}catch(e){console.log("this._loadInner error in _loadAsBinaryJson",e)}return c[0][0]})}_loadAsTextJson(e,t,n,i){return $e(this,void 0,void 0,function*(){let s,r;i&&(s=i.substring(0,i.lastIndexOf("/"))+"/"),void 0===e.asset.extras&&(e.asset.extras={fileType:"glTF",version:"2"}),t=this._getOptions(n,e,t),this._mergeExtendedJson(e,t.extendedJson),e.asset.extras.basePath=s,e.asset.extras.rnLoaderOptions=t;try{r=yield this._loadInner(void 0,s,e,t)}catch(e){console.log("this._loadInner error in _loadAsTextJson",e)}return r[0][0]})}_loadInner(e,t,n,i){let s=[];return s.push(this._loadResources(e,t,n,i,{shaders:[],buffers:[],images:[]})),s.push(new Promise((e,t)=>{this._loadJsonContent(n,i),e()})),Promise.all(s)}_loadJsonContent(e,t){this._loadDependenciesOfScenes(e),this._loadDependenciesOfNodes(e),this._loadDependenciesOfMeshes(e),this._loadDependenciesOfMaterials(e),this._loadDependenciesOfTextures(e),this._loadDependenciesOfJoints(e),this._loadDependenciesOfAnimations(e),this._loadDependenciesOfAccessors(e),this._loadDependenciesOfBufferViews(e),void 0===e.asset&&(e.asset={}),void 0===e.asset.extras&&(e.asset.extras={})}_loadDependenciesOfScenes(e){for(let t of e.scenes){t.nodesIndices=t.nodes.concat();for(let n in t.nodesIndices)t.nodes[n]=e.nodes[t.nodes[n]]}}_loadDependenciesOfNodes(e){for(let t of e.nodes){if(t.children){t.childrenIndices=t.children.concat(),t.children=[];for(let n in t.childrenIndices)t.children[n]=e.nodes[t.childrenIndices[n]]}void 0!==t.mesh&&void 0!==e.meshes&&(t.meshIndex=t.mesh,t.mesh=e.meshes[t.meshIndex]),void 0!==t.skin&&void 0!==e.skins&&(t.skinIndex=t.skin,t.skin=e.skins[t.skinIndex],void 0===t.mesh.extras&&(t.mesh.extras={}),t.mesh.extras._skin=t.skin),void 0!==t.camera&&void 0!==e.cameras&&(t.cameraIndex=t.camera,t.camera=e.cameras[t.cameraIndex]),void 0!==t.extensions&&void 0!==e.extensions&&void 0!==e.extensions.KHR_lights_punctual&&(t.extensions.KHR_lights_punctual.lightIndex=t.extensions.KHR_lights_punctual.light,t.extensions.KHR_lights_punctual.light=e.extensions.KHR_lights_punctual.lights[t.extensions.KHR_lights_punctual.lightIndex])}}_loadDependenciesOfMeshes(e){for(let t of e.meshes)for(let n of t.primitives){void 0!==n.material&&(n.materialIndex=n.material,n.material=e.materials[n.materialIndex]),n.attributesindex=Object.assign({},n.attributes);for(let t in n.attributesindex)if(n.attributesindex[t]>=0){let i=e.accessors[n.attributesindex[t]];i.extras={toGetAsTypedArray:!0,attributeName:t},n.attributes[t]=i}else n.attributes[t]=void 0;if(null!=n.indices&&(n.indicesIndex=n.indices,n.indices=e.accessors[n.indicesIndex]),null!=n.targets){n.targetIndices=n.targets,n.targets=[];for(let t of n.targetIndices){const i={};for(let n in t)if(t[n]>=0){let s=e.accessors[t[n]];s.extras={toGetAsTypedArray:!0,attributeName:n},i[n]=s}else i[n]=void 0;n.targets.push(i)}}}}_checkRnGltfLoaderOptionsExist(e){return!(!e.asset.extras||!e.asset.extras.rnLoaderOptions)}_loadDependenciesOfMaterials(e){if(e.materials)for(let t of e.materials){if(t.pbrMetallicRoughness){let n=t.pbrMetallicRoughness.baseColorTexture;void 0!==n&&(n.texture=e.textures[n.index]);let i=t.pbrMetallicRoughness.metallicRoughnessTexture;void 0!==i&&(i.texture=e.textures[i.index])}let n=t.normalTexture;void 0!==n&&(n.texture=e.textures[n.index]);const i=t.occlusionTexture;void 0!==i&&(i.texture=e.textures[i.index]);const s=t.emissiveTexture;if(void 0!==s&&(s.texture=e.textures[s.index]),t.extensions&&t.extensions.ZOZO_materials_pbrMultiLayer){const n=t.extensions.ZOZO_materials_pbrMultiLayer;let i=n.diffuseTexture;void 0!==i&&(i.texture=e.textures[i.index]);let s=n.specularGlossinessTexture;void 0!==s&&(s.texture=e.textures[s.index])}this._checkRnGltfLoaderOptionsExist(e)&&e.asset.extras.rnLoaderOptions.loaderExtension&&e.asset.extras.rnLoaderOptions.loaderExtension.setTextures&&e.asset.extras.rnLoaderOptions.loaderExtension.setTextures(e,t)}}_loadDependenciesOfTextures(e){if(e.textures)for(let t of e.textures)void 0!==t.sampler&&(t.samplerIndex=t.sampler,t.sampler=e.samplers[t.samplerIndex]),void 0!==t.source&&(t.sourceIndex=t.source,t.image=e.images[t.sourceIndex])}_loadDependenciesOfJoints(e){if(e.skins)for(let t of e.skins){t.skeletonIndex=t.skeleton,t.skeleton=e.nodes[t.skeletonIndex],t.inverseBindMatricesIndex=t.inverseBindMatrices,t.inverseBindMatrices=e.accessors[t.inverseBindMatricesIndex],null==t.skeleton&&(t.skeletonIndex=t.joints[0],t.skeleton=e.nodes[t.skeletonIndex]),t.jointsIndices=t.joints,t.joints=[];for(let n of t.jointsIndices)t.joints.push(e.nodes[n])}}_loadDependenciesOfAnimations(e){if(e.animations)for(let t of e.animations){for(let n of t.channels)n.samplerIndex=n.sampler,n.sampler=t.samplers[n.samplerIndex],n.target.nodeIndex=n.target.node,n.target.node=e.nodes[n.target.nodeIndex];for(let n of t.channels)if(n.sampler.inputIndex=n.sampler.input,n.sampler.outputIndex=n.sampler.output,n.sampler.input=e.accessors[n.sampler.inputIndex],n.sampler.output=e.accessors[n.sampler.outputIndex],void 0===n.sampler.output.extras&&(n.sampler.output.extras={}),"rotation"===n.target.path&&(n.sampler.output.extras.quaternionIfVec4=!0),"weights"===n.target.path){const e=n.sampler.output.count/n.sampler.input.count;n.sampler.output.extras.weightCount=e}}}_loadDependenciesOfAccessors(e){for(let t of e.accessors)null==t.bufferView&&(t.bufferView=0),t.bufferViewIndex=t.bufferView,t.bufferView=e.bufferViews[t.bufferViewIndex]}_loadDependenciesOfBufferViews(e){for(let t of e.bufferViews)void 0!==t.buffer&&(t.bufferIndex=t.buffer,t.buffer=e.buffers[t.bufferIndex])}_mergeExtendedJson(e,t){let n=null;if(t instanceof ArrayBuffer){const e=ke.a.arrayBufferToString(t);n=JSON.parse(e)}else"string"==typeof t?n=n=JSON.parse(t):"object"==typeof t&&(n=t);Object.assign(e,n)}_loadResources(e,t,n,i,s){return $e(this,void 0,void 0,function*(){let r=[];for(let a in n.buffers){let o,h,l=n.buffers[a];l.uri&&(o=l.uri.split("/"),h=o[o.length-1]),void 0===l.uri?r.push(new Promise((t,i)=>{s.buffers[a]=e,l.buffer=e,t(n)})):l.uri.match(/^data:application\/(.*);base64,/)?r.push(new Promise((e,t)=>{let i=ke.a.dataUriToArrayBuffer(l.uri);s.buffers[a]=i,l.buffer=i,e(n)})):i.files&&i.files[h]?r.push(new Promise((e,t)=>{const r=i.files[h];s.buffers[a]=r,l.buffer=r,e(n)})):r.push(ke.a.loadResourceAsync(t+l.uri,!0,(e,t)=>{s.buffers[a]=t,l.buffer=t,e(n)},(e,t)=>{}))}yield Promise.all(r);for(let a in n.images){const o=a;let h,l=n.images[o];if(void 0===l.uri){let t=e;if(null==e){t=n.bufferViews[l.bufferView].buffer.buffer}h=this._accessBinaryAsImage(l.bufferView,n,t,l.mimeType)}else{let e=l.uri;const n=e.split("/"),s=n[n.length-1];if(i.files&&i.files[s]){const e=i.files[s],t=s.split("."),n=t[t.length-1];h=this._accessArrayBufferAsImage(e,n)}else h=e.match(/^data:/)?e:t+e}r.push(new Promise((e,t)=>$e(this,void 0,void 0,function*(){let t=new Image;if(t.crossOrigin="Anonymous",yield this._imgLoad(t,h),l.image=t,s.images[o]=t,h.match(/^data:/))e(n);else{const i=(t,i)=>{for(var s=new Uint8Array(i),r="",a=0,o=s.byteLength;a<o;a++)r+=String.fromCharCode(s[a]);const c=h.split(".");let u=c[c.length-1];t.src=this._getImageType(u)+window.btoa(r),t.name=l.name?l.name:l.uri,t.onload=()=>{e(n)}};(()=>{var e=new XMLHttpRequest;e.onreadystatechange=function(t){return function(){4==e.readyState&&200==e.status&&i(t,e.response)}}(t),e.open("GET",h),e.responseType="arraybuffer",e.send()})()}s.images[o]=t})))}return Promise.all(r).then().catch(e=>{console.log("Promise.all error",e)})})}_accessBinaryAsImage(e,t,n,i){let s=this._sliceBufferViewToArrayBuffer(t,e,n);return this._accessArrayBufferAsImage(s,i)}_sliceBufferViewToArrayBuffer(e,t,n){let i=e.bufferViews[t],s=null!=i.byteOffset?i.byteOffset:0,r=i.byteLength;return n.slice(s,s+r)}_accessArrayBufferAsImage(e,t){let n=new Uint8Array(e),i="";for(let e=0,t=n.byteLength;e<t;e++)i+=String.fromCharCode(n[e]);return this._getImageType(t)+ke.a.btoa(i)}_imgLoad(e,t){return new Promise((n,i)=>{e.onload=()=>{n()},e.src=t})}_getImageType(e){let t=null;return t="image/jpeg"===e||"jpg"===e.toLowerCase()||"jpeg"===e.toLowerCase()?"data:image/jpeg;base64,":"image/png"==e||"png"===e.toLowerCase()?"data:image/png;base64,":"image/gif"==e||"gif"===e.toLowerCase()?"data:image/gif;base64,":"image/bmp"==e||"bmp"===e.toLowerCase()?"data:image/bmp;base64,":"data:image/unknown;base64,"}static getInstance(){return this.__instance||(this.__instance=new je),this.__instance}}var Qe=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function a(e){try{h(i.next(e))}catch(e){r(e)}}function o(e){try{h(i.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(a,o)}h((i=i.apply(e,t||[])).next())})};class qe{constructor(){}importPointCloud(e,t,n){return Qe(this,void 0,void 0,function*(){let i,s={files:{},loaderExtension:null,defaultMaterial:null,statesOfElements:[{targets:[],states:{enable:[],functions:{}},isTransparent:!0,opacity:1,isTextureImageToLoadPreMultipliedAlpha:!1}],extendedJson:void 0};if(n&&n.files)for(let e in n.files){const i=e.split(".");if("drc"===i[i.length-1])return yield this.__decodeDraco(n.files[e],n,s,void 0,t).catch(e=>{console.log("this.__decodeDraco error",e)})}try{i=yield fetch(e)}catch(e){throw new Error("this.__loadFromArrayBuffer: "+e)}const r=yield i.arrayBuffer();return yield this.__decodeDraco(r,n,s,e,t).catch(e=>{console.log("this.__decodeDraco error",e)})})}__decodeDraco(e,t,n,i,s){return Qe(this,void 0,void 0,function*(){let r,a;return yield this.__decodeBuffer(e,s).then(e=>Qe(this,void 0,void 0,function*(){r=JSON.stringify(e),a=JSON.parse(r)})),yield this._loadAsTextJson(a,t,n,i).catch(e=>{console.log("this.__loadAsTextJson error",e)})})}__decodeBuffer(e,t){const n=new DracoDecoderModule,i=new n.Decoder,s=this.__getGeometryFromDracoBuffer(n,i,e);if(null==s)throw new Error("invalid dracoGeometry.");if(s.geometryType!==n.POINT_CLOUD)throw new Error("invalid geometryType of drc file.");if(-1===i.GetAttributeId(s,n.POSITION))throw n.destroy(i),n.destroy(s),new Error("Draco: No position attribute found.");const r=["POSITION","NORMAL","COLOR","TEX_COORD"],a=s.num_points(),o=[],h=[];let l=0;for(let e=0;e<r.length;e++){const t=i.GetAttributeId(s,n[r[e]]);if(-1===t){r.splice(e,1),e--;continue}const c=i.GetAttribute(s,t),u=new n.DracoFloat32Array;i.GetAttributeFloatForAllPoints(s,c,u),o[e]=u;let _=c.num_components();h[e]=_,"COLOR"===r[e]?l+=4*a:l+=a*_}const c=new Float32Array(l);for(let e=0,t=0;e<r.length;e++){if("COLOR"===r[e]&&3===h[e])for(var u=0;u<a;t+=4,u+=3)c[t]=o[e].GetValue(u),c[t+1]=o[e].GetValue(u+1),c[t+2]=o[e].GetValue(u+2),c[t+3]=1;else if("TEX_COORD"===r[e])for(u=0;u<a;t+=2,u++)c[t]=o[e].GetValue(2*u),c[t+1]=1-o[e].GetValue(2*u+1);else for(u=0;u<a*h[e];t++,u++)c[t]=o[e].GetValue(u);n.destroy(o[e])}return n.destroy(i),n.destroy(s),this.__decodedBufferToJSON(c,a,r,h,t)}__decodedBufferToJSON(e,t,n,i,s){return Qe(this,void 0,void 0,function*(){let r={asset:{version:"2.0"},nodes:[{name:"Node",mesh:0}],scenes:[{nodes:[0]}]};yield this.__convertBufferToURI(e.buffer,"application/octet-stream").then(t=>{r.buffers=[{name:"input",byteLength:e.byteLength,uri:t}]}).catch(e=>{console.log("this.__convertBufferToURI error:",e)});const a=[],o=[];let h=0;for(let e=0,s=0;e<n.length;s++){const r=i[e],l="VEC"+r;let c=0;for(;e<n.length&&r===i[e];)a.push({name:"point-cloud_"+n[e].toLowerCase()+"s",componentType:5126,count:t,type:l,bufferView:s,byteOffset:c}),"COLOR"===n[e]?c+=4*t*4:c+=t*i[e]*4,e++;o[s]={name:"bufferView_"+s,buffer:0,byteLength:c,byteOffset:h,byteStride:4*r,target:34962},h+=c}r.accessors=a,r.bufferViews=o;const l={name:"Node-Mesh",primitives:[{mode:0}]},c={};for(let e=0;e<n.length;e++)if("TEX_COORD"!==n[e])c[n[e]]=e;else{if(!s)continue;c.TEXCOORD_0=e;try{let e=yield fetch(s);const t=yield e.arrayBuffer(),n="image/jpeg";yield this.__convertBufferToURI(t,n).then(e=>{r.images=[{mimeType:n,uri:e}],r.textures=[{source:0}],r.materials=[{pbrMetallicRoughness:{baseColorTexture:{index:0},metallicFactor:0}}],l.primitives[0].material=0}).catch(e=>{console.log("this.__convertBufferToURI error:",e)})}catch(e){throw new Error("jpg load error")}}return l.primitives[0].attributes=c,r.meshes=[l],new Promise((e,t)=>{e(r)})})}__convertBufferToURI(e,t){return new Promise((n,i)=>{var s=new Blob([e],{type:t}),r=new FileReader;r.onload=e=>{n(r.result)},r.onerror=e=>{i(r.error)},r.readAsDataURL(s)})}importDirect(e,t){return Qe(this,void 0,void 0,function*(){let n,i={files:{},loaderExtension:null,defaultMaterial:null,statesOfElements:[{targets:[],states:{enable:[],functions:{}},isTransparent:!0,opacity:1,isTextureImageToLoadPreMultipliedAlpha:!1}],extendedJson:void 0};if(t&&t.files)for(let e in t.files){const n=e.split("."),s=n[n.length-1];if("gltf"===s||"glb"===s)return yield this.__loadFromArrayBuffer(t.files[e],t,i,void 0).catch(e=>{console.log("this.__loadFromArrayBuffer error",e)})}try{n=yield fetch(e)}catch(e){console.log("this.__loadFromArrayBuffer",e)}const s=yield n.arrayBuffer();return this.__decodeDracoDirect(s,t)})}__decodeDracoDirect(e,t){const n=new DracoDecoderModule,i=new n.Decoder,s=this.__getGeometryFromDracoBuffer(n,i,e);if(null==s)return;if(s.geometryType!==n.POINT_CLOUD)throw new Error("invalid geometryType of drc file.");const r=[],a=[],o=[];this.__getPositions(n,i,s,r,a,o),this.__getColors(n,i,s,r,a,o),this.__getNormals(n,i,s,r,a,o);const h=Re.createPrimitive({attributeCompositionTypes:r,attributeSemantics:a,attributes:o,material:Le.createClassicUberMaterial({isSkinning:!1,isLighting:!0}),primitiveMode:y.Points});return n.destroy(i),n.destroy(s),new Promise((e,t)=>{e(h)})}__getGeometryFromDracoBuffer(e,t,n){const i=new e.DecoderBuffer;i.Init(new Int8Array(n),n.byteLength);const s=t.GetEncodedGeometryType(i);let r,a;if(s===e.TRIANGULAR_MESH)r=new e.Mesh,a=t.DecodeBufferToMesh(i,r);else if(s===e.POINT_CLOUD)r=new e.PointCloud,a=t.DecodeBufferToPointCloud(i,r);else{const e="Unknown geometry type.";console.error(e)}if(r.geometryType=s,!a.ok()||0==r.ptr){let n="Decoding failed: ";return n+=a.error_msg(),console.error(n),e.destroy(t),void e.destroy(r)}return e.destroy(i),r}__getPositions(e,t,n,i,s,r){const a=t.GetAttributeId(n,e.POSITION);if(-1===a)throw e.destroy(t),e.destroy(n),new Error("Draco: No position attribute found.");const o=t.GetAttribute(n,a),h=new e.DracoFloat32Array;t.GetAttributeFloatForAllPoints(n,o,h);const l=3*n.num_points(),c=new Float32Array(l);for(var u=0;u<l;u+=1)c[u]=h.GetValue(u);return i.push(S.a.Vec3),s.push(b.a.Position),r.push(c),e.destroy(h),c}__getColors(e,t,n,i,s,r){const a=t.GetAttributeId(n,e.COLOR);if(-1===a)return null;{const o=t.GetAttribute(n,a),h=new e.DracoFloat32Array;t.GetAttributeFloatForAllPoints(n,o,h);const l=n.num_points(),c=o.num_components(),u=4*l,_=new Float32Array(u);for(let e=0;e<u;e+=c)_[e]=h.GetValue(e),_[e+1]=h.GetValue(e+1),_[e+2]=h.GetValue(e+2),_[e+3]=4==c?h.GetValue(e+3):1;return i.push(S.a.Vec3),s.push(b.a.Color0),r.push(_),e.destroy(h),_}}__getNormals(e,t,n,i,s,r){const a=t.GetAttributeId(n,e.NORMAL);if(-1===a)return null;{const h=t.GetAttribute(n,a),l=new e.DracoFloat32Array;t.GetAttributeFloatForAllPoints(n,h,l);const c=3*n.num_points(),u=new Float32Array(c);for(var o=0;o<c;o+=1)u[o]=l.GetValue(o);return i.push(S.a.Vec3),s.push(b.a.Normal),r.push(u),e.destroy(l),u}}__loadFromArrayBuffer(e,t,n,i){return Qe(this,void 0,void 0,function*(){const s=new DataView(e,0,20);let r;if(1179937895!==s.getUint32(0,!0)){const s=ke.a.arrayBufferToString(e),a=JSON.parse(s);r=yield this._loadAsTextJson(a,t,n,i).catch(e=>{console.log("this.__loadAsTextJson error",e)})}else r=yield this._loadAsBinaryJson(s,!0,e,t,n,i).catch(e=>{console.log("this.__loadAsBinaryJson error",e)});return r})}_getOptions(e,t,n){if(t.asset&&t.asset.extras&&t.asset.extras.rnLoaderOptions)for(let n in t.asset.extras.rnLoaderOptions)e[n]=t.asset.extras.rnLoaderOptions[n];for(let t in n)e[t]=n[t];return e}_loadAsBinaryJson(e,t,n,i,s,r){return Qe(this,void 0,void 0,function*(){if(2!==e.getUint32(4,t))throw new Error("invalid version field in this binary glTF file.");e.getUint32(8,t);let a=e.getUint32(12,t);if(1313821514!==e.getUint32(16,t))throw new Error("invalid chunkType of chunk0 in this binary glTF file.");let o=n.slice(20,20+a),h=ke.a.arrayBufferToString(o),l=JSON.parse(h);i=this._getOptions(s,l,i);let c,u=n.slice(20+a+8),_=null;r&&(_=r.substring(0,r.lastIndexOf("/"))+"/"),void 0===l.asset.extras&&(l.asset.extras={fileType:"glTF",version:"2"}),this._mergeExtendedJson(l,i.extendedJson),l.asset.extras.basePath=_;try{c=yield this._loadInner(u,_,l,i)}catch(e){console.log("this._loadInner error in _loadAsBinaryJson",e)}return c[0][0]})}_loadAsTextJson(e,t,n,i){return Qe(this,void 0,void 0,function*(){let s,r;i&&(s=i.substring(0,i.lastIndexOf("/"))+"/"),void 0===e.asset.extras&&(e.asset.extras={fileType:"glTF",version:"2"}),t=this._getOptions(n,e,t),this._mergeExtendedJson(e,t.extendedJson),e.asset.extras.basePath=s;try{r=yield this._loadInner(void 0,s,e,t)}catch(e){console.log("this._loadInner error in _loadAsTextJson",e)}return r[0][0]})}_loadInner(e,t,n,i){let s=[];return s.push(this._loadResources(e,t,n,i,{shaders:[],buffers:[],images:[]})),s.push(new Promise((e,t)=>{this._loadJsonContent(n,i),e()})),Promise.all(s)}_loadJsonContent(e,t){this._loadDependenciesOfScenes(e),this._loadDependenciesOfNodes(e),this._loadDependenciesOfMeshes(e),this._loadDependenciesOfMaterials(e),this._loadDependenciesOfTextures(e),this._loadDependenciesOfJoints(e),this._loadDependenciesOfAnimations(e),this._loadDependenciesOfAccessors(e),this._loadDependenciesOfBufferViews(e),void 0===e.asset&&(e.asset={}),void 0===e.asset.extras&&(e.asset.extras={})}_loadDependenciesOfScenes(e){for(let t of e.scenes){t.nodesIndices=t.nodes.concat();for(let n in t.nodesIndices)t.nodes[n]=e.nodes[t.nodes[n]]}}_loadDependenciesOfNodes(e){for(let t of e.nodes){if(t.children){t.childrenIndices=t.children.concat(),t.children=[];for(let n in t.childrenIndices)t.children[n]=e.nodes[t.childrenIndices[n]]}void 0!==t.mesh&&void 0!==e.meshes&&(t.meshIndex=t.mesh,t.mesh=e.meshes[t.meshIndex]),void 0!==t.skin&&void 0!==e.skins&&(t.skinIndex=t.skin,t.skin=e.skins[t.skinIndex],void 0===t.mesh.extras&&(t.mesh.extras={}),t.mesh.extras._skin=t.skin),void 0!==t.camera&&void 0!==e.cameras&&(t.cameraIndex=t.camera,t.camera=e.cameras[t.cameraIndex])}}_loadDependenciesOfMeshes(e){for(let t of e.meshes)for(let n of t.primitives){void 0!==n.material&&(n.materialIndex=n.material,n.material=e.materials[n.materialIndex]),n.attributesindex=Object.assign({},n.attributes);for(let t in n.attributesindex)if(n.attributesindex[t]>=0){let i=e.accessors[n.attributesindex[t]];i.extras={toGetAsTypedArray:!0,attributeName:t},n.attributes[t]=i}else n.attributes[t]=void 0;if(null!=n.indices&&(n.indicesIndex=n.indices,n.indices=e.accessors[n.indicesIndex]),null!=n.targets){n.targetIndices=n.targets,n.targets=[];for(let t of n.targetIndices){const i={};for(let n in t)if(t[n]>=0){let s=e.accessors[t[n]];s.extras={toGetAsTypedArray:!0,attributeName:n},i[n]=s}else i[n]=void 0;n.targets.push(i)}}}}_loadDependenciesOfMaterials(e){if(e.materials)for(let t of e.materials){if(t.pbrMetallicRoughness){let n=t.pbrMetallicRoughness.baseColorTexture;void 0!==n&&(n.texture=e.textures[n.index]);let i=t.pbrMetallicRoughness.metallicRoughnessTexture;void 0!==i&&(i.texture=e.textures[i.index])}let n=t.normalTexture;void 0!==n&&(n.texture=e.textures[n.index]);const i=t.occlusionTexture;void 0!==i&&(i.texture=e.textures[i.index]);const s=t.emissiveTexture;void 0!==s&&(s.texture=e.textures[s.index])}}_loadDependenciesOfTextures(e){if(e.textures)for(let t of e.textures)void 0!==t.sampler&&(t.samplerIndex=t.sampler,t.sampler=e.samplers[t.samplerIndex]),void 0!==t.source&&(t.sourceIndex=t.source,t.image=e.images[t.sourceIndex])}_loadDependenciesOfJoints(e){if(e.skins)for(let t of e.skins){t.skeletonIndex=t.skeleton,t.skeleton=e.nodes[t.skeletonIndex],t.inverseBindMatricesIndex=t.inverseBindMatrices,t.inverseBindMatrices=e.accessors[t.inverseBindMatricesIndex],null==t.skeleton&&(t.skeletonIndex=t.joints[0],t.skeleton=e.nodes[t.skeletonIndex]),t.jointsIndices=t.joints,t.joints=[];for(let n of t.jointsIndices)t.joints.push(e.nodes[n])}}_loadDependenciesOfAnimations(e){if(e.animations)for(let t of e.animations){for(let n of t.channels)n.samplerIndex=n.sampler,n.sampler=t.samplers[n.samplerIndex],n.target.nodeIndex=n.target.node,n.target.node=e.nodes[n.target.nodeIndex];for(let n of t.channels)if(n.sampler.inputIndex=n.sampler.input,n.sampler.outputIndex=n.sampler.output,n.sampler.input=e.accessors[n.sampler.inputIndex],n.sampler.output=e.accessors[n.sampler.outputIndex],void 0===n.sampler.output.extras&&(n.sampler.output.extras={}),"rotation"===n.target.path&&(n.sampler.output.extras.quaternionIfVec4=!0),"weights"===n.target.path){const e=n.sampler.output.count/n.sampler.input.count;n.sampler.output.extras.weightCount=e}}}_loadDependenciesOfAccessors(e){for(let t of e.accessors)null==t.bufferView&&(t.bufferView=0),t.bufferViewIndex=t.bufferView,t.bufferView=e.bufferViews[t.bufferViewIndex]}_loadDependenciesOfBufferViews(e){for(let t of e.bufferViews)void 0!==t.buffer&&(t.bufferIndex=t.buffer,t.buffer=e.buffers[t.bufferIndex])}_mergeExtendedJson(e,t){let n=null;if(t instanceof ArrayBuffer){const e=ke.a.arrayBufferToString(t);n=JSON.parse(e)}else"string"==typeof t?n=n=JSON.parse(t):"object"==typeof t&&(n=t);Object.assign(e,n)}_loadResources(e,t,n,i,s){let r=[];for(let a in n.buffers){let o,h,l=n.buffers[a];l.uri&&(o=l.uri.split("/"),h=o[o.length-1]),void 0===l.uri?r.push(new Promise((t,i)=>{s.buffers[a]=e,l.buffer=e,t(n)})):l.uri.match(/^data:application\/(.*);base64,/)?r.push(new Promise((e,t)=>{let i=ke.a.dataUriToArrayBuffer(l.uri);s.buffers[a]=i,l.buffer=i,e(n)})):i.files&&i.files[h]?r.push(new Promise((e,t)=>{const r=i.files[h];s.buffers[a]=r,l.buffer=r,e(n)})):r.push(ke.a.loadResourceAsync(t+l.uri,!0,(e,t)=>{s.buffers[a]=t,l.buffer=t,e(n)},(e,t)=>{}))}for(let a in n.images){const o=a;let h,l=n.images[o];if(void 0===l.uri)h=this._accessBinaryAsImage(l.bufferView,n,e,l.mimeType);else{let e=l.uri;const n=e.split("/"),s=n[n.length-1];if(i.files&&i.files[s]){const e=i.files[s],t=s.split("."),n=t[t.length-1];h=this._accessArrayBufferAsImage(e,n)}else h=e.match(/^data:/)?e:t+e}r.push(new Promise((e,t)=>Qe(this,void 0,void 0,function*(){let t=new Image;if(t.crossOrigin="Anonymous",yield this._imgLoad(t,h),l.image=t,s.images[o]=t,h.match(/^data:/))e(n);else{const i=(t,i)=>{for(var s=new Uint8Array(i),r="",a=0,o=s.byteLength;a<o;a++)r+=String.fromCharCode(s[a]);const c=h.split(".");let u=c[c.length-1];t.src=this._getImageType(u)+window.btoa(r),t.name=l.name?l.name:l.uri,t.onload=()=>{e(n)}};(()=>{var e=new XMLHttpRequest;e.onreadystatechange=function(t){return function(){4==e.readyState&&200==e.status&&i(t,e.response)}}(t),e.open("GET",h),e.responseType="arraybuffer",e.send()})()}s.images[o]=t})))}return Promise.all(r).then().catch(e=>{console.log("Promise.all error",e)})}_accessBinaryAsImage(e,t,n,i){let s=this._sliceBufferViewToArrayBuffer(t,e,n);return this._accessArrayBufferAsImage(s,i)}_sliceBufferViewToArrayBuffer(e,t,n){let i=e.bufferViews[t],s=null!=i.byteOffset?i.byteOffset:0,r=i.byteLength;return n.slice(s,s+r)}_accessArrayBufferAsImage(e,t){let n=new Uint8Array(e),i="";for(let e=0,t=n.byteLength;e<t;e++)i+=String.fromCharCode(n[e]);return this._getImageType(t)+ke.a.btoa(i)}_imgLoad(e,t){return new Promise((n,i)=>{e.onload=()=>{n()},e.src=t})}_getImageType(e){let t=null;return t="image/jpeg"===e||"jpg"===e.toLowerCase()||"jpeg"===e.toLowerCase()?"data:image/jpeg;base64,":"image/png"==e||"png"===e.toLowerCase()?"data:image/png;base64,":"image/gif"==e||"gif"===e.toLowerCase()?"data:image/gif;base64,":"image/bmp"==e||"bmp"===e.toLowerCase()?"data:image/bmp;base64,":"data:image/unknown;base64,"}static getInstance(){return this.__instance||(this.__instance=new qe),this.__instance}}var He=n(34);class Ze{constructor(){}static getInstance(){return this.__instance||(this.__instance=new Ze),this.__instance}export(e){const t=Ze.__entityRepository._getEntities(),n={asset:{version:"2.0",generator:`Rhodonite (${window.Rn.VERSION})`}},i=e||"Rhodonite_"+(new Date).getTime();n.buffers=[{uri:i+".bin"}],n.bufferViews=[],n.accessors=[],n.materials=[{pbrMetallicRoughness:{baseColorFactor:[1,1,1,1]}}],this.countMeshes(n,t),this.createNodes(n,t),this.createMeshBinaryMetaData(n,t),this.createMeshes(n,t),this.createMaterials(n,t);const s=this.createWriteBinary(n,t);this.download(n,i,s)}createWriteBinary(e,t){const n=new ArrayBuffer(e.buffers[0].byteLength),i=new DataView(n);for(let t=0;t<e.accessors.length;t++){const n=e.accessors[t],s=n.accessor,r=s.compositionType,a=s.componentType,o=s.getDataViewSetter(a),h=n.count,l=e.bufferViews[n.bufferView].byteOffset;for(let e=0;e<h;e++)if(1===r.getNumberOfComponents()){const t=a.getSizeInBytes()*e,n=s.getScalar(e,{});i[o](l+t,n,!0)}else if(2===r.getNumberOfComponents()){const t=s.getVec2AsArray(e,{});for(let n=0;n<2;n++)i[o](l+a.getSizeInBytes()*(2*e+n),t[n],!0)}else if(3===r.getNumberOfComponents()){const t=s.getVec3AsArray(e,{});for(let n=0;n<3;n++)i[o](l+a.getSizeInBytes()*(3*e+n),t[n],!0)}else if(4===r.getNumberOfComponents()){const t=s.getVec4AsArray(e,{});for(let n=0;n<4;n++)i[o](l+a.getSizeInBytes()*(4*e+n),t[n],!0)}n.accessor=void 0}return n}countMeshes(e,t){let n=0;e.meshes=[];for(let e=0;e<t.length;e++){const i=t[e];i.getComponent(o.a)&&(i.gltfMeshIndex=n++)}}createMeshes(e,t){let n=0;e.meshes=[];for(let i=0;i<t.length;i++){const s=t[i],r=s.getComponent(o.a);if(r&&r.mesh){e.meshes[n]={};const t=e.meshes[n];t.primitives=[];const i=r.mesh.getPrimitiveNumber();for(let e=0;e<i;e++){t.primitives[e]={};const n=t.primitives[e],i=r.mesh.getPrimitiveAt(e),s=i.indicesAccessor;s&&(n.indices=s.gltfAccessorIndex,n.mode=i.primitiveMode.index);const a=i.attributeAccessors;n.attributes={};const o=n.attributes;for(let e=0;e<a.length;e++){const t=a[e];o[i.attributeSemantics[e].str]=t.gltfAccessorIndex}n.material=0}s.gltfMeshIndex=n++}}}createMaterials(e,t){let n=0,i=0,s=0,r=0;e.materials=[],e.textures=[],e.samplers=[],e.images=[],e.samplers[0]={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};for(let a=0;a<t.length;a++){const h=t[a].getComponent(o.a);if(h&&h.mesh){const t=e.meshes[n++],a=h.mesh.getPrimitiveNumber();for(let n=0;n<a;n++){const a=h.mesh.getPrimitiveAt(n),o=t.primitives[n],l=a.material;let c,u=1,_=1;null!=l?null==(c=l.getParameter(C.a.BaseColorFactor))?c=l.getParameter(C.a.DiffuseColorFactor):(u=l.getParameter(C.a.MetallicRoughnessFactor).x,_=l.getParameter(C.a.MetallicRoughnessFactor).y):c=new L.b(1,1,1,1);const m={pbrMetallicRoughness:{baseColorFactor:Array.prototype.slice.call(c.v),metallicFactor:u,roughnessFactor:_}};if(l){m.alphaMode=l.alphaMode.str;const t=t=>{if(t&&1!==t.width&&1!==t.height){let n=r,i=!1;for(let s=0;s<e.images.length;s++){e.images[s].uri===t.name&&(n=s,i=!0)}if(!i){e.images[r++]={uri:t.name};const n=t.htmlCanvasElement;if(n){n.toBlob(e=>{var n=document.createElement("a");const i=document.createEvent("MouseEvent");i.initEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),n.href=URL.createObjectURL(e),n.download=t.name,n.dispatchEvent(i)})}}return e.textures[s]={sampler:0,source:n},s++}return s};let n,i,a=l.getParameter(C.a.BaseColorTexture);if(null!=a)null!=(i=t(n=He.a.getRhodoniteTexture(a.y)))&&(m.pbrMetallicRoughness.baseColorTexture={index:i});else if(null!=(a=l.getParameter(C.a.DiffuseColorTexture))){let e=t(He.a.getRhodoniteTexture(a.y));null!=e&&(m.pbrMetallicRoughness.baseColorTexture={index:e})}a=l.getParameter(C.a.MetallicRoughnessTexture),null!=(i=t(n=He.a.getRhodoniteTexture(a.y)))&&(m.pbrMetallicRoughness.metallicRoughnessTexture={index:i}),a=l.getParameter(C.a.NormalTexture),null!=(i=t(n=He.a.getRhodoniteTexture(a.y)))&&(m.normalTexture={index:i}),a=l.getParameter(C.a.OcclusionTexture),null!=(i=t(n=He.a.getRhodoniteTexture(a.y)))&&(m.occlusionTexture={index:i}),a=l.getParameter(C.a.EmissiveTexture),null!=(i=t(n=He.a.getRhodoniteTexture(a.y)))&&(m.emissiveTexture={index:i})}e.materials.push(m),o.material=i++}}}}createNodes(e,t){e.nodes=[],e.scenes=[{nodes:[]}];const n=e.scenes[0],i=e.nodes;for(let e=0;e<t.length;e++){t[e].gltfNodeIndex=e}for(let e=0;e<t.length;e++){const s=t[e];i[e]={};const r=i[e];r.name=s.uniqueName,r.children=[];const a=s.getSceneGraph(),o=a.children;for(let e=0;e<o.length;e++){const t=o[e];r.children.push(t.entity.gltfNodeIndex)}r.matrix=Array.prototype.slice.call(s.getTransform().matrix.v),r.mesh=s.gltfMeshIndex,null==a.parent&&n.nodes.push(e)}}createMeshBinaryMetaData(e,t){let n=0,i=0;for(let s=0;s<t.length;s++){const r=t[s].getComponent(o.a);if(r&&r.mesh){const t=r.mesh.getPrimitiveNumber();for(let s=0;s<t;s++){const t=r.mesh.getPrimitiveAt(s),a=t.indicesAccessor;if(a){let t=!1;for(let n=0;n<e.bufferViews.length;n++){e.bufferViews[n].rnAccessor===a&&(t=!0,a.gltfAccessorIndex=n)}if(!t){e.bufferViews[n]={};const t=e.bufferViews[n];t.rnAccessor=a,t.buffer=0,t.byteLength=a.byteLength,t.byteOffset=i,t.target=34963,e.accessors[n]={};const s=e.accessors[n];s.bufferView=n,s.byteOffset=0,s.componentType=5123,s.count=a.elementCount,a.calcMinMax(),s.max=[a.max],s.min=[a.min],s.type="SCALAR",i+=a.byteLength,a.gltfAccessorIndex=n,n++,s.accessor=a}}const o=t.attributeAccessors;for(let t=0;t<o.length;t++){const s=o[t];let r=!1;for(let t=0;t<e.bufferViews.length;t++){e.bufferViews[t].rnAccessor===s&&(r=!0,s.gltfAccessorIndex=t)}if(!r){e.bufferViews[n]={};const r=e.bufferViews[n];r.rnAccessor=s,r.buffer=0,r.byteLength=o[t].byteLength,r.byteOffset=i,r.target=34962,e.accessors[n]={};const a=e.accessors[n];a.bufferView=n,a.byteOffset=0,a.componentType=5126,a.count=s.elementCount,s.calcMinMax(),a.max=Array.prototype.slice.call(s.max),a.min=Array.prototype.slice.call(s.min),a.type="VEC"+a.max.length,i+=s.byteLength,s.gltfAccessorIndex=n,n++,a.accessor=s}}}}}e.bufferViews.forEach(e=>{e.rnAccessor=void 0}),e.buffers[0].byteLength=i}download(e,t,n){let i=document.createElement("a"),s=document.createEvent("MouseEvent");i.download=t+".gltf",i.href="data:application/octet-stream,"+encodeURIComponent(JSON.stringify(e)),s.initEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(s),i=document.createElement("a"),(s=document.createEvent("MouseEvent")).initEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null);var r=new Blob([n],{type:"octet/stream"}),a=window.URL.createObjectURL(r);i.download=t+".bin",i.href=a,i.dispatchEvent(s)}}Ze.__entityRepository=i.a.getInstance();var Je=n(23),Ke=n(52),et=n(47),tt=n(50),nt=n(55),it=n(57),st=n(40),rt=n(51),at=n(53);class ot{constructor(){this.__instanceIdx=0,this.__primitives=[],this.__opaquePrimitives=[],this.__transparentPrimitives=[],this.weights=[],this.__morphPrimitives=[],this.__localAABB=new E.a,this.__vaoUids=[],this.__variationVBOUid=N.a.InvalidCGAPIResourceUid,this.__instances=[],this._attatchedEntityUID=at.a.invalidEntityUID,this.__instancesDirty=!0,this.__meshUID=++ot.__mesh_uid_count}static get originalMeshes(){return this.__originalMeshes}get variationVBOUid(){return this.isInstanceMesh()?this.__instanceOf.variationVBOUid:this.__variationVBOUid}getVaoUids(e){return this.isInstanceMesh()?this.__instanceOf.getVaoUids(e):this.__vaoUids[e]}_addMeshToInstanceArray(e){this.__instances.push(e),this.__instancesDirty=!0}addPrimitive(e){this.__instanceOf=void 0,this.__instanceIdx=0,null!=e.material&&e.material.isBlend()?this.__transparentPrimitives.push(e):this.__opaquePrimitives.push(e),this.__primitives=this.__opaquePrimitives.concat(this.__transparentPrimitives),ot.__originalMeshes.push(this)}setMesh(e){return e.isInstanceMesh()?(console.error("Don't set InstanceMesh."),!1):(this.__primitives.length=0,this.__instanceOf=e,e._addMeshToInstanceArray(this),this.__instanceIdx=e.instanceIndex+1,ot.__originalMeshes=ot.__originalMeshes.filter(e=>e!==this),!0)}isAllBlend(){return this.isInstanceMesh()?this.__instanceOf.isAllBlend():this.__transparentPrimitives.length>0&&0===this.__opaquePrimitives.length}isBlendPartially(){return this.isInstanceMesh()?this.__instanceOf.isBlendPartially():this.__transparentPrimitives.length>0&&this.__opaquePrimitives.length>0}isOpaque(){return this.isInstanceMesh()?this.__instanceOf.isOpaque():0===this.__transparentPrimitives.length&&this.__opaquePrimitives.length>0}isFirstOpaquePrimitiveAt(e){return this.isFirstOpaquePrimitiveAt(e)?this.__instanceOf.isFirstOpaquePrimitiveAt(e):this.__opaquePrimitives.length>0&&0===e}isFirstTransparentPrimitiveAt(e){return this.isFirstOpaquePrimitiveAt(e)?this.__instanceOf.isFirstTransparentPrimitiveAt(e):this.__transparentPrimitives.length>0&&this.__opaquePrimitives.length===e}__calcFaceNormalFor3Vertices(e,t,n,i,s,r){const a=n.x-t.x,o=n.y-t.y,h=n.z-t.z,l=i.x-t.x,c=i.y-t.y,u=i.z-t.z;let _=o*u-h*c,m=h*l-a*u,d=a*c-o*l,f=Math.sqrt(_*_+m*m+d*d);f<=1e-6&&(f=1e-4),_*=f=1/f,m*=f,d*=f;const p=new R.b(_,m,d);s.setVec3(e,p.x,p.y,p.z,{indicesAccessor:r}),s.setVec3(e+1,p.x,p.y,p.z,{indicesAccessor:r}),s.setVec3(e+2,p.x,p.y,p.z,{indicesAccessor:r})}__calcTangents(){for(let e of this.__primitives){if(-1!==e.attributeSemantics.indexOf(b.a.Tangent))continue;const t=e.attributeSemantics.indexOf(b.a.Texcoord0),n=e.attributeSemantics.indexOf(b.a.Normal);if(-1!==t&&-1!==n){const i=e.attributeSemantics.indexOf(b.a.Position),s=e.attributeAccessors[i],r=e.attributeAccessors[t],a=e.attributeAccessors[n],o=e.indicesAccessor;let h=3;e.primitiveMode!==y.TriangleStrip&&e.primitiveMode!==y.TriangleFan||(h=1);const l=e.getVertexCountAsIndicesBased(),c=w.a.getInstance().getBuffer(I.a.CPUGeneric),u=s.byteLength,_=c.takeBufferView({byteLengthToNeed:u,byteStride:0,isAoS:!1}).takeAccessor({compositionType:S.a.Vec3,componentType:T.a.Float,count:s.elementCount});for(let e=0;e<l-2;e+=h){const t=s.getVec3(e,{indicesAccessor:o}),n=s.getVec3(e+1,{indicesAccessor:o}),i=s.getVec3(e+2,{indicesAccessor:o}),h=r.getVec2(e,{indicesAccessor:o}),l=r.getVec2(e+1,{indicesAccessor:o}),c=r.getVec2(e+2,{indicesAccessor:o}),u=a.getVec3(e,{indicesAccessor:o}),m=a.getVec3(e+1,{indicesAccessor:o}),d=a.getVec3(e+2,{indicesAccessor:o});this.__calcTangentFor3Vertices(e,t,n,i,h,l,c,u,m,d,_,o)}e.setVertexAttribute(_,b.a.Tangent)}}}__calcTangentFor3Vertices(e,t,n,i,s,r,a,o,h,l,c,u){const _=this.__calcTangentPerVertex(t,n,i,s,r,a,o,h,l),m=this.__calcTangentPerVertex(n,i,t,r,a,s,o,h,l),d=this.__calcTangentPerVertex(i,t,n,a,s,r,o,h,l);c.setVec3(e,_.x,_.y,_.z,{indicesAccessor:u}),c.setVec3(e+1,m.x,m.y,m.z,{indicesAccessor:u}),c.setVec3(e+2,d.x,d.y,d.z,{indicesAccessor:u})}__calcTangentPerVertex(e,t,n,i,s,r,a,o,h){let l=[new R.b(e.x,i.x,i.y),new R.b(e.y,i.x,i.y),new R.b(e.z,i.x,i.y)],c=[new R.b(t.x,s.x,s.y),new R.b(t.y,s.x,s.y),new R.b(t.z,s.x,s.y)],u=[new R.b(n.x,r.x,r.y),new R.b(n.y,r.x,r.y),new R.b(n.z,r.x,r.y)],_=[],m=[];for(let e=0;e<3;e++){let t=R.b.subtract(c[e],l[e]),n=R.b.subtract(u[e],c[e]),i=R.b.cross(t,n),s=Math.abs(i.x)<Number.EPSILON;if(s)return console.assert(s,"Polygons or polygons on UV are degenerate!"),new R.b(0,0,0);_[e]=-i.y/i.x,m[e]=-i.z/i.x}if(_[0]*_[0]+_[1]*_[1]+_[2]*_[2]<Number.EPSILON){const e=R.b.cross(a,new R.b(t));_[0]=e.x,_[1]=e.y,_[2]=e.z}return R.b.normalize(new R.b(_[0],_[1],_[2]))}getPrimitiveAt(e){return this.isInstanceMesh()?this.__instanceOf.getPrimitiveAt(e):this.__primitives[e]}getPrimitiveNumber(){return this.isInstanceMesh()?this.__instanceOf.getPrimitiveNumber():this.__primitives.length}__calcFaceNormals(){for(let e of this.__primitives){const t=e.attributeSemantics.indexOf(b.a.Position),n=e.attributeAccessors[t],i=e.indicesAccessor;let s=3;e.primitiveMode!==y.TriangleStrip&&e.primitiveMode!==y.TriangleFan||(s=1);const r=e.getVertexCountAsIndicesBased(),a=w.a.getInstance().getBuffer(I.a.CPUGeneric),o=n.byteLength,h=a.takeBufferView({byteLengthToNeed:o,byteStride:0,isAoS:!1}).takeAccessor({compositionType:S.a.Vec3,componentType:T.a.Float,count:n.elementCount});for(let e=0;e<r-2;e+=s){const t=n.getVec3(e,{indicesAccessor:i}),s=n.getVec3(e+1,{indicesAccessor:i}),r=n.getVec3(e+2,{indicesAccessor:i});this.__calcFaceNormalFor3Vertices(e,t,s,r,h,i)}e.setVertexAttribute(h,b.a.FaceNormal)}}makeVerticesSepareted(){for(let e of this.__primitives)if(e.hasIndices()){const t=w.a.getInstance().getBuffer(I.a.CPUGeneric),n=e.getVertexCountAsIndicesBased(),i=e.indicesAccessor;for(let s in e.attributeAccessors){const r=e.attributeAccessors[s],a=r.elementSizeInBytes,o=t.takeBufferView({byteLengthToNeed:a*n,byteStride:0,isAoS:!1}).takeAccessor({compositionType:r.compositionType,componentType:r.componentType,count:n});for(let e=0;e<n;e++){const t=i.getScalar(e,{});o.setElementFromSameCompositionAccessor(e,r,t)}e.setVertexAttribute(o,e.attributeSemantics[s])}const s=e.indicesAccessor,r=s.elementSizeInBytes,a=t.takeBufferView({byteLengthToNeed:r*n,byteStride:0,isAoS:!1}).takeAccessor({compositionType:s.compositionType,componentType:s.componentType,count:n});for(let e=0;e<n;e++)a.setScalar(e,e,{});e.setIndices(a)}}__calcBaryCentricCoord(){for(let e in this.__primitives){let t=this.__primitives[e];const n=w.a.getInstance().getBuffer(I.a.CPUGeneric),i=t.attributeSemantics.indexOf(b.a.Position),s=t.attributeAccessors[i],r=t.indicesAccessor;let a=s.elementCount;r&&(a=r.elementCount);const o=4*a*4,h=n.takeBufferView({byteLengthToNeed:o,byteStride:0,isAoS:!1}).takeAccessor({compositionType:S.a.Vec4,componentType:T.a.Float,count:a});for(let e=0;e<a;e++){h.setVec4(e,e%3==0?1:0,e%3==1?1:0,e%3==2?1:0,e,{})}t.setVertexAttribute(h,b.a.BaryCentricCoord)}}__initMorphPrimitives(){if(0===this.weights.length)return;const e=w.a.getInstance().getBuffer(I.a.CPUGeneric);for(let t=0;t<this.__primitives.length;t++){const n=this.__primitives[t];if(null==this.__morphPrimitives[t]){const i=n.targets[0],s=new Map;i.forEach((t,n)=>{const i=e.takeBufferView({byteLengthToNeed:t.byteLength,byteStride:0,isAoS:!1}).takeAccessor({compositionType:t.compositionType,componentType:t.componentType,count:t.elementCount});s.set(n,i)});const r=new Re;r.setData(s,n.primitiveMode,n.material,n.indicesAccessor),r.setTargets(n.targets),this.__morphPrimitives[t]=r}}}__calcMorphPrimitives(){if(0!==this.weights.length)for(let e=0;e<this.__primitives.length;e++){const t=this.__morphPrimitives[e],n=this.__primitives[e];n.targets[0].forEach((e,i)=>{const s=t.getAttribute(i),r=s.elementCount;for(let e=0;e<r;e++)s.setElementFromSameCompositionAccessor(e,n.getAttribute(i))})}}get AABB(){if(this.__localAABB.isVanilla())for(let e of this.__primitives)this.__localAABB.mergeAABB(e.AABB);return this.__localAABB}get instanceIndex(){return this.__instanceIdx}isInstanceMesh(){return null!=this.__instanceOf}isOriginalMesh(){return!this.isInstanceMesh()}get meshUID(){return this.__meshUID}updateVariationVBO(){if(this.isInstanceMesh())return this.__instanceOf.updateVariationVBO();{if(!this.__instancesDirty)return!1;const t=N.a.getWebGLResourceRepository();this.__primitives.forEach((e,n)=>{this.__vaoUids[n]=t.createVertexArray()}),this.__variationVBOUid!=N.a.InvalidCGAPIResourceUid&&t.deleteVertexBuffer(this.__variationVBOUid);const n=this.__instances.length,i=new Float32Array(n+1);i[0]=this._attatchedEntityUID;for(var e=0;e<n;e++)i[e+1]=this.__instances[e]._attatchedEntityUID;return this.__variationVBOUid=t.createVertexBufferFromTypedArray(i),this.__instancesDirty=!1,!0}}deleteVariationVBO(){if(this.isInstanceMesh())return this.__instanceOf.updateVariationVBO();{const e=N.a.getWebGLResourceRepository();if(this.__variationVBOUid!==N.a.InvalidCGAPIResourceUid)return e.deleteVertexBuffer(this.__variationVBOUid),this.__vaoUids.forEach(t=>{e.deleteVertexArray(t)}),!0}return!1}get instanceCountIncludeOriginal(){return this.__instances.length+1}}ot.invalidateMeshUID=-1,ot.__mesh_uid_count=ot.invalidateMeshUID,ot.__originalMeshes=[];var ht=n(60),lt=n(59);class ct{constructor(){}static getInstance(){return this.__instance||(this.__instance=new ct),this.__instance}_getDefaultShader(e){return null}__generateEntity(e,t){const n=i.a.getInstance().createEntity(e);return n.tryToSetTag("SourceType",t.asset.extras.fileType),n.tryToSetTag("SourceTypeVersion",t.asset.extras.version),n}__generateGroupEntity(e){return this.__generateEntity([r.a,a.a],e)}__generateMeshEntity(e){return this.__generateEntity([r.a,a.a,o.a,h.a],e)}__generateCameraEntity(e){return this.__generateEntity([r.a,a.a,G.a],e)}__generateLightEntity(e){return this.__generateEntity([r.a,a.a,ht.a],e)}convertToRhodoniteObject(e){e.asset.extras.rnMeshesAtGltMeshIdx=[];const t=this.createRnBuffer(e),n=this.__setupObjects(e,t);this._setupTransform(e,n),this._setupSkeleton(e,n),this._setupHierarchy(e,n),this.__setupAnimation(e,n);const i=this.__generateGroupEntity(e);if(i.tryToSetUniqueName("FileRoot",!0),i.tryToSetTag("ObjectType","top"),e.scenes[0].nodesIndices)for(let t of e.scenes[0].nodesIndices)i.getSceneGraph().addChild(n[t].getSceneGraph());return i}_setupCamera(e){}createRnBuffer(e){const t=e.buffers[0];return new Ke.a({byteLength:t.byteLength,arrayBuffer:t.buffer,name:`gltf2Buffer_0_(${t.uri})`})}_setupTransform(e,t){for(let n in e.nodes){let i=t[n],s=e.nodes[n];s.translation&&(i.getTransform().translate=new R.b(s.translation[0],s.translation[1],s.translation[2])),s.scale&&(i.getTransform().scale=new R.b(s.scale[0],s.scale[1],s.scale[2])),s.rotation&&(i.getTransform().quaternion=new Je.a(s.rotation[0],s.rotation[1],s.rotation[2],s.rotation[3])),s.matrix&&(i.getTransform().matrix=new $.a(s.matrix,!0))}}_setupHierarchy(e,t){const n=t.map(e=>e.getSceneGraph());for(let t in e.nodes){const i=parseInt(t);let s=e.nodes[i];if(s.childrenIndices){let e=n[i];for(let t of s.childrenIndices){let i=n[t];e.addChild(i)}}}}__setupAnimation(e,t){if(e.animations)for(let t of e.animations)for(let e of t.samplers)this._accessBinaryWithAccessor(e.input),this._accessBinaryWithAccessor(e.output);const n=i.a.getInstance();if(e.animations)for(let i of e.animations)for(let e of i.channels){const i=e.sampler.input.extras.typedDataArray,s=e.sampler.output.extras.typedDataArray,r=null!=e.sampler.interpolation?e.sampler.interpolation:"LINEAR";let a="";a="translation"===e.target.path?"translate":"rotation"===e.target.path?"quaternion":e.target.path;let o=t[e.target.nodeIndex];if(o){n.addComponentsToEntity([nt.a],o.entityUID);const e=o.getComponent(nt.a);e&&e.setAnimation(a,i,s,it.a.fromString(r))}}}_setupSkeleton(e,t){if(null==e.skins)return;const n=i.a.getInstance();for(let t of e.skins)t.inverseBindMatrices&&this._accessBinaryWithAccessor(t.inverseBindMatrices);for(let i in e.nodes){let s,r=e.nodes[i],a=t[i].getSceneGraph();if(null!=r.skin){let e=t[i];n.addComponentsToEntity([K],e.entityUID),(s=e.getComponent(K))._jointIndices=r.skin.jointsIndices,null!=r.skin.bindShapeMatrix&&(s._bindShapeMatrix=new $.a(r.skin.bindShapeMatrix))}if(r.skin&&r.skin.skeleton&&(a.isRootJoint=!0,r.mesh)){const e=[];for(let n of r.skin.jointsIndices)e.push(t[n].getSceneGraph());s.joints=e}if(r.skin&&r.skin.joints)for(let e of r.skin.jointsIndices){t[e].getSceneGraph().jointIndex=e}r.skin&&null!=r.skin.inverseBindMatrices&&(s._inverseBindMatrices=r.skin.inverseBindMatrices.extras.typedDataArray)}}__setupObjects(e,t){const n=[];for(let s in e.nodes){let r,a=e.nodes[parseInt(s)];if(null!=a.mesh){let n=a.meshIndex;null==n&&(n=a.meshNames[0]);const i=this.__setupMesh(a,a.mesh,n,t,e);if(a.name&&i.tryToSetUniqueName(a.name,!0),a.mesh.name){i.getComponent(o.a).tryToSetUniqueName(a.mesh.name,!0)}r=i}else if(null!=a.camera){const t=this.__setupCamera(a.camera,e);a.name&&t.tryToSetUniqueName(a.name,!0),r=t}else if(a.extensions&&a.extensions.KHR_lights_punctual){r=this.__setupLight(a.extensions.KHR_lights_punctual.light,e)}else{const t=this.__generateGroupEntity(e);a.name&&t.tryToSetUniqueName(a.name,!0),r=t}if(n.push(r),null!=a.weights){i.a.getInstance().addComponentsToEntity([te],r.entityUID),r.getComponent(te).weights=a.weights}}return n}__setupLight(e,t){const n=this.__generateLightEntity(t),i=n.getComponent(ht.a);if(null!=e.name){i.tryToSetUniqueName(e.name,!0),i.type=lt.a.fromString(e.type);let t=new R.b(1,1,1),n=1;null!=e.color&&(t=new R.b(e.color)),null!=e.intensity&&(n=e.intensity),i.intensity=R.b.multiply(t,n),null!=e.range&&(i.range=e.range)}return n}__setupCamera(e,t){const n=this.__generateCameraEntity(t),i=n.getComponent(G.a);return i.direction=new R.b(0,0,-1),t.asset&&t.asset.LastSaved_ApplicationVendor&&(i.direction=new R.b(1,0,0),i.directionInner=new R.b(1,0,0)),i.up=new R.b(0,1,0),i.type=et.a.fromString(e.type),i.type===et.a.Perspective?(i.aspect=e.perspective.aspectRatio?e.perspective.aspectRatio:1,i.fovy=st.a.radianToDegree(e.perspective.yfov),i.zNear=e.perspective.znear,i.zFar=e.perspective.zfar?e.perspective.zfar:1e5):i.type===et.a.Orthographic&&(i.xmag=e.orthographic.zmag,i.ymag=e.orthographic.ymag,i.zNear=e.orthographic.znear,i.zFar=e.orthographic.zfar),n}__setupMesh(e,t,n,i,s){const r=this.__generateMeshEntity(s),a=s.asset.extras.rnMeshesAtGltMeshIdx[n];let h=y.Triangles;const l=r.getComponent(o.a),c=new ot;let u=c;if(null!=a)c.setMesh(a),u=a;else{for(let n in t.primitives){let a,o=t.primitives[n];null!=o.mode&&(h=y.from(o.mode));const l=new Map;if(o.extensions&&o.extensions.KHR_draco_mesh_compression){if(null==(a=this.__decodeDraco(o,i,s,l)))break}else{o.indices&&(a=this.__getRnAccessor(o.indices,i));for(let e in o.attributes){let t=o.attributes[e];const n=this.__getRnAccessor(t,i);l.set(b.a.fromString(t.extras.attributeName),n)}}const u=this.__setupMaterial(r,e,s,o.material),_=new Re;if(_.setData(l,h,u,a),null!=o.targets){const e=[];for(let t of o.targets){const n=new Map;for(let e in t){let s=t[e];const r=this.__getRnAccessor(s,i),a=this.__copyRnAccessorAndBufferView(r);n.set(b.a.fromString(e),a)}e.push(n)}_.setTargets(e)}c.addPrimitive(_)}t.weights&&(c.weights=t.weights)}return l.setMesh(c),s.asset.extras.rnMeshesAtGltMeshIdx[n]=u,r}__generateAppropreateMaterial(e,t,n,i){if(this._checkRnGltfLoaderOptionsExist(n)&&n.asset.extras.rnLoaderOptions.loaderExtension&&n.asset.extras.rnLoaderOptions.loaderExtension.isNeededToUseThisMaterial(n)){return n.asset.extras.rnLoaderOptions.loaderExtension.generateMaterial()}let s=V.a.maxMaterialInstanceForEachType;n.meshes.length>V.a.maxMaterialInstanceForEachType&&(s=n.meshes.length+V.a.maxMaterialInstanceForEachType/2);const r=null!=t.mesh&&null!=t.mesh.weights,a=null!=t.skin,o=null!=t.skin?`skin${null!=t.skinIndex?t.skinIndex:t.skinName}`:void 0;return null!=i&&i.pbrMetallicRoughness?Le.createPbrUberMaterial({isMorphing:r,isSkinning:a,isLighting:!0,additionalName:o,maxInstancesNumber:s}):Le.createClassicUberMaterial({isSkinning:a,isLighting:!0,additionalName:o,maxInstancesNumber:s})}static _createTexture(e,t){let n=t.asset.extras.rnLoaderOptions;const i=new tt.a;i.autoDetectTransparency=!0===n.autoDetectTextureTransparency,i.autoResize=!0===n.autoResizeTexture;const s=e.texture;if(s.image.image){const e=s.image.image;i.generateTextureFromImage(e),i.name=e.name}return i}__setupMaterial(e,t,n,i){let s=n.asset.extras.rnLoaderOptions,r=this.__generateAppropreateMaterial(e,t,n,i);if(null==i)return r;const a=i.pbrMetallicRoughness;if(null!=a){const e=a.baseColorFactor;null!=e&&r.setParameter(C.a.BaseColorFactor,new L.b(e));const t=a.baseColorTexture;if(null!=t){const e=ct._createTexture(t,n);r.setTextureParameter(C.a.BaseColorTexture,e)}const s=i.occlusionTexture;if(null!=s){const e=ct._createTexture(s,n);r.setTextureParameter(C.a.OcclusionTexture,e)}let o=a.metallicFactor;o=null!=o?o:1;let h=a.roughnessFactor;h=null!=h?h:1,r.setParameter(C.a.MetallicRoughnessFactor,new M.b(o,h));const l=a.metallicRoughnessTexture;if(null!=l){const e=ct._createTexture(l,n);r.setTextureParameter(C.a.MetallicRoughnessTexture,e)}}else{let e=_e.Phong.index;if(i.extras&&i.extras.technique){switch(i.extras.technique){case _e.Constant.str:e=_e.Constant.index;break;case _e.Lambert.str:e=_e.Lambert.index;break;case _e.BlinnPhong.str:e=_e.BlinnPhong.index;break;case _e.Phong.str:e=_e.Phong.index}r.setParameter(C.a.ShadingModel,e)}}const o=i.emissiveTexture;if(null!=o){const e=ct._createTexture(o,n);r.setTextureParameter(C.a.EmissiveTexture,e)}let h=i.alphaMode;null!=s&&s.alphaMode&&(h=s.alphaMode),null!=h&&(r.alphaMode=rt.a.fromString(h));const l=i.diffuseColorTexture;if(null!=l){const e=ct._createTexture(l,n);if(r.setTextureParameter(C.a.DiffuseColorTexture,e),this._checkRnGltfLoaderOptionsExist(n)&&n.asset.extras.rnLoaderOptions.loaderExtension){const e=n.asset.extras.rnLoaderOptions.loaderExtension;e.setUVTransformToTexture&&e.setUVTransformToTexture(r,l.texture.sampler)}}const c=i.diffuseColorFactor;null!=c&&r.setParameter(C.a.DiffuseColorFactor,new L.b(c));const u=i.normalTexture;if(null!=u){const e=ct._createTexture(u,n);r.setTextureParameter(C.a.NormalTexture,e)}if(this._checkRnGltfLoaderOptionsExist(n)&&n.asset.extras.rnLoaderOptions.loaderExtension){n.asset.extras.rnLoaderOptions.loaderExtension.setupMaterial(n,i,r)}return r}_checkRnGltfLoaderOptionsExist(e){return!(!e.asset.extras||!e.asset.extras.rnLoaderOptions)}_adjustByteAlign(e,t,n,i,s){return i%n!=0?new e(t.slice(i),0,s):new e(t,i,s)}_checkBytesPerComponent(e){var t=0;switch(e.componentType){case 5120:case 5121:t=1;break;case 5122:case 5123:t=2;break;case 5124:case 5125:case 5126:t=4}return t}_checkComponentNumber(e){var t=0;switch(e.type){case"SCALAR":t=1;break;case"VEC2":t=2;break;case"VEC3":t=3;break;case"VEC4":t=4;break;case"MAT4":t=16}return t}_checkDataViewMethod(e){var t="";switch(e.componentType){case 5120:t="getInt8";break;case 5121:t="getUint8";break;case 5122:t="getInt16";break;case 5123:t="getUint16";break;case 5124:t="getInt32";break;case 5125:t="getUint32";break;case 5126:t="getFloat32"}return t}static _isSystemLittleEndian(){return!!new Uint8Array(new Uint16Array([255]).buffer)[0]}_accessBinaryWithAccessor(e){var t=e.bufferView;const n=t.byteOffset+(void 0!==e.byteOffset?e.byteOffset:0);var i=t.buffer.buffer;let s=this._checkComponentNumber(e),r=this._checkBytesPerComponent(e),a=this._checkDataViewMethod(e);void 0===e.extras&&(e.extras={}),e.extras.componentN=s,e.extras.componentBytes=r,e.extras.dataViewMethod=a;var o=r*s*e.count,h=[];if(e.extras&&e.extras.toGetAsTypedArray)if(ct._isSystemLittleEndian())"getFloat32"===a?h=this._adjustByteAlign(Float32Array,i,4,n,o/r):"getInt8"===a?h=new Int8Array(i,n,o/r):"getUint8"===a?h=new Uint8Array(i,n,o/r):"getInt16"===a?h=this._adjustByteAlign(Int16Array,i,2,n,o/r):"getUint16"===a?h=this._adjustByteAlign(Uint16Array,i,2,n,o/r):"getInt32"===a?h=this._adjustByteAlign(Int32Array,i,4,n,o/r):"getUint32"===a&&(h=this._adjustByteAlign(Uint32Array,i,4,n,o/r));else{let t=new DataView(i,n,o),l=r*s,c=!0;for(let n=0;n<o;n+=l)switch(e.type){case"SCALAR":h.push(t[a](n,c));break;case"VEC2":h.push(t[a](n,c)),h.push(t[a](n+r,c));break;case"VEC3":h.push(t[a](n,c)),h.push(t[a](n+r,c)),h.push(t[a](n+2*r,c));break;case"VEC4":h.push(t[a](n,c)),h.push(t[a](n+r,c)),h.push(t[a](n+2*r,c)),h.push(t[a](n+3*r,c))}"getInt8"===a?h=new Int8Array(h):"getUint8"===a?h=new Uint8Array(h):"getInt16"===a?h=new Int16Array(h):"getUint16"===a?h=new Uint16Array(h):"getInt32"===a?h=new Int32Array(h):"getUint32"===a?h=new Uint32Array(h):"getFloat32"===a&&(h=new Float32Array(h))}else{let t=new DataView(i,n,o),l=r*s;e.extras&&e.extras.weightCount&&(l=r*s*e.extras.weightCount);let c=!0;for(let n=0;n<o;n+=l)switch(e.type){case"SCALAR":if(e.extras&&e.extras.weightCount){const i=[];for(let s=0;s<e.extras.weightCount;s++)i.push(t[a](n+r*s,c));h.push(i)}else h.push(t[a](n,c));break;case"VEC2":h.push(new M.b(t[a](n,c),t[a](n+r,c)));break;case"VEC3":h.push(new R.b(t[a](n,c),t[a](n+r,c),t[a](n+2*r,c)));break;case"VEC4":e.extras&&e.extras.quaternionIfVec4?h.push(new Je.a(t[a](n,c),t[a](n+r,c),t[a](n+2*r,c),t[a](n+3*r,c))):h.push(new L.b(t[a](n,c),t[a](n+r,c),t[a](n+2*r,c),t[a](n+3*r,c)));break;case"MAT4":let i=[];for(let e=0;e<16;e++)i[e]=t[a](n+r*e,c);h.push(new $.a(i,!0))}}return e.extras.typedDataArray=h,h}__addOffsetToIndices(e){const t=e.mesh.getPrimitiveNumber();let n=0;for(let i=0;i<t;i++){const t=e.mesh.getPrimitiveAt(i).indicesAccessor;if(t){const e=t.elementCount;for(let i=0;i<e;i++){const e=t.getScalar(i,{});t.setScalar(i,e+n,{})}n+=e}}}__getRnAccessor(e,t){const n=e.bufferView,i=t.takeBufferViewWithByteOffset({byteLengthToNeed:n.byteLength,byteStride:null!=n.byteStride?n.byteStride:0,byteOffset:null!=n.byteOffset?n.byteOffset:0,isAoS:!1});let s;return s=null!=e.byteStride?i.takeFlexibleAccessorWithByteOffset({compositionType:S.a.fromString(e.type),componentType:T.a.from(e.componentType),count:e.count,byteStride:e.byteStride,byteOffset:null!=e.byteOffset?e.byteOffset:0,max:e.max,min:e.min}):i.takeAccessorWithByteOffset({compositionType:S.a.fromString(e.type),componentType:T.a.from(e.componentType),count:e.count,byteOffset:null!=e.byteOffset?e.byteOffset:0,max:e.max,min:e.min})}__copyRnAccessorAndBufferView(e){const t=w.a.getInstance().getBuffer(I.a.GPUInstanceData).takeBufferView({byteLengthToNeed:4*e.elementCount*4,byteStride:16,isAoS:!1}).takeAccessor({compositionType:S.a.Vec4,componentType:T.a.Float,count:e.elementCount,max:e.max,min:e.min});for(let n=0;n<e.elementCount;n++)t.setElementFromAccessor(n,e);return t}__createRnAccessor(e,t,n,i){const s=i.takeBufferView({byteLengthToNeed:t*n*4,byteStride:0,isAoS:!1});let r;return r=null!=e.byteStride?s.takeFlexibleAccessorWithByteOffset({compositionType:S.a.fromString(e.type),componentType:T.a.from(e.componentType),count:t,byteStride:e.byteStride,byteOffset:null!=e.byteOffset?e.byteOffset:0,max:e.max,min:e.min}):s.takeAccessorWithByteOffset({compositionType:S.a.fromString(e.type),componentType:T.a.from(e.componentType),count:t,byteOffset:null!=e.byteOffset?e.byteOffset:0,max:e.max,min:e.min})}__getRnBufferView(e,t){return t.takeBufferViewWithByteOffset({byteLengthToNeed:e.byteLength,byteStride:null!=e.byteStride?e.byteStride:0,byteOffset:null!=e.byteOffset?e.byteOffset:0,isAoS:!1})}__getGeometryFromDracoBuffer(e,t,n){const i=new e.DecoderBuffer;i.Init(new Int8Array(n),n.byteLength);const s=t.GetEncodedGeometryType(i);let r,a;if(s===e.TRIANGULAR_MESH)r=new e.Mesh,a=t.DecodeBufferToMesh(i,r);else if(s==e.POINT_CLOUD)r=new e.PointCloud,a=t.DecodeBufferToPointCloud(i,r);else{const e="Unknown geometry type.";console.error(e)}if(r.geometryType=s,!a.ok()||0==r.ptr){let n="Decoding failed: ";return n+=a.error_msg(),console.error(n),e.destroy(t),void e.destroy(r)}return e.destroy(i),r}__getIndicesFromDraco(e,t,n,i){if(n.geometryType!==e.TRIANGULAR_MESH)return;let s;if(i){const i=new e.DracoInt32Array;t.GetTriangleStripsFromMesh(n,i),s=new Uint32Array(i.size());for(var r=0;r<i.size();++r)s[r]=i.GetValue(r);e.destroy(i)}else{const i=n.num_faces();s=new Uint32Array(3*i);const r=new e.DracoInt32Array;for(let e=0;e<i;++e){t.GetFaceFromMesh(n,e,r);var a=3*e;s[a]=r.GetValue(0),s[a+1]=r.GetValue(1),s[a+2]=r.GetValue(2)}e.destroy(r)}return s}__decodeDraco(e,t,n,i){const s=n.bufferViews[e.extensions.KHR_draco_mesh_compression.bufferView],r=this.__getRnBufferView(s,t),a=new Uint8Array(r.getUint8Array()).buffer,o=new DracoDecoderModule,h=new o.Decoder,l=this.__getGeometryFromDracoBuffer(o,h,a);if(null==l)return o.destroy(l),void o.destroy(h);const c=l.num_points();if(-1==h.GetAttributeId(l,o.POSITION)){const e="Position attribute not found in draco.";return console.error(e),o.destroy(l),void o.destroy(h)}let u=0;if(e.indices){u+=4*e.indices.count}for(let t in e.attributes){const n=e.attributes[t];u+=c*S.a.fromString(n.type).getNumberOfComponents()*4}const _=new Ke.a({byteLength:u,arrayBuffer:new ArrayBuffer(u),name:"Draco"});let m=!1;y.from(e.mode)===y.TriangleStrip&&(m=!0);const d=this.__getIndicesFromDraco(o,h,l,m),f=this.__createRnAccessor(e.indices,d.length,1,_);for(let e=0;e<d.length;e++)f.setScalar(e,d[e],{});for(let t in e.attributes){const n=e.attributes[t],s=S.a.fromString(n.type).getNumberOfComponents(),r=this.__createRnAccessor(n,c,s,_);let a=t;"TEXCOORD_0"===t&&(a="TEX_COORD");const u=h.GetAttributeId(l,o[a]);if(-1===u){const e=t+"attribute not found in draco.";console.error(e);continue}const m=h.GetAttribute(l,u),d=new o.DracoFloat32Array;h.GetAttributeFloatForAllPoints(l,m,d);for(let e=0;e<c;e++)1===s?r.setScalar(e,d.GetValue(e*s),{}):2===s?r.setVec2(e,d.GetValue(e*s),d.GetValue(e*s+1),{}):3===s?r.setVec3(e,d.GetValue(e*s),d.GetValue(e*s+1),d.GetValue(e*s+2),{}):4===s&&r.setVec4(e,d.GetValue(e*s),d.GetValue(e*s+1),d.GetValue(e*s+2),d.GetValue(e*s+3),{});o.destroy(d),i.set(b.a.fromString(n.extras.attributeName),r)}return o.destroy(l),o.destroy(h),f}static _setupTextureTransform(e,t,n,i){if(e&&e.extensions&&e.extensions.KHR_texture_transform){let s=H.a.zero(),r=0;const a=e.extensions.KHR_texture_transform;null!=a.scale&&(s.x=a.scale[0],s.y=a.scale[1]),null!=a.offset&&(s.z=a.offset[0],s.w=a.offset[1]),null!=a.rotation&&(r=a.rotation),t.setParameter(n,s),t.setParameter(i,r)}}}var ut=n(64),_t=n(58),mt=function(e,t,n,i){return new(n||(n=Promise))(function(s,r){function a(e){try{h(i.next(e))}catch(e){r(e)}}function o(e){try{h(i.throw(e))}catch(e){r(e)}}function h(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(a,o)}h((i=i.apply(e,t||[])).next())})};function dt(e,t){const n=new DataView(e,0,20);if(1179937895!==n.getUint32(0,!0)){let n=ke.a.arrayBufferToString(e);return void t("glTF"+function(e){let t=1;e.asset&&e.asset.version&&(t=parseFloat(e.asset.version));return t}(JSON.parse(n)))}t("glTF"+n.getUint32(4,!0))}var ft=n(65);class pt extends A.a{constructor(){super(),this.__colorAttachments=[],this.cgApiResourceUid=N.a.InvalidCGAPIResourceUid,this.width=0,this.height=0,this.__colorAttachmentMap=new Map}get colorAttachmentsRenderBufferTargets(){return Array.from(this.__colorAttachmentMap.keys())}get colorAttachments(){return this.__colorAttachments}get depthAttachment(){return this.__depthAttachment}get stencilAttachement(){return this.__stencilAttachment}get depthStancilAttachment(){return this.__depthStencilAttachment}create(e,t){this.width=e,this.height=t;const n=N.a.getWebGLResourceRepository();return this.cgApiResourceUid=n.createFrameBufferObject(),this.cgApiResourceUid}get framebufferUID(){return this.cgApiResourceUid}setColorAttachmentAt(e,t){if(t.width!==this.width||t.height!==this.height)return!1;return this.__colorAttachments[e]=t,N.a.getWebGLResourceRepository().attachColorBufferToFrameBufferObject(this,e,t),this.__colorAttachmentMap.set(ft.a.from(e),t),!0}setDepthAttachment(e){if(e.width!==this.width||e.height!==this.height)return!1;return this.__depthAttachment=e,N.a.getWebGLResourceRepository().attachDepthBufferToFrameBufferObject(this,e),!0}setStencilAttachment(e){if(e.width!==this.width||e.height!==this.height)return!1;return this.__stencilAttachment=e,N.a.getWebGLResourceRepository().attachStencilBufferToFrameBufferObject(this,e),!0}setDepthStencilAttachment(e){if(e.width!==this.width||e.height!==this.height)return!1;return this.__depthStencilAttachment=e,N.a.getWebGLResourceRepository().attachDepthStencilBufferToFrameBufferObject(this,e),!0}destroy3DAPIResources(){N.a.getWebGLResourceRepository().deleteFrameBufferObject(this.cgApiResourceUid),this.depthAttachment&&this.depthAttachment.destroy3DAPIResources(),this.depthStancilAttachment&&this.depthStancilAttachment.destroy3DAPIResources(),this.stencilAttachement&&this.stencilAttachement.destroy3DAPIResources();for(let e of this.colorAttachments)e.destroy3DAPIResources()}whichColorAttachment(e){return this.__colorAttachments.indexOf(e)}}var gt=n(56);class vt extends A.a{constructor(){super(),this.width=0,this.height=0,this.cgApiResourceUid=-1}set _fbo(e){this.__fbo=e}get fbo(){return this.__fbo}create(e,t,n){this.width=e,this.height=t;const i=N.a.getWebGLResourceRepository();this.cgApiResourceUid=i.createRenderBuffer(e,t,n)}destroy3DAPIResources(){return N.a.getWebGLResourceRepository().deleteRenderBuffer(this.cgApiResourceUid),!0}}var xt=n(20),yt=n(38);var bt=Object.freeze({createTexturesForRenderTarget:function(e,t,n,{level:i=0,internalFormat:s=yt.a.RGBA,format:r=yt.a.RGBA,type:a=T.a.UnsignedByte,magFilter:o=xt.a.Linear,minFilter:h=xt.a.Linear,wrapS:l=xt.a.ClampToEdge,wrapT:c=xt.a.ClampToEdge}){const u=new pt;u.create(e,t);for(let _=0;_<n;_++){const n=new gt.a;n.create({width:e,height:t,level:i,internalFormat:s,format:r,type:a,magFilter:o,minFilter:h,wrapS:l,wrapT:c}),u.setColorAttachmentAt(_,n)}const _=new vt;return _.create(e,t,xt.a.Depth16),u.setDepthAttachment(_),u}});var At=Object.freeze({createGroupEntity:function(){return i.a.getInstance().createEntity([r.a,a.a])},createMeshEntity:function(){return i.a.getInstance().createEntity([r.a,a.a,o.a,h.a])},createCameraEntity:function(){return i.a.getInstance().createEntity([r.a,a.a,G.a])},createCameraWithControllerEntity:function(){return i.a.getInstance().createEntity([r.a,a.a,G.a,_t.a])}}),Tt=n(29);const wt={EntityRepository:i.a,ComponentRepository:s.a,TransformComponent:r.a,SceneGraphComponent:a.a,MeshComponent:o.a,MeshRendererComponent:h.a,Primitive:Re,CompositionType:S.a,ComponentType:T.a,VertexAttribute:b.a,PrimitiveMode:y,System:Ue,Scalar:k.b,Vector2:M.b,Vector3:R.b,Vector4:L.b,MutableVector2:Oe.a,MutableVector3:Q.a,MutableVector4:H.a,Matrix22:ze,Matrix33:Ge.a,Matrix44:$.a,MutableMatrix22:Xe,MutableMatrix33:Ce.a,MutableMatrix44:Z.a,ProcessApproach:J.a,Gltf1Importer:Ye,Gltf2Importer:je,DrcPointCloudImporter:qe,ModelConverter:ct,ModuleManager:De.a,MemoryManager:w.a,CameraComponent:G.a,CameraType:et.a,AnimationComponent:nt.a,LightComponent:ht.a,LightType:lt.a,CubeTexture:ut.a,CameraControllerComponent:_t.a,AlphaMode:rt.a,Gltf2Exporter:Ze,detectFormat:function(e,t){return mt(this,void 0,void 0,function*(){if(t)for(let e in t){const n=e.split("."),i=n[n.length-1];if("gltf"===i||"glb"===i)return new Promise((n,i)=>{dt(t[e],n)});if("drc"===i)return new Promise((e,t)=>{e("Draco")})}const n=e.split("."),i=n[n.length-1];return"efk"===i?new Promise((e,t)=>{e("Effekseer")}):"drc"===i?new Promise((e,t)=>{e("Draco")}):ke.a.loadResourceAsync(e,!0,(e,t)=>{dt(t,e)},(e,t)=>{console.log(t)})})},Config:V.a,Plane:class extends Re{constructor(){super()}generate({width:e,height:t,uSpan:n,vSpan:i,isUVRepeat:s=!1,material:r}){var a=[];for(let s=0;s<=i;s++)for(let r=0;r<=n;r++)a.push((r/n-.5)*e),a.push(0),a.push((s/i-.5)*t);var o=[];for(let e=0;e<i;e++){let t=0,i=0;for(let s=0;s<=n;s++)o.push(e*(n+1)+s),o.push((e+1)*(n+1)+s),0===s?t=(e+1)*(n+1)+s:s===n&&(i=(e+1)*(n+1)+s);o.push(i),o.push(t)}var h=[];for(let e=0;e<=i;e++)for(let e=0;e<=n;e++)h.push(0),h.push(1),h.push(0);var l=[];for(let e=0;e<=i;e++)for(let t=0;t<=n;t++)s?(l.push(t),l.push(e)):(l.push(t/n),l.push(e/i));const c=[S.a.Vec3,S.a.Vec3,S.a.Vec2],u=[b.a.Position,b.a.Normal,b.a.Texcoord0],_=y.TriangleStrip,m=w.a.getInstance().getBuffer(I.a.GPUVertexData),d=m.takeBufferView({byteLengthToNeed:2*o.length,byteStride:0,isAoS:!1}).takeAccessor({compositionType:S.a.Scalar,componentType:T.a.UnsignedShort,count:o.length});for(let e=0;e<o.length;e++)d.setScalar(e,o[e],{});const f=[new Float32Array(a),new Float32Array(h),new Float32Array(l)];let p=0;f.forEach(e=>{p+=e.byteLength});const g=m.takeBufferView({byteLengthToNeed:p,byteStride:0,isAoS:!1}),v=[],x=[];f.forEach((e,t)=>{x[t]=T.a.fromTypedArray(f[t]);const n=g.takeAccessor({compositionType:c[t],componentType:T.a.fromTypedArray(f[t]),count:e.byteLength/c[t].getNumberOfComponents()/x[t].getSizeInBytes()});n.copyFromTypedArray(e),v.push(n)});const A=new Map;for(let e=0;e<u.length;e++)A.set(u[e],v[e]);this.setData(A,_,r,d)}},Sphere:class extends Re{constructor(){super()}generate({radius:e,widthSegments:t,heightSegments:n,material:i}){for(var s=[],r=[],a=[],o=0;o<=n;o++)for(var h=o*Math.PI/n+1e-5,l=Math.sin(h),c=Math.cos(h),u=0;u<=t;u++){var _=2*u*Math.PI/t,m=Math.sin(_),d=e*Math.cos(_)*l,f=e*c,p=e*m*l,g=new R.b(d,f,p);s.push(d),s.push(f),s.push(p);var v=1-u/t,x=o/n;r.push(v),r.push(x);const i=R.b.normalize(g);a.push(i.x),a.push(i.y),a.push(i.z)}var A=[];for(o=0;o<n;o++)for(u=0;u<t;u++){var E=o*(t+1)+u,F=E+t+1;A.push(E+1),A.push(F),A.push(E),A.push(E+1),A.push(F+1),A.push(F)}const C=[S.a.Vec3,S.a.Vec3,S.a.Vec2],P=[b.a.Position,b.a.Normal,b.a.Texcoord0],M=y.Triangles,N=w.a.getInstance().getBuffer(I.a.GPUVertexData),L=N.takeBufferView({byteLengthToNeed:2*A.length,byteStride:0,isAoS:!1}).takeAccessor({compositionType:S.a.Scalar,componentType:T.a.UnsignedShort,count:A.length});for(let e=0;e<A.length;e++)L.setScalar(e,A[e],{});const D=[new Float32Array(s),new Float32Array(a),new Float32Array(r)];let V=0;D.forEach(e=>{V+=e.byteLength});const B=N.takeBufferView({byteLengthToNeed:V,byteStride:0,isAoS:!1}),U=[],O=[];D.forEach((e,t)=>{O[t]=T.a.fromTypedArray(D[t]);const n=B.takeAccessor({compositionType:C[t],componentType:T.a.fromTypedArray(D[t]),count:e.byteLength/C[t].getNumberOfComponents()/O[t].getSizeInBytes()});n.copyFromTypedArray(e),U.push(n)});const z=new Map;for(let e=0;e<P.length;e++)z.set(P[e],U[e]);this.setData(z,M,i,L)}},Material:F.a,MaterialHelper:Le,ShaderSemantics:C.a,RenderPass:Be,FrameBuffer:pt,Expression:Ve,HdriFormat:X.a,RenderTargetTexture:gt.a,RenderBuffer:vt,TextureParameter:xt.a,RenderableHelper:bt,Texture:tt.a,EntityHelper:At,MathClassUtil:Tt.a,Mesh:ot,MathUtil:st.a,Component:W.a,EnvConstantSingleMaterialNode:ge,RnObject:A.a};t.default=wt;window.Rn=wt}]);
(0,eval)('this').Rn.VERSION='version: 0.1.1-1094-g07d7-mod branch: master';
