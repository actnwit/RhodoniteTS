(window.webpackJsonp=window.webpackJsonp||[]).push([["webgl"],{43:function(e,t,r){"use strict";r.r(t);var i=r(35),n=r(17),a=r(32),o=function(){function e(){this.__webglResourceRepository=a.a.getInstance(),this.vertexShaderBody="\n\nvoid main ()\n{\n  mat4 matrix = getMatrix(a_instanceID);\n  //mat4 matrix = getMatrix(gl_InstanceID);\n\n  gl_Position = matrix * vec4(a_position, 1.0);\n  // gl_Position = vec4(a_position, 1.0);\n  // gl_Position.xyz /= 10.0;\n  // gl_Position.x += a_instanceID / 20.0;\n//  gl_Position.x += col0.x / 5.0;\n\n  v_color = a_color;\n}\n  "}return e.getInstance=function(){return this.__instance||(this.__instance=new e),this.__instance},Object.defineProperty(e.prototype,"glsl_rt0",{get:function(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"layout(location = 0) out vec4 rt0;\n":"vec4 rt0;\n"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glsl_fragColor",{get:function(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"":"gl_FragColor = rt0;\n"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glsl_vertex_in",{get:function(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"in":"attribute"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glsl_fragment_in",{get:function(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"in":"varying"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glsl_vertex_out",{get:function(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"out":"varying"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glsl_texture",{get:function(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"texture":"texture2D"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glsl_versionText",{get:function(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"#version 300 es\n":""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexShaderVariableDefinitions",{get:function(){var e=this.glsl_versionText,t=this.glsl_vertex_in;return e+"\nprecision highp float;\n"+t+" vec3 a_position;\n"+t+" vec3 a_color;\n"+t+" float a_instanceID;\n"+this.glsl_vertex_out+" vec3 v_color;"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentShaderSimple",{get:function(){return this.glsl_versionText+"\nprecision highp float;\n"+this.glsl_fragment_in+" vec3 v_color;\n"+this.glsl_rt0+"\nvoid main ()\n{\n  rt0 = vec4(v_color, 1.0);\n  "+this.glsl_fragColor+"\n}\n"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentShader",{get:function(){return this.fragmentShaderSimple},enumerable:!0,configurable:!0}),e.attributeNames=["a_position","a_color","a_instanceID"],e.attributeSemantics=[n.a.Position,n.a.Color0,n.a.Instance],e}(),s=r(34),u=r(33),_=r(21),c=r(14);var d,h,p,l=(d=new Float32Array(1),h=new Int32Array(d.buffer),function(e){d[0]=e;var t=h[0],r=t>>16&32768,i=t>>12&2047,n=t>>23&255;return n<103?r:n>142?(r|=31744,r|=(255==n?0:1)&&8388607&t):n<113?r|=((i|=2048)>>114-n)+(i>>113-n&1):(r|=n-112<<10|i>>1,r+=1&i)}),g=Object.freeze({radianToDegree:function(e){return 180*e/Math.PI},degreeToRadian:function(e){return e*Math.PI/180},toHalfFloat:l}),f=r(4),b=(p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),R=function(e){function t(t){var r=t.index,i=t.str;return e.call(this,{index:r,str:i})||this}return b(t,e),t}(f.a),x=new R({index:6402,str:"DEPTH_COMPONENT"}),m=new R({index:6406,str:"ALPHA"}),v=new R({index:6407,str:"RGB"}),y=new R({index:6408,str:"RGBA"}),w=new R({index:6409,str:"LUMINANCE"}),U=new R({index:6410,str:"LUMINANCE_ALPHA"});var T=Object.freeze({DepthComponent:x,Alpha:m,RGB:v,RGBA:y,Luminance:w,LuminanceAlpha:U}),G=r(0),P=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),L=function(e){function t(t){var r=t.index,i=t.str;return e.call(this,{index:r,str:i})||this}return P(t,e),t}(f.a),A=new L({index:9728,str:"NEAREST"}),W=new L({index:9729,str:"LINEAR"}),I=new L({index:10240,str:"TEXTURE_MAG_FILTER"}),S=new L({index:10241,str:"TEXTURE_MIN_FILTER"}),B=new L({index:10242,str:"TEXTURE_WRAP_S"}),D=new L({index:10243,str:"TEXTURE_WRAP_T"}),C=new L({index:3553,str:"TEXTURE_2D"}),F=new L({index:5890,str:"TEXTURE"}),H=new L({index:33984,str:"TEXTURE0"}),O=new L({index:33985,str:"TEXTURE1"}),E=new L({index:34016,str:"ACTIVE_TEXTURE"}),V=new L({index:10497,str:"REPEAT"}),N=new L({index:33071,str:"CLAMP_TO_EDGE"}),j=new L({index:32849,str:"RGB8"}),M=new L({index:32856,str:"RGBA8"}),z=new L({index:32857,str:"RGB10_A2"}),k=new L({index:34843,str:"RGB16F"}),$=new L({index:34837,str:"RGB32F"}),X=new L({index:34842,str:"RGBA16F"}),Y=new L({index:34836,str:"RGBA32F"});var J=Object.freeze({Nearest:A,Linear:W,TextureMagFilter:I,TextureMinFilter:S,TextureWrapS:B,TextureWrapT:D,Texture2D:C,Texture:F,Texture0:H,Texture1:O,ActiveTexture:E,Repeat:V,ClampToEdge:N,RGB8:j,RGBA8:M,RGB10_A2:z,RGB16F:k,RGB32F:$,RGBA16F:X,RGBA32F:Y}),q=r(5),K=r(11),Q=function(){function e(){this.__webglResourceRepository=a.a.getInstance(),this.__dataTextureUid=K.a.InvalidCGAPIResourceUid,this.__shaderProgramUid=K.a.InvalidCGAPIResourceUid,this.__vertexHandles=[],this.__isVAOSet=!1}return Object.defineProperty(e.prototype,"vertexShaderMethodDefinitions_dataTexture",{get:function(){var e=o.getInstance().glsl_texture;return"\n  uniform sampler2D u_dataTexture;\n  /*\n   * This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n   * arg = vec2(1. / size.x, 1. / size.x / size.y);\n   */\n  // vec4 fetchElement(sampler2D tex, float index, vec2 arg)\n  // {\n  //   return "+e+"( tex, arg * (index + 0.5) );\n  // }\n\n  vec4 fetchElement(sampler2D tex, float index, vec2 invSize)\n  {\n    float t = (index + 0.5) * invSize.x;\n    float x = fract(t);\n    float y = (floor(t) + 0.5) * invSize.y;\n    return "+e+"( tex, vec2(x, y) );\n  }\n\n  mat4 getMatrix(float instanceId)\n  {\n    float index = instanceId;\n    float powWidthVal = "+c.a.bufferWidthLength+".0;\n    float powHeightVal = "+c.a.bufferHeightLength+".0;\n    vec2 arg = vec2(1.0/powWidthVal, 1.0/powHeightVal);\n  //  vec2 arg = vec2(1.0/powWidthVal, 1.0/powWidthVal/powHeightVal);\n\n    vec4 col0 = fetchElement(u_dataTexture, index * 4.0 + 0.0, arg);\n   vec4 col1 = fetchElement(u_dataTexture, index * 4.0 + 1.0, arg);\n   vec4 col2 = fetchElement(u_dataTexture, index * 4.0 + 2.0, arg);\n\n    mat4 matrix = mat4(\n      col0.x, col1.x, col2.x, 0.0,\n      col0.y, col1.y, col2.y, 0.0,\n      col0.z, col1.z, col2.z, 0.0,\n      col0.w, col1.w, col2.w, 1.0\n      );\n\n    return matrix;\n  }\n  "},enumerable:!0,configurable:!0}),e.prototype.setupShaderProgram=function(){if(this.__shaderProgramUid===K.a.InvalidCGAPIResourceUid){var e=o.getInstance(),t=e.vertexShaderVariableDefinitions+this.vertexShaderMethodDefinitions_dataTexture+e.vertexShaderBody,r=e.fragmentShader;this.__shaderProgramUid=this.__webglResourceRepository.createShaderProgram({vertexShaderStr:t,fragmentShaderStr:r,attributeNames:o.attributeNames,attributeSemantics:o.attributeSemantics})}},e.prototype.__isLoaded=function(e){return null!=this.__vertexHandles[e]},e.prototype.$load=function(t){if(!this.__isLoaded(0))for(var r=t.getPrimitiveNumber(),i=0;i<r;i++){var n=t.getPrimitiveAt(i),a=this.__webglResourceRepository.createVertexDataResources(n);this.__vertexHandles[i]=a,e.__vertexHandleOfPrimitiveObjectUids.set(n.objectUid,a)}},e.prototype.$prerender=function(t,r){if(!this.__isVAOSet){for(var i=t.getPrimitiveNumber(),n=0;n<i;n++){var a=t.getPrimitiveAt(n);this.__vertexHandles[n]=e.__vertexHandleOfPrimitiveObjectUids.get(a.objectUid),this.__webglResourceRepository.setVertexDataToPipeline(this.__vertexHandles[n],a,r)}this.__isVAOSet=!0}},e.prototype.common_$prerender=function(){var e=!1;(this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2||this.__webglResourceRepository.currentWebGLContextWrapper.isSupportWebGL1Extension(_.a.TextureHalfFloat))&&(e=!0);var t,r=c.a.getInstance().getBuffer(q.a.GPUInstanceData),i=new Float32Array(r.getArrayBuffer());if(e){t=new Uint16Array(i.length);var n=r.byteSizeInUse/4;n/=2;for(var a=0;a<n;a++)t[a]=g.toHalfFloat(i[a])}this.__dataTextureUid===K.a.InvalidCGAPIResourceUid?e?this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__dataTextureUid=this.__webglResourceRepository.createTexture(i,{level:0,internalFormat:J.RGBA16F,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,border:0,format:T.RGBA,type:G.a.Float,magFilter:J.Nearest,minFilter:J.Nearest,wrapS:J.Repeat,wrapT:J.Repeat}):this.__dataTextureUid=this.__webglResourceRepository.createTexture(t,{level:0,internalFormat:T.RGBA,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,border:0,format:T.RGBA,type:G.a.HalfFloat,magFilter:J.Nearest,minFilter:J.Nearest,wrapS:J.Repeat,wrapT:J.Repeat}):this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__dataTextureUid=this.__webglResourceRepository.createTexture(i,{level:0,internalFormat:J.RGBA32F,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,border:0,format:T.RGBA,type:G.a.Float,magFilter:J.Nearest,minFilter:J.Nearest,wrapS:J.Repeat,wrapT:J.Repeat}):this.__dataTextureUid=this.__webglResourceRepository.createTexture(i,{level:0,internalFormat:T.RGBA,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,border:0,format:T.RGBA,type:G.a.Float,magFilter:J.Nearest,minFilter:J.Nearest,wrapS:J.Repeat,wrapT:J.Repeat}):e?this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__webglResourceRepository.updateTexture(this.__dataTextureUid,i,{level:0,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,format:T.RGBA,type:G.a.Float}):this.__webglResourceRepository.updateTexture(this.__dataTextureUid,t,{level:0,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,format:T.RGBA,type:G.a.HalfFloat}):(this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2,this.__webglResourceRepository.updateTexture(this.__dataTextureUid,i,{level:0,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,format:T.RGBA,type:G.a.Float}))},e.prototype.attachGPUData=function(){var e=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),t=this.__webglResourceRepository.getWebGLResource(this.__dataTextureUid);e.bindTexture(e.TEXTURE_2D,t);var r=this.__webglResourceRepository.getWebGLResource(this.__shaderProgramUid),i=e.getUniformLocation(r,"u_dataTexture");e.uniform1i(i,0)},e.prototype.attatchShaderProgram=function(){var e=this.__shaderProgramUid,t=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),r=this.__webglResourceRepository.getWebGLResource(e);t.useProgram(r)},e.prototype.attachVertexData=function(e,t,r,i){var n=this.__vertexHandles[e],a=this.__webglResourceRepository.getWebGLResource(n.vaoHandle),o=r.getRawContext();if(null!=a)r.bindVertexArray(a);else{this.__webglResourceRepository.setVertexDataToPipeline(n,t,i);var s=this.__webglResourceRepository.getWebGLResource(n.iboHandle);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,s)}},e.getInstance=function(){return this.__instance||(this.__instance=new e),this.__instance},e.prototype.common_$render=function(){return!0},e.__vertexHandleOfPrimitiveObjectUids=new Map,e}(),Z=r(27),ee=r(13),te=r(30),re=r(2),ie=r(26),ne=function(){function e(){this.__webglResourceRepository=a.a.getInstance(),this.__instanceDataTextureUid=K.a.InvalidCGAPIResourceUid,this.__vertexDataTextureUid=K.a.InvalidCGAPIResourceUid,this.__shaderProgramUid=K.a.InvalidCGAPIResourceUid,this.__primitiveHeaderUboUid=K.a.InvalidCGAPIResourceUid,this.__indexCountToSubtractUboUid=K.a.InvalidCGAPIResourceUid,this.__entitiesUidUboUid=K.a.InvalidCGAPIResourceUid,this.__primitiveUidUboUid=K.a.InvalidCGAPIResourceUid,this.__isVertexReady=!1}return Object.defineProperty(e.prototype,"__transformFeedbackShaderText",{get:function(){o.getInstance().glsl_vertex_in,o.getInstance().glsl_texture;return"#version 300 es\n\n    layout (std140) uniform indexCountsToSubtract {\n      ivec4 counts[256];\n    } u_indexCountsToSubtract;\n    layout (std140) uniform entityUids {\n      ivec4 ids[256];\n    } u_entityData;\n    layout (std140) uniform primitiveUids {\n      ivec4 ids[256];\n    } u_primitiveData;\n    layout (std140) uniform primitiveHeader {\n      ivec4 data[256];\n    } u_primitiveHeader;\n\n    out vec4 position;\n    //out vec3 colors;\n\n    uniform sampler2D u_instanceDataTexture;\n    uniform sampler2D u_vertexDataTexture;\n\n    void main(){\n      int indexOfVertices = gl_VertexID + 3*gl_InstanceID;\n\n      int entityUidMinusOne = 0;\n      int primitiveUid = 0;\n      for (int i=0; i<=indexOfVertices; i++) {\n        for (int j=0; j<1024; j++) {\n          int value = u_indexCountsToSubtract.counts[j/4][j%4];\n          int result = int(step(float(value), float(i)));\n          if (result > 0) {\n            entityUidMinusOne = result * int(u_entityData.ids[j/4][j%4]) - 1;\n            primitiveUid = result * u_primitiveData.ids[j/4][j%4];\n          } else {\n            break;\n          }\n        }\n      }\n\n      ivec4 indicesMeta = u_primitiveHeader.data[9*primitiveUid + 0];\n      int primIndicesByteOffset = indicesMeta.x;\n      int primIndicesComponentSizeInByte = indicesMeta.y;\n      int primIndicesLength = indicesMeta.z;\n\n      int idx = gl_VertexID - primIndicesByteOffset / 4 /*byte*/;\n\n      // get Indices\n      int texelLength = "+c.a.bufferWidthLength+";\n      vec4 indexVec4 = texelFetch(u_vertexDataTexture, ivec2(idx%texelLength, idx/texelLength), 0);\n      int index = int(indexVec4[idx%4]);\n\n      // get Positions\n      ivec4 indicesData = u_primitiveHeader.data[9*primitiveUid + 1];\n      int primPositionsByteOffset = indicesData.x;\n      idx = primPositionsByteOffset/4 + index;\n      vec4 posVec4 = texelFetch(u_vertexDataTexture, ivec2(idx%texelLength, idx/texelLength), 0);\n\n      position = posVec4;\n    }\n"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"__transformFeedbackFragmentShaderText",{get:function(){return"#version 300 es\nprecision highp float;\n\nout vec4 outColor;\n\nvoid main(){\n    outColor = vec4(1.0);\n}\n    "},enumerable:!0,configurable:!0}),e.prototype.setupShaderProgram=function(){if(this.__shaderProgramUid===K.a.InvalidCGAPIResourceUid){var e=this.__transformFeedbackShaderText,t=this.__transformFeedbackFragmentShaderText;this.__shaderProgramUid=this.__webglResourceRepository.createShaderProgram({vertexShaderStr:e,fragmentShaderStr:t,attributeNames:o.attributeNames,attributeSemantics:o.attributeSemantics})}},e.prototype.$load=function(e){if(!this.__isVertexReady){var t=c.a.getInstance().getBuffer(q.a.CPUGeneric),r=t.takeBufferView({byteLengthToNeed:12,byteStride:4,isAoS:!1}).takeAccessor({compositionType:re.a.Scalar,componentType:G.a.UnsingedInt,count:3}),i=t.takeBufferView({byteLengthToNeed:48,byteStride:16,isAoS:!1}).takeAccessor({compositionType:re.a.Vec4,componentType:G.a.Float,count:3}),a=r.getTypedArray();a[0]=0,a[1]=1,a[2]=2;var o=te.a.createPrimitive({indices:a,attributeCompositionTypes:[i.compositionType],attributeSemantics:[n.a.Position],attributes:[i.getTypedArray()],primitiveMode:ie.a.Triangles,material:0});this.__vertexHandle=this.__webglResourceRepository.createVertexDataResources(o),this.__isVertexReady=!0}},e.prototype.$prerender=function(e,t){},e.prototype.__setupUBOPrimitiveHeaderData=function(){var e=c.a.getInstance().getBuffer(q.a.UBOGeneric),t=new Int32Array(e.getArrayBuffer());this.__primitiveHeaderUboUid===K.a.InvalidCGAPIResourceUid&&(this.__primitiveHeaderUboUid=this.__webglResourceRepository.createUniformBuffer(t),this.__webglResourceRepository.bindUniformBufferBase(3,this.__primitiveHeaderUboUid))},e.prototype.__setupGPUInstanceMetaData=function(){if(this.__primitiveUidUboUid===K.a.InvalidCGAPIResourceUid){var e=Z.a.getInstance()._getEntities(),t=new Int32Array(e.length),r=new Int32Array(e.length),i=new Int32Array(e.length),n=0;e.forEach(function(e,a){var o=e.getComponent(ee.a.componentTID);if(o){r[a]=o.getPrimitiveAt(0).primitiveUid,t[a]=e.entityUID;var s=o.getPrimitiveAt(0).indicesAccessor.elementCount;i[a]=n+s,n+=s}}),this.__indexCountToSubtractUboUid=this.__webglResourceRepository.createUniformBuffer(i),this.__webglResourceRepository.bindUniformBufferBase(0,this.__indexCountToSubtractUboUid),this.__entitiesUidUboUid=this.__webglResourceRepository.createUniformBuffer(t),this.__webglResourceRepository.bindUniformBufferBase(1,this.__entitiesUidUboUid),this.__primitiveUidUboUid=this.__webglResourceRepository.createUniformBuffer(r),this.__webglResourceRepository.bindUniformBufferBase(2,this.__primitiveUidUboUid)}},e.prototype.__setupGPUInstanceData=function(){var e=!1;(this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2||this.__webglResourceRepository.currentWebGLContextWrapper.isSupportWebGL1Extension(_.a.TextureHalfFloat))&&(e=!0);var t,r=c.a.getInstance().getBuffer(q.a.GPUInstanceData),i=new Float32Array(r.getArrayBuffer());if(e){t=new Uint16Array(i.length);var n=r.byteSizeInUse/4;n/=2;for(var a=0;a<n;a++)t[a]=g.toHalfFloat(i[a])}this.__instanceDataTextureUid===K.a.InvalidCGAPIResourceUid?e?this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__instanceDataTextureUid=this.__webglResourceRepository.createTexture(i,{level:0,internalFormat:J.RGBA16F,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,border:0,format:T.RGBA,type:G.a.Float,magFilter:J.Nearest,minFilter:J.Nearest,wrapS:J.Repeat,wrapT:J.Repeat}):this.__instanceDataTextureUid=this.__webglResourceRepository.createTexture(t,{level:0,internalFormat:T.RGBA,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,border:0,format:T.RGBA,type:G.a.HalfFloat,magFilter:J.Nearest,minFilter:J.Nearest,wrapS:J.Repeat,wrapT:J.Repeat}):this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__instanceDataTextureUid=this.__webglResourceRepository.createTexture(i,{level:0,internalFormat:J.RGBA32F,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,border:0,format:T.RGBA,type:G.a.Float,magFilter:J.Nearest,minFilter:J.Nearest,wrapS:J.Repeat,wrapT:J.Repeat}):this.__instanceDataTextureUid=this.__webglResourceRepository.createTexture(i,{level:0,internalFormat:T.RGBA,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,border:0,format:T.RGBA,type:G.a.Float,magFilter:J.Nearest,minFilter:J.Nearest,wrapS:J.Repeat,wrapT:J.Repeat}):e?this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__webglResourceRepository.updateTexture(this.__instanceDataTextureUid,i,{level:0,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,format:T.RGBA,type:G.a.Float}):this.__webglResourceRepository.updateTexture(this.__instanceDataTextureUid,t,{level:0,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,format:T.RGBA,type:G.a.HalfFloat}):(this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2,this.__webglResourceRepository.updateTexture(this.__instanceDataTextureUid,i,{level:0,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,format:T.RGBA,type:G.a.Float}))},e.prototype.__setupGPUVertexData=function(){if(this.__vertexDataTextureUid===K.a.InvalidCGAPIResourceUid){var e=c.a.getInstance().getBuffer(q.a.GPUVertexData),t=new Float32Array(e.getArrayBuffer());this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__vertexDataTextureUid=this.__webglResourceRepository.createTexture(t,{level:0,internalFormat:J.RGBA32F,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,border:0,format:T.RGBA,type:G.a.Float,magFilter:J.Nearest,minFilter:J.Nearest,wrapS:J.Repeat,wrapT:J.Repeat}):this.__vertexDataTextureUid=this.__webglResourceRepository.createTexture(t,{level:0,internalFormat:T.RGBA,width:c.a.bufferWidthLength,height:c.a.bufferHeightLength,border:0,format:T.RGBA,type:G.a.Float,magFilter:J.Nearest,minFilter:J.Nearest,wrapS:J.Repeat,wrapT:J.Repeat})}},e.prototype.common_$prerender=function(){this.__setupUBOPrimitiveHeaderData(),this.__setupGPUInstanceMetaData(),this.__setupGPUInstanceData(),this.__setupGPUVertexData()},e.prototype.attachGPUData=function(){var e=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),t=this.__webglResourceRepository.getWebGLResource(this.__instanceDataTextureUid);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t);var r=this.__webglResourceRepository.getWebGLResource(this.__shaderProgramUid),i=e.getUniformLocation(r,"u_instanceDataTexture");e.uniform1i(i,0);e=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),t=this.__webglResourceRepository.getWebGLResource(this.__vertexDataTextureUid);e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t);r=this.__webglResourceRepository.getWebGLResource(this.__shaderProgramUid);var n=e.getUniformLocation(r,"u_vertexDataTexture");e.uniform1i(n,1),this.__webglResourceRepository.bindUniformBlock(this.__shaderProgramUid,"indexCountsToSubtract",0),this.__webglResourceRepository.bindUniformBlock(this.__shaderProgramUid,"entityUids",1),this.__webglResourceRepository.bindUniformBlock(this.__shaderProgramUid,"primitiveUids",2),this.__webglResourceRepository.bindUniformBlock(this.__shaderProgramUid,"primitiveHeader",3)},e.prototype.attatchShaderProgram=function(){var e=this.__shaderProgramUid,t=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),r=this.__webglResourceRepository.getWebGLResource(e);t.useProgram(r)},e.prototype.attachVertexData=function(e,t,r,i){},e.getInstance=function(){return this.__instance||(this.__instance=new e),this.__instance},e.prototype.common_$render=function(){return!0},e}(),ae=r(16),oe=function(){function e(){this.__webglResourceRepository=a.a.getInstance(),this.__uboUid=K.a.InvalidCGAPIResourceUid,this.__shaderProgramUid=K.a.InvalidCGAPIResourceUid,this.__vertexHandles=[],this.__isVAOSet=!1,this.vertexShaderMethodDefinitions_UBO="layout (std140) uniform matrix {\n    mat4 world[1024];\n  } u_matrix;\n\n  mat4 getMatrix(float instanceId) {\n    float index = instanceId;\n    return transpose(u_matrix.world[int(index)]);\n  }\n  "}return e.prototype.setupShaderProgram=function(){if(this.__shaderProgramUid===K.a.InvalidCGAPIResourceUid){var e=o.getInstance(),t=e.vertexShaderVariableDefinitions+this.vertexShaderMethodDefinitions_UBO+e.vertexShaderBody,r=e.fragmentShader;this.__shaderProgramUid=this.__webglResourceRepository.createShaderProgram({vertexShaderStr:t,fragmentShaderStr:r,attributeNames:o.attributeNames,attributeSemantics:o.attributeSemantics})}},e.prototype.__isLoaded=function(e){return null!=this.__vertexHandles[e]},e.prototype.$load=function(t){if(!this.__isLoaded(0))for(var r=t.getPrimitiveNumber(),i=0;i<r;i++){var n=t.getPrimitiveAt(i),a=this.__webglResourceRepository.createVertexDataResources(n);this.__vertexHandles[i]=a,e.__vertexHandleOfPrimitiveObjectUids.set(n.objectUid,a)}},e.prototype.$prerender=function(t,r){if(!this.__isVAOSet){for(var i=t.getPrimitiveNumber(),n=0;n<i;n++){var a=t.getPrimitiveAt(n);this.__vertexHandles[n]=e.__vertexHandleOfPrimitiveObjectUids.get(a.objectUid),this.__webglResourceRepository.setVertexDataToPipeline(this.__vertexHandles[n],a,r)}this.__isVAOSet=!0}},e.prototype.common_$prerender=function(){var e=c.a.getInstance().getBuffer(q.a.GPUInstanceData);new Float32Array(e.getArrayBuffer());this.__uboUid===K.a.InvalidCGAPIResourceUid?(this.__uboUid=this.__webglResourceRepository.createUniformBuffer(ae.a.getAccessor("worldMatrix",ae.a).dataViewOfBufferView),this.__webglResourceRepository.bindUniformBufferBase(0,this.__uboUid)):this.__webglResourceRepository.updateUniformBuffer(this.__uboUid,ae.a.getAccessor("worldMatrix",ae.a).dataViewOfBufferView)},e.prototype.attachGPUData=function(){this.__webglResourceRepository.bindUniformBlock(this.__shaderProgramUid,"matrix",0)},e.prototype.attatchShaderProgram=function(){var e=this.__shaderProgramUid,t=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),r=this.__webglResourceRepository.getWebGLResource(e);t.useProgram(r)},e.prototype.attachVertexData=function(e,t,r,i){var n=this.__vertexHandles[e],a=this.__webglResourceRepository.getWebGLResource(n.vaoHandle),o=r.getRawContext();if(null!=a)r.bindVertexArray(a);else{this.__webglResourceRepository.setVertexDataToPipeline(n,t,i);var s=this.__webglResourceRepository.getWebGLResource(n.iboHandle);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,s)}},e.getInstance=function(){return this.__instance||(this.__instance=new e),this.__instance},e.prototype.common_$render=function(){return!0},e.__vertexHandleOfPrimitiveObjectUids=new Map,e}(),se=r(29),ue=function(){function e(){this.__webglResourceRepository=a.a.getInstance(),this.__uboUid=K.a.InvalidCGAPIResourceUid,this.__shaderProgramUid=K.a.InvalidCGAPIResourceUid,this.__vertexHandles=[],this.__isVAOSet=!1,this.vertexShaderMethodDefinitions_uniform="\n  uniform mat4 worldMatrix;\n\n  mat4 getMatrix(float instanceId) {\n    return worldMatrix;\n  }\n  "}return e.prototype.setupShaderProgram=function(){if(this.__shaderProgramUid===K.a.InvalidCGAPIResourceUid){var e=o.getInstance(),t=e.vertexShaderVariableDefinitions+this.vertexShaderMethodDefinitions_uniform+e.vertexShaderBody,r=e.fragmentShader;this.__shaderProgramUid=this.__webglResourceRepository.createShaderProgram({vertexShaderStr:t,fragmentShaderStr:r,attributeNames:o.attributeNames,attributeSemantics:o.attributeSemantics}),this.__shaderProgram=this.__webglResourceRepository.getWebGLResource(this.__shaderProgramUid);var i=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext();this.__uniformLocation_worldMatrix=i.getUniformLocation(this.__shaderProgram,"worldMatrix")}},e.prototype.__isLoaded=function(e){return null!=this.__vertexHandles[e]},e.prototype.$load=function(t){if(!this.__isLoaded(0))for(var r=t.getPrimitiveNumber(),i=0;i<r;i++){var n=t.getPrimitiveAt(i),a=this.__webglResourceRepository.createVertexDataResources(n);this.__vertexHandles[i]=a,e.__vertexHandleOfPrimitiveObjectUids.set(n.objectUid,a)}},e.prototype.$prerender=function(t,r){if(!this.__isVAOSet){for(var i=t.getPrimitiveNumber(),n=0;n<i;n++){var a=t.getPrimitiveAt(n);this.__vertexHandles[n]=e.__vertexHandleOfPrimitiveObjectUids.get(a.objectUid),this.__webglResourceRepository.setVertexDataToPipeline(this.__vertexHandles[n],a,r)}this.__isVAOSet=!0}},e.prototype.common_$prerender=function(){},e.prototype.attachGPUData=function(){},e.prototype.attatchShaderProgram=function(){this.__shaderProgramUid;this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext().useProgram(this.__shaderProgram)},e.prototype.attachVertexData=function(e,t,r,i){var n=this.__vertexHandles[e],a=this.__webglResourceRepository.getWebGLResource(n.vaoHandle),o=r.getRawContext();if(null!=a)r.bindVertexArray(a);else{this.__webglResourceRepository.setVertexDataToPipeline(n,t,i);var s=this.__webglResourceRepository.getWebGLResource(n.iboHandle);o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,s)}},e.getInstance=function(){return this.__instance||(this.__instance=new e),this.__instance},e.prototype.common_$render=function(){return!1},e.prototype.$render=function(e,t,r){var i=this.__webglResourceRepository.currentWebGLContextWrapper;this.attatchShaderProgram();var n=i.getRawContext();this.attachVertexData(e,t,i,K.a.InvalidCGAPIResourceUid),n.uniformMatrix4fv(this.__uniformLocation_worldMatrix,!1,se.a.transpose(r).raw()),i.drawElementsInstanced(t.primitiveMode.index,t.indicesAccessor.elementCount,t.indicesAccessor.componentType.index,0,1)},e.__vertexHandleOfPrimitiveObjectUids=new Map,e}(),_e=Object.freeze({getRenderingStrategy:i.a,GLSLShader:o,WebGLContextWrapper:s.a,WebGLRenderingPipeline:u.a,WebGLResourceRepository:a.a,WebGLStrategyDataTexture:Q,WebGLStrategyTransformFeedback:ne,WebGLStrategyUBO:oe,WebGLStrategyUniform:ue});t.default=_e}}]);
(0,eval)('this').Rn.WEBGL_VERSION='version: 0.1.0-15-g9b58-mod branch: feature/webpack';
