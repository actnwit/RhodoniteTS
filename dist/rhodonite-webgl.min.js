(window.webpackJsonp=window.webpackJsonp||[]).push([["webgl"],{40:function(e,t,r){"use strict";r.r(t);var i,n=r(18),o=r(32),a=r(28),s=r(3),_=r(1),u=r(5),c=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),l=function(e){function t(t){var r=t.index,i=t.str;return e.call(this,{index:r,str:i})||this}return c(t,e),t}(u.a),h=new l({index:1,str:"OES_vertex_array_object"}),d=new l({index:2,str:"OES_texture_float"}),p=new l({index:3,str:"OES_texture_half_float"}),f=new l({index:4,str:"OES_texture_float_linear"}),g=new l({index:5,str:"OES_texture_half_float_linear"}),b=new l({index:6,str:"ANGLE_instanced_arrays"}),x=new l({index:7,str:"EXT_texture_filter_anisotropic"});var m=Object.freeze({VertexArrayObject:h,TextureFloat:d,TextureHalfFloat:p,TextureFloatLinear:f,TextureHalfFloatLinear:g,InstancedArrays:b,TextureFilterAnisotropic:x}),R=function(){function e(e){this.__webglVersion=1,this.__extensions=new Map,this.__gl=e,"WebGL2RenderingContext"===this.__gl.constructor.name?this.__webglVersion=2:(this.webgl1ExtVAO=this.__getExtension(m.VertexArrayObject),this.webgl1ExtIA=this.__getExtension(m.InstancedArrays),this.webgl1ExtTF=this.__getExtension(m.TextureFloat),this.webgl1ExtTHF=this.__getExtension(m.TextureHalfFloat),this.webgl1ExtTFL=this.__getExtension(m.TextureFloatLinear),this.webgl1ExtTHFL=this.__getExtension(m.TextureHalfFloatLinear),this.webgl1ExtTFA=this.__getExtension(m.TextureFilterAnisotropic))}return e.prototype.getRawContext=function(){return this.__gl},e.prototype.isSupportWebGL1Extension=function(e){return!!this.__getExtension(e)},Object.defineProperty(e.prototype,"isWebGL2",{get:function(){return 2===this.__webglVersion},enumerable:!0,configurable:!0}),e.prototype.createVertexArray=function(){return this.isWebGL2?this.__gl.createVertexArray():null!=this.webgl1ExtVAO?this.webgl1ExtVAO.createVertexArrayOES():void 0},e.prototype.bindVertexArray=function(e){this.isWebGL2?this.__gl.bindVertexArray(e):null!=this.webgl1ExtVAO&&this.webgl1ExtVAO.bindVertexArrayOES(e)},e.prototype.vertexAttribDivisor=function(e,t){this.isWebGL2?this.__gl.vertexAttribDivisor(e,t):this.webgl1ExtIA.vertexAttribDivisorANGLE(e,t)},e.prototype.drawElementsInstanced=function(e,t,r,i,n){this.isWebGL2?this.__gl.drawElementsInstanced(e,t,r,i,n):this.webgl1ExtIA.drawElementsInstancedANGLE(e,t,r,i,n)},e.prototype.__getExtension=function(e){var t=this.__gl;if(!this.__extensions.has(e)){var r=t.getExtension(e.toString());if(null==r){var i="The library does not support this environment because the "+e.toString()+" is not available";null!=console.error?console.error(i):console.log(i)}return this.__extensions.set(e,r),r}return this.__extensions.get(e)},e}();var v,w,y=(v=new Float32Array(1),w=new Int32Array(v.buffer),function(e){v[0]=e;var t=w[0],r=t>>16&32768,i=t>>12&2047,n=t>>23&255;return n<103?r:n>142?(r|=31744,r|=(255==n?0:1)&&8388607&t):n<113?r|=((i|=2048)>>114-n)+(i>>113-n&1):(r|=n-112<<10|i>>1,r+=1&i)});function U(e){return 0==(e&e-1)}var T=Object.freeze({radianToDegree:function(e){return 180*e/Math.PI},degreeToRadian:function(e){return e*Math.PI/180},toHalfFloat:y,isPowerOfTwo:U,isPowerOfTwoTexture:function(e,t){return U(e)&&U(t)}}),L=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),A=function(e){function t(){var t=e.call(this)||this;return t.__webglContexts=new Map,t.__resourceCounter=o.a.InvalidCGAPIResourceUid,t.__webglResources=new Map,t}return L(t,e),t.getInstance=function(){return this.__instance||(this.__instance=new t),this.__instance},t.prototype.addWebGLContext=function(e,t){var r=new R(e);this.__webglContexts.set("default",r),t&&(this.__glw=r)},Object.defineProperty(t.prototype,"currentWebGLContextWrapper",{get:function(){return this.__glw},enumerable:!0,configurable:!0}),t.prototype.getResourceNumber=function(){return++this.__resourceCounter},t.prototype.getWebGLResource=function(e){return this.__webglResources.get(e)},t.prototype.createIndexBuffer=function(e){var t=this.__glw.getRawContext();if(null==t)throw new Error("No WebGLRenderingContext set as Default.");var r=t.createBuffer(),i=this.getResourceNumber();return this.__webglResources.set(i,r),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.getTypedArray(),t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),i},t.prototype.createVertexBuffer=function(e){var t=this.__glw.getRawContext();if(null==t)throw new Error("No WebGLRenderingContext set as Default.");var r=t.createBuffer(),i=this.getResourceNumber();return this.__webglResources.set(i,r),t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,e.getTypedArray(),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),i},t.prototype.createVertexArray=function(){if(null==this.__glw)throw new Error("No WebGLRenderingContext set as Default.");var e=this.__glw.createVertexArray(),t=this.getResourceNumber();return this.__webglResources.set(t,e),t},t.prototype.createVertexDataResources=function(e){var t,r=this,i=this.__glw.getRawContext(),n=this.createVertexArray();e.hasIndices&&(t=this.createIndexBuffer(e.indicesAccessor));var o=[];return e.attributeAccessors.forEach(function(e){var t=r.createVertexBuffer(e);o.push(t)}),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),{vaoHandle:n,iboHandle:t,vboHandles:o}},t.prototype.createShaderProgram=function(e){var t=e.vertexShaderStr,r=e.fragmentShaderStr,i=e.attributeNames,n=e.attributeSemantics,o=this.__glw.getRawContext();if(null==o)throw new Error("No WebGLRenderingContext set as Default.");var a=o.createShader(o.VERTEX_SHADER);o.shaderSource(a,t),o.compileShader(a),this.__checkShaderCompileStatus(a,t);var s,_=o.createProgram();o.attachShader(_,a),null!=r&&(s=o.createShader(o.FRAGMENT_SHADER),o.shaderSource(s,r),o.compileShader(s),this.__checkShaderCompileStatus(s,r),o.attachShader(_,s)),i.forEach(function(e,t){o.bindAttribLocation(_,n[t].getAttributeSlot(),e)}),o.linkProgram(_);var u=this.getResourceNumber();return this.__webglResources.set(u,_),this.__checkShaderProgramLinkStatus(_),o.deleteShader(a),null!=r&&o.deleteShader(s),u},t.prototype.__addLineNumber=function(e){for(var t=e.split(/\r\n|\r|\n/),r="",i=0;i<t.length;i++){var n=i+1,o=" : ";n<10?o="  : ":n>=100&&(o=": "),r+=n+o+t[i]+"\n"}return r},t.prototype.__checkShaderCompileStatus=function(e,t){var r=this.__glw.getRawContext();if(!r.getShaderParameter(e,r.COMPILE_STATUS))throw console.log(this.__addLineNumber(t)),new Error("An error occurred compiling the shaders:"+r.getShaderInfoLog(e))},t.prototype.__checkShaderProgramLinkStatus=function(e){var t=this.__glw.getRawContext();if(!t.getProgramParameter(e,t.LINK_STATUS))throw new Error("Unable to initialize the shader program: "+t.getProgramInfoLog(e))},t.prototype.setVertexDataToPipeline=function(e,t,r){var i=this,n=e.vaoHandle,u=e.iboHandle,c=e.vboHandles;void 0===r&&(r=o.a.InvalidCGAPIResourceUid);var l=this.__glw.getRawContext(),h=this.getWebGLResource(n);if(this.__glw.bindVertexArray(h),null!=u){var d=this.getWebGLResource(u);if(null==d)throw new Error("Nothing Element Array Buffer!");l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,d)}if(c.forEach(function(e,r){var n=i.getWebGLResource(e);if(null==n)throw new Error("Nothing Element Array Buffer at index "+r);l.bindBuffer(l.ARRAY_BUFFER,n),l.enableVertexAttribArray(t.attributeSemantics[r].getAttributeSlot()),l.vertexAttribPointer(t.attributeSemantics[r].getAttributeSlot(),t.attributeCompositionTypes[r].getNumberOfComponents(),t.attributeComponentTypes[r].index,!1,t.attributeAccessors[r].byteStride,0)}),r!==o.a.InvalidCGAPIResourceUid){var p=this.getWebGLResource(r);if(null==p)throw new Error("Nothing Element Array Buffer at index");l.bindBuffer(l.ARRAY_BUFFER,p),l.enableVertexAttribArray(a.a.Instance.getAttributeSlot()),l.vertexAttribPointer(a.a.Instance.getAttributeSlot(),s.a.Scalar.getNumberOfComponents(),_.a.Float.index,!1,0,0),this.__glw.vertexAttribDivisor(a.a.Instance.getAttributeSlot(),1)}l.bindBuffer(l.ARRAY_BUFFER,null),this.__glw.bindVertexArray(null),null==h&&l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null)},t.prototype.createTexture=function(e,t){var r=t.level,i=t.internalFormat,n=t.width,o=t.height,a=t.border,s=t.format,_=t.type,u=t.magFilter,c=t.minFilter,l=t.wrapS,h=t.wrapT,d=t.generateMipmap,p=t.anisotropy,f=this.__glw.getRawContext(),g=f.createTexture(),b=this.getResourceNumber();return this.__webglResources.set(b,g),f.bindTexture(f.TEXTURE_2D,g),e instanceof HTMLImageElement||e instanceof HTMLCanvasElement?f.texImage2D(f.TEXTURE_2D,r,i.index,a,s.index,_.index,e):f.texImage2D(f.TEXTURE_2D,r,i.index,n,o,a,s.index,_.index,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l.index),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,h.index),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,u.index),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,c.index),T.isPowerOfTwoTexture(n,o)&&(p&&this.__glw.webgl1ExtTFA&&f.texParameteri(f.TEXTURE_2D,this.__glw.webgl1ExtTFA.TEXTURE_MAX_ANISOTROPY_EXT,4),d&&f.generateMipmap(f.TEXTURE_2D)),b},t.prototype.updateTexture=function(e,t,r){var i=r.level,n=r.width,o=r.height,a=r.format,s=r.type,_=this.__glw.getRawContext(),u=this.getWebGLResource(e);_.bindTexture(_.TEXTURE_2D,u),_.texSubImage2D(_.TEXTURE_2D,i,0,0,n,o,a.index,s.index,t)},t.prototype.deleteTexture=function(e){var t=this.getWebGLResource(e),r=this.__glw.getRawContext();null!=t&&(r.deleteTexture(t),this.__webglResources.delete(e))},t.prototype.createUniformBuffer=function(e){var t=this.__glw.getRawContext();if(null==t)throw new Error("No WebGLRenderingContext set as Default.");var r=t.createBuffer(),i=this.getResourceNumber();return this.__webglResources.set(i,r),t.bindBuffer(t.UNIFORM_BUFFER,r),t.bufferData(t.UNIFORM_BUFFER,e,t.DYNAMIC_DRAW),t.bindBuffer(t.UNIFORM_BUFFER,null),i},t.prototype.updateUniformBuffer=function(e,t){var r=this.__glw.getRawContext(),i=this.getWebGLResource(e);r.bindBuffer(r.UNIFORM_BUFFER,i),r.bufferSubData(r.UNIFORM_BUFFER,0,t,0),r.bindBuffer(r.UNIFORM_BUFFER,null)},t.prototype.bindUniformBlock=function(e,t,r){var i=this.__glw.getRawContext();if(null==i)throw new Error("No WebGLRenderingContext set as Default.");var n=this.getWebGLResource(e),o=i.getUniformBlockIndex(n,t);i.uniformBlockBinding(n,o,r)},t.prototype.bindUniformBufferBase=function(e,t){var r=this.__glw.getRawContext();if(null==r)throw new Error("No WebGLRenderingContext set as Default.");var i=this.getWebGLResource(t);r.bindBufferBase(r.UNIFORM_BUFFER,e,i)},t.prototype.deleteUniformBuffer=function(e){var t=this.__glw.getRawContext();null==t&&new Error("No WebGLRenderingContext set as Default.");var r=this.getWebGLResource(e);t.deleteBuffer(r)},t.prototype.createTransformFeedback=function(){var e=this.__glw.getRawContext(),t=e.createTransformFeedback(),r=this.getResourceNumber();return this.__webglResources.set(r,t),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,t),r},t.prototype.deleteTransformFeedback=function(e){var t=this.__glw.getRawContext(),r=this.getWebGLResource(e);t.deleteTransformFeedback(r)},t}(o.a),G=r(17),E=r(12),P=function(){function e(){this.__webglResourceRepository=A.getInstance(),this.vertexShaderBody="\n\nvoid main ()\n{\n  mat4 worldMatrix = getMatrix(a_instanceID);\n  mat4 viewMatrix = getViewMatrix(a_instanceID);\n  mat4 projectionMatrix = getProjectionMatrix(a_instanceID);\n  mat3 normalMatrix = getNormalMatrix(a_instanceID);\n\n  gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(a_position, 1.0);\n\n  v_color = a_color;\n\n  v_normal_inWorld = normalMatrix * a_normal;\n  //v_normal_inWorld = a_normal;\n\n  v_position_inWorld = worldMatrix * vec4(a_position, 1.0);\n}\n  "}return e.getInstance=function(){return this.__instance||(this.__instance=new e),this.__instance},Object.defineProperty(e.prototype,"glsl_rt0",{get:function(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"layout(location = 0) out vec4 rt0;\n":"vec4 rt0;\n"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glsl_fragColor",{get:function(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"":"gl_FragColor = rt0;\n"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glsl_vertex_in",{get:function(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"in":"attribute"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glsl_fragment_in",{get:function(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"in":"varying"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glsl_vertex_out",{get:function(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"out":"varying"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glsl_texture",{get:function(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"texture":"texture2D"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glsl_versionText",{get:function(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"#version 300 es\n":""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexShaderVariableDefinitions",{get:function(){var e=this.glsl_versionText,t=this.glsl_vertex_in,r=this.glsl_vertex_out;return e+"\nprecision highp float;\n"+t+" vec3 a_position;\n"+t+" vec3 a_color;\n"+t+" vec3 a_normal;\n"+t+" float a_instanceID;\n"+r+" vec3 v_color;\n"+r+" vec3 v_normal_inWorld;\n"+r+" vec4 v_position_inWorld;\n"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentShaderSimple",{get:function(){var e=this.glsl_versionText,t=this.glsl_fragment_in;return e+"\nprecision highp float;\n\nstruct Material {\n  vec4 baseColor;\n};\n\nuniform Material uMaterial;\n\n"+t+" vec3 v_color;\n"+t+" vec3 v_normal_inWorld;\n"+t+" vec4 v_position_inWorld;\n"+this.glsl_rt0+"\nvoid main ()\n{\n\n  vec3 lightPosition = vec3(10000.0, 10000.0, 10000.0);\n  vec3 normal_inWorld = normalize(v_normal_inWorld);\n  vec3 color = vec3(0.0, 0.0, 0.0);\n  if (v_color != color && uMaterial.baseColor.rgb != color) {\n    color = v_color * uMaterial.baseColor.rgb;\n  } else if (v_color == color) {\n    color = uMaterial.baseColor.rgb;\n  } else if (uMaterial.baseColor.rgb == color) {\n    color = v_color;\n  } else {\n    color = vec3(1.0, 1.0, 1.0);\n  }\n\n  if (length(v_normal_inWorld) > 0.5) {\n    vec3 lightDirection = normalize(lightPosition - v_position_inWorld.xyz);\n    float diffuse = 1.0 * dot(normal_inWorld, lightDirection);\n    color *= diffuse;\n  }\n\n  rt0 = vec4(color, 1.0);\n\n\n  "+this.glsl_fragColor+"\n}\n"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragmentShader",{get:function(){return this.fragmentShaderSimple},enumerable:!0,configurable:!0}),e.attributeNames=["a_position","a_color","a_normal","a_instanceID"],e.attributeSemantics=[a.a.Position,a.a.Color0,a.a.Normal,a.a.Instance],e}(),I=r(4),W=function(){function e(){this.__webglResourceRepository=A.getInstance(),this.__uboUid=o.a.InvalidCGAPIResourceUid,this.__shaderProgramUid=o.a.InvalidCGAPIResourceUid,this.__vertexHandles=[],this.__isVAOSet=!1,this.vertexShaderMethodDefinitions_UBO="layout (std140) uniform matrix {\n    mat4 world[1024];\n  } u_matrix;\n\n  uniform mat4 u_viewMatrix;\n  uniform mat4 u_projectionMatrix;\n  uniform mat3 u_normalMatrix;\n\n  mat4 getMatrix(float instanceId) {\n    float index = instanceId;\n    return transpose(u_matrix.world[int(index)]);\n  }\n\n  mat4 getViewMatrix(float instanceId) {\n    return u_viewMatrix;\n  }\n\n  mat4 getProjectionMatrix(float instanceId) {\n    return u_projectionMatrix;\n  }\n\n  mat3 getNormalMatrix(float instanceId) {\n    return u_normalMatrix;\n  }\n\n  "}return e.prototype.setupShaderProgram=function(){if(this.__shaderProgramUid===o.a.InvalidCGAPIResourceUid){var e=P.getInstance(),t=e.vertexShaderVariableDefinitions+this.vertexShaderMethodDefinitions_UBO+e.vertexShaderBody,r=e.fragmentShader;this.__shaderProgramUid=this.__webglResourceRepository.createShaderProgram({vertexShaderStr:t,fragmentShaderStr:r,attributeNames:P.attributeNames,attributeSemantics:P.attributeSemantics});var i=this.__webglResourceRepository.getWebGLResource(this.__shaderProgramUid),n=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext();this.__uniformLocation_viewMatrix=n.getUniformLocation(i,"u_viewMatrix"),this.__uniformLocation_projectionMatrix=n.getUniformLocation(i,"u_projectionMatrix")}},e.prototype.__isLoaded=function(e){return null!=this.__vertexHandles[e]},e.prototype.$load=function(t){if(!this.__isLoaded(0))for(var r=t.getPrimitiveNumber(),i=0;i<r;i++){var n=t.getPrimitiveAt(i),o=this.__webglResourceRepository.createVertexDataResources(n);this.__vertexHandles[i]=o,e.__vertexHandleOfPrimitiveObjectUids.set(n.objectUid,o)}},e.prototype.$prerender=function(t,r){if(!this.__isVAOSet){for(var i=t.getPrimitiveNumber(),n=0;n<i;n++){var o=t.getPrimitiveAt(n);this.__vertexHandles[n]=e.__vertexHandleOfPrimitiveObjectUids.get(o.objectUid),this.__webglResourceRepository.setVertexDataToPipeline(this.__vertexHandles[n],o,r)}this.__isVAOSet=!0}},e.prototype.common_$prerender=function(){var e=G.a.getInstance().getBuffer(I.a.GPUInstanceData);new Float32Array(e.getArrayBuffer());this.__uboUid===o.a.InvalidCGAPIResourceUid?(this.__uboUid=this.__webglResourceRepository.createUniformBuffer(E.a.getAccessor("worldMatrix",E.a).dataViewOfBufferView),this.__webglResourceRepository.bindUniformBufferBase(0,this.__uboUid)):this.__webglResourceRepository.updateUniformBuffer(this.__uboUid,E.a.getAccessor("worldMatrix",E.a).dataViewOfBufferView)},e.prototype.attachGPUData=function(){this.__webglResourceRepository.bindUniformBlock(this.__shaderProgramUid,"matrix",0)},e.prototype.attatchShaderProgram=function(){var e=this.__shaderProgramUid,t=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),r=this.__webglResourceRepository.getWebGLResource(e);t.useProgram(r)},e.prototype.attachVertexData=function(e,t,r,i){var n=this.__vertexHandles[e],o=this.__webglResourceRepository.getWebGLResource(n.vaoHandle),a=r.getRawContext();if(null!=o)r.bindVertexArray(o);else{this.__webglResourceRepository.setVertexDataToPipeline(n,t,i);var s=this.__webglResourceRepository.getWebGLResource(n.iboHandle);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,s)}},e.getInstance=function(){return this.__instance||(this.__instance=new e),this.__instance},e.prototype.common_$render=function(e,t){var r=this.__webglResourceRepository.currentWebGLContextWrapper;this.attatchShaderProgram();var i=r.getRawContext();return i.uniformMatrix4fv(this.__uniformLocation_viewMatrix,!1,e.v),i.uniformMatrix4fv(this.__uniformLocation_projectionMatrix,!1,t.v),!0},e.__vertexHandleOfPrimitiveObjectUids=new Map,e}(),S=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),C=function(e){function t(t){var r=t.index,i=t.str;return e.call(this,{index:r,str:i})||this}return S(t,e),t}(u.a),M=new C({index:6402,str:"DEPTH_COMPONENT"}),B=new C({index:6406,str:"ALPHA"}),F=new C({index:6407,str:"RGB"}),D=new C({index:6408,str:"RGBA"}),O=new C({index:6409,str:"LUMINANCE"}),N=new C({index:6410,str:"LUMINANCE_ALPHA"});var V=Object.freeze({DepthComponent:M,Alpha:B,RGB:F,RGBA:D,Luminance:O,LuminanceAlpha:N}),H=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),j=function(e){function t(t){var r=t.index,i=t.str;return e.call(this,{index:r,str:i})||this}return H(t,e),t}(u.a),k=new j({index:9728,str:"NEAREST"}),X=new j({index:9729,str:"LINEAR"}),z=new j({index:10240,str:"TEXTURE_MAG_FILTER"}),$=new j({index:10241,str:"TEXTURE_MIN_FILTER"}),Y=new j({index:10242,str:"TEXTURE_WRAP_S"}),J=new j({index:10243,str:"TEXTURE_WRAP_T"}),K=new j({index:3553,str:"TEXTURE_2D"}),q=new j({index:5890,str:"TEXTURE"}),Q=new j({index:33984,str:"TEXTURE0"}),Z=new j({index:33985,str:"TEXTURE1"}),ee=new j({index:34016,str:"ACTIVE_TEXTURE"}),te=new j({index:10497,str:"REPEAT"}),re=new j({index:33071,str:"CLAMP_TO_EDGE"}),ie=new j({index:32849,str:"RGB8"}),ne=new j({index:32856,str:"RGBA8"}),oe=new j({index:32857,str:"RGB10_A2"}),ae=new j({index:34843,str:"RGB16F"}),se=new j({index:34837,str:"RGB32F"}),_e=new j({index:34842,str:"RGBA16F"}),ue=new j({index:34836,str:"RGBA32F"});var ce=Object.freeze({Nearest:k,Linear:X,TextureMagFilter:z,TextureMinFilter:$,TextureWrapS:Y,TextureWrapT:J,Texture2D:K,Texture:q,Texture0:Q,Texture1:Z,ActiveTexture:ee,Repeat:te,ClampToEdge:re,RGB8:ie,RGBA8:ne,RGB10_A2:oe,RGB16F:ae,RGB32F:se,RGBA16F:_e,RGBA32F:ue}),le=r(23),he=r(19),de=r(29),pe=r(25),fe=function(){function e(){this.__webglResourceRepository=A.getInstance(),this.__instanceDataTextureUid=o.a.InvalidCGAPIResourceUid,this.__vertexDataTextureUid=o.a.InvalidCGAPIResourceUid,this.__shaderProgramUid=o.a.InvalidCGAPIResourceUid,this.__primitiveHeaderUboUid=o.a.InvalidCGAPIResourceUid,this.__indexCountToSubtractUboUid=o.a.InvalidCGAPIResourceUid,this.__entitiesUidUboUid=o.a.InvalidCGAPIResourceUid,this.__primitiveUidUboUid=o.a.InvalidCGAPIResourceUid,this.__isVertexReady=!1}return Object.defineProperty(e.prototype,"__transformFeedbackShaderText",{get:function(){P.getInstance().glsl_vertex_in,P.getInstance().glsl_texture;return"#version 300 es\n\n    layout (std140) uniform indexCountsToSubtract {\n      ivec4 counts[256];\n    } u_indexCountsToSubtract;\n    layout (std140) uniform entityUids {\n      ivec4 ids[256];\n    } u_entityData;\n    layout (std140) uniform primitiveUids {\n      ivec4 ids[256];\n    } u_primitiveData;\n    layout (std140) uniform primitiveHeader {\n      ivec4 data[256];\n    } u_primitiveHeader;\n\n    out vec4 position;\n    //out vec3 colors;\n\n    uniform sampler2D u_instanceDataTexture;\n    uniform sampler2D u_vertexDataTexture;\n\n    void main(){\n      int indexOfVertices = gl_VertexID + 3*gl_InstanceID;\n\n      int entityUidMinusOne = 0;\n      int primitiveUid = 0;\n      for (int i=0; i<=indexOfVertices; i++) {\n        for (int j=0; j<1024; j++) {\n          int value = u_indexCountsToSubtract.counts[j/4][j%4];\n          int result = int(step(float(value), float(i)));\n          if (result > 0) {\n            entityUidMinusOne = result * int(u_entityData.ids[j/4][j%4]) - 1;\n            primitiveUid = result * u_primitiveData.ids[j/4][j%4];\n          } else {\n            break;\n          }\n        }\n      }\n\n      ivec4 indicesMeta = u_primitiveHeader.data[9*primitiveUid + 0];\n      int primIndicesByteOffset = indicesMeta.x;\n      int primIndicesComponentSizeInByte = indicesMeta.y;\n      int primIndicesLength = indicesMeta.z;\n\n      int idx = gl_VertexID - primIndicesByteOffset / 4 /*byte*/;\n\n      // get Indices\n      int texelLength = "+G.a.bufferWidthLength+";\n      vec4 indexVec4 = texelFetch(u_vertexDataTexture, ivec2(idx%texelLength, idx/texelLength), 0);\n      int index = int(indexVec4[idx%4]);\n\n      // get Positions\n      ivec4 indicesData = u_primitiveHeader.data[9*primitiveUid + 1];\n      int primPositionsByteOffset = indicesData.x;\n      idx = primPositionsByteOffset/4 + index;\n      vec4 posVec4 = texelFetch(u_vertexDataTexture, ivec2(idx%texelLength, idx/texelLength), 0);\n\n      position = posVec4;\n    }\n"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"__transformFeedbackFragmentShaderText",{get:function(){return"#version 300 es\nprecision highp float;\n\nout vec4 outColor;\n\nvoid main(){\n    outColor = vec4(1.0);\n}\n    "},enumerable:!0,configurable:!0}),e.prototype.setupShaderProgram=function(){if(this.__shaderProgramUid===o.a.InvalidCGAPIResourceUid){var e=this.__transformFeedbackShaderText,t=this.__transformFeedbackFragmentShaderText;this.__shaderProgramUid=this.__webglResourceRepository.createShaderProgram({vertexShaderStr:e,fragmentShaderStr:t,attributeNames:P.attributeNames,attributeSemantics:P.attributeSemantics});var r=this.__webglResourceRepository.getWebGLResource(this.__shaderProgramUid),i=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext();this.__uniformLocation_viewMatrix=i.getUniformLocation(r,"u_viewMatrix"),this.__uniformLocation_projectionMatrix=i.getUniformLocation(r,"u_projectionMatrix")}},e.prototype.$load=function(e){if(!this.__isVertexReady){var t=G.a.getInstance().getBuffer(I.a.CPUGeneric),r=t.takeBufferView({byteLengthToNeed:12,byteStride:4,isAoS:!1}).takeAccessor({compositionType:s.a.Scalar,componentType:_.a.UnsingedInt,count:3}),i=t.takeBufferView({byteLengthToNeed:48,byteStride:16,isAoS:!1}).takeAccessor({compositionType:s.a.Vec4,componentType:_.a.Float,count:3}),n=r.getTypedArray();n[0]=0,n[1]=1,n[2]=2;var o=de.a.createPrimitive({indices:n,attributeCompositionTypes:[i.compositionType],attributeSemantics:[a.a.Position],attributes:[i.getTypedArray()],primitiveMode:pe.a.Triangles,material:void 0});this.__vertexHandle=this.__webglResourceRepository.createVertexDataResources(o),this.__isVertexReady=!0}},e.prototype.$prerender=function(e,t){},e.prototype.__setupUBOPrimitiveHeaderData=function(){var e=G.a.getInstance().getBuffer(I.a.UBOGeneric),t=new Int32Array(e.getArrayBuffer());this.__primitiveHeaderUboUid===o.a.InvalidCGAPIResourceUid&&(this.__primitiveHeaderUboUid=this.__webglResourceRepository.createUniformBuffer(t),this.__webglResourceRepository.bindUniformBufferBase(3,this.__primitiveHeaderUboUid))},e.prototype.__setupGPUInstanceMetaData=function(){if(this.__primitiveUidUboUid===o.a.InvalidCGAPIResourceUid){var e=le.a.getInstance()._getEntities(),t=new Int32Array(e.length),r=new Int32Array(e.length),i=new Int32Array(e.length),n=0;e.forEach(function(e,o){var a=e.getComponent(he.a.componentTID);if(a){r[o]=a.getPrimitiveAt(0).primitiveUid,t[o]=e.entityUID;var s=a.getPrimitiveAt(0).indicesAccessor.elementCount;i[o]=n+s,n+=s}}),this.__indexCountToSubtractUboUid=this.__webglResourceRepository.createUniformBuffer(i),this.__webglResourceRepository.bindUniformBufferBase(0,this.__indexCountToSubtractUboUid),this.__entitiesUidUboUid=this.__webglResourceRepository.createUniformBuffer(t),this.__webglResourceRepository.bindUniformBufferBase(1,this.__entitiesUidUboUid),this.__primitiveUidUboUid=this.__webglResourceRepository.createUniformBuffer(r),this.__webglResourceRepository.bindUniformBufferBase(2,this.__primitiveUidUboUid)}},e.prototype.__setupGPUInstanceData=function(){var e=!1;(this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2||this.__webglResourceRepository.currentWebGLContextWrapper.isSupportWebGL1Extension(m.TextureHalfFloat))&&(e=!0);var t,r=G.a.getInstance().getBuffer(I.a.GPUInstanceData),i=new Float32Array(r.getArrayBuffer());if(e){t=new Uint16Array(i.length);var n=r.byteSizeInUse/4;n/=2;for(var a=0;a<n;a++)t[a]=T.toHalfFloat(i[a])}this.__instanceDataTextureUid===o.a.InvalidCGAPIResourceUid?e?this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__instanceDataTextureUid=this.__webglResourceRepository.createTexture(i,{level:0,internalFormat:ce.RGBA16F,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,border:0,format:V.RGBA,type:_.a.Float,magFilter:ce.Nearest,minFilter:ce.Nearest,wrapS:ce.Repeat,wrapT:ce.Repeat,generateMipmap:!1,anisotropy:!1}):this.__instanceDataTextureUid=this.__webglResourceRepository.createTexture(t,{level:0,internalFormat:V.RGBA,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,border:0,format:V.RGBA,type:_.a.HalfFloat,magFilter:ce.Nearest,minFilter:ce.Nearest,wrapS:ce.Repeat,wrapT:ce.Repeat,generateMipmap:!1,anisotropy:!1}):this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__instanceDataTextureUid=this.__webglResourceRepository.createTexture(i,{level:0,internalFormat:ce.RGBA32F,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,border:0,format:V.RGBA,type:_.a.Float,magFilter:ce.Nearest,minFilter:ce.Nearest,wrapS:ce.Repeat,wrapT:ce.Repeat,generateMipmap:!1,anisotropy:!1}):this.__instanceDataTextureUid=this.__webglResourceRepository.createTexture(i,{level:0,internalFormat:V.RGBA,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,border:0,format:V.RGBA,type:_.a.Float,magFilter:ce.Nearest,minFilter:ce.Nearest,wrapS:ce.Repeat,wrapT:ce.Repeat,generateMipmap:!1,anisotropy:!1}):e?this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__webglResourceRepository.updateTexture(this.__instanceDataTextureUid,i,{level:0,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,format:V.RGBA,type:_.a.Float}):this.__webglResourceRepository.updateTexture(this.__instanceDataTextureUid,t,{level:0,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,format:V.RGBA,type:_.a.HalfFloat}):(this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2,this.__webglResourceRepository.updateTexture(this.__instanceDataTextureUid,i,{level:0,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,format:V.RGBA,type:_.a.Float}))},e.prototype.__setupGPUVertexData=function(){if(this.__vertexDataTextureUid===o.a.InvalidCGAPIResourceUid){var e=G.a.getInstance().getBuffer(I.a.GPUVertexData),t=new Float32Array(e.getArrayBuffer());this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__vertexDataTextureUid=this.__webglResourceRepository.createTexture(t,{level:0,internalFormat:ce.RGBA32F,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,border:0,format:V.RGBA,type:_.a.Float,magFilter:ce.Nearest,minFilter:ce.Nearest,wrapS:ce.Repeat,wrapT:ce.Repeat,generateMipmap:!1,anisotropy:!1}):this.__vertexDataTextureUid=this.__webglResourceRepository.createTexture(t,{level:0,internalFormat:V.RGBA,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,border:0,format:V.RGBA,type:_.a.Float,magFilter:ce.Nearest,minFilter:ce.Nearest,wrapS:ce.Repeat,wrapT:ce.Repeat,generateMipmap:!1,anisotropy:!1})}},e.prototype.common_$prerender=function(){this.__setupUBOPrimitiveHeaderData(),this.__setupGPUInstanceMetaData(),this.__setupGPUInstanceData(),this.__setupGPUVertexData()},e.prototype.attachGPUData=function(){var e=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),t=this.__webglResourceRepository.getWebGLResource(this.__instanceDataTextureUid);e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t);var r=this.__webglResourceRepository.getWebGLResource(this.__shaderProgramUid),i=e.getUniformLocation(r,"u_instanceDataTexture");e.uniform1i(i,0);e=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),t=this.__webglResourceRepository.getWebGLResource(this.__vertexDataTextureUid);e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t);r=this.__webglResourceRepository.getWebGLResource(this.__shaderProgramUid);var n=e.getUniformLocation(r,"u_vertexDataTexture");e.uniform1i(n,1),this.__webglResourceRepository.bindUniformBlock(this.__shaderProgramUid,"indexCountsToSubtract",0),this.__webglResourceRepository.bindUniformBlock(this.__shaderProgramUid,"entityUids",1),this.__webglResourceRepository.bindUniformBlock(this.__shaderProgramUid,"primitiveUids",2),this.__webglResourceRepository.bindUniformBlock(this.__shaderProgramUid,"primitiveHeader",3)},e.prototype.attatchShaderProgram=function(){var e=this.__shaderProgramUid,t=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),r=this.__webglResourceRepository.getWebGLResource(e);t.useProgram(r)},e.prototype.attachVertexData=function(e,t,r,i){},e.getInstance=function(){return this.__instance||(this.__instance=new e),this.__instance},e.prototype.common_$render=function(e,t){var r=this.__webglResourceRepository.currentWebGLContextWrapper;this.attatchShaderProgram();var i=r.getRawContext();return i.uniformMatrix4fv(this.__uniformLocation_viewMatrix,!1,e.v),i.uniformMatrix4fv(this.__uniformLocation_projectionMatrix,!1,t.v),!0},e}(),ge=function(){function e(){this.__webglResourceRepository=A.getInstance(),this.__dataTextureUid=o.a.InvalidCGAPIResourceUid,this.__shaderProgramUid=o.a.InvalidCGAPIResourceUid,this.__vertexHandles=[],this.__isVAOSet=!1}return Object.defineProperty(e.prototype,"vertexShaderMethodDefinitions_dataTexture",{get:function(){var e=P.getInstance().glsl_texture;return"\n  uniform sampler2D u_dataTexture;\n  uniform mat4 u_viewMatrix;\n  uniform mat4 u_projectionMatrix;\n  uniform mat3 u_normalMatrix;\n\n  /*\n   * This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n   * arg = vec2(1. / size.x, 1. / size.x / size.y);\n   */\n  // vec4 fetchElement(sampler2D tex, float index, vec2 arg)\n  // {\n  //   return "+e+"( tex, arg * (index + 0.5) );\n  // }\n\n  vec4 fetchElement(sampler2D tex, float index, vec2 invSize)\n  {\n    float t = (index + 0.5) * invSize.x;\n    float x = fract(t);\n    float y = (floor(t) + 0.5) * invSize.y;\n    return "+e+"( tex, vec2(x, y) );\n  }\n\n  mat4 getMatrix(float instanceId)\n  {\n    float index = instanceId;\n    float powWidthVal = "+G.a.bufferWidthLength+".0;\n    float powHeightVal = "+G.a.bufferHeightLength+".0;\n    vec2 arg = vec2(1.0/powWidthVal, 1.0/powHeightVal);\n  //  vec2 arg = vec2(1.0/powWidthVal, 1.0/powWidthVal/powHeightVal);\n\n    vec4 col0 = fetchElement(u_dataTexture, index * 4.0 + 0.0, arg);\n   vec4 col1 = fetchElement(u_dataTexture, index * 4.0 + 1.0, arg);\n   vec4 col2 = fetchElement(u_dataTexture, index * 4.0 + 2.0, arg);\n\n    mat4 matrix = mat4(\n      col0.x, col1.x, col2.x, 0.0,\n      col0.y, col1.y, col2.y, 0.0,\n      col0.z, col1.z, col2.z, 0.0,\n      col0.w, col1.w, col2.w, 1.0\n      );\n\n    return matrix;\n  }\n\n  mat4 getViewMatrix(float instanceId) {\n    return u_viewMatrix;\n  }\n\n  mat4 getProjectionMatrix(float instanceId) {\n    return u_projectionMatrix;\n  }\n\n  mat3 getNormalMatrix(float instanceId) {\n    return u_normalMatrix;\n  }\n\n  "},enumerable:!0,configurable:!0}),e.prototype.setupShaderProgram=function(){if(this.__shaderProgramUid===o.a.InvalidCGAPIResourceUid){var e=P.getInstance(),t=e.vertexShaderVariableDefinitions+this.vertexShaderMethodDefinitions_dataTexture+e.vertexShaderBody,r=e.fragmentShader;this.__shaderProgramUid=this.__webglResourceRepository.createShaderProgram({vertexShaderStr:t,fragmentShaderStr:r,attributeNames:P.attributeNames,attributeSemantics:P.attributeSemantics});var i=this.__webglResourceRepository.getWebGLResource(this.__shaderProgramUid),n=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext();this.__uniformLocation_viewMatrix=n.getUniformLocation(i,"u_viewMatrix"),this.__uniformLocation_projectionMatrix=n.getUniformLocation(i,"u_projectionMatrix")}},e.prototype.__isLoaded=function(e){return null!=this.__vertexHandles[e]},e.prototype.$load=function(t){if(!this.__isLoaded(0))for(var r=t.getPrimitiveNumber(),i=0;i<r;i++){var n=t.getPrimitiveAt(i),o=this.__webglResourceRepository.createVertexDataResources(n);this.__vertexHandles[i]=o,e.__vertexHandleOfPrimitiveObjectUids.set(n.objectUid,o)}},e.prototype.$prerender=function(t,r){if(!this.__isVAOSet){for(var i=t.getPrimitiveNumber(),n=0;n<i;n++){var o=t.getPrimitiveAt(n);this.__vertexHandles[n]=e.__vertexHandleOfPrimitiveObjectUids.get(o.objectUid),this.__webglResourceRepository.setVertexDataToPipeline(this.__vertexHandles[n],o,r)}this.__isVAOSet=!0}},e.prototype.common_$prerender=function(){var e=!1;(this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2||this.__webglResourceRepository.currentWebGLContextWrapper.isSupportWebGL1Extension(m.TextureHalfFloat))&&(e=!0);var t,r=G.a.getInstance().getBuffer(I.a.GPUInstanceData),i=new Float32Array(r.getArrayBuffer());if(e){t=new Uint16Array(i.length);var n=r.byteSizeInUse/4;n/=2;for(var a=0;a<n;a++)t[a]=T.toHalfFloat(i[a])}this.__dataTextureUid===o.a.InvalidCGAPIResourceUid?e?this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__dataTextureUid=this.__webglResourceRepository.createTexture(i,{level:0,internalFormat:ce.RGBA16F,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,border:0,format:V.RGBA,type:_.a.Float,magFilter:ce.Nearest,minFilter:ce.Nearest,wrapS:ce.Repeat,wrapT:ce.Repeat,generateMipmap:!1,anisotropy:!1}):this.__dataTextureUid=this.__webglResourceRepository.createTexture(t,{level:0,internalFormat:V.RGBA,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,border:0,format:V.RGBA,type:_.a.HalfFloat,magFilter:ce.Nearest,minFilter:ce.Nearest,wrapS:ce.Repeat,wrapT:ce.Repeat,generateMipmap:!1,anisotropy:!1}):this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__dataTextureUid=this.__webglResourceRepository.createTexture(i,{level:0,internalFormat:ce.RGBA32F,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,border:0,format:V.RGBA,type:_.a.Float,magFilter:ce.Nearest,minFilter:ce.Nearest,wrapS:ce.Repeat,wrapT:ce.Repeat,generateMipmap:!1,anisotropy:!1}):this.__dataTextureUid=this.__webglResourceRepository.createTexture(i,{level:0,internalFormat:V.RGBA,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,border:0,format:V.RGBA,type:_.a.Float,magFilter:ce.Nearest,minFilter:ce.Nearest,wrapS:ce.Repeat,wrapT:ce.Repeat,generateMipmap:!1,anisotropy:!1}):e?this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__webglResourceRepository.updateTexture(this.__dataTextureUid,i,{level:0,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,format:V.RGBA,type:_.a.Float}):this.__webglResourceRepository.updateTexture(this.__dataTextureUid,t,{level:0,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,format:V.RGBA,type:_.a.HalfFloat}):(this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2,this.__webglResourceRepository.updateTexture(this.__dataTextureUid,i,{level:0,width:G.a.bufferWidthLength,height:G.a.bufferHeightLength,format:V.RGBA,type:_.a.Float}))},e.prototype.attachGPUData=function(){var e=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),t=this.__webglResourceRepository.getWebGLResource(this.__dataTextureUid);e.bindTexture(e.TEXTURE_2D,t);var r=this.__webglResourceRepository.getWebGLResource(this.__shaderProgramUid),i=e.getUniformLocation(r,"u_dataTexture");e.uniform1i(i,0)},e.prototype.attatchShaderProgram=function(){var e=this.__shaderProgramUid,t=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),r=this.__webglResourceRepository.getWebGLResource(e);t.useProgram(r)},e.prototype.attachVertexData=function(e,t,r,i){var n=this.__vertexHandles[e],o=this.__webglResourceRepository.getWebGLResource(n.vaoHandle),a=r.getRawContext();if(null!=o)r.bindVertexArray(o);else{this.__webglResourceRepository.setVertexDataToPipeline(n,t,i);var s=this.__webglResourceRepository.getWebGLResource(n.iboHandle);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,s)}},e.getInstance=function(){return this.__instance||(this.__instance=new e),this.__instance},e.prototype.common_$render=function(e,t){var r=this.__webglResourceRepository.currentWebGLContextWrapper;this.attatchShaderProgram();var i=r.getRawContext();return i.uniformMatrix4fv(this.__uniformLocation_viewMatrix,!1,e.v),i.uniformMatrix4fv(this.__uniformLocation_projectionMatrix,!1,t.v),!0},e.__vertexHandleOfPrimitiveObjectUids=new Map,e}(),be=r(22),xe=function(){function e(){this.__webglResourceRepository=A.getInstance(),this.__uboUid=o.a.InvalidCGAPIResourceUid,this.__shaderProgramUid=o.a.InvalidCGAPIResourceUid,this.__vertexHandles=[],this.__isVAOSet=!1,this.vertexShaderMethodDefinitions_uniform="\n  uniform mat4 u_worldMatrix;\n  uniform mat4 u_viewMatrix;\n  uniform mat4 u_projectionMatrix;\n  uniform mat3 u_normalMatrix;\n\n  mat4 getMatrix(float instanceId) {\n    return u_worldMatrix;\n  }\n\n  mat4 getViewMatrix(float instanceId) {\n    return u_viewMatrix;\n  }\n\n  mat4 getProjectionMatrix(float instanceId) {\n    return u_projectionMatrix;\n  }\n\n  mat3 getNormalMatrix(float instanceId) {\n    return u_normalMatrix;\n  }\n\n  "}return e.prototype.setupShaderProgram=function(){if(this.__shaderProgramUid===o.a.InvalidCGAPIResourceUid){var e=P.getInstance(),t=e.vertexShaderVariableDefinitions+this.vertexShaderMethodDefinitions_uniform+e.vertexShaderBody,r=e.fragmentShader;this.__shaderProgramUid=this.__webglResourceRepository.createShaderProgram({vertexShaderStr:t,fragmentShaderStr:r,attributeNames:P.attributeNames,attributeSemantics:P.attributeSemantics}),this.__shaderProgram=this.__webglResourceRepository.getWebGLResource(this.__shaderProgramUid);var i=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext();this.__uniformLocation_worldMatrix=i.getUniformLocation(this.__shaderProgram,"u_worldMatrix"),this.__uniformLocation_material=i.getUniformLocation(this.__shaderProgram,"uMaterial.baseColor"),this.__uniformLocation_viewMatrix=i.getUniformLocation(this.__shaderProgram,"u_viewMatrix"),this.__uniformLocation_projectionMatrix=i.getUniformLocation(this.__shaderProgram,"u_projectionMatrix"),this.__uniformLocation_normalMatrix=i.getUniformLocation(this.__shaderProgram,"u_normalMatrix")}},e.prototype.__isLoaded=function(e){return null!=this.__vertexHandles[e]},e.prototype.$load=function(t){if(!this.__isLoaded(0))for(var r=t.getPrimitiveNumber(),i=0;i<r;i++){var n=t.getPrimitiveAt(i),o=this.__webglResourceRepository.createVertexDataResources(n);this.__vertexHandles[i]=o,e.__vertexHandleOfPrimitiveObjectUids.set(n.objectUid,o)}},e.prototype.$prerender=function(t,r){if(!this.__isVAOSet){for(var i=t.getPrimitiveNumber(),n=0;n<i;n++){var o=t.getPrimitiveAt(n);this.__vertexHandles[n]=e.__vertexHandleOfPrimitiveObjectUids.get(o.objectUid),this.__webglResourceRepository.setVertexDataToPipeline(this.__vertexHandles[n],o,r)}this.__isVAOSet=!0}},e.prototype.common_$prerender=function(){},e.prototype.attachGPUData=function(){},e.prototype.attatchShaderProgram=function(){this.__shaderProgramUid;this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext().useProgram(this.__shaderProgram)},e.prototype.attachVertexData=function(e,t,r,i){var n=this.__vertexHandles[e],o=this.__webglResourceRepository.getWebGLResource(n.vaoHandle),a=r.getRawContext();if(null!=o)r.bindVertexArray(o);else{this.__webglResourceRepository.setVertexDataToPipeline(n,t,i);var s=this.__webglResourceRepository.getWebGLResource(n.iboHandle);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,s)}},e.getInstance=function(){return this.__instance||(this.__instance=new e),this.__instance},e.prototype.common_$render=function(e,t){var r=this.__webglResourceRepository.currentWebGLContextWrapper;this.attatchShaderProgram();var i=r.getRawContext();return i.uniformMatrix4fv(this.__uniformLocation_viewMatrix,!1,e.v),i.uniformMatrix4fv(this.__uniformLocation_projectionMatrix,!1,t.v),!1},e.prototype.$render=function(e,t,r,i){var n=this.__webglResourceRepository.currentWebGLContextWrapper;this.attatchShaderProgram();var a=n.getRawContext();this.attachVertexData(e,t,n,o.a.InvalidCGAPIResourceUid),a.uniformMatrix4fv(this.__uniformLocation_worldMatrix,!1,be.a.transpose(r).raw()),a.uniformMatrix3fv(this.__uniformLocation_normalMatrix,!1,i.v);var s=t.material,_=[];s?(_[0]=s.baseColor.r,_[1]=s.baseColor.g,_[2]=s.baseColor.b,_[3]=s.alpha):(_[0]=1,_[1]=1,_[2]=1,_[3]=1),a.uniform4fv(this.__uniformLocation_material,_),n.drawElementsInstanced(t.primitiveMode.index,t.indicesAccessor.elementCount,t.indicesAccessor.componentType.index,0,1)},e.__vertexHandleOfPrimitiveObjectUids=new Map,e}(),me=function(e){return e.index===n.a.UBOWebGL2.index?W.getInstance():e.index===n.a.TransformFeedbackWebGL2.index?fe.getInstance():e.index===n.a.UniformWebGL1.index?xe.getInstance():ge.getInstance()},Re=r(9),ve=r(31),we=r(20),ye=r(7),Ue=function(){function e(){this.__webglResourceRepository=A.getInstance(),this.__componentRepository=Re.a.getInstance(),this.__instanceIDBufferUid=o.a.InvalidCGAPIResourceUid,this.__tmp_indentityMatrix=ye.a.identity()}return e.getInstance=function(){return this.__instance||(this.__instance=new e),this.__instance},e.prototype.common_$load=function(e){this.__webGLStrategy=me(e),this.__webGLStrategy.setupShaderProgram()},e.prototype.common_$prerender=function(){if(null==this.__webglResourceRepository.currentWebGLContextWrapper)throw new Error("No WebGLRenderingContext!");return this.__webGLStrategy.common_$prerender(),this.__isReady()?0:(this.__instanceIDBufferUid=this.__setupInstanceIDBuffer(),this.__instanceIDBufferUid)},e.prototype.__isReady=function(){return this.__instanceIDBufferUid!==o.a.InvalidCGAPIResourceUid},e.prototype.__setupInstanceIDBuffer=function(){if(null==this.__instanceIdAccessor){var e=G.a.getInstance().getBuffer(I.a.CPUGeneric),t=ve.a.maxEntityNumber,r=e.takeBufferView({byteLengthToNeed:4*t,byteStride:0,isAoS:!1});this.__instanceIdAccessor=r.takeAccessor({compositionType:s.a.Scalar,componentType:_.a.Float,count:t})}var i=this.__componentRepository.getComponentsWithType(he.a.componentTID);if(null==i)return o.a.InvalidCGAPIResourceUid;for(var n=0;n<i.length;n++)this.__instanceIdAccessor.setScalar(n,i[n].entityUID);return this.__webglResourceRepository.createVertexBuffer(this.__instanceIdAccessor)},e.prototype.common_$render=function(){this.__cameraComponent=this.__componentRepository.getComponent(we.a.componentTID,we.a.main);var e=this.__tmp_indentityMatrix,t=this.__tmp_indentityMatrix;if(this.__cameraComponent&&(e=this.__cameraComponent.viewMatrix,t=this.__cameraComponent.projectionMatrix),this.__webGLStrategy.common_$render(e,t))for(var r=this.__componentRepository.getComponentsWithType(he.a.componentTID)[0],i=r.getPrimitiveNumber(),n=this.__webglResourceRepository.currentWebGLContextWrapper,o=0;o<i;o++){var a=r.getPrimitiveAt(o);this.__webGLStrategy.attachVertexData(o,a,n,this.__instanceIDBufferUid),this.__webGLStrategy.attatchShaderProgram(),this.__webGLStrategy.attachGPUData();var s=this.__componentRepository.getComponentsWithType(he.a.componentTID);n.drawElementsInstanced(a.primitiveMode.index,a.indicesAccessor.elementCount,a.indicesAccessor.componentType.index,0,s.length)}},e}(),Te=Object.freeze({getRenderingStrategy:me,GLSLShader:P,WebGLContextWrapper:R,WebGLRenderingPipeline:Ue,WebGLResourceRepository:A,WebGLStrategyDataTexture:ge,WebGLStrategyTransformFeedback:fe,WebGLStrategyUBO:W,WebGLStrategyUniform:xe});t.default=Te}}]);
(0,eval)('this').Rn.WEBGL_VERSION='version: 0.1.1-17-g26df-mod branch: master';
