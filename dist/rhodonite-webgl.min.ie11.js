(window.webpackJsonp=window.webpackJsonp||[]).push([["webgl"],{77:function(e,t,a){"use strict";a.r(t);var r=a(45),i=a(61),n=a(25),o=a(9),s=a(3),c=a(10),l=a(60),m=a(17),u=a(48),p=a(38),d=a(1),h=a(20),_=a(46),g=a(0),f=a(12),x=a(2),y=a(7),b=a(28),v=a(5),T=a(66),w=a(11),R=(a(40),function(e,t,a,r){return new(a||(a=Promise))(function(i,n){function o(e){try{c(r.next(e))}catch(e){n(e)}}function s(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){e.done?i(e.value):new a(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})}),M=function(e,t){var a,r,i,n,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,r&&(i=2&n[0]?r.return:n[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,n[1])).done)return i;switch(r=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,r=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){o=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){o.label=n[1];break}if(6===n[0]&&o.label<i[1]){o.label=i[1],i=n;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(n);break}i[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],r=0}finally{a=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}},A=function(){function e(){this.__webglResourceRepository=i.a.getInstance(),this.__lastRenderPassCullFace=!1,this.__pointDistanceAttenuation=new x.b(0,.1,.01),this.__lastRenderPassTickCount=-1,this.__dataTextureUid=o.a.InvalidCGAPIResourceUid,this.__lastShader=-1}return e.prototype.setupShaderProgram=function(t){if(null!=t.mesh)for(var a=t.mesh.getPrimitiveNumber(),r=0;r<a;r++){var i=t.mesh.getPrimitiveAt(r),c=i.material;if(c){if(c._shaderProgramUid!==o.a.InvalidCGAPIResourceUid)return;var l=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),m=[{semantic:s.a.VertexAttributesExistenceArray,compositionType:g.a.ScalarArray,componentType:d.a.Int,stage:v.a.VertexShader,min:0,max:1,isSystem:!0,updateInteval:y.a.EveryTime},{semantic:s.a.WorldMatrix,compositionType:g.a.Mat4,componentType:d.a.Float,stage:v.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:y.a.EveryTime},{semantic:s.a.NormalMatrix,compositionType:g.a.Mat3,componentType:d.a.Float,stage:v.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:y.a.EveryTime},{semantic:s.a.ViewMatrix,compositionType:g.a.Mat4,componentType:d.a.Float,stage:v.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:y.a.FirstTimeOnly},{semantic:s.a.ProjectionMatrix,compositionType:g.a.Mat4,componentType:d.a.Float,stage:v.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:y.a.FirstTimeOnly},{semantic:s.a.ViewPosition,compositionType:g.a.Vec3,componentType:d.a.Float,stage:v.a.PixelShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:y.a.FirstTimeOnly},{semantic:s.a.BoneMatrix,compositionType:g.a.Mat4,componentType:d.a.Float,stage:v.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:y.a.EveryTime},{semantic:s.a.BoneCompressedChank,compositionType:g.a.Vec4Array,componentType:d.a.Float,stage:v.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:y.a.EveryTime},{semantic:s.a.BoneCompressedInfo,compositionType:g.a.Vec4,componentType:d.a.Float,stage:v.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:y.a.EveryTime},{semantic:s.a.SkinningMode,compositionType:g.a.Scalar,componentType:d.a.Int,stage:v.a.VertexShader,min:0,max:1,isSystem:!0,updateInteval:y.a.EveryTime},{semantic:s.a.DiffuseEnvTexture,compositionType:g.a.TextureCube,componentType:d.a.Int,stage:v.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInteval:y.a.EveryTime},{semantic:s.a.SpecularEnvTexture,compositionType:g.a.TextureCube,componentType:d.a.Int,stage:v.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInteval:y.a.EveryTime},{semantic:s.a.IBLParameter,compositionType:g.a.Vec4,componentType:d.a.Float,stage:v.a.PixelShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInteval:y.a.EveryTime},{semantic:s.a.HDRIFormat,compositionType:g.a.Vec2,componentType:d.a.Int,stage:v.a.PixelShader,min:0,max:5,isSystem:!0,updateInteval:y.a.EveryTime},{semantic:s.a.BrdfLutTexture,compositionType:g.a.Texture2D,componentType:d.a.Int,stage:v.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInteval:y.a.EveryTime},{semantic:s.a.LightNumber,compositionType:g.a.Scalar,componentType:d.a.Int,stage:v.a.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInteval:y.a.FirstTimeOnly}];i.primitiveMode.index===l.POINTS&&m.push({semantic:s.a.PointSize,compositionType:g.a.Scalar,componentType:d.a.Float,stage:v.a.PixelShader,min:0,max:Number.MAX_VALUE,isSystem:!0,updateInteval:y.a.EveryTime},{semantic:s.a.PointDistanceAttenuation,compositionType:g.a.Vec3,componentType:d.a.Float,stage:v.a.PixelShader,min:0,max:1,isSystem:!0,updateInteval:y.a.EveryTime}),e.__shaderSemanticInfoArray=e.__shaderSemanticInfoArray.concat(m),e.setupMaterial(c,e.__shaderSemanticInfoArray)}}else n.a.alertNoMeshSet(t)},e.setupMaterial=function(t,a){var r;r=null!=a?a:t.fieldsInfoArray;T.a.getInstance().glsl_texture;e.__vertexShaderMethodDefinitions_uniform="\n  uniform mat4 u_worldMatrix;\n  uniform mat4 u_viewMatrix;\n  uniform mat4 u_projectionMatrix;\n  uniform mat3 u_normalMatrix;\n\n  mat4 get_worldMatrix(float instanceId) {\n    return u_worldMatrix;\n  }\n\n  mat4 get_viewMatrix(float instanceId) {\n    return u_viewMatrix;\n  }\n\n  mat4 get_projectionMatrix(float instanceId) {\n    return u_projectionMatrix;\n  }\n\n  mat3 get_normalMatrix(float instanceId) {\n    return u_normalMatrix;\n  }\n\n\n#ifdef RN_IS_MORPHING\n  vec3 get_position(float vertexId, vec3 basePosition) {\n    vec3 position = basePosition;\n    for (int i=0; i<"+m.a.maxVertexMorphNumberInShader+"; i++) {\n      float index = u_dataTextureMorphOffsetPosition[i] + 1.0 * vertexId;\n      float powWidthVal = "+b.a.bufferWidthLength+".0;\n      float powHeightVal = "+b.a.bufferHeightLength+".0;\n      vec2 arg = vec2(1.0/powWidthVal, 1.0/powHeightVal);\n    //  vec2 arg = vec2(1.0/powWidthVal, 1.0/powWidthVal/powHeightVal);\n      vec3 addPos = fetchElement(u_dataTexture, index + 0.0, arg).xyz;\n      position += addPos * u_morphWeights[i];\n      if (i == u_morphTargetNumber-1) {\n        break;\n      }\n    }\n\n    return position;\n  }\n#endif\n\n  ",t.createProgram(e.__vertexShaderMethodDefinitions_uniform,s.a.getShaderProperty),i.a.getInstance().setupUniformLocations(t._shaderProgramUid,r),t.setUniformLocations(t._shaderProgramUid)},e.prototype.$load=function(e){return R(this,void 0,void 0,function(){var t,a,r,i;return M(this,function(o){switch(o.label){case 0:if(null==e.mesh)return n.a.alertNoMeshSet(e),[2];for(this.setupShaderProgram(e),t=e.mesh.getPrimitiveNumber(),a=0;a<t;a++)e.mesh.getPrimitiveAt(a).create3DAPIVertexData();return e.mesh.updateVariationVBO(),this.__dummyWhiteTextureUid=this.__webglResourceRepository.createDummyTexture(),this.__dummyBlackTextureUid=this.__webglResourceRepository.createDummyTexture("rgba(0, 0, 0, 1)"),this.__dummyBlackCubeTextureUid=this.__webglResourceRepository.createDummyCubeTexture(),r=u.a.getInstance().getModule("pbr").pbrCookTorranceBrdfLutDataUrl,i=this,[4,this.__webglResourceRepository.createTextureFromDataUri(r,{level:0,internalFormat:p.a.RGBA,border:0,format:p.a.RGBA,type:d.a.Float,magFilter:h.a.Linear,minFilter:h.a.Linear,wrapS:h.a.ClampToEdge,wrapT:h.a.ClampToEdge,generateMipmap:!1,anisotropy:!1})];case 1:return i.__pbrCookTorranceBrdfLutDataUrlUid=o.sent(),[2]}})})},e.prototype.$prerender=function(e,t,a){if(null!=e.mesh){var r=e.mesh.getPrimitiveNumber();if(e.mesh.weights.length>0)for(var i=0;i<r;i++){var o=e.mesh.getPrimitiveAt(i);this.__webglResourceRepository.resendVertexBuffer(o,o.vertexHandles.vboHandles)}for(i=0;i<r;i++){o=e.mesh.getPrimitiveAt(i);this.__webglResourceRepository.setVertexDataToPipeline({vaoHandle:e.mesh.getVaoUids(i),iboHandle:o.vertexHandles.iboHandle,vboHandles:o.vertexHandles.vboHandles},o,a)}}else n.a.alertNoMeshSet(e)},e.prototype.common_$prerender=function(){var e=c.a.getInstance();this.__lightComponents=e.getComponentsWithType(l.a);var t=b.a.getInstance().getBuffer(w.a.GPUInstanceData),a=new Float32Array(t.getArrayBuffer());this.__dataTextureUid!==o.a.InvalidCGAPIResourceUid||(this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__dataTextureUid=this.__webglResourceRepository.createTexture(a,{level:0,internalFormat:h.a.RGBA32F,width:b.a.bufferWidthLength,height:b.a.bufferHeightLength,border:0,format:p.a.RGBA,type:d.a.Float,magFilter:h.a.Nearest,minFilter:h.a.Nearest,wrapS:h.a.Repeat,wrapT:h.a.Repeat,generateMipmap:!1,anisotropy:!1}):this.__dataTextureUid=this.__webglResourceRepository.createTexture(a,{level:0,internalFormat:p.a.RGBA,width:b.a.bufferWidthLength,height:b.a.bufferHeightLength,border:0,format:p.a.RGBA,type:d.a.Float,magFilter:h.a.Nearest,minFilter:h.a.Nearest,wrapS:h.a.Repeat,wrapT:h.a.Repeat,generateMipmap:!1,anisotropy:!1}))},e.prototype.attachGPUData=function(e){},e.prototype.attatchShaderProgram=function(e){},e.prototype.attachVertexData=function(e,t,a,r){},e.prototype.attachVertexDataInner=function(e,t,a,r,i){var n=t.vertexHandles,o=this.__webglResourceRepository.getWebGLResource(e.getVaoUids(a)),s=r.getRawContext();if(null!=o)r.bindVertexArray(o);else{this.__webglResourceRepository.setVertexDataToPipeline(n,t,i);var c=this.__webglResourceRepository.getWebGLResource(n.iboHandle);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,c)}},e.prototype.dettachVertexData=function(e){var t=e.getRawContext();e.bindVertexArray&&e.bindVertexArray(null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindBuffer(t.ARRAY_BUFFER,null)},e.getInstance=function(){return this.__instance||(this.__instance=new e),this.__instance},e.prototype.common_$render=function(e,t,a,r,i){return!1},e.isOpaqueMode=function(){return e.__isOpaqueMode},e.isTransparentMode=function(){return!e.__isOpaqueMode},e.prototype.$render=function(t,a,r,i,s,c,l,m,u){var p=this.__webglResourceRepository.currentWebGLContextWrapper,d=p.getRawContext();if(this.setWebGLStatesBegin(t,d,c),null!=a.mesh){for(var h=a.mesh.getPrimitiveNumber(),_=0;_<h;_++){var g=a.mesh.getPrimitiveAt(_);if((!e.isOpaqueMode()||!g.isBlend())&&(!e.isTransparentMode()||!g.isOpaque())){this.attachVertexDataInner(a.mesh,g,_,p,o.a.InvalidCGAPIResourceUid);var f=void 0;f=null!=c.material?c.material:g.material;var x=this.__webglResourceRepository.getWebGLResource(f._shaderProgramUid),y=f._shaderProgramUid,b=!1;if(l!==this.__lastRenderPassTickCount&&(b=!0),y!==this.__lastShader){d.useProgram(x);var v=d.getUniformLocation(x,"u_dataTexture");d.uniform1i(v,7),this.__lastShader=y,b=!0}this.__webglResourceRepository.bindTexture2D(7,this.__dataTextureUid),f&&f.setParemetersForGPU({material:f,shaderProgram:x,firstTime:b,args:{setUniform:!0,glw:p,entity:s,primitive:g,worldMatrix:r,normalMatrix:i,lightComponents:this.__lightComponents,renderPass:c,diffuseCube:m,specularCube:u}}),g.indicesAccessor?d.drawElements(g.primitiveMode.index,g.indicesAccessor.elementCount,g.indicesAccessor.componentType.index,0):d.drawArrays(g.primitiveMode.index,0,g.getVertexCountAsVerticesBased()),this.dettachVertexData(p)}}this.setWebGLStatesEnd(t,d,c),this.__lastRenderPassTickCount=l}else n.a.alertNoMeshSet(a)},e.prototype.setWebGLStatesBegin=function(t,a,r){t===_.a.firstTranparentIndex&&(a.enable(a.BLEND),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE),a.depthMask(!1),e.__isOpaqueMode=!1),r.cullface!==this.__lastRenderPassCullFace&&(r.cullface?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.__lastRenderPassCullFace=r.cullface)},e.prototype.setWebGLStatesEnd=function(t,a,r){t===_.a.lastTransparentIndex&&(a.disable(a.BLEND),a.depthMask(!0),e.__isOpaqueMode=!0)},e.__isOpaqueMode=!0,e.__shaderSemanticInfoArray=[],e.transposedMatrix44=new f.a([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),e}(),I=a(62),V=a(27),P=a(31),S=a(8),L=a(14),U=function(){function e(){this.__webglResourceRepository=i.a.getInstance(),this.__dataTextureUid=o.a.InvalidCGAPIResourceUid,this.__lastShader=o.a.InvalidCGAPIResourceUid}return Object.defineProperty(e.prototype,"vertexShaderMethodDefinitions_dataTexture",{get:function(){T.a.getInstance().glsl_texture;return"\n  uniform mat4 u_viewMatrix;\n  uniform mat4 u_projectionMatrix;\n  uniform mat3 u_normalMatrix;\n\n\n  mat4 get_worldMatrix(float instanceId)\n  {\n    highp float index = "+V.a.getLocationOffsetOfMemberOfComponent(P.a,"worldMatrix")+".0 + 4.0 * instanceId;\n    highp float powWidthVal = "+b.a.bufferWidthLength+".0;\n    highp float powHeightVal = "+b.a.bufferHeightLength+".0;\n    vec2 arg = vec2(1.0/powWidthVal, 1.0/powHeightVal);\n    // highp vec2 arg = vec2(1.0/powWidthVal, 1.0/powWidthVal/powHeightVal);\n\n    vec4 col0 = fetchElement(u_dataTexture, index + 0.0, arg);\n    vec4 col1 = fetchElement(u_dataTexture, index + 1.0, arg);\n    vec4 col2 = fetchElement(u_dataTexture, index + 2.0, arg);\n    vec4 col3 = fetchElement(u_dataTexture, index + 3.0, arg);\n\n    mat4 matrix = mat4(\n      col0.x, col0.y, col0.z, 0.0,\n      col1.x, col1.y, col1.z, 0.0,\n      col2.x, col2.y, col2.z, 0.0,\n      col3.x, col3.y, col3.z, 1.0\n      );\n\n    return matrix;\n  }\n\n  mat4 get_viewMatrix(float instanceId) {\n    return u_viewMatrix;\n  }\n\n  mat4 get_projectionMatrix(float instanceId) {\n    return u_projectionMatrix;\n  }\n\n  mat3 get_normalMatrix(float instanceId) {\n    float index = "+V.a.getLocationOffsetOfMemberOfComponent(P.a,"normalMatrix")+".0 + 3.0 * instanceId;\n    float powWidthVal = "+b.a.bufferWidthLength+".0;\n    float powHeightVal = "+b.a.bufferHeightLength+".0;\n    vec2 arg = vec2(1.0/powWidthVal, 1.0/powHeightVal);\n  //  vec2 arg = vec2(1.0/powWidthVal, 1.0/powWidthVal/powHeightVal);\n\n    vec4 col0 = fetchElement(u_dataTexture, index + 0.0, arg);\n    vec4 col1 = fetchElement(u_dataTexture, index + 1.0, arg);\n    vec4 col2 = fetchElement(u_dataTexture, index + 2.0, arg);\n\n    mat3 matrix = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n      // mat3 matrix = mat3(\n      //   col0.x, col0.y, col0.z,\n      //   col1.x, col1.y, col1.z,\n      //   col2.x, col2.y, col2.z\n      //   );\n  \n      // mat3 matrix = mat3(\n    //   col0.x, col0.w, col1.z,\n    //   col0.y, col1.x, col1.w,\n    //   col0.z, col1.y, col2.x\n    //   );\n\n\n    return matrix;\n  }\n\n#ifdef RN_IS_MORPHING\n  vec3 get_position(float vertexId, vec3 basePosition) {\n    vec3 position = basePosition;\n    for (int i=0; i<"+m.a.maxVertexMorphNumberInShader+"; i++) {\n      float index = u_dataTextureMorphOffsetPosition[i] + 1.0 * vertexId;\n      float powWidthVal = "+b.a.bufferWidthLength+".0;\n      float powHeightVal = "+b.a.bufferHeightLength+".0;\n      vec2 arg = vec2(1.0/powWidthVal, 1.0/powHeightVal);\n    //  vec2 arg = vec2(1.0/powWidthVal, 1.0/powWidthVal/powHeightVal);\n      vec3 addPos = fetchElement(u_dataTexture, index + 0.0, arg).xyz;\n      position += addPos * u_morphWeights[i];\n      if (i == u_morphTargetNumber-1) {\n        break;\n      }\n    }\n\n    return position;\n  }\n#endif\n  "},enumerable:!0,configurable:!0}),e.prototype.setupShaderProgram=function(e){if(null!=e.mesh)for(var t=function(e){var t=1;switch(e.compositionType){case g.a.Mat4:t=4;break;case g.a.Mat3:t=3}return t},a=function(e,a,r){var i,n,o=a.compositionType.getGlslStr(a.componentType),c=[],l=1,m=-1,u=a.compositionType===g.a.Texture2D||a.compositionType===g.a.TextureCube,p=a.semantic.str.replace(".","_"),h=a.compositionType.getGlslStr(a.componentType),_="";if(a.maxIndex&&(_="["+a.maxIndex+"]"),n="  uniform "+h+" u_"+p+_+";\n",r<0){if(Math.abs(r)%s.b._scale!=0)return"";for(var f=t(a),x=0;x<a.maxIndex;x++){var y=I.a.getLocationOffsetOfMemberOfMaterial(e,r);c.push(y)}var v="highp float indices["+(l=a.maxIndex)+"];";c.forEach(function(e,t){v+="\nindices["+t+"] = "+e+".0;"}),i="\n          "+v+"\n          highp float idx = 0.0;\n          for (int i=0; i<"+l+"; i++) {\n            idx = indices[i] + "+f+".0 * instanceId;\n            if (i == index) {\n              break;\n            }\n          }"}else{f=t(a);m=I.a.getLocationOffsetOfMemberOfMaterial(e,r);var T=void 0,w=0;g.a.isArray(a.compositionType)?(T="float(index)",null!=a.maxIndex&&(w=f*a.maxIndex)):T="instanceId",i="highp float idx = "+m+".0 + "+w+".0 * instanceId + "+f+".0 * "+T+";"}var R="";a.componentType===d.a.Int&&a.compositionType!==g.a.Scalar&&(R="i");var M="";u||(M+="\n  "+o+" get_"+p+"(highp float instanceId, const int index) {\n    "+i+"\n    highp float powWidthVal = "+b.a.bufferWidthLength+".0;\n    highp float powHeightVal = "+b.a.bufferHeightLength+".0;\n    highp vec2 arg = vec2(1.0/powWidthVal, 1.0/powHeightVal);\n    highp vec4 col0 = fetchElement(u_dataTexture, idx + 0.0, arg);\n");var A=""+n+M;switch(a.compositionType){case g.a.Vec4:case g.a.Vec4Array:A+="        highp "+R+"vec4 val = "+R+"vec4(col0);";break;case g.a.Vec3:case g.a.Vec3Array:A+="        highp "+R+"vec3 val = "+R+"vec3(col0.xyz);";break;case g.a.Vec2:case g.a.Vec2Array:A+="        highp "+R+"vec2 val = "+R+"vec2(col0.xy);";break;case g.a.Scalar:case g.a.ScalarArray:a.componentType===d.a.Int?A+="        int val = int(col0.x);":a.componentType===d.a.Bool?A+="        bool val = bool(col0.x);":A+="       float val = col0.x;";break;case g.a.Mat4:A+="\n          vec4 col1 = fetchElement(u_dataTexture, index + 1.0, arg);\n          vec4 col2 = fetchElement(u_dataTexture, index + 2.0, arg);\n          mat4 val = mat4(\n            col0.x, col1.x, col2.x, 0.0,\n            col0.y, col1.y, col2.y, 0.0,\n            col0.z, col1.z, col2.z, 0.0,\n            col0.w, col1.w, col2.w, 1.0\n            );\n          ";break;case g.a.Mat3:A+="\n          vec4 col1 = fetchElement(u_dataTexture, index + 1.0, arg);\n          vec4 col2 = fetchElement(u_dataTexture, index + 2.0, arg);\n          mat3 val = mat3(\n            col0.x, col0.w, col1.z,\n            col0.y, col1.x, col1.w,\n            col0.z, col1.y, col2.x,\n            );\n          ";break;default:A+=""}return u||(A+="\n        return val;\n      }\n    "),A},r=e.mesh.getPrimitiveNumber(),i=0;i<r;i++){var c=e.mesh.getPrimitiveAt(i).material;if(c){if(c._shaderProgramUid!==o.a.InvalidCGAPIResourceUid)return;c.createProgram(this.vertexShaderMethodDefinitions_dataTexture,a),this.__webglResourceRepository.setupUniformLocations(c._shaderProgramUid,[{semantic:s.a.ViewMatrix,compositionType:g.a.Mat4,componentType:d.a.Float,stage:v.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0},{semantic:s.a.ProjectionMatrix,compositionType:g.a.Mat4,componentType:d.a.Float,stage:v.a.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0}]),c.setUniformLocations(c._shaderProgramUid)}}else n.a.alertNoMeshSet(e)},e.prototype.__isLoaded=function(e){if(null==e.mesh)return!1;if(e.mesh.variationVBOUid!==o.a.InvalidCGAPIResourceUid){for(var t=e.mesh.getPrimitiveNumber(),a=0,r=0;r<t;r++){null!=e.mesh.getPrimitiveAt(r).vertexHandles&&a++}return t===a}return!1},e.prototype.$load=function(e){if(!this.__isLoaded(e))if(null!=e.mesh){this.setupShaderProgram(e);for(var t=e.mesh.getPrimitiveNumber(),a=0;a<t;a++){e.mesh.getPrimitiveAt(a).create3DAPIVertexData()}e.mesh.updateVariationVBO()}else n.a.alertNoMeshSet(e)},e.prototype.$prerender=function(e,t,a){if(!t._readyForRendering)if(null!=e.mesh)if(e.mesh.isInstanceMesh())t._readyForRendering=!0;else{for(var r=e.mesh.getPrimitiveNumber(),i=0;i<r;i++){var o=e.mesh.getPrimitiveAt(i);this.__webglResourceRepository.setVertexDataToPipeline({vaoHandle:e.mesh.getVaoUids(i),iboHandle:o.vertexHandles.iboHandle,vboHandles:o.vertexHandles.vboHandles},o,e.mesh.variationVBOUid)}t._readyForRendering=!0}else n.a.alertNoMeshSet(e)},e.prototype.common_$prerender=function(){var e=b.a.getInstance().getBuffer(w.a.GPUInstanceData),t=new Float32Array(e.getArrayBuffer());if(this.__dataTextureUid!==o.a.InvalidCGAPIResourceUid)return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2,void this.__webglResourceRepository.updateTexture(this.__dataTextureUid,t,{level:0,width:b.a.bufferWidthLength,height:e.takenSizeInByte/b.a.bufferWidthLength/4,format:p.a.RGBA,type:d.a.Float});this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__dataTextureUid=this.__webglResourceRepository.createTexture(t,{level:0,internalFormat:h.a.RGBA32F,width:b.a.bufferWidthLength,height:b.a.bufferHeightLength,border:0,format:p.a.RGBA,type:d.a.Float,magFilter:h.a.Nearest,minFilter:h.a.Nearest,wrapS:h.a.Repeat,wrapT:h.a.Repeat,generateMipmap:!1,anisotropy:!1}):this.__dataTextureUid=this.__webglResourceRepository.createTexture(t,{level:0,internalFormat:p.a.RGBA,width:b.a.bufferWidthLength,height:b.a.bufferHeightLength,border:0,format:p.a.RGBA,type:d.a.Float,magFilter:h.a.Nearest,minFilter:h.a.Nearest,wrapS:h.a.Repeat,wrapT:h.a.Repeat,generateMipmap:!1,anisotropy:!1});var a=c.a.getInstance();this.__lightComponents=a.getComponentsWithType(l.a)},e.prototype.attachGPUData=function(e){var t=e.material,a=this.__webglResourceRepository.currentWebGLContextWrapper,r=a.getRawContext(),i=this.__webglResourceRepository.getWebGLResource(this.__dataTextureUid);a.bindTexture2D(0,i);var n=this.__webglResourceRepository.getWebGLResource(t._shaderProgramUid),o=r.getUniformLocation(n,"u_dataTexture");r.uniform1i(o,0)},e.prototype.attachGPUDataInner=function(e,t){this.__webglResourceRepository.bindTexture2D(0,this.__dataTextureUid);var a=e.getUniformLocation(t,"u_dataTexture");e.uniform1i(a,0)},e.prototype.attatchShaderProgram=function(e){var t=e._shaderProgramUid;if(t!==this.__lastShader){var a=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),r=this.__webglResourceRepository.getWebGLResource(t);a.useProgram(r),this.__lastShader=t}},e.prototype.attachVertexData=function(e,t,a,r){},e.prototype.attachVertexDataInner=function(e,t,a,r,i){var n=t.vertexHandles,o=this.__webglResourceRepository.getWebGLResource(e.getVaoUids(a)),s=r.getRawContext();if(null!=o)r.bindVertexArray(o);else{this.__webglResourceRepository.setVertexDataToPipeline(n,t,e.variationVBOUid);var c=this.__webglResourceRepository.getWebGLResource(n.iboHandle);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,c)}},e.getInstance=function(){return this.__instance||(this.__instance=new e),this.__instance},e.prototype.__setupMaterial=function(e,t){e.setParameter(s.a.LightNumber,this.__lightComponents.length);for(var a=0;a<this.__lightComponents.length&&!(a>=m.a.maxLightNumberInShader);a++){var r=this.__lightComponents[a],i=r.entity.getSceneGraph().worldPosition,n=r.direction,o=r.intensity;e.setParameter(s.a.LightPosition,new S.b(i.x,i.y,i.z,r.type.index),a),e.setParameter(s.a.LightDirection,new S.b(n.x,n.y,n.z,0),a),e.setParameter(s.a.LightIntensity,new S.b(o.x,o.y,o.z,0),a)}},e.prototype.__setupMaterialEveryFrame=function(e,t){var a=t.cameraComponent;if(null==a&&(a=c.a.getInstance().getComponent(L.a,L.a.main)),a){var r=a.worldPosition;e.setParameter(s.a.ViewPosition,r)}},e.prototype.common_$render=function(t,a,r,i,n){for(var o=this.__webglResourceRepository.currentWebGLContextWrapper,c=o.getRawContext(),l=0;l<t.length;l++){var m=a[t[l]];if(null==m)break;var u=m.mesh;if(u&&u.isOriginalMesh())for(var p=u.getPrimitiveNumber(),d=0;d<p;d++){var h=u.getPrimitiveAt(d),g=h.material._shaderProgramUid;if(-1!==g){if(this.attachVertexDataInner(u,h,d,o,u.variationVBOUid),g!==this.__lastShader){var f=this.__webglResourceRepository.getWebGLResource(g);c.useProgram(f);var x=c.getUniformLocation(f,"u_dataTexture");c.uniform1i(x,7),this.__materialSIDLocation=c.getUniformLocation(f,"u_materialSID"),this.__setupMaterial(h.material,n),e.__shaderProgram=f,this.__webglResourceRepository.setUniformValue(f,s.a.ViewMatrix.str,!0,r),this.__webglResourceRepository.setUniformValue(f,s.a.ProjectionMatrix.str,!0,i)}c.uniform1f(this.__materialSIDLocation,h.material.materialSID),this.__webglResourceRepository.bindTexture2D(7,this.__dataTextureUid),this.__setupMaterialEveryFrame(h.material,n);var y=m.entity,b=y.getComponent(_.a);h.material.setParemetersForGPU({material:h.material,shaderProgram:e.__shaderProgram,firstTime:!0,args:{glw:o,entity:y,worldMatrix:y.getSceneGraph().worldMatrixInner,normalMatrix:y.getSceneGraph().normalMatrixInner,lightComponents:this.__lightComponents,renderPass:n,primitive:h,diffuseCube:b.diffuseCubeMap,specularCube:b.specularCubeMap}}),h.indicesAccessor?o.drawElementsInstanced(h.primitiveMode.index,h.indicesAccessor.elementCount,h.indicesAccessor.componentType.index,0,u.instanceCountIncludeOriginal):o.drawArraysInstanced(h.primitiveMode.index,0,h.getVertexCountAsVerticesBased(),u.instanceCountIncludeOriginal),this.__lastShader=g}}}var v=e.__shaderProgram;return this.__webglResourceRepository.setUniformValue(v,s.a.ViewMatrix.str,!0,r),this.__webglResourceRepository.setUniformValue(v,s.a.ProjectionMatrix.str,!0,i),!1},e}(),E=function(e){return e.index===r.a.FastestWebGL1.index?U.getInstance():(e.index===r.a.UniformWebGL1.index||(e.index,r.a.UniformWebGL2.index),A.getInstance())},C=a(39),N=a(68),W=Object.freeze({getRenderingStrategy:E,GLSLShader:C.a,WebGLContextWrapper:N.a,WebGLResourceRepository:i.a,WebGLStrategyUniform:A});t.default=W;window.RnWebGL=W}}]);