(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["sparkgear"],{

/***/ "./src/sparkgear/SparkGearComponent.ts":
/*!*********************************************!*\
  !*** ./src/sparkgear/SparkGearComponent.ts ***!
  \*********************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return SparkGearComponent; });\n/* harmony import */ var _foundation_core_Component__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../foundation/core/Component */ \"./src/foundation/core/Component.ts\");\n/* harmony import */ var _foundation_components_WellKnownComponentTIDs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../foundation/components/WellKnownComponentTIDs */ \"./src/foundation/components/WellKnownComponentTIDs.ts\");\n/* harmony import */ var _foundation_definitions_ProcessStage__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../foundation/definitions/ProcessStage */ \"./src/foundation/definitions/ProcessStage.ts\");\n/* harmony import */ var _foundation_math_Matrix44__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../foundation/math/Matrix44 */ \"./src/foundation/math/Matrix44.ts\");\n/* harmony import */ var _foundation_components_CameraComponent__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../foundation/components/CameraComponent */ \"./src/foundation/components/CameraComponent.ts\");\n/* harmony import */ var _foundation_core_ComponentRepository__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../foundation/core/ComponentRepository */ \"./src/foundation/core/ComponentRepository.ts\");\n/* harmony import */ var _foundation_components_SceneGraphComponent__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../foundation/components/SceneGraphComponent */ \"./src/foundation/components/SceneGraphComponent.ts\");\n/* harmony import */ var _foundation_system_ModuleManager__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../foundation/system/ModuleManager */ \"./src/foundation/system/ModuleManager.ts\");\n\n\n\n\n\n\n\n\nclass SparkGearComponent extends _foundation_core_Component__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n    constructor(entityUid, componentSid, entityRepository) {\n        super(entityUid, componentSid, entityRepository);\n    }\n    static get componentTID() {\n        return _foundation_components_WellKnownComponentTIDs__WEBPACK_IMPORTED_MODULE_1__[\"WellKnownComponentTIDs\"].SparkGearComponentTID;\n    }\n    static common_$load() {\n        if (SparkGearComponent.__isInitialized) {\n            return;\n        }\n        const moduleManager = _foundation_system_ModuleManager__WEBPACK_IMPORTED_MODULE_7__[\"default\"].getInstance();\n        const moduleName = 'webgl';\n        const webglModule = moduleManager.getModule(moduleName);\n        // Initialize SPARKGEAR\n        SparkGearComponent.SPFX_Initialize(webglModule.WebGLResourceRepository.getInstance());\n    }\n    $logic() {\n        // Keep Playing\n        if (!this.isPlaying()) {\n            this.play();\n        }\n        const cameraComponent = _foundation_core_ComponentRepository__WEBPACK_IMPORTED_MODULE_5__[\"default\"].getInstance().getComponent(_foundation_components_CameraComponent__WEBPACK_IMPORTED_MODULE_4__[\"default\"], _foundation_components_CameraComponent__WEBPACK_IMPORTED_MODULE_4__[\"default\"].main);\n        let viewMatrix = SparkGearComponent.__tmp_indentityMatrix;\n        let projectionMatrix = SparkGearComponent.__tmp_indentityMatrix;\n        if (cameraComponent) {\n            viewMatrix = cameraComponent.viewMatrix;\n            projectionMatrix = cameraComponent.projectionMatrix;\n        }\n        SparkGearComponent.SPARK_SetCameraMatrix(viewMatrix, projectionMatrix);\n        SparkGearComponent.SPFX_Update(1.0);\n        const m = this.__sceneGraphComponent.worldMatrixInner;\n        _SPARK_Instance_SetTransformFor3D(this.__hSPFXInst, m.v[0], m.v[4], m.v[8], m.v[12], m.v[1], m.v[5], m.v[9], m.v[13], m.v[2], m.v[6], m.v[10], m.v[14], m.v[3], m.v[7], m.v[11], m.v[15]);\n        this.moveStageTo(_foundation_definitions_ProcessStage__WEBPACK_IMPORTED_MODULE_2__[\"ProcessStage\"].Render);\n    }\n    $render() {\n        this.onAfterRender();\n        this.moveStageTo(_foundation_definitions_ProcessStage__WEBPACK_IMPORTED_MODULE_2__[\"ProcessStage\"].Logic);\n    }\n    $load() {\n        if (this.url == null) {\n            return;\n        }\n        const loadBytes = function (path, type, callback) {\n            var request = new XMLHttpRequest();\n            request.open('GET', path, true);\n            request.responseType = type;\n            request.onload = () => {\n                switch (request.status) {\n                    case 200:\n                        callback(request.response);\n                        break;\n                    default:\n                        console.error('Failed to load (' + request.status + ') : ' + path);\n                        break;\n                }\n            };\n            request.send(null);\n        };\n        const ThisClass = SparkGearComponent;\n        loadBytes(this.url, 'arraybuffer', (data) => {\n            var buffer = new Uint8Array(data);\n            ThisClass.SPARK_BackupStatus();\n            var SPFXData = window.Module.ccall(\"SPARK_Data_Create\", 'number', ['string', 'number', 'array', 'number'], [this.url, this.url.length, buffer, buffer.length]);\n            this.__hSPFXInst = _SPARK_Instance_Create(SPFXData);\n            _SPARK_Data_Delete(SPFXData);\n            ThisClass.SPARK_RestoreStatus();\n            this.moveStageTo(_foundation_definitions_ProcessStage__WEBPACK_IMPORTED_MODULE_2__[\"ProcessStage\"].Logic);\n        });\n    }\n    $create() {\n        this.__sceneGraphComponent = this.__entityRepository.getComponentOfEntity(this.__entityUid, _foundation_components_SceneGraphComponent__WEBPACK_IMPORTED_MODULE_6__[\"default\"]);\n        this.moveStageTo(_foundation_definitions_ProcessStage__WEBPACK_IMPORTED_MODULE_2__[\"ProcessStage\"].Load);\n    }\n    onBeforeRender() {\n    }\n    onAfterRender() {\n        const ThisClass = SparkGearComponent;\n        ThisClass.SPARK_BackupStatus();\n        _SPARK_Draw(this.__hSPFXInst);\n        ThisClass.SPARK_RestoreStatus();\n    }\n    // clone() {\n    //   return new this.constructor(this._LoadingManager, this._Url).copy(this);\n    // }\n    play() {\n        _SPARK_Instance_Play(this.__hSPFXInst, 1.0, false, 0);\n    }\n    stop() {\n        _SPARK_Instance_Stop(this.__hSPFXInst);\n    }\n    pause() {\n        _SPARK_Instance_Pause(this.__hSPFXInst);\n    }\n    isPlaying() {\n        return _SPARK_Instance_IsPlaying(this.__hSPFXInst);\n    }\n    kickTrigger(trigger) {\n        _SPARK_Instance_KickTrigger(this.__hSPFXInst, trigger);\n    }\n    static SPARK_BackupStatus() {\n        const ThisClass = SparkGearComponent;\n        const gl = ThisClass.SPFX_WebGLResourceRepository.currentWebGLContextWrapper.getRawContext();\n        ThisClass.SPFX_ArrayBuffer = gl.getParameter(gl.ARRAY_BUFFER_BINDING);\n        ThisClass.SPFX_ElementArrayBuffer = gl.getParameter(gl.ELEMENT_ARRAY_BUFFER_BINDING);\n        ThisClass.SPFX_CurrentProgram = gl.getParameter(gl.CURRENT_PROGRAM);\n        ThisClass.SPFX_FrontFace = gl.getParameter(gl.FRONT_FACE);\n        ThisClass.SPFX_DepthFunc = gl.getParameter(gl.DEPTH_FUNC);\n        ThisClass.SPFX_DepthWriteMask = gl.getParameter(gl.DEPTH_WRITEMASK);\n        ThisClass.SPFX_StencilTestEnabled = gl.isEnabled(gl.STENCIL_TEST);\n        ThisClass.SPFX_DepthTestEnabled = gl.isEnabled(gl.DEPTH_TEST);\n        ThisClass.SPFX_CullFaceEnabled = gl.isEnabled(gl.CULL_FACE);\n        ThisClass.SPFX_BlendEnabled = gl.isEnabled(gl.BLEND);\n        ThisClass.SPFX_BlendSrcRgb = gl.getParameter(gl.BLEND_SRC_RGB);\n        ThisClass.SPFX_BlendDstRgb = gl.getParameter(gl.BLEND_DST_RGB);\n        ThisClass.SPFX_BlendSrcAlpha = gl.getParameter(gl.BLEND_SRC_ALPHA);\n        ThisClass.SPFX_BlendDstAlpha = gl.getParameter(gl.BLEND_DST_ALPHA);\n        ThisClass.SPFX_ActiveTexture = gl.getParameter(gl.ACTIVE_TEXTURE);\n        for (let i = 0; i < 8; i++) {\n            gl.activeTexture(gl.TEXTURE0 + i);\n            ThisClass.SPFX_Texture[i] = gl.getParameter(gl.TEXTURE_BINDING_2D);\n        }\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);\n        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n    }\n    static SPFX_Uninitialize() {\n        const ThisClass = SparkGearComponent;\n        ThisClass.SPARK_BackupStatus();\n        _SPARK_Uninitialize();\n        ThisClass.SPARK_RestoreStatus();\n    }\n    static SPARK_SetCameraMatrix(viewMatrix, projectionMatrix) {\n        _SPARK_SetMatrix(0, viewMatrix.v[0], viewMatrix.v[1], viewMatrix.v[2], viewMatrix.v[3], viewMatrix.v[4], viewMatrix.v[5], viewMatrix.v[6], viewMatrix.v[7], viewMatrix.v[8], viewMatrix.v[9], viewMatrix.v[10], viewMatrix.v[11], viewMatrix.v[12], viewMatrix.v[13], viewMatrix.v[14], viewMatrix.v[15]);\n        _SPARK_SetMatrix(1, projectionMatrix.v[0], projectionMatrix.v[1], projectionMatrix.v[2], projectionMatrix.v[3], projectionMatrix.v[4], projectionMatrix.v[5], projectionMatrix.v[6], projectionMatrix.v[7], projectionMatrix.v[8], projectionMatrix.v[9], projectionMatrix.v[10], projectionMatrix.v[11], projectionMatrix.v[12], projectionMatrix.v[13], projectionMatrix.v[14], projectionMatrix.v[15]);\n    }\n    static SPARK_Draw() {\n        const ThisClass = SparkGearComponent;\n        ThisClass.SPARK_BackupStatus();\n        _SPARK_DrawAll();\n        ThisClass.SPARK_RestoreStatus();\n    }\n    static SPARK_DrawDebugInfo(InfoType) {\n        const ThisClass = SparkGearComponent;\n        ThisClass.SPARK_BackupStatus();\n        _SPARK_DrawDebugInfo(InfoType);\n        ThisClass.SPARK_RestoreStatus();\n    }\n}\nSparkGearComponent.__isInitialized = false;\nSparkGearComponent.SPFX_Texture = [];\nSparkGearComponent.__tmp_indentityMatrix = _foundation_math_Matrix44__WEBPACK_IMPORTED_MODULE_3__[\"default\"].identity();\nSparkGearComponent.SPARK_RestoreStatus = function () {\n    const ThisClass = SparkGearComponent;\n    const gl = ThisClass.SPFX_WebGLResourceRepository.currentWebGLContextWrapper.getRawContext();\n    gl.useProgram(ThisClass.SPFX_CurrentProgram);\n    gl.bindBuffer(gl.ARRAY_BUFFER, ThisClass.SPFX_ArrayBuffer);\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ThisClass.SPFX_ElementArrayBuffer);\n    gl.frontFace(ThisClass.SPFX_FrontFace);\n    gl.depthFunc(ThisClass.SPFX_DepthFunc);\n    gl.depthMask(ThisClass.SPFX_DepthWriteMask);\n    gl.blendFuncSeparate(ThisClass.SPFX_BlendSrcRgb, ThisClass.SPFX_BlendDstRgb, ThisClass.SPFX_BlendSrcAlpha, ThisClass.SPFX_BlendDstAlpha);\n    ThisClass.SPFX_StencilTestEnabled ? gl.enable(gl.STENCIL_TEST) : gl.disable(gl.STENCIL_TEST);\n    ThisClass.SPFX_DepthTestEnabled ? gl.enable(gl.DEPTH_TEST) : gl.disable(gl.DEPTH_TEST);\n    ThisClass.SPFX_CullFaceEnabled ? gl.enable(gl.CULL_FACE) : gl.disable(gl.CULL_FACE);\n    ThisClass.SPFX_BlendEnabled ? gl.enable(gl.BLEND) : gl.disable(gl.BLEND);\n    for (let i = 0; i < 8; i++) {\n        gl.activeTexture(gl.TEXTURE0 + i);\n        gl.bindTexture(gl.TEXTURE_2D, ThisClass.SPFX_Texture[i]);\n    }\n    gl.activeTexture(ThisClass.SPFX_ActiveTexture);\n};\nSparkGearComponent.SPFX_Initialize = function (repository) {\n    const ThisClass = SparkGearComponent;\n    if (repository.currentWebGLContextWrapper == null) {\n        return;\n    }\n    ThisClass.SPFX_WebGLResourceRepository = repository;\n    window.GLctx = ThisClass.SPFX_WebGLResourceRepository.currentWebGLContextWrapper.getRawContext();\n    ThisClass.SPARK_BackupStatus();\n    const glw = ThisClass.SPFX_WebGLResourceRepository.currentWebGLContextWrapper;\n    _SPARK_InitializeFor3D(glw.width, glw.height);\n    ThisClass.SPARK_RestoreStatus();\n    ThisClass.__isInitialized = true;\n};\nSparkGearComponent.SPFX_Update = function (DeltaTime) {\n    _SPARK_Update(DeltaTime);\n};\n_foundation_core_ComponentRepository__WEBPACK_IMPORTED_MODULE_5__[\"default\"].registerComponentClass(SparkGearComponent);\n\n\n//# sourceURL=webpack:///./src/sparkgear/SparkGearComponent.ts?");

/***/ }),

/***/ "./src/sparkgear/main.ts":
/*!*******************************!*\
  !*** ./src/sparkgear/main.ts ***!
  \*******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _SparkGearComponent__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./SparkGearComponent */ \"./src/sparkgear/SparkGearComponent.ts\");\n/* harmony import */ var _foundation_core_EntityRepository__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../foundation/core/EntityRepository */ \"./src/foundation/core/EntityRepository.ts\");\n/* harmony import */ var _foundation_components_TransformComponent__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../foundation/components/TransformComponent */ \"./src/foundation/components/TransformComponent.ts\");\n/* harmony import */ var _foundation_components_SceneGraphComponent__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../foundation/components/SceneGraphComponent */ \"./src/foundation/components/SceneGraphComponent.ts\");\n\n\n\n\nconst createSparkGearEntity = function () {\n    const entityRepository = _foundation_core_EntityRepository__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getInstance();\n    const entity = entityRepository.createEntity([_foundation_components_TransformComponent__WEBPACK_IMPORTED_MODULE_2__[\"default\"], _foundation_components_SceneGraphComponent__WEBPACK_IMPORTED_MODULE_3__[\"default\"], _SparkGearComponent__WEBPACK_IMPORTED_MODULE_0__[\"default\"]]);\n    return entity;\n};\nconst SparkGear = Object.freeze({\n    SparkGearComponent: _SparkGearComponent__WEBPACK_IMPORTED_MODULE_0__[\"default\"],\n    createSparkGearEntity\n});\n/* harmony default export */ __webpack_exports__[\"default\"] = (SparkGear);\n\n\n//# sourceURL=webpack:///./src/sparkgear/main.ts?");

/***/ })

}]);