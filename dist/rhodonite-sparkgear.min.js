(window.webpackJsonp=window.webpackJsonp||[]).push([["sparkgear"],{67:function(e,t,a){"use strict";a.r(t);var r=a(15),n=a(20),_=a(5),s=a(10),i=a(31),S=a(12),o=a(18),P=a(35);class c extends r.a{constructor(e,t,a){super(e,t,a)}static get componentTID(){return n.a.SparkGearComponentTID}static common_$load(){if(c.__isInitialized)return;const e=P.a.getInstance().getModule("webgl");c.SPFX_Initialize(e.WebGLResourceRepository.getInstance())}$logic(){this.isPlaying()||this.play();const e=S.a.getInstance().getComponent(i.a,i.a.main);let t=c.__tmp_indentityMatrix,a=c.__tmp_indentityMatrix;e&&(t=e.viewMatrix,a=e.projectionMatrix),c.SPARK_SetCameraMatrix(t,a),c.SPFX_Update(1);const r=this.__sceneGraphComponent.worldMatrixInner;_SPARK_Instance_SetTransformFor3D(this.__hSPFXInst,r.v[0],r.v[4],r.v[8],r.v[12],r.v[1],r.v[5],r.v[9],r.v[13],r.v[2],r.v[6],r.v[10],r.v[14],r.v[3],r.v[7],r.v[11],r.v[15]),this.moveStageTo(_.a.Render)}$render(){this.onAfterRender(),this.moveStageTo(_.a.Logic)}$load(){if(null==this.url)return;const e=c;var t,a,r,n;t=this.url,a="arraybuffer",r=(t=>{var a=new Uint8Array(t);e.SPARK_BackupStatus();var r=window.Module.ccall("SPARK_Data_Create","number",["string","number","array","number"],[this.url,this.url.length,a,a.length]);this.__hSPFXInst=_SPARK_Instance_Create(r),_SPARK_Data_Delete(r),e.SPARK_RestoreStatus(),this.moveStageTo(_.a.Logic)}),(n=new XMLHttpRequest).open("GET",t,!0),n.responseType=a,n.onload=(()=>{switch(n.status){case 200:r(n.response);break;default:console.error("Failed to load ("+n.status+") : "+t)}}),n.send(null)}$create(){this.__sceneGraphComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,o.a),this.moveStageTo(_.a.Load)}onBeforeRender(){}onAfterRender(){const e=c;e.SPARK_BackupStatus(),_SPARK_Draw(this.__hSPFXInst),e.SPARK_RestoreStatus()}play(){_SPARK_Instance_Play(this.__hSPFXInst,1,!1,0)}stop(){_SPARK_Instance_Stop(this.__hSPFXInst)}pause(){_SPARK_Instance_Pause(this.__hSPFXInst)}isPlaying(){return _SPARK_Instance_IsPlaying(this.__hSPFXInst)}kickTrigger(e){_SPARK_Instance_KickTrigger(this.__hSPFXInst,e)}static SPARK_BackupStatus(){const e=c,t=e.SPFX_WebGLResourceRepository.currentWebGLContextWrapper.getRawContext();e.SPFX_ArrayBuffer=t.getParameter(t.ARRAY_BUFFER_BINDING),e.SPFX_ElementArrayBuffer=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING),e.SPFX_CurrentProgram=t.getParameter(t.CURRENT_PROGRAM),e.SPFX_FrontFace=t.getParameter(t.FRONT_FACE),e.SPFX_DepthFunc=t.getParameter(t.DEPTH_FUNC),e.SPFX_DepthWriteMask=t.getParameter(t.DEPTH_WRITEMASK),e.SPFX_StencilTestEnabled=t.isEnabled(t.STENCIL_TEST),e.SPFX_DepthTestEnabled=t.isEnabled(t.DEPTH_TEST),e.SPFX_CullFaceEnabled=t.isEnabled(t.CULL_FACE),e.SPFX_BlendEnabled=t.isEnabled(t.BLEND),e.SPFX_BlendSrcRgb=t.getParameter(t.BLEND_SRC_RGB),e.SPFX_BlendDstRgb=t.getParameter(t.BLEND_DST_RGB),e.SPFX_BlendSrcAlpha=t.getParameter(t.BLEND_SRC_ALPHA),e.SPFX_BlendDstAlpha=t.getParameter(t.BLEND_DST_ALPHA),e.SPFX_ActiveTexture=t.getParameter(t.ACTIVE_TEXTURE);for(let a=0;a<8;a++)t.activeTexture(t.TEXTURE0+a),e.SPFX_Texture[a]=t.getParameter(t.TEXTURE_BINDING_2D);t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1)}static SPFX_Uninitialize(){const e=c;e.SPARK_BackupStatus(),_SPARK_Uninitialize(),e.SPARK_RestoreStatus()}static SPARK_SetCameraMatrix(e,t){_SPARK_SetMatrix(0,e.v[0],e.v[1],e.v[2],e.v[3],e.v[4],e.v[5],e.v[6],e.v[7],e.v[8],e.v[9],e.v[10],e.v[11],e.v[12],e.v[13],e.v[14],e.v[15]),_SPARK_SetMatrix(1,t.v[0],t.v[1],t.v[2],t.v[3],t.v[4],t.v[5],t.v[6],t.v[7],t.v[8],t.v[9],t.v[10],t.v[11],t.v[12],t.v[13],t.v[14],t.v[15])}static SPARK_Draw(){const e=c;e.SPARK_BackupStatus(),_SPARK_DrawAll(),e.SPARK_RestoreStatus()}static SPARK_DrawDebugInfo(e){const t=c;t.SPARK_BackupStatus(),_SPARK_DrawDebugInfo(e),t.SPARK_RestoreStatus()}}c.__isInitialized=!1,c.SPFX_Texture=[],c.__tmp_indentityMatrix=s.a.identity(),c.SPARK_RestoreStatus=function(){const e=c,t=e.SPFX_WebGLResourceRepository.currentWebGLContextWrapper.getRawContext();t.useProgram(e.SPFX_CurrentProgram),t.bindBuffer(t.ARRAY_BUFFER,e.SPFX_ArrayBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.SPFX_ElementArrayBuffer),t.frontFace(e.SPFX_FrontFace),t.depthFunc(e.SPFX_DepthFunc),t.depthMask(e.SPFX_DepthWriteMask),t.blendFuncSeparate(e.SPFX_BlendSrcRgb,e.SPFX_BlendDstRgb,e.SPFX_BlendSrcAlpha,e.SPFX_BlendDstAlpha),e.SPFX_StencilTestEnabled?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),e.SPFX_DepthTestEnabled?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),e.SPFX_CullFaceEnabled?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),e.SPFX_BlendEnabled?t.enable(t.BLEND):t.disable(t.BLEND);for(let a=0;a<8;a++)t.activeTexture(t.TEXTURE0+a),t.bindTexture(t.TEXTURE_2D,e.SPFX_Texture[a]);t.activeTexture(e.SPFX_ActiveTexture)},c.SPFX_Initialize=function(e){const t=c;if(null==e.currentWebGLContextWrapper)return;t.SPFX_WebGLResourceRepository=e,window.GLctx=t.SPFX_WebGLResourceRepository.currentWebGLContextWrapper.getRawContext(),t.SPARK_BackupStatus();const a=t.SPFX_WebGLResourceRepository.currentWebGLContextWrapper;_SPARK_InitializeFor3D(a.width,a.height),t.SPARK_RestoreStatus(),t.__isInitialized=!0},c.SPFX_Update=function(e){_SPARK_Update(e)},S.a.registerComponentClass(c);var R=a(40),l=a(34);const u=Object.freeze({SparkGearComponent:c,createSparkGearEntity:function(){return R.a.getInstance().createEntity([l.a,o.a,c])}});t.default=u}}]);